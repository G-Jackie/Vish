var i18n = {"vish":{"es":{"i.walk1":"Puedes utilizar el icono tutorial", "i.walk2":'durante las secciones de la aplicaci\u00f3n para servirte de ayuda a la hora de utilizar el "ViSH Editor". De esta manera podr\u00e1s aprender a utilizar el programa desde sus funciones b\u00e1sicas hasta la publicaci\u00f3n final de tu excursi\u00f3n. Pulsa "Siguiente" para continuar.', "i.walk3":'Este espacio te permite a\u00f1adir el t\u00edtulo de tu excursi\u00f3n.El t\u00edtulo de la excursi\u00f3n es obligatorio ya que gracias a el, otros usuarios podr\u00e1n encontrarla mas f\u00e1cilmente dentro del ViSH. Pulsa "Siguiente" para continuar.', 
"i.walk4":'En este espacio puedes explicar en mas detalle los conceptos e ideas de tu excursi\u00f3n, as\u00ed como los datos que consideres interesantes para que los usuarios sepan el contenido de esta. Pulsa "Siguiente" para continuar.', "i.walk5":'A\u00f1ade palabras que vayan acorde con el tema de tu excursi\u00f3n para que esta aparezca a la hora de que los usuarios busquen temas dentro del ViSH. Pulsa "Siguiente" para continuar.', "i.walk6":'Escoge una de estas im\u00e1genes para representar tu excursi\u00f3n dentro del ViSH.Utiliza las flechas de los laterales o los circulos en la parte inferior de la galer\u00eda para ver todas las im\u00e1genes y escoger una. Pulsa "Siguiente" para continuar.', 
"i.walk7":'Una vez que cierres el tutorial pulsando el bot\u00f3n "cerrar", haz clic en el bot\u00f3n continuar situado debajo de este. De esta manera salvaras los detalles de tu excursi\u00f3n y podr\u00e1s comenzar a a\u00f1adir contenido a esta.', "i.walk8":'Bienvenido, este es el escritorio de ViSH Editor, desde aqu\u00ed, aprender\u00e1s a realizar excursiones paso a paso. Pulsa "Siguiente" para continuar.', "i.walk9":'En esta zona podr\u00e1s ver las opciones principales para crear y editar una excursi\u00f3n virtual dentro de ViSH. Pulsa "Siguiente" para continuar.', 
"i.walk10":'Haciendo clic en este bot\u00f3n, podr\u00e1s volver a ver la pantalla principal donde a\u00f1adiste la informaci\u00f3n a tu excursi\u00f3n. Pulsa "Siguiente" para continuar.', "i.walk11":'Esta zona se utiliza para definir el paginado de tu excursi\u00f3n, a trav\u00e9s de esta secci\u00f3n podr\u00e1s crear, moverte y editar cualquiera de las paginas de tu excursi\u00f3n. Pulsa "Siguiente" para continuar.', "i.walk12":'A Trav\u00e9s de este bot\u00f3n podr\u00e1s salvar y publicar tus excursiones en ViSH. Pulsa "Siguiente" para continuar.', 
"i.walk13":'Este icono te llevar\u00e1 a la ventana de selecci\u00f3n de plantillas para a\u00f1adir paginas a tu excursi\u00f3n. Cuando a\u00f1adas una nueva p\u00e1gina te aparecer\u00e1 a modo de icono en la l\u00ednea de tiempo para mostrarte su ubicaci\u00f3n dentro del paginado de la excursi\u00f3n. Pulsa "Cerrar" para continuar.', "i.walk14":'Esta zona te ofrece una variedad de plantillas para a\u00f1adir a tu excursi\u00f3n. Solo tienes que hacer clic en la miniatura que m\u00e1s se ajuste a la informaci\u00f3n que quieras transmitir. Pulsa "Cerrar" para continuar.', 
"i.walk15":"Para rellenar la plantilla que has escogido, solo tienes que hacer clic en los espacios grises de esta. Si haces click dentro, te aparecer\u00e1n los siguientes iconos:", "i.walk16":"Si haces clic en uno de estos iconos (dependiendo de que tipo de contenido quieras a\u00f1adir a esa zona), te aparecer\u00e1 otra ventana que te ayudar\u00e1 en esta tarea, a excepci\u00f3n del icono de texto, que mostrar\u00e1 una barra en la zona superior con herramientas para tratar tu tipograf\u00eda y definir el estilo de texto.", 
"i.walk17":"Una vez hayas rellenado una zona gris con contenido, podr\u00e1s editarla volviendo a hacer clic en el espacio que contiene el contenido. En caso de que quieras borrar este contenido puedes hacer clic en el icono inferior derecho de cada zona gris rellena con contenido:", "i.walk18":"Si quisieras borrar una plantilla o cerrar ventanas en la aplicaci\u00f3n, deber\u00e1s usar el icono superior derecho:", "i.walk19":'Si necesitas cualquier otra ayuda con el contenido, siempre puedes utilizar los iconos "tutorial".', 
"i.walk20":"Esta ventana te ayudar\u00e1 a la hora de a\u00f1adir im\u00e1genes. Como puedes ver en la zona superior tienes las siguientes opciones:", "i.walk21":"(a\u00f1adir imagen desde un enlace)", "i.walk22":"(a\u00f1adir imagen subi\u00e9ndola al repositorio)", "i.walk23":"(a\u00f1adir imagen desde el repositorio)", "i.walk24":"(a\u00f1adir imagen desde flickr)", "i.walk25":'Ahora estas en la secci\u00f3n Url. Pulsa "Siguiente" para continuar.', "i.walk26":"Este espacio esta reservado para escribir o pegar un enlace que contenga una imagen, por ejemplo:", 
"i.walk27":'Los formatos de imagen soportados por la aplicaci\u00f3n son muy variados (jpg, tiff, png, etc...) Una vez hayas rellenado el espacio, haz clic en el bot\u00f3n "previsualizar".Haz clic en "Continuar".', "i.walk28":'Esta zona te mostrar\u00e1 el contenido que has subido antes de a\u00f1adirlo a la presentaci\u00f3n, de esta manera puedes comprobarlo. Una vez est\u00e9s listo, haz clic en el bot\u00f3n de a\u00f1adir contenido (Este bot\u00f3n aparecer\u00e1 cuando pulses el bot\u00f3n previsualizar). Haz clic en "cerrar" para terminar este tutorial.', 
"i.walk29":'Pulsa en examinar para acceder a una nueva ventana y buscar un archivo en tu disco duro.Una vez lo hayas elegido, haz click en el bot\u00f3n "previsualizar.Haz clic en "Continuar".', "i.walk30":'En este espacio puedes buscar im\u00e1genes dentro del repositorio. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de im\u00e1genes de las cuales solo debes pulsar encima de una de ellas para a\u00f1adirla a tu presentaci\u00f3n..Haz clic en "cerrar" para terminar este tutorial.', 
"i.walk31":'En este espacio puedes buscar im\u00e1genes en la pagina Flickr. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de im\u00e1genes de las cuales solo debes pulsar encima de una de ellas para a\u00f1adirla a tu presentaci\u00f3n..Haz clic en "cerrar" para terminar este tutorial.', "i.walk32":"Esta ventana te ayudar\u00e1 a la hora de a\u00f1adir contenidos Object. Como puedes ver en la zona superior tienes las siguientes opciones:", "i.walk33":"(a\u00f1adir contenido desde un enlace)", 
"i.walk34":"(a\u00f1adir contenido subi\u00e9ndolo al repositorio)", "i.walk35":"(a\u00f1adir contenido desde el repositorio)", "i.walk36":'Ahora estas en la secci\u00f3n Embed.Haz clic en "Continuar".', "i.walk37":"Este espacio esta reservado para escribir o pegar un enlace que contenga un contenidos flash, web etc... por ejemplo:", "i.walk38":'Una vez hayas rellenado el espacio, haz click en el bot\u00f3n "previsualizar".Haz click en "Continuar".', "i.walk39":'Pulsa en examinar para acceder a una nueva ventana y buscar un archivo en tu disco duro.Una vez lo hayas elegido, haz click en el bot\u00f3n "previsualizar".Haz click en "Continuar".', 
"i.walk40":'En este espacio puedes buscar contenido dentro del repositorio. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de im\u00e1genes de las cuales solo debes pulsar encima de una de ellas para acceder a una peque\u00f1a ventana con t\u00edtulo y descripci\u00f3n mas detallada del contenido que te ofrecer\u00e1 la posibilidad de a\u00f1adir el contenido. Solo debes pulsar ese bot\u00f3n para realizar esa tarea..Haz click en "cerrar" para terminar este tutorial.', 
"i.walk41":"Esta ventana te ayudar\u00e1 a la hora de a\u00f1adir im\u00e1genes. Como puedes ver en la zona superior tienes las siguientes opciones:", "i.walk42":"(a\u00f1adir v\u00eddeo desde un enlace)", "i.walk43":"(a\u00f1adir v\u00eddeo desde el repositorio)", "i.walk44":"(a\u00f1adir v\u00eddeo desde youtube)", "i.walk45":"(a\u00f1adir v\u00eddeo desde vimeo)", "i.walk46":'Ahora estas en la secci\u00f3n Url.Haz click en "Continuar".', "i.walk47":"Este espacio esta reservardo para escribir o pegar un enlace que contenga una imagen, por ejemplo:", 
"i.walk48":'Los formatos de v\u00eddeo soportados por la aplicaci\u00f3n son muy variados (avi, flv, mpg...).Una vez hayas rellenado el espacio, haz click en el bot\u00f3n "previsualizar".Haz click en "Continuar".', "i.walk49":'En este espacio puedes buscar v\u00eddeos dentro del repositorio. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de v\u00eddeos de las cuales solo debes pulsar encima de uno de ellas para acceder a una peque\u00f1a ventana con t\u00edtulo y descripci\u00f3n mas detallada del contenido que te ofrecera la posibilidad de a\u00f1adir el v\u00eddeo. Solo debes pulsar ese bot\u00f3n para realizar esa tarea..Haz click en "cerrar" para terminar este tutorial.', 
"i.walk50":'En este espacio puedes buscar v\u00eddeos dentro de youtube. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de v\u00eddeos de las cuales solo debes pulsar encima de uno de ellas para acceder a una peque\u00f1a ventana con t\u00edtulo y descripci\u00f3n mas detallada del contenido que te ofrecera la posibilidad de a\u00f1adir el v\u00eddeo. Solo debes pulsar ese bot\u00f3n para realizar esa tarea..Haz click en "cerrar" para terminar este tutorial.', 
"i.walk51":'En este espacio puedes buscar v\u00eddeos dentro de vimeo. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda de v\u00eddeos de las cuales solo debes pulsar encima de uno de ellas para acceder a una peque\u00f1a ventana con t\u00edtulo y descripci\u00f3n mas detallada del contenido que te ofrecera la posibilidad de a\u00f1adir el v\u00eddeo. Solo debes pulsar ese bot\u00f3n para realizar esa tarea..Haz click en "cerrar" para terminar este tutorial.', 
"i.walk52":"Esta ventana te ayudar\u00e1 a la hora de a\u00f1adir contenido en directo. Como puedes ver en la zona superior tienes de momento la siguiente opci\u00f3n:", "i.walk53":"(a\u00f1adir v\u00eddeo desde una camara en directo)", "i.walk54":'Ahora estas en la secci\u00f3n Webcam. Haz click en "Continuar"', "i.walk55":'En este espacio puedes buscar contenido en directo dentro del repositorio. Solamente escribe lo que busques y en la zona inferior te aparecer\u00e1 una galer\u00eda, desde la cual solo debes pulsar encima del contenido para acceder a una peque\u00f1a ventana con t\u00edtulo y descripci\u00f3n mas detallada del contenido que te ofrecera la posibilidad de a\u00f1adirlo. Solo debes pulsar ese bot\u00f3n para realizar esa tarea..Haz click en "cerrar" para terminar este tutorial.', 
"i.walk56":"Una Flashcard es una aplicaci\u00f3n que te ayudar\u00e1 a representar tu excursi\u00f3n como una infograf\u00eda, usando una imagen para representar el concepto de la misma y marcando las zonas para que el usuario interactue con ellas de manera que pueda visualizar las paginas de la excursi\u00f3n.", "i.walk57":"Primero, utiliza estos iconos para a\u00f1adir una imagen de fondo.", "i.walk58":"Puedes a\u00f1adir im\u00e1genes por:", "i.walk59":"Una vez hecho esto, puedes arrastrar las flechas de la zona inferior hacia la flashcard para marcar la zona de cada p\u00e1gina dentro de esta", 
"i.walk60":"Puedes previsualizar la flashcard en cualquier momento utilizando el icono de previsualizar.", "i.walk61":"Si salvas tu presentaci\u00f3n como una flashcard, se mostrar\u00e1 como tal, pero en cualquier momento puedes editarla y mostrarla como una presentaci\u00f3n normal de nuevo.", "i.walk62":"Haciendo click en este bot\u00f3n, podr\u00e1s previsualizar tu excursi\u00f3n como si ya estuviese publicada.", "i.walk63":"Este bot\u00f3n te permitir\u00e1 escojer entre varias opciones para tu excursion:", 
"i.walk64":"Utilizando este menu puedes salvar tu excursi\u00f3n, convertir tu presentaci\u00f3n a flashcard, previsualizar tu excursi\u00f3n antes de publicarla, cambiar los detalles de tu excursi\u00f3n y utilizar este tutorial cada vez que lo necesites", "i.walk65":"Muchas de estas opciones est\u00e1n en el espacio de ViSH Editor, pero siempre podr\u00e1s encontrarlas aqu\u00ed de igual manera.", "i.walk66":"Utilizando este bot\u00f3n  podr\u00e1s visualizar el tutorial principal de la aplicaci\u00f3n ViSH Editor", 
"i.walk67":"Utilizando este bot\u00f3n acceder\u00e1s a la selecci\u00f3n de un tema visual para representar tu excursi\u00f3n.", "i.walk68":"Este espacio contiene todas las opciones para interactuar con tu contenido:", "i.walk69":"Todas las veces en las que a\u00f1adas o selecciones contenido en tu excursi\u00f3n, esta barra de herramientas se activar\u00e1 para que puedas interacturar con tu contenido.", "i.walk70":"Escoje entre los diferentes temas que m\u00e1s representen tu excursi\u00f3n. La primera linea de temas contiene degradados y colores vibrantes, la segunda linea esta compuesta por texturas suaves, la ultima linea imita los objectos de la vida real y por \u00faltimo, el \u00faltimo tema contiene una suave animaci\u00f3n para darle a tu excursi\u00f3n un toque especial. \u00a1Disfr\u00fatalos!", 
"i.walk71":"(A\u00f1adir p\u00e1gina web)", "i.walk72":"(A\u00f1adir Captura de p\u00e1gina web)", "i.walk73":"A\u00f1adir p\u00e1gina web", "i.walk74":"A\u00f1adir Captura de p\u00e1gina web", "i.walk75":'Esta zona te ofrece una variedad de Quizes para a\u00f1adir a tu excursi\u00f3n. Solo tienes que hacer clic en la miniatura que m\u00e1s se ajuste a la informaci\u00f3n que quieras transmitir. Pulsa "Cerrar" para continuar.', "i.link":"A\u00f1adir url", "i.resize":"Redimensionar", "i.flashcardbg":"Fondo de flashcard", 
"i.text":"Texto", "i.themesButton":"ViSH Editor Themes", "i.toolbarButton":"Barra de herramientas", "i.themesTitle":"Selecci\u00f3n de temas", "i.pic.add":"a\u00f1adir URL de imagen", "i.browserrequirements":"El navegador que estas utilizando no cumple los requisitos minimos para utilizar esta aplicaci\u00f3n. Por favor, actualiza tu navegador", "i.accept":"aceptar", "i.Add":"A\u00f1adir", "i.add":"a\u00f1adir", "i.AddContent":"A\u00f1adir Contenido", "i.AddSlide":"A\u00f1adir bot\u00f3n de nueva slide", 
"i.Addv\u00eddeoUrl":"a\u00f1adir URL de v\u00eddeo", "i.AddTags":"A\u00f1ade tags a tu excursi\u00f3n", "i.AddSlideContent":"A\u00f1adiendo contenido a una slide", "i.AddObjectContent":"A\u00f1adiendo contenido Object", "i.AddObjectContentUpload":"Subiendo contenido Object", "i.AddObjectContentUrl":"A\u00f1adiendo contenido Object por url", "i.AddImagesContent":"A\u00f1adiendo im\u00e1genes", "i.AddImagesContentUrl":"A\u00f1adiendo im\u00e1genes por url", "i.AddImagesContentUpload":"Subiendo im\u00e1genes", 
"i.Addv\u00eddeoContent":"A\u00f1adiendo v\u00eddeo", "i.Addv\u00eddeoContentUrl":"A\u00f1adiendo v\u00eddeo por url", "i.AddLiveContent":"A\u00f1adiendo Contenido en Directo", "i.age_range":"Rango de edad", "i.sure":"\u00bfest\u00e1 seguro?", "i.cancel":"cancelar", "i.closeOrDelete":"Borrar o Cerrar", "i.close":"cerrar", "i.Close":"Cerrar", "i.Competencies":"Competencias adquiridas", "i.CompetenciesPlaceholder":"Describa aqu\u00ed las competencias que los estudiantes adquirir\u00e1n con esta excursi\u00f3n", 
"i.continue":"Continuar", "i.Content":"Contenido", "i.done":"Hecho", "i.oneSlideAlert":"Debe crear al menos una slide antes de salvar", "i.thumbnailsChoosing":"Elige una imagen que representar\u00e1 tu excursi\u00f3n", "i.configButton":"Bot\u00f3n de configuraci\u00f3n", "i.delete":"borrar", "i.deleteContent":"Borrar contenido", "i.presDescriptionPlaceHolder":"Describa la excursi\u00f3n en unas palabras", "i.Description":"Descripci\u00f3n", "i.Editdetails":"Editar detalles", "i.Educational":"Objetivos educacionales", 
"i.EducationalPlaceholder":"Describa aqu\u00ed los objetivos educacionales de la excursi\u00f3n", "i.Flashcard":"Flashcard", "i.Flashcards":"Flashcards", "i.presTitle":"T\u00edtulo de la excursi\u00f3n", "i.tutorialButton":"Bot\u00f3n de tutorial", "i.previewButton":"Bot\u00f3n de previsualizaci\u00f3n", "i.menuButton":"Men\u00fa de ViSH Editor", "i.objectContent":"Contenido Flash", "i.Image":"Imagen", "i.Images":"Im\u00e1genes", "i.Insert":"Insertar", "i.v\u00eddeo":"v\u00eddeo", "i.v\u00eddeos":"v\u00eddeos", 
"i.Text":"Texto", "i.Object":"Objeto", "i.language":"Idioma", "i.Live":"Contenidos en directo", "i.writeTitle":"Escribamos un t\u00edtulo (obligatorio)", "i.no":"no", "i.No":"No", "i.next":"siguiente", "i.Next":"Siguiente", "i.OK":"OK", "i.enterTitle":"Por favor, introduzca un t\u00edtulo", "i.preview":"Vista previa", "i.save":"guardar", "i.Save":"Guardar", "i.SaveButton":"Bot\u00f3n de salvar", "i.SaveSlides":"Salvar las diapositivas", "i.SavePresentationDetails":"Salva los detalles de tu excursi\u00f3n", 
"i.SearchContent":"Buscar contenido", "i.SearchObjectContent":"Buscar contenido flash", "i.SearchImagesFlickr":"Buscar im\u00e1genes en Flickr", "i.SearchImagesVish":"Buscar im\u00e1genes en el repositorio ViSH", "i.Searchv\u00eddeosVimeo":"Buscar v\u00eddeos en Vimeo", "i.Searchv\u00eddeosVish":"Buscar v\u00eddeos en el repositorio del ViSH", "i.Searchv\u00eddeosYoutube":"Buscar v\u00eddeos en Youtube", "i.SearchLiveContent":"Buscar contenido en directo", "i.SeeContentBefore":"Puedes ver el contenido antes de a\u00f1adirlo", 
"i.SeeImageBefore":"Puedes ver las im\u00e1genes antes de a\u00f1adirlas", "i.Seev\u00eddeoBefore":"Puedes ver el v\u00eddeo antes de a\u00f1adirlo", "i.selectPicture":"Seleccionar imagen para subir", "i.selectObject":"Seleccionar archivo swf para subir", "i.selectSlide":"Seleccionando una slide", "i.selectTheme":"Seleccionar tema", "i.selectquiz":"Seleccionar Quiz", "i.slidesmenu":"Este es el menu de slides", "i.Subject":"Tema", "i.TeachingGuidelines":"Orientaciones did\u00e1cticas", "i.Title":"T\u00edtulo", 
"i.thisIsVishEditor":"\u00a1Esto es el ViSH Editor!", "i.thisIsToolsMenu":"Esto es el men\u00fa de herramientas", "i.welcomeVishEditor":"\u00a1Bienvenidos a ViSH Editor!", "i.Url":"Enlace", "i.url":"Enlace", "i.Upload":"Subir", "i.OwnImages":"Subir tus propias im\u00e1genes", "i.upload":"Subir", "i.Thumbnail":"Miniatura", "i.WriteDescription":"Escribe una descripci\u00f3n (opcional)", "i.ConvertTo":"Convertir a", "i.Settings":"Ajustes", "i.Help":"Ayuda", "i.ExportAs":"Exportar como", "i.File":"Archivo", 
"i.Presentation":"Presentaci\u00f3n", "i.WysiwygInit":"Insertar texto aqu\u00ed", "i.embedObject":"embeber objeto", "i.embedWebsites":"embeber web", "i.html5App":"Aplicaci\u00f3n HTML5", "i.Game":"Juego", "i.VirtualTour":"Virtual Tour", "i.vExperiment":"Experimento virtual", "i.changeBackground":"Cambiar fondo", "i.Microscopes":"Microscopios", "i.AddTags":"A\u00f1adir etiquetas", "i.limitReached":"limite alcanzado", "i.Templates":"Plantillas", "i.Author":"Autor", "i.draft":"Borrador", "i.publish":"Publicar", 
"i.wysiwyg.addurl":"A\u00f1adir enlace", "i.exitConfirmation":"Vas a abandonar esta pagina. Se perder\u00e1n todos los cambios que no hayas salvado.", "i.Remove":"Borrar"}, "default":{"i.Author":"Author", "i.AddTags":"Add tags", "i.Add":"Add", "i.add":"add", "i.WysiwygInit":"Insert text here", "i.SearchContent":"Search Content", "i.Description":"Description", "i.limitReached":"limit reached", "i.wysiwyg.addurl":"Add link", "i.Title":"T\u00edtulo", "i.exitConfirmation":"You are about to leave this website. You will lose any changes you have not saved."}}, 
"standalone":{"es":{"i.save":"Standalone"}, "default":{"i.save":"Standalone"}}};
var VISH = VISH || {};
VISH.VERSION = "0.5";
VISH.AUTHORS = "GING";
VISH.URL = "http://github.com/ging/vish_editor";
VISH.Constant = VISH.Constant || {};
VISH.Constant.Edit = "Editor";
VISH.Constant.Viewer = "Viewer";
VISH.Constant.AnyMode = "Both";
VISH.Constant.NOSERVER = "noserver";
VISH.Constant.VISH = "vish";
VISH.Constant.STANDALONE = "node";
VISH.Constant.UA_IE = "Microsoft Internet Explorer";
VISH.Constant.UA_NETSCAPE = "Netscape";
VISH.Constant.IE = "Internet Explorer";
VISH.Constant.FIREFOX = "Mozilla Firefox";
VISH.Constant.CHROME = "Google Chrome";
VISH.Constant.SAFARI = "Safari";
VISH.Constant.ANDROID_BROWSER = "Android Browser";
VISH.Constant.EXTRA_SMALL = "extra-small";
VISH.Constant.SMALL = "small";
VISH.Constant.MEDIUM = "medium";
VISH.Constant.LARGE = "large";
VISH.Constant.THUMBNAIL = "thumbnail";
VISH.Constant.NONE = "none";
VISH.Constant.UNKNOWN = "Unknown";
VISH.Constant.AGE_RANGE = "4 - 20";
VISH.Constant.PRESENTATION = "presentation";
VISH.Constant.STANDARD = "standard";
VISH.Constant.FLASHCARD = "flashcard";
VISH.Constant.QUIZ_SIMPLE = "quiz_simple";
VISH.Constant.GAME = "game";
VISH.Constant.VTOUR = "VirtualTour";
VISH.Constant.TEXT = "text";
VISH.Constant.IMAGE = "image";
VISH.Constant.VIDEO = "video";
VISH.Constant.OBJECT = "object";
VISH.Constant.SNAPSHOT = "snapshot";
VISH.Constant.APPLET = "applet";
VISH.Constant.QUIZ = "quiz";
VISH.Constant.QZ_TYPE = {};
VISH.Constant.QZ_TYPE.OPEN = "open";
VISH.Constant.QZ_TYPE.MCHOICE = "multiplechoice";
VISH.Constant.QZ_TYPE.TF = "truefalse";
VISH.Constant.QZ_MODE = {};
VISH.Constant.QZ_MODE.SELFA = "selfA";
VISH.Constant.QZ_MODE.RT = "realTime";
VISH.Constant.TextDefault = 12;
VISH.Constant.TextBase = 12;
VISH.Constant.Video = {};
VISH.Constant.Video.HTML5 = "HTML5";
VISH.Constant.Video.Youtube = "Youtube";
VISH.Constant.Clipboard = {};
VISH.Constant.Clipboard.Slide = "slide";
VISH.Constant.Clipboard.LocalStorageStack = "VishEditorClipboardStack";
VISH.Constant.Themes = {};
VISH.Constant.Themes.Default = "theme1";
VISH.Constant.Event = {};
VISH.Constant.Event.onMessage = "onMessage";
VISH.Constant.Event.onGoToSlide = "onGoToSlide";
VISH.Constant.Event.onPlayVideo = "onPlayVideo";
VISH.Constant.Event.onPauseVideo = "onPauseVideo";
VISH.Constant.Event.onSeekVideo = "onSeekVideo";
VISH.Constant.Event.onFlashcardPointClicked = "onFlashcardPointClicked";
VISH.Constant.Event.onFlashcardSlideClosed = "onFlashcardSlideClosed";
VISH.Constant.Event.onSetSlave = "onSetSlave";
VISH.Constant.Event.onPreventDefault = "onPreventDefault";
VISH.Constant.Event.allowExitWithoutConfirmation = "allowExitWithoutConfirmation";
VISH.Constant.Event.onSelectedSlides = "onSelectedSlides";
VISH.Constant.Storage = {};
VISH.Constant.Storage.Device = "Device";
VISH.Constant.VTour = {};
VISH.Constant.VTour.DEFAULT_MAP = "roadmap";
VISH.Constant.VTour.ROADMAP = "roadmap";
VISH.Constant.INTRO = 13;
window.Chart = function(context) {
  var chart = this;
  var animationOptions = {linear:function(t) {
    return t
  }, easeInQuad:function(t) {
    return t * t
  }, easeOutQuad:function(t) {
    return-1 * t * (t - 2)
  }, easeInOutQuad:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t
    }
    return-1 / 2 * (--t * (t - 2) - 1)
  }, easeInCubic:function(t) {
    return t * t * t
  }, easeOutCubic:function(t) {
    return 1 * ((t = t / 1 - 1) * t * t + 1)
  }, easeInOutCubic:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t
    }
    return 1 / 2 * ((t -= 2) * t * t + 2)
  }, easeInQuart:function(t) {
    return t * t * t * t
  }, easeOutQuart:function(t) {
    return-1 * ((t = t / 1 - 1) * t * t * t - 1)
  }, easeInOutQuart:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t * t
    }
    return-1 / 2 * ((t -= 2) * t * t * t - 2)
  }, easeInQuint:function(t) {
    return 1 * (t /= 1) * t * t * t * t
  }, easeOutQuint:function(t) {
    return 1 * ((t = t / 1 - 1) * t * t * t * t + 1)
  }, easeInOutQuint:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t * t * t
    }
    return 1 / 2 * ((t -= 2) * t * t * t * t + 2)
  }, easeInSine:function(t) {
    return-1 * Math.cos(t / 1 * (Math.PI / 2)) + 1
  }, easeOutSine:function(t) {
    return 1 * Math.sin(t / 1 * (Math.PI / 2))
  }, easeInOutSine:function(t) {
    return-1 / 2 * (Math.cos(Math.PI * t / 1) - 1)
  }, easeInExpo:function(t) {
    return t == 0 ? 1 : 1 * Math.pow(2, 10 * (t / 1 - 1))
  }, easeOutExpo:function(t) {
    return t == 1 ? 1 : 1 * (-Math.pow(2, -10 * t / 1) + 1)
  }, easeInOutExpo:function(t) {
    if(t == 0) {
      return 0
    }
    if(t == 1) {
      return 1
    }
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * Math.pow(2, 10 * (t - 1))
    }
    return 1 / 2 * (-Math.pow(2, -10 * --t) + 2)
  }, easeInCirc:function(t) {
    if(t >= 1) {
      return t
    }
    return-1 * (Math.sqrt(1 - (t /= 1) * t) - 1)
  }, easeOutCirc:function(t) {
    return 1 * Math.sqrt(1 - (t = t / 1 - 1) * t)
  }, easeInOutCirc:function(t) {
    if((t /= 1 / 2) < 1) {
      return-1 / 2 * (Math.sqrt(1 - t * t) - 1)
    }
    return 1 / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1)
  }, easeInElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1) == 1) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    return-(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p))
  }, easeOutElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1) == 1) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    return a * Math.pow(2, -10 * t) * Math.sin((t * 1 - s) * 2 * Math.PI / p) + 1
  }, easeInOutElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1 / 2) == 2) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3 * 1.5
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    if(t < 1) {
      return-0.5 * a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p)
    }
    return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p) * 0.5 + 1
  }, easeInBack:function(t) {
    var s = 1.70158;
    return 1 * (t /= 1) * t * ((s + 1) * t - s)
  }, easeOutBack:function(t) {
    var s = 1.70158;
    return 1 * ((t = t / 1 - 1) * t * ((s + 1) * t + s) + 1)
  }, easeInOutBack:function(t) {
    var s = 1.70158;
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * (((s *= 1.525) + 1) * t - s)
    }
    return 1 / 2 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2)
  }, easeInBounce:function(t) {
    return 1 - animationOptions.easeOutBounce(1 - t)
  }, easeOutBounce:function(t) {
    if((t /= 1) < 1 / 2.75) {
      return 1 * 7.5625 * t * t
    }else {
      if(t < 2 / 2.75) {
        return 1 * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75)
      }else {
        if(t < 2.5 / 2.75) {
          return 1 * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375)
        }else {
          return 1 * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375)
        }
      }
    }
  }, easeInOutBounce:function(t) {
    if(t < 1 / 2) {
      return animationOptions.easeInBounce(t * 2) * 0.5
    }
    return animationOptions.easeOutBounce(t * 2 - 1) * 0.5 + 1 * 0.5
  }};
  var width = context.canvas.width;
  var height = context.canvas.height;
  if(window.devicePixelRatio) {
    context.canvas.style.width = width + "px";
    context.canvas.style.height = height + "px";
    context.canvas.height = height * window.devicePixelRatio;
    context.canvas.width = width * window.devicePixelRatio;
    context.scale(window.devicePixelRatio, window.devicePixelRatio)
  }
  this.PolarArea = function(data, options) {
    chart.PolarArea.defaults = {scaleOverlay:true, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleShowLine:true, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowLabelBackdrop:true, scaleBackdropColor:"rgba(255,255,255,0.75)", scaleBackdropPaddingY:2, scaleBackdropPaddingX:2, segmentShowStroke:true, segmentStrokeColor:"#fff", 
    segmentStrokeWidth:2, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.PolarArea.defaults, options) : chart.PolarArea.defaults;
    return new PolarArea(data, config, context)
  };
  this.Radar = function(data, options) {
    chart.Radar.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleShowLine:true, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:false, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowLabelBackdrop:true, scaleBackdropColor:"rgba(255,255,255,0.75)", scaleBackdropPaddingY:2, scaleBackdropPaddingX:2, angleShowLineOut:true, angleLineColor:"rgba(0,0,0,.1)", 
    angleLineWidth:1, pointLabelFontFamily:"'Arial'", pointLabelFontStyle:"normal", pointLabelFontSize:12, pointLabelFontColor:"#666", pointDot:true, pointDotRadius:3, pointDotStrokeWidth:1, datasetStroke:true, datasetStrokeWidth:2, datasetFill:true, animation:true, animationSteps:60, animationEasing:"easeOutQuart", onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.Radar.defaults, options) : chart.Radar.defaults;
    return new Radar(data, config, context)
  };
  this.Pie = function(data, options) {
    chart.Pie.defaults = {segmentShowStroke:true, segmentStrokeColor:"#fff", segmentStrokeWidth:2, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.Pie.defaults, options) : chart.Pie.defaults;
    return new Pie(data, config, context)
  };
  this.Doughnut = function(data, options) {
    chart.Doughnut.defaults = {segmentShowStroke:true, segmentStrokeColor:"#fff", segmentStrokeWidth:2, percentageInnerCutout:50, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.Doughnut.defaults, options) : chart.Doughnut.defaults;
    return new Doughnut(data, config, context)
  };
  this.Line = function(data, options) {
    chart.Line.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowGridLines:true, scaleGridLineColor:"rgba(0,0,0,.05)", scaleGridLineWidth:1, bezierCurve:true, pointDot:true, pointDotRadius:4, pointDotStrokeWidth:2, datasetStroke:true, datasetStrokeWidth:2, 
    datasetFill:true, animation:true, animationSteps:60, animationEasing:"easeOutQuart", onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.Line.defaults, options) : chart.Line.defaults;
    return new Line(data, config, context)
  };
  this.Bar = function(data, options) {
    chart.Bar.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowGridLines:true, scaleGridLineColor:"rgba(0,0,0,.05)", scaleGridLineWidth:1, barShowStroke:true, barStrokeWidth:2, barValueSpacing:5, barDatasetSpacing:1, animation:true, animationSteps:60, 
    animationEasing:"easeOutQuart", onAnimationComplete:null};
    var config = options ? mergeChartConfig(chart.Bar.defaults, options) : chart.Bar.defaults;
    return new Bar(data, config, context)
  };
  var clear = function(c) {
    c.clearRect(0, 0, width, height)
  };
  var PolarArea = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : null;
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = maxSize / calculatedScale.steps;
    animationLoop(config, drawScale, drawAllSegments, ctx);
    function calculateDrawingSizes() {
      maxSize = Min([width, height]) / 2;
      maxSize -= Max([config.scaleFontSize * 0.5, config.scaleLineWidth * 0.5]);
      labelHeight = config.scaleFontSize * 2;
      if(config.scaleShowLabelBackdrop) {
        labelHeight += 2 * config.scaleBackdropPaddingY;
        maxSize -= config.scaleBackdropPaddingY * 1.5
      }
      scaleHeight = maxSize;
      labelHeight = Default(labelHeight, 5)
    }
    function drawScale() {
      for(var i = 0;i < calculatedScale.steps;i++) {
        if(config.scaleShowLine) {
          ctx.beginPath();
          ctx.arc(width / 2, height / 2, scaleHop * (i + 1), 0, Math.PI * 2, true);
          ctx.strokeStyle = config.scaleLineColor;
          ctx.lineWidth = config.scaleLineWidth;
          ctx.stroke()
        }
        if(config.scaleShowLabels) {
          ctx.textAlign = "center";
          ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
          var label = calculatedScale.labels[i];
          if(config.scaleShowLabelBackdrop) {
            var textWidth = ctx.measureText(label).width;
            ctx.fillStyle = config.scaleBackdropColor;
            ctx.beginPath();
            ctx.rect(Math.round(width / 2 - textWidth / 2 - config.scaleBackdropPaddingX), Math.round(height / 2 - scaleHop * (i + 1) - config.scaleFontSize * 0.5 - config.scaleBackdropPaddingY), Math.round(textWidth + config.scaleBackdropPaddingX * 2), Math.round(config.scaleFontSize + config.scaleBackdropPaddingY * 2));
            ctx.fill()
          }
          ctx.textBaseline = "middle";
          ctx.fillStyle = config.scaleFontColor;
          ctx.fillText(label, width / 2, height / 2 - scaleHop * (i + 1))
        }
      }
    }
    function drawAllSegments(animationDecimal) {
      var startAngle = -Math.PI / 2, angleStep = Math.PI * 2 / data.length, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * calculateOffset(data[i].value, calculatedScale, scaleHop), startAngle, startAngle + rotateAnimation * angleStep, false);
        ctx.lineTo(width / 2, height / 2);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(config.segmentShowStroke) {
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.stroke()
        }
        startAngle += rotateAnimation * angleStep
      }
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.length;i++) {
        if(data[i].value > upperValue) {
          upperValue = data[i].value
        }
        if(data[i].value < lowerValue) {
          lowerValue = data[i].value
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Radar = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString;
    if(!data.labels) {
      data.labels = []
    }
    calculateDrawingSizes();
    var valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : null;
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = maxSize / calculatedScale.steps;
    animationLoop(config, drawScale, drawAllDataPoints, ctx);
    function drawAllDataPoints(animationDecimal) {
      var rotationDegree = 2 * Math.PI / data.datasets[0].data.length;
      ctx.save();
      ctx.translate(width / 2, height / 2);
      for(var i = 0;i < data.datasets.length;i++) {
        ctx.beginPath();
        ctx.moveTo(0, animationDecimal * -1 * calculateOffset(data.datasets[i].data[0], calculatedScale, scaleHop));
        for(var j = 1;j < data.datasets[i].data.length;j++) {
          ctx.rotate(rotationDegree);
          ctx.lineTo(0, animationDecimal * -1 * calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop))
        }
        ctx.closePath();
        ctx.fillStyle = data.datasets[i].fillColor;
        ctx.strokeStyle = data.datasets[i].strokeColor;
        ctx.lineWidth = config.datasetStrokeWidth;
        ctx.fill();
        ctx.stroke();
        if(config.pointDot) {
          ctx.fillStyle = data.datasets[i].pointColor;
          ctx.strokeStyle = data.datasets[i].pointStrokeColor;
          ctx.lineWidth = config.pointDotStrokeWidth;
          for(var k = 0;k < data.datasets[i].data.length;k++) {
            ctx.rotate(rotationDegree);
            ctx.beginPath();
            ctx.arc(0, animationDecimal * -1 * calculateOffset(data.datasets[i].data[k], calculatedScale, scaleHop), config.pointDotRadius, 2 * Math.PI, false);
            ctx.fill();
            ctx.stroke()
          }
        }
        ctx.rotate(rotationDegree)
      }
      ctx.restore()
    }
    function drawScale() {
      var rotationDegree = 2 * Math.PI / data.datasets[0].data.length;
      ctx.save();
      ctx.translate(width / 2, height / 2);
      if(config.angleShowLineOut) {
        ctx.strokeStyle = config.angleLineColor;
        ctx.lineWidth = config.angleLineWidth;
        for(var h = 0;h < data.datasets[0].data.length;h++) {
          ctx.rotate(rotationDegree);
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.lineTo(0, -maxSize);
          ctx.stroke()
        }
      }
      for(var i = 0;i < calculatedScale.steps;i++) {
        ctx.beginPath();
        if(config.scaleShowLine) {
          ctx.strokeStyle = config.scaleLineColor;
          ctx.lineWidth = config.scaleLineWidth;
          ctx.moveTo(0, -scaleHop * (i + 1));
          for(var j = 0;j < data.datasets[0].data.length;j++) {
            ctx.rotate(rotationDegree);
            ctx.lineTo(0, -scaleHop * (i + 1))
          }
          ctx.closePath();
          ctx.stroke()
        }
        if(config.scaleShowLabels) {
          ctx.textAlign = "center";
          ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
          ctx.textBaseline = "middle";
          if(config.scaleShowLabelBackdrop) {
            var textWidth = ctx.measureText(calculatedScale.labels[i]).width;
            ctx.fillStyle = config.scaleBackdropColor;
            ctx.beginPath();
            ctx.rect(Math.round(-textWidth / 2 - config.scaleBackdropPaddingX), Math.round(-scaleHop * (i + 1) - config.scaleFontSize * 0.5 - config.scaleBackdropPaddingY), Math.round(textWidth + config.scaleBackdropPaddingX * 2), Math.round(config.scaleFontSize + config.scaleBackdropPaddingY * 2));
            ctx.fill()
          }
          ctx.fillStyle = config.scaleFontColor;
          ctx.fillText(calculatedScale.labels[i], 0, -scaleHop * (i + 1))
        }
      }
      for(var k = 0;k < data.labels.length;k++) {
        ctx.font = config.pointLabelFontStyle + " " + config.pointLabelFontSize + "px " + config.pointLabelFontFamily;
        ctx.fillStyle = config.pointLabelFontColor;
        var opposite = Math.sin(rotationDegree * k) * (maxSize + config.pointLabelFontSize);
        var adjacent = Math.cos(rotationDegree * k) * (maxSize + config.pointLabelFontSize);
        if(rotationDegree * k == Math.PI || rotationDegree * k == 0) {
          ctx.textAlign = "center"
        }else {
          if(rotationDegree * k > Math.PI) {
            ctx.textAlign = "right"
          }else {
            ctx.textAlign = "left"
          }
        }
        ctx.textBaseline = "middle";
        ctx.fillText(data.labels[k], opposite, -adjacent)
      }
      ctx.restore()
    }
    function calculateDrawingSizes() {
      maxSize = Min([width, height]) / 2;
      labelHeight = config.scaleFontSize * 2;
      var labelLength = 0;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.font = config.pointLabelFontStyle + " " + config.pointLabelFontSize + "px " + config.pointLabelFontFamily;
        var textMeasurement = ctx.measureText(data.labels[i]).width;
        if(textMeasurement > labelLength) {
          labelLength = textMeasurement
        }
      }
      maxSize -= Max([labelLength, config.pointLabelFontSize / 2 * 1.5]);
      maxSize -= config.pointLabelFontSize;
      maxSize = CapValue(maxSize, null, 0);
      scaleHeight = maxSize;
      labelHeight = Default(labelHeight, 5)
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Pie = function(data, config, ctx) {
    var segmentTotal = 0;
    var pieRadius = Min([height / 2, width / 2]) - 5;
    for(var i = 0;i < data.length;i++) {
      segmentTotal += data[i].value
    }
    animationLoop(config, null, drawPieSegments, ctx);
    function drawPieSegments(animationDecimal) {
      var cumulativeAngle = -Math.PI / 2, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        var segmentAngle = rotateAnimation * data[i].value / segmentTotal * Math.PI * 2;
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * pieRadius, cumulativeAngle, cumulativeAngle + segmentAngle);
        ctx.lineTo(width / 2, height / 2);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(config.segmentShowStroke) {
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.stroke()
        }
        cumulativeAngle += segmentAngle
      }
    }
  };
  var Doughnut = function(data, config, ctx) {
    var segmentTotal = 0;
    var doughnutRadius = Min([height / 2, width / 2]) - 5;
    var cutoutRadius = doughnutRadius * (config.percentageInnerCutout / 100);
    for(var i = 0;i < data.length;i++) {
      segmentTotal += data[i].value
    }
    animationLoop(config, null, drawPieSegments, ctx);
    function drawPieSegments(animationDecimal) {
      var cumulativeAngle = -Math.PI / 2, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        var segmentAngle = rotateAnimation * data[i].value / segmentTotal * Math.PI * 2;
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * doughnutRadius, cumulativeAngle, cumulativeAngle + segmentAngle, false);
        ctx.arc(width / 2, height / 2, scaleAnimation * cutoutRadius, cumulativeAngle + segmentAngle, cumulativeAngle, true);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(config.segmentShowStroke) {
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.stroke()
        }
        cumulativeAngle += segmentAngle
      }
    }
  };
  var Line = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString, valueHop, widestXLabel, xAxisLength, yAxisPosX, xAxisPosY, rotateLabels = 0;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : "";
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = Math.floor(scaleHeight / calculatedScale.steps);
    calculateXAxisSize();
    animationLoop(config, drawScale, drawLines, ctx);
    function drawLines(animPc) {
      for(var i = 0;i < data.datasets.length;i++) {
        ctx.strokeStyle = data.datasets[i].strokeColor;
        ctx.lineWidth = config.datasetStrokeWidth;
        ctx.beginPath();
        ctx.moveTo(yAxisPosX, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[0], calculatedScale, scaleHop));
        for(var j = 1;j < data.datasets[i].data.length;j++) {
          if(config.bezierCurve) {
            ctx.bezierCurveTo(xPos(j - 0.5), yPos(i, j - 1), xPos(j - 0.5), yPos(i, j), xPos(j), yPos(i, j))
          }else {
            ctx.lineTo(xPos(j), yPos(i, j))
          }
        }
        ctx.stroke();
        if(config.datasetFill) {
          ctx.lineTo(yAxisPosX + valueHop * (data.datasets[i].data.length - 1), xAxisPosY);
          ctx.lineTo(yAxisPosX, xAxisPosY);
          ctx.closePath();
          ctx.fillStyle = data.datasets[i].fillColor;
          ctx.fill()
        }else {
          ctx.closePath()
        }
        if(config.pointDot) {
          ctx.fillStyle = data.datasets[i].pointColor;
          ctx.strokeStyle = data.datasets[i].pointStrokeColor;
          ctx.lineWidth = config.pointDotStrokeWidth;
          for(var k = 0;k < data.datasets[i].data.length;k++) {
            ctx.beginPath();
            ctx.arc(yAxisPosX + valueHop * k, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[k], calculatedScale, scaleHop), config.pointDotRadius, 0, Math.PI * 2, true);
            ctx.fill();
            ctx.stroke()
          }
        }
      }
      function yPos(dataSet, iteration) {
        return xAxisPosY - animPc * calculateOffset(data.datasets[dataSet].data[iteration], calculatedScale, scaleHop)
      }
      function xPos(iteration) {
        return yAxisPosX + valueHop * iteration
      }
    }
    function drawScale() {
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(width - widestXLabel / 2 + 5, xAxisPosY);
      ctx.lineTo(width - widestXLabel / 2 - xAxisLength - 5, xAxisPosY);
      ctx.stroke();
      if(rotateLabels > 0) {
        ctx.save();
        ctx.textAlign = "right"
      }else {
        ctx.textAlign = "center"
      }
      ctx.fillStyle = config.scaleFontColor;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.save();
        if(rotateLabels > 0) {
          ctx.translate(yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize);
          ctx.rotate(-(rotateLabels * (Math.PI / 180)));
          ctx.fillText(data.labels[i], 0, 0);
          ctx.restore()
        }else {
          ctx.fillText(data.labels[i], yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize + 3)
        }
        ctx.beginPath();
        ctx.moveTo(yAxisPosX + i * valueHop, xAxisPosY + 3);
        if(config.scaleShowGridLines && i > 0) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + i * valueHop, 5)
        }else {
          ctx.lineTo(yAxisPosX + i * valueHop, xAxisPosY + 3)
        }
        ctx.stroke()
      }
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(yAxisPosX, xAxisPosY + 5);
      ctx.lineTo(yAxisPosX, 5);
      ctx.stroke();
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(var j = 0;j < calculatedScale.steps;j++) {
        ctx.beginPath();
        ctx.moveTo(yAxisPosX - 3, xAxisPosY - (j + 1) * scaleHop);
        if(config.scaleShowGridLines) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + xAxisLength + 5, xAxisPosY - (j + 1) * scaleHop)
        }else {
          ctx.lineTo(yAxisPosX - 0.5, xAxisPosY - (j + 1) * scaleHop)
        }
        ctx.stroke();
        if(config.scaleShowLabels) {
          ctx.fillText(calculatedScale.labels[j], yAxisPosX - 8, xAxisPosY - (j + 1) * scaleHop)
        }
      }
    }
    function calculateXAxisSize() {
      var longestText = 1;
      if(config.scaleShowLabels) {
        ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
        for(var i = 0;i < calculatedScale.labels.length;i++) {
          var measuredText = ctx.measureText(calculatedScale.labels[i]).width;
          longestText = measuredText > longestText ? measuredText : longestText
        }
        longestText += 10
      }
      xAxisLength = width - longestText - widestXLabel;
      valueHop = Math.floor(xAxisLength / (data.labels.length - 1));
      yAxisPosX = width - widestXLabel / 2 - xAxisLength;
      xAxisPosY = scaleHeight + config.scaleFontSize / 2
    }
    function calculateDrawingSizes() {
      maxSize = height;
      ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
      widestXLabel = 1;
      for(var i = 0;i < data.labels.length;i++) {
        var textLength = ctx.measureText(data.labels[i]).width;
        widestXLabel = textLength > widestXLabel ? textLength : widestXLabel
      }
      if(width / data.labels.length < widestXLabel) {
        rotateLabels = 45;
        if(width / data.labels.length < Math.cos(rotateLabels) * widestXLabel) {
          rotateLabels = 90;
          maxSize -= widestXLabel
        }else {
          maxSize -= Math.sin(rotateLabels) * widestXLabel
        }
      }else {
        maxSize -= config.scaleFontSize
      }
      maxSize -= 5;
      labelHeight = config.scaleFontSize;
      maxSize -= labelHeight;
      scaleHeight = maxSize
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Bar = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString, valueHop, widestXLabel, xAxisLength, yAxisPosX, xAxisPosY, barWidth, rotateLabels = 0;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : "";
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = Math.floor(scaleHeight / calculatedScale.steps);
    calculateXAxisSize();
    animationLoop(config, drawScale, drawBars, ctx);
    function drawBars(animPc) {
      ctx.lineWidth = config.barStrokeWidth;
      for(var i = 0;i < data.datasets.length;i++) {
        ctx.fillStyle = data.datasets[i].fillColor;
        ctx.strokeStyle = data.datasets[i].strokeColor;
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          var barOffset = yAxisPosX + config.barValueSpacing + valueHop * j + barWidth * i + config.barDatasetSpacing * i + config.barStrokeWidth * i;
          ctx.beginPath();
          ctx.moveTo(barOffset, xAxisPosY);
          ctx.lineTo(barOffset, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop) + config.barStrokeWidth / 2);
          ctx.lineTo(barOffset + barWidth, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop) + config.barStrokeWidth / 2);
          ctx.lineTo(barOffset + barWidth, xAxisPosY);
          if(config.barShowStroke) {
            ctx.stroke()
          }
          ctx.closePath();
          ctx.fill()
        }
      }
    }
    function drawScale() {
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(width - widestXLabel / 2 + 5, xAxisPosY);
      ctx.lineTo(width - widestXLabel / 2 - xAxisLength - 5, xAxisPosY);
      ctx.stroke();
      if(rotateLabels > 0) {
        ctx.save();
        ctx.textAlign = "right"
      }else {
        ctx.textAlign = "center"
      }
      ctx.fillStyle = config.scaleFontColor;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.save();
        if(rotateLabels > 0) {
          ctx.translate(yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize);
          ctx.rotate(-(rotateLabels * (Math.PI / 180)));
          ctx.fillText(data.labels[i], 0, 0);
          ctx.restore()
        }else {
          ctx.fillText(data.labels[i], yAxisPosX + i * valueHop + valueHop / 2, xAxisPosY + config.scaleFontSize + 3)
        }
        ctx.beginPath();
        ctx.moveTo(yAxisPosX + (i + 1) * valueHop, xAxisPosY + 3);
        ctx.lineWidth = config.scaleGridLineWidth;
        ctx.strokeStyle = config.scaleGridLineColor;
        ctx.lineTo(yAxisPosX + (i + 1) * valueHop, 5);
        ctx.stroke()
      }
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(yAxisPosX, xAxisPosY + 5);
      ctx.lineTo(yAxisPosX, 5);
      ctx.stroke();
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(var j = 0;j < calculatedScale.steps;j++) {
        ctx.beginPath();
        ctx.moveTo(yAxisPosX - 3, xAxisPosY - (j + 1) * scaleHop);
        if(config.scaleShowGridLines) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + xAxisLength + 5, xAxisPosY - (j + 1) * scaleHop)
        }else {
          ctx.lineTo(yAxisPosX - 0.5, xAxisPosY - (j + 1) * scaleHop)
        }
        ctx.stroke();
        if(config.scaleShowLabels) {
          ctx.fillText(calculatedScale.labels[j], yAxisPosX - 8, xAxisPosY - (j + 1) * scaleHop)
        }
      }
    }
    function calculateXAxisSize() {
      var longestText = 1;
      if(config.scaleShowLabels) {
        ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
        for(var i = 0;i < calculatedScale.labels.length;i++) {
          var measuredText = ctx.measureText(calculatedScale.labels[i]).width;
          longestText = measuredText > longestText ? measuredText : longestText
        }
        longestText += 10
      }
      xAxisLength = width - longestText - widestXLabel;
      valueHop = Math.floor(xAxisLength / data.labels.length);
      barWidth = (valueHop - config.scaleGridLineWidth * 2 - config.barValueSpacing * 2 - (config.barDatasetSpacing * data.datasets.length - 1) - (config.barStrokeWidth / 2 * data.datasets.length - 1)) / data.datasets.length;
      yAxisPosX = width - widestXLabel / 2 - xAxisLength;
      xAxisPosY = scaleHeight + config.scaleFontSize / 2
    }
    function calculateDrawingSizes() {
      maxSize = height;
      ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
      widestXLabel = 1;
      for(var i = 0;i < data.labels.length;i++) {
        var textLength = ctx.measureText(data.labels[i]).width;
        widestXLabel = textLength > widestXLabel ? textLength : widestXLabel
      }
      if(width / data.labels.length < widestXLabel) {
        rotateLabels = 45;
        if(width / data.labels.length < Math.cos(rotateLabels) * widestXLabel) {
          rotateLabels = 90;
          maxSize -= widestXLabel
        }else {
          maxSize -= Math.sin(rotateLabels) * widestXLabel
        }
      }else {
        maxSize -= config.scaleFontSize
      }
      maxSize -= 5;
      labelHeight = config.scaleFontSize;
      maxSize -= labelHeight;
      scaleHeight = maxSize
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  function calculateOffset(val, calculatedScale, scaleHop) {
    var outerValue = calculatedScale.steps * calculatedScale.stepValue;
    var adjustedValue = val - calculatedScale.graphMin;
    var scalingFactor = CapValue(adjustedValue / outerValue, 1, 0);
    return scaleHop * calculatedScale.steps * scalingFactor
  }
  function animationLoop(config, drawScale, drawData, ctx) {
    var animFrameAmount = config.animation ? 1 / CapValue(config.animationSteps, Number.MAX_VALUE, 1) : 1, easingFunction = animationOptions[config.animationEasing], percentAnimComplete = config.animation ? 0 : 1;
    if(typeof drawScale !== "function") {
      drawScale = function() {
      }
    }
    requestAnimFrame(animLoop);
    function animateFrame() {
      var easeAdjustedAnimationPercent = config.animation ? CapValue(easingFunction(percentAnimComplete), null, 0) : 1;
      clear(ctx);
      if(config.scaleOverlay) {
        drawData(easeAdjustedAnimationPercent);
        drawScale()
      }else {
        drawScale();
        drawData(easeAdjustedAnimationPercent)
      }
    }
    function animLoop() {
      percentAnimComplete += animFrameAmount;
      animateFrame();
      if(percentAnimComplete <= 1) {
        requestAnimFrame(animLoop)
      }else {
        if(typeof config.onAnimationComplete == "function") {
          config.onAnimationComplete()
        }
      }
    }
  }
  var requestAnimFrame = function() {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
      window.setTimeout(callback, 1E3 / 60)
    }
  }();
  function calculateScale(drawingHeight, maxSteps, minSteps, maxValue, minValue, labelTemplateString) {
    var graphMin, graphMax, graphRange, stepValue, numberOfSteps, valueRange, rangeOrderOfMagnitude, decimalNum;
    valueRange = maxValue - minValue;
    rangeOrderOfMagnitude = calculateOrderOfMagnitude(valueRange);
    graphMin = Math.floor(minValue / (1 * Math.pow(10, rangeOrderOfMagnitude))) * Math.pow(10, rangeOrderOfMagnitude);
    graphMax = Math.ceil(maxValue / (1 * Math.pow(10, rangeOrderOfMagnitude))) * Math.pow(10, rangeOrderOfMagnitude);
    graphRange = graphMax - graphMin;
    stepValue = Math.pow(10, rangeOrderOfMagnitude);
    numberOfSteps = Math.round(graphRange / stepValue);
    while(numberOfSteps < minSteps || numberOfSteps > maxSteps) {
      if(numberOfSteps < minSteps) {
        stepValue /= 2;
        numberOfSteps = Math.round(graphRange / stepValue)
      }else {
        stepValue *= 2;
        numberOfSteps = Math.round(graphRange / stepValue)
      }
    }
    var labels = [];
    populateLabels(labelTemplateString, labels, numberOfSteps, graphMin, stepValue);
    return{steps:numberOfSteps, stepValue:stepValue, graphMin:graphMin, labels:labels};
    function calculateOrderOfMagnitude(val) {
      return Math.floor(Math.log(val) / Math.LN10)
    }
  }
  function populateLabels(labelTemplateString, labels, numberOfSteps, graphMin, stepValue) {
    if(labelTemplateString) {
      for(var i = 1;i < numberOfSteps + 1;i++) {
        labels.push(tmpl(labelTemplateString, {value:(graphMin + stepValue * i).toFixed(getDecimalPlaces(stepValue))}))
      }
    }
  }
  function Max(array) {
    return Math.max.apply(Math, array)
  }
  function Min(array) {
    return Math.min.apply(Math, array)
  }
  function Default(userDeclared, valueIfFalse) {
    if(!userDeclared) {
      return valueIfFalse
    }else {
      return userDeclared
    }
  }
  function isNumber(n) {
    return!isNaN(parseFloat(n)) && isFinite(n)
  }
  function CapValue(valueToCap, maxValue, minValue) {
    if(isNumber(maxValue)) {
      if(valueToCap > maxValue) {
        return maxValue
      }
    }
    if(isNumber(minValue)) {
      if(valueToCap < minValue) {
        return minValue
      }
    }
    return valueToCap
  }
  function getDecimalPlaces(num) {
    var numberOfDecimalPlaces;
    if(num % 1 != 0) {
      return num.toString().split(".")[1].length
    }else {
      return 0
    }
  }
  function mergeChartConfig(defaults, userDefined) {
    var returnObj = {};
    for(var attrname in defaults) {
      returnObj[attrname] = defaults[attrname]
    }
    for(var attrname in userDefined) {
      returnObj[attrname] = userDefined[attrname]
    }
    return returnObj
  }
  var cache = {};
  function tmpl(str, data) {
    var fn = !/\W/.test(str) ? cache[str] = cache[str] || tmpl(document.getElementById(str).innerHTML) : new Function("obj", "var p=[],print=function(){p.push.apply(p,arguments);};" + "with(obj){p.push('" + str.replace(/[\r\t\n]/g, " ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g, "$1\r").replace(/\t=(.*?)%>/g, "',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'") + "');}return p.join('');");
    return data ? fn(data) : fn
  }
};
window.Chart = function(context, options) {
  var chart = this;
  var animationOptions = {linear:function(t) {
    return t
  }, easeInQuad:function(t) {
    return t * t
  }, easeOutQuad:function(t) {
    return-1 * t * (t - 2)
  }, easeInOutQuad:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t
    }
    return-1 / 2 * (--t * (t - 2) - 1)
  }, easeInCubic:function(t) {
    return t * t * t
  }, easeOutCubic:function(t) {
    return 1 * ((t = t / 1 - 1) * t * t + 1)
  }, easeInOutCubic:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t
    }
    return 1 / 2 * ((t -= 2) * t * t + 2)
  }, easeInQuart:function(t) {
    return t * t * t * t
  }, easeOutQuart:function(t) {
    return-1 * ((t = t / 1 - 1) * t * t * t - 1)
  }, easeInOutQuart:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t * t
    }
    return-1 / 2 * ((t -= 2) * t * t * t - 2)
  }, easeInQuint:function(t) {
    return 1 * (t /= 1) * t * t * t * t
  }, easeOutQuint:function(t) {
    return 1 * ((t = t / 1 - 1) * t * t * t * t + 1)
  }, easeInOutQuint:function(t) {
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * t * t * t
    }
    return 1 / 2 * ((t -= 2) * t * t * t * t + 2)
  }, easeInSine:function(t) {
    return-1 * Math.cos(t / 1 * (Math.PI / 2)) + 1
  }, easeOutSine:function(t) {
    return 1 * Math.sin(t / 1 * (Math.PI / 2))
  }, easeInOutSine:function(t) {
    return-1 / 2 * (Math.cos(Math.PI * t / 1) - 1)
  }, easeInExpo:function(t) {
    return t == 0 ? 1 : 1 * Math.pow(2, 10 * (t / 1 - 1))
  }, easeOutExpo:function(t) {
    return t == 1 ? 1 : 1 * (-Math.pow(2, -10 * t / 1) + 1)
  }, easeInOutExpo:function(t) {
    if(t == 0) {
      return 0
    }
    if(t == 1) {
      return 1
    }
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * Math.pow(2, 10 * (t - 1))
    }
    return 1 / 2 * (-Math.pow(2, -10 * --t) + 2)
  }, easeInCirc:function(t) {
    if(t >= 1) {
      return t
    }
    return-1 * (Math.sqrt(1 - (t /= 1) * t) - 1)
  }, easeOutCirc:function(t) {
    return 1 * Math.sqrt(1 - (t = t / 1 - 1) * t)
  }, easeInOutCirc:function(t) {
    if((t /= 1 / 2) < 1) {
      return-1 / 2 * (Math.sqrt(1 - t * t) - 1)
    }
    return 1 / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1)
  }, easeInElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1) == 1) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    return-(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p))
  }, easeOutElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1) == 1) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    return a * Math.pow(2, -10 * t) * Math.sin((t * 1 - s) * 2 * Math.PI / p) + 1
  }, easeInOutElastic:function(t) {
    var s = 1.70158;
    var p = 0;
    var a = 1;
    if(t == 0) {
      return 0
    }
    if((t /= 1 / 2) == 2) {
      return 1
    }
    if(!p) {
      p = 1 * 0.3 * 1.5
    }
    if(a < Math.abs(1)) {
      a = 1;
      var s = p / 4
    }else {
      var s = p / (2 * Math.PI) * Math.asin(1 / a)
    }
    if(t < 1) {
      return-0.5 * a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p)
    }
    return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * 1 - s) * 2 * Math.PI / p) * 0.5 + 1
  }, easeInBack:function(t) {
    var s = 1.70158;
    return 1 * (t /= 1) * t * ((s + 1) * t - s)
  }, easeOutBack:function(t) {
    var s = 1.70158;
    return 1 * ((t = t / 1 - 1) * t * ((s + 1) * t + s) + 1)
  }, easeInOutBack:function(t) {
    var s = 1.70158;
    if((t /= 1 / 2) < 1) {
      return 1 / 2 * t * t * (((s *= 1.525) + 1) * t - s)
    }
    return 1 / 2 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2)
  }, easeInBounce:function(t) {
    return 1 - animationOptions.easeOutBounce(1 - t)
  }, easeOutBounce:function(t) {
    if((t /= 1) < 1 / 2.75) {
      return 1 * 7.5625 * t * t
    }else {
      if(t < 2 / 2.75) {
        return 1 * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75)
      }else {
        if(t < 2.5 / 2.75) {
          return 1 * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375)
        }else {
          return 1 * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375)
        }
      }
    }
  }, easeInOutBounce:function(t) {
    if(t < 1 / 2) {
      return animationOptions.easeInBounce(t * 2) * 0.5
    }
    return animationOptions.easeOutBounce(t * 2 - 1) * 0.5 + 1 * 0.5
  }};
  this.tooltips = [], defaults = {tooltips:{background:"rgba(0,0,0,0.6)", fontFamily:"'Arial'", fontStyle:"normal", fontColor:"white", fontSize:"12px", labelTemplate:"<%=label%>: <%=value%>", padding:{top:10, right:10, bottom:10, left:10}, offset:{left:0, top:0}, border:{width:0, color:"#000"}, showHighlight:true, highlight:{stroke:{width:1, color:"rgba(230,230,230,0.25)"}, fill:"rgba(255,255,255,0.25)"}}}, options = options ? mergeChartConfig(defaults, options) : defaults;
  function registerTooltip(ctx, areaObj, data, type) {
    chart.tooltips.push(new Tooltip(ctx, areaObj, data, type))
  }
  var Tooltip = function(ctx, areaObj, data, type) {
    this.ctx = ctx;
    this.areaObj = areaObj;
    this.data = data;
    this.savedState = null;
    this.highlightState = null;
    this.x = null;
    this.y = null;
    this.inRange = function(x, y) {
      if(this.areaObj.type) {
        switch(this.areaObj.type) {
          case "rect":
            return x >= this.areaObj.x && x <= this.areaObj.x + this.areaObj.width && y >= this.areaObj.y && y <= this.areaObj.y + this.areaObj.height;
            break;
          case "circle":
            return Math.pow(x - this.areaObj.x, 2) + Math.pow(y - this.areaObj.y, 2) < Math.pow(this.areaObj.r, 2);
            break;
          case "shape":
            var poly = this.areaObj.points;
            for(var c = false, i = -1, l = poly.length, j = l - 1;++i < l;j = i) {
              (poly[i].y <= y && y < poly[j].y || poly[j].y <= y && y < poly[i].y) && x < (poly[j].x - poly[i].x) * (y - poly[i].y) / (poly[j].y - poly[i].y) + poly[i].x && (c = !c)
            }
            return c;
            break
        }
      }
    };
    this.render = function(x, y) {
      if(this.savedState == null) {
        this.ctx.putImageData(chart.savedState, 0, 0);
        this.savedState = this.ctx.getImageData(0, 0, this.ctx.canvas.width, this.ctx.canvas.height)
      }
      this.ctx.putImageData(this.savedState, 0, 0);
      if(options.tooltips.showHighlight) {
        if(this.highlightState == null) {
          this.ctx.strokeStyle = options.tooltips.highlight.stroke.color;
          this.ctx.lineWidth = options.tooltips.highlight.stroke.width;
          this.ctx.fillStyle = options.tooltips.highlight.fill;
          switch(this.areaObj.type) {
            case "rect":
              this.ctx.strokeRect(this.areaObj.x, this.areaObj.y, this.areaObj.width, this.areaObj.height);
              this.ctx.fillStyle = options.tooltips.highlight.fill;
              this.ctx.fillRect(this.areaObj.x, this.areaObj.y, this.areaObj.width, this.areaObj.height);
              break;
            case "circle":
              this.ctx.beginPath();
              this.ctx.arc(this.areaObj.x, this.areaObj.y, this.areaObj.r, 0, 2 * Math.PI, false);
              this.ctx.stroke();
              this.ctx.fill();
              break;
            case "shape":
              this.ctx.beginPath();
              this.ctx.moveTo(this.areaObj.points[0].x, this.areaObj.points[0].y);
              for(var p in this.areaObj.points) {
                this.ctx.lineTo(this.areaObj.points[p].x, this.areaObj.points[p].y)
              }
              this.ctx.stroke();
              this.ctx.fill();
              break
          }
          this.highlightState = this.ctx.getImageData(0, 0, this.ctx.canvas.width, this.ctx.canvas.height)
        }else {
          this.ctx.putImageData(this.highlightState, 0, 0)
        }
      }
      var posX = x + options.tooltips.offset.left, posY = y + options.tooltips.offset.top, tpl = tmpl(options.tooltips.labelTemplate, this.data), rectWidth = options.tooltips.padding.left + this.ctx.measureText(tpl).width + options.tooltips.padding.right;
      if(posX + rectWidth > ctx.canvas.width) {
        posX -= posX - rectWidth < 0 ? posX : rectWidth
      }
      if(posY + 24 > ctx.canvas.height) {
        posY -= 24
      }
      this.ctx.fillStyle = options.tooltips.background;
      this.ctx.fillRect(posX, posY, rectWidth, 24);
      if(options.tooltips.border.width > 0) {
        this.ctx.fillStyle = options.tooltips.order.color;
        this.ctx.lineWidth = options.tooltips.border.width;
        this.ctx.strokeRect(posX, posY, rectWidth, 24)
      }
      this.ctx.font = options.tooltips.fontStyle + " " + options.tooltips.fontSize + " " + options.tooltips.fontFamily;
      this.ctx.fillStyle = options.tooltips.fontColor;
      this.ctx.textAlign = "center";
      this.ctx.textBaseline = "middle";
      this.ctx.fillText(tpl, posX + rectWidth / 2, posY + 12);
      this.x = x;
      this.y = y
    }
  };
  var width = context.canvas.width, height = context.canvas.height;
  this.savedState = null;
  function getPosition(e) {
    var xPosition = 0;
    var yPosition = 0;
    while(e) {
      xPosition += e.offsetLeft + e.clientLeft;
      yPosition += e.offsetTop + e.clientTop;
      e = e.offsetParent
    }
    if(window.pageXOffset > 0 || window.pageYOffset > 0) {
      xPosition -= window.pageXOffset;
      yPosition -= window.pageYOffset
    }else {
      if(document.body.scrollLeft > 0 || document.body.scrollTop > 0) {
        xPosition -= document.body.scrollLeft;
        yPosition -= document.body.scrollTop
      }
    }
    return{x:xPosition, y:yPosition}
  }
  function tooltipEventHandler(e) {
    if(chart.tooltips.length > 0) {
      chart.savedState = chart.savedState == null ? context.getImageData(0, 0, context.canvas.width, context.canvas.height) : chart.savedState;
      var rendered = 0;
      for(var i in chart.tooltips) {
        var position = getPosition(context.canvas), mx = e.clientX - position.x, my = e.clientY - position.y;
        if(chart.tooltips[i].inRange(mx, my)) {
          chart.tooltips[i].render(mx, my);
          rendered++
        }
      }
      if(rendered == 0) {
        context.putImageData(chart.savedState, 0, 0)
      }
    }
  }
  if(window.Touch) {
    context.canvas.ontouchstart = function(e) {
      e.clientX = e.targetTouches[0].clientX;
      e.clientY = e.targetTouches[0].clientY;
      tooltipEventHandler(e)
    };
    context.canvas.ontouchmove = function(e) {
      e.clientX = e.targetTouches[0].clientX;
      e.clientY = e.targetTouches[0].clientY;
      tooltipEventHandler(e)
    }
  }else {
    context.canvas.onmousemove = function(e) {
      tooltipEventHandler(e)
    }
  }
  context.canvas.onmouseout = function(e) {
    if(chart.savedState != null) {
      context.putImageData(chart.savedState, 0, 0)
    }
  };
  if(window.devicePixelRatio) {
    context.canvas.style.width = width + "px";
    context.canvas.style.height = height + "px";
    context.canvas.height = height * window.devicePixelRatio;
    context.canvas.width = width * window.devicePixelRatio;
    context.scale(window.devicePixelRatio, window.devicePixelRatio)
  }
  this.PolarArea = function(data, options) {
    chart.PolarArea.defaults = {scaleOverlay:true, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleShowLine:true, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowLabelBackdrop:true, scaleBackdropColor:"rgba(255,255,255,0.75)", scaleBackdropPaddingY:2, scaleBackdropPaddingX:2, segmentShowStroke:true, segmentStrokeColor:"#fff", 
    segmentStrokeWidth:2, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null, showTooltips:true};
    var config = options ? mergeChartConfig(chart.PolarArea.defaults, options) : chart.PolarArea.defaults;
    return new PolarArea(data, config, context)
  };
  this.Radar = function(data, options) {
    chart.Radar.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleShowLine:true, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:false, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowLabelBackdrop:true, scaleBackdropColor:"rgba(255,255,255,0.75)", scaleBackdropPaddingY:2, scaleBackdropPaddingX:2, angleShowLineOut:true, angleLineColor:"rgba(0,0,0,.1)", 
    angleLineWidth:1, pointLabelFontFamily:"'Arial'", pointLabelFontStyle:"normal", pointLabelFontSize:12, pointLabelFontColor:"#666", pointDot:true, pointDotRadius:3, pointDotStrokeWidth:1, datasetStroke:true, datasetStrokeWidth:2, datasetFill:true, animation:true, animationSteps:60, animationEasing:"easeOutQuart", onAnimationComplete:null, showTooltips:true};
    var config = options ? mergeChartConfig(chart.Radar.defaults, options) : chart.Radar.defaults;
    return new Radar(data, config, context)
  };
  this.Pie = function(data, options) {
    chart.Pie.defaults = {segmentShowStroke:true, segmentStrokeColor:"#fff", segmentStrokeWidth:2, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null, labelFontFamily:"'Arial'", labelFontStyle:"normal", labelFontSize:12, labelFontColor:"#666", labelAlign:"right", showTooltips:true};
    var config = options ? mergeChartConfig(chart.Pie.defaults, options) : chart.Pie.defaults;
    return new Pie(data, config, context)
  };
  this.Doughnut = function(data, options) {
    chart.Doughnut.defaults = {segmentShowStroke:true, segmentStrokeColor:"#fff", segmentStrokeWidth:2, percentageInnerCutout:50, animation:true, animationSteps:100, animationEasing:"easeOutBounce", animateRotate:true, animateScale:false, onAnimationComplete:null, showTooltips:true};
    var config = options ? mergeChartConfig(chart.Doughnut.defaults, options) : chart.Doughnut.defaults;
    return new Doughnut(data, config, context)
  };
  this.Line = function(data, options) {
    chart.Line.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowGridLines:true, scaleGridLineColor:"rgba(0,0,0,.05)", scaleGridLineWidth:1, bezierCurve:true, pointDot:true, pointDotRadius:4, pointDotStrokeWidth:2, datasetStroke:true, datasetStrokeWidth:2, 
    datasetFill:true, animation:true, animationSteps:60, animationEasing:"easeOutQuart", onAnimationComplete:null, showTooltips:true};
    var config = options ? mergeChartConfig(chart.Line.defaults, options) : chart.Line.defaults;
    return new Line(data, config, context)
  };
  this.Bar = function(data, options) {
    chart.Bar.defaults = {scaleOverlay:false, scaleOverride:false, scaleSteps:null, scaleStepWidth:null, scaleStartValue:null, scaleLineColor:"rgba(0,0,0,.1)", scaleLineWidth:1, scaleShowLabels:true, scaleLabel:"<%=value%>", scaleFontFamily:"'Arial'", scaleFontSize:12, scaleFontStyle:"normal", scaleFontColor:"#666", scaleShowGridLines:true, scaleGridLineColor:"rgba(0,0,0,.05)", scaleGridLineWidth:1, barShowStroke:true, barStrokeWidth:2, barValueSpacing:5, barDatasetSpacing:1, animation:true, animationSteps:60, 
    animationEasing:"easeOutQuart", onAnimationComplete:null, showTooltips:true};
    var config = options ? mergeChartConfig(chart.Bar.defaults, options) : chart.Bar.defaults;
    return new Bar(data, config, context)
  };
  var clear = function(c) {
    c.clearRect(0, 0, width, height)
  };
  var PolarArea = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : null;
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = maxSize / calculatedScale.steps;
    animationLoop(config, drawScale, drawAllSegments, ctx);
    function calculateDrawingSizes() {
      maxSize = Min([width, height]) / 2;
      maxSize -= Max([config.scaleFontSize * 0.5, config.scaleLineWidth * 0.5]);
      labelHeight = config.scaleFontSize * 2;
      if(config.scaleShowLabelBackdrop) {
        labelHeight += 2 * config.scaleBackdropPaddingY;
        maxSize -= config.scaleBackdropPaddingY * 1.5
      }
      scaleHeight = maxSize;
      labelHeight = Default(labelHeight, 5)
    }
    function drawScale() {
      for(var i = 0;i < calculatedScale.steps;i++) {
        if(config.scaleShowLine) {
          ctx.beginPath();
          ctx.arc(width / 2, height / 2, scaleHop * (i + 1), 0, Math.PI * 2, true);
          ctx.strokeStyle = config.scaleLineColor;
          ctx.lineWidth = config.scaleLineWidth;
          ctx.stroke()
        }
        if(config.scaleShowLabels) {
          ctx.textAlign = "center";
          ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
          var label = calculatedScale.labels[i];
          if(config.scaleShowLabelBackdrop) {
            var textWidth = ctx.measureText(label).width;
            ctx.fillStyle = config.scaleBackdropColor;
            ctx.beginPath();
            ctx.rect(Math.round(width / 2 - textWidth / 2 - config.scaleBackdropPaddingX), Math.round(height / 2 - scaleHop * (i + 1) - config.scaleFontSize * 0.5 - config.scaleBackdropPaddingY), Math.round(textWidth + config.scaleBackdropPaddingX * 2), Math.round(config.scaleFontSize + config.scaleBackdropPaddingY * 2));
            ctx.fill()
          }
          ctx.textBaseline = "middle";
          ctx.fillStyle = config.scaleFontColor;
          ctx.fillText(label, width / 2, height / 2 - scaleHop * (i + 1))
        }
      }
    }
    function drawAllSegments(animationDecimal) {
      var startAngle = -Math.PI / 2, angleStep = Math.PI * 2 / data.length, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * calculateOffset(data[i].value, calculatedScale, scaleHop), startAngle, startAngle + rotateAnimation * angleStep, false);
        ctx.lineTo(width / 2, height / 2);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(animationDecimal >= 1 && config.showTooltips) {
          var points = [{x:width / 2, y:height / 2}], pAmount = 50, radius = calculateOffset(data[i].value, calculatedScale, scaleHop);
          points.push({x:width / 2 + radius * Math.cos(startAngle), y:height / 2 + radius * Math.sin(startAngle)});
          for(var p = 0;p <= pAmount;p++) {
            points.push({x:width / 2 + radius * Math.cos(startAngle + p / pAmount * rotateAnimation * angleStep), y:height / 2 + radius * Math.sin(startAngle + p / pAmount * rotateAnimation * angleStep)})
          }
          registerTooltip(ctx, {type:"shape", points:points}, {label:data[i].label, value:data[i].value}, "PolarArea")
        }
        if(config.segmentShowStroke) {
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.stroke()
        }
        startAngle += rotateAnimation * angleStep
      }
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.length;i++) {
        if(data[i].value > upperValue) {
          upperValue = data[i].value
        }
        if(data[i].value < lowerValue) {
          lowerValue = data[i].value
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Radar = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString;
    if(!data.labels) {
      data.labels = []
    }
    calculateDrawingSizes();
    var valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : null;
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = maxSize / calculatedScale.steps;
    animationLoop(config, drawScale, drawAllDataPoints, ctx);
    function drawAllDataPoints(animationDecimal) {
      var rotationDegree = 2 * Math.PI / data.datasets[0].data.length;
      ctx.save();
      ctx.translate(width / 2, height / 2);
      for(var i = 0;i < data.datasets.length;i++) {
        var offset = calculateOffset(data.datasets[i].data[0], calculatedScale, scaleHop);
        ctx.beginPath();
        ctx.moveTo(0, animationDecimal * -1 * offset);
        if(animationDecimal >= 1 && config.showTooltips) {
          var curX = width / 2 + offset * Math.cos(0 - Math.PI / 2), curY = height / 2 + offset * Math.sin(0 - Math.PI / 2), pointRadius = config.pointDot ? config.pointDotRadius + config.pointDotStrokeWidth : 10, ttData = data.labels[0].trim() != "" ? data.labels[0] + ": " + data.datasets[i].data[0] : data.datasets[i].data[0];
          registerTooltip(ctx, {type:"circle", x:curX, y:curY, r:pointRadius}, {label:data.labels[0], value:data.datasets[i].data[0]}, "Radar")
        }
        for(var j = 1;j < data.datasets[i].data.length;j++) {
          offset = calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop);
          ctx.rotate(rotationDegree);
          ctx.lineTo(0, animationDecimal * -1 * offset);
          if(animationDecimal >= 1 && config.showTooltips) {
            var curX = width / 2 + offset * Math.cos(j * rotationDegree - Math.PI / 2), curY = height / 2 + offset * Math.sin(j * rotationDegree - Math.PI / 2), pointRadius = config.pointDot ? config.pointDotRadius + config.pointDotStrokeWidth : 10, ttData = data.labels[j].trim() != "" ? data.labels[j] + ": " + data.datasets[i].data[j] : data.datasets[i].data[j];
            registerTooltip(ctx, {type:"circle", x:curX, y:curY, r:pointRadius}, {label:data.labels[j], value:data.datasets[i].data[j]}, "Radar")
          }
        }
        ctx.closePath();
        ctx.fillStyle = data.datasets[i].fillColor;
        ctx.strokeStyle = data.datasets[i].strokeColor;
        ctx.lineWidth = config.datasetStrokeWidth;
        ctx.fill();
        ctx.stroke();
        if(config.pointDot) {
          ctx.fillStyle = data.datasets[i].pointColor;
          ctx.strokeStyle = data.datasets[i].pointStrokeColor;
          ctx.lineWidth = config.pointDotStrokeWidth;
          for(var k = 0;k < data.datasets[i].data.length;k++) {
            ctx.rotate(rotationDegree);
            ctx.beginPath();
            ctx.arc(0, animationDecimal * -1 * calculateOffset(data.datasets[i].data[k], calculatedScale, scaleHop), config.pointDotRadius, 2 * Math.PI, false);
            ctx.fill();
            ctx.stroke()
          }
        }
        ctx.rotate(rotationDegree)
      }
      ctx.restore()
    }
    function drawScale() {
      var rotationDegree = 2 * Math.PI / data.datasets[0].data.length;
      ctx.save();
      ctx.translate(width / 2, height / 2);
      if(config.angleShowLineOut) {
        ctx.strokeStyle = config.angleLineColor;
        ctx.lineWidth = config.angleLineWidth;
        for(var h = 0;h < data.datasets[0].data.length;h++) {
          ctx.rotate(rotationDegree);
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.lineTo(0, -maxSize);
          ctx.stroke()
        }
      }
      for(var i = 0;i < calculatedScale.steps;i++) {
        ctx.beginPath();
        if(config.scaleShowLine) {
          ctx.strokeStyle = config.scaleLineColor;
          ctx.lineWidth = config.scaleLineWidth;
          ctx.moveTo(0, -scaleHop * (i + 1));
          for(var j = 0;j < data.datasets[0].data.length;j++) {
            ctx.rotate(rotationDegree);
            ctx.lineTo(0, -scaleHop * (i + 1))
          }
          ctx.closePath();
          ctx.stroke()
        }
        if(config.scaleShowLabels) {
          ctx.textAlign = "center";
          ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
          ctx.textBaseline = "middle";
          if(config.scaleShowLabelBackdrop) {
            var textWidth = ctx.measureText(calculatedScale.labels[i]).width;
            ctx.fillStyle = config.scaleBackdropColor;
            ctx.beginPath();
            ctx.rect(Math.round(-textWidth / 2 - config.scaleBackdropPaddingX), Math.round(-scaleHop * (i + 1) - config.scaleFontSize * 0.5 - config.scaleBackdropPaddingY), Math.round(textWidth + config.scaleBackdropPaddingX * 2), Math.round(config.scaleFontSize + config.scaleBackdropPaddingY * 2));
            ctx.fill()
          }
          ctx.fillStyle = config.scaleFontColor;
          ctx.fillText(calculatedScale.labels[i], 0, -scaleHop * (i + 1))
        }
      }
      for(var k = 0;k < data.labels.length;k++) {
        ctx.font = config.pointLabelFontStyle + " " + config.pointLabelFontSize + "px " + config.pointLabelFontFamily;
        ctx.fillStyle = config.pointLabelFontColor;
        var opposite = Math.sin(rotationDegree * k) * (maxSize + config.pointLabelFontSize);
        var adjacent = Math.cos(rotationDegree * k) * (maxSize + config.pointLabelFontSize);
        if(rotationDegree * k == Math.PI || rotationDegree * k == 0) {
          ctx.textAlign = "center"
        }else {
          if(rotationDegree * k > Math.PI) {
            ctx.textAlign = "right"
          }else {
            ctx.textAlign = "left"
          }
        }
        ctx.textBaseline = "middle";
        ctx.fillText(data.labels[k], opposite, -adjacent)
      }
      ctx.restore()
    }
    function calculateDrawingSizes() {
      maxSize = Min([width, height]) / 2;
      labelHeight = config.scaleFontSize * 2;
      var labelLength = 0;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.font = config.pointLabelFontStyle + " " + config.pointLabelFontSize + "px " + config.pointLabelFontFamily;
        var textMeasurement = ctx.measureText(data.labels[i]).width;
        if(textMeasurement > labelLength) {
          labelLength = textMeasurement
        }
      }
      maxSize -= Max([labelLength, config.pointLabelFontSize / 2 * 1.5]);
      maxSize -= config.pointLabelFontSize;
      maxSize = CapValue(maxSize, null, 0);
      scaleHeight = maxSize;
      labelHeight = Default(labelHeight, 5)
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Pie = function(data, config, ctx) {
    var segmentTotal = 0;
    var pieRadius = Min([height / 2, width / 2]) - 5;
    for(var i = 0;i < data.length;i++) {
      segmentTotal += data[i].value
    }
    ctx.fillStyle = "black";
    ctx.textBaseline = "base";
    animationLoop(config, null, drawPieSegments, ctx);
    function drawPieSegments(animationDecimal) {
      var cumulativeAngle = -Math.PI / 2, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        var segmentAngle = rotateAnimation * data[i].value / segmentTotal * Math.PI * 2;
        segmentAngle = Math.min(Math.PI * 1.999999, segmentAngle);
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * pieRadius, cumulativeAngle, cumulativeAngle + segmentAngle);
        ctx.lineTo(width / 2, height / 2);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(data[i].label && scaleAnimation * pieRadius * 2 * segmentAngle / (2 * Math.PI) > config.labelFontSize) {
          function getPieLabelX(align, r) {
            switch(align) {
              case "left":
                return-r + 20;
                break;
              case "center":
                return-r / 2;
                break
            }
            return-10
          }
          function reversePieLabelAlign(align) {
            switch(align) {
              case "left":
                return"right";
                break;
              case "right":
                return"left";
                break;
              case "center":
                return align;
                break
            }
          }
          var fontSize = data[i].labelFontSize || config.labelFontSize + "px";
          if(fontSize.match(/^[0-9]+$/g) != null) {
            fontSize = fontSize + "px"
          }
          ctx.font = config.labelFontStyle + " " + fontSize + " " + config.labelFontFamily;
          ctx.fillStyle = getFadeColor(animationDecimal, data[i].labelColor || "black", data[i].color);
          ctx.textBaseline = "middle";
          var textRotation = -(cumulativeAngle + segmentAngle) + segmentAngle / 2, tX = width / 2 + scaleAnimation * pieRadius * Math.cos(textRotation), tY = height / 2 - scaleAnimation * pieRadius * Math.sin(textRotation);
          ctx.textAlign = data[i].labelAlign || config.labelAlign;
          textX = getPieLabelX(ctx.textAlign, scaleAnimation * pieRadius);
          if(textRotation < -Math.PI / 2) {
            textRotation -= Math.PI;
            ctx.textAlign = reversePieLabelAlign(ctx.textAlign);
            textX = -textX
          }
          ctx.translate(tX, tY);
          ctx.rotate(-textRotation);
          ctx.fillText(data[i].label, textX, 0);
          ctx.rotate(textRotation);
          ctx.translate(-tX, -tY)
        }
        if(animationDecimal >= 1 && config.showTooltips) {
          var points = [{x:width / 2, y:height / 2}], pAmount = 50;
          points.push({x:width / 2 + pieRadius * Math.cos(cumulativeAngle), y:height / 2 + pieRadius * Math.sin(cumulativeAngle)});
          for(var p = 0;p <= pAmount;p++) {
            points.push({x:width / 2 + pieRadius * Math.cos(cumulativeAngle + p / pAmount * segmentAngle), y:height / 2 + pieRadius * Math.sin(cumulativeAngle + p / pAmount * segmentAngle)})
          }
          registerTooltip(ctx, {type:"shape", points:points}, {label:data[i].label, value:data[i].value}, "Pie")
        }
        if(config.segmentShowStroke) {
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.stroke()
        }
        cumulativeAngle += segmentAngle
      }
    }
  };
  var Doughnut = function(data, config, ctx) {
    var segmentTotal = 0;
    var doughnutRadius = Min([height / 2, width / 2]) - 5;
    var cutoutRadius = doughnutRadius * (config.percentageInnerCutout / 100);
    for(var i = 0;i < data.length;i++) {
      segmentTotal += data[i].value
    }
    animationLoop(config, null, drawPieSegments, ctx);
    function drawPieSegments(animationDecimal) {
      var cumulativeAngle = -Math.PI / 2, scaleAnimation = 1, rotateAnimation = 1;
      if(config.animation) {
        if(config.animateScale) {
          scaleAnimation = animationDecimal
        }
        if(config.animateRotate) {
          rotateAnimation = animationDecimal
        }
      }
      for(var i = 0;i < data.length;i++) {
        var segmentAngle = rotateAnimation * data[i].value / segmentTotal * Math.PI * 2;
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, scaleAnimation * doughnutRadius, cumulativeAngle, cumulativeAngle + segmentAngle, false);
        ctx.arc(width / 2, height / 2, scaleAnimation * cutoutRadius, cumulativeAngle + segmentAngle, cumulativeAngle, true);
        ctx.closePath();
        ctx.fillStyle = data[i].color;
        ctx.fill();
        if(animationDecimal >= 1 && config.showTooltips) {
          var points = [], pAmount = 50;
          points.push({x:width / 2 + doughnutRadius * Math.cos(cumulativeAngle), y:height / 2 + doughnutRadius * Math.sin(cumulativeAngle)});
          for(var p = 0;p <= pAmount;p++) {
            points.push({x:width / 2 + doughnutRadius * Math.cos(cumulativeAngle + p / pAmount * segmentAngle), y:height / 2 + doughnutRadius * Math.sin(cumulativeAngle + p / pAmount * segmentAngle)})
          }
          points.push({x:width / 2 + cutoutRadius * Math.cos(cumulativeAngle + segmentAngle), y:height / 2 + cutoutRadius * Math.sin(cumulativeAngle + segmentAngle)});
          for(var p = pAmount;p >= 0;p--) {
            points.push({x:width / 2 + cutoutRadius * Math.cos(cumulativeAngle + p / pAmount * segmentAngle), y:height / 2 + cutoutRadius * Math.sin(cumulativeAngle + p / pAmount * segmentAngle)})
          }
          registerTooltip(ctx, {type:"shape", points:points}, {label:data[i].label, value:data[i].value}, "Doughnut")
        }
        if(config.segmentShowStroke) {
          ctx.lineWidth = config.segmentStrokeWidth;
          ctx.strokeStyle = config.segmentStrokeColor;
          ctx.stroke()
        }
        cumulativeAngle += segmentAngle
      }
    }
  };
  var Line = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString, valueHop, widestXLabel, xAxisLength, yAxisPosX, xAxisPosY, rotateLabels = 0;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : "";
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = Math.floor(scaleHeight / calculatedScale.steps);
    calculateXAxisSize();
    animationLoop(config, drawScale, drawLines, ctx);
    function drawLines(animPc) {
      for(var i = 0;i < data.datasets.length;i++) {
        ctx.strokeStyle = data.datasets[i].strokeColor;
        ctx.lineWidth = config.datasetStrokeWidth;
        ctx.beginPath();
        ctx.moveTo(yAxisPosX, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[0], calculatedScale, scaleHop));
        for(var j = 1;j < data.datasets[i].data.length;j++) {
          if(config.bezierCurve) {
            ctx.bezierCurveTo(xPos(j - 0.5), yPos(i, j - 1), xPos(j - 0.5), yPos(i, j), xPos(j), yPos(i, j))
          }else {
            ctx.lineTo(xPos(j), yPos(i, j))
          }
        }
        var pointRadius = config.pointDot ? config.pointDotRadius + config.pointDotStrokeWidth : 10;
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(animPc >= 1 && config.showTooltips) {
            registerTooltip(ctx, {type:"circle", x:xPos(j), y:yPos(i, j), r:pointRadius}, {label:data.labels[j], value:data.datasets[i].data[j]}, "Line")
          }
        }
        ctx.stroke();
        if(config.datasetFill) {
          ctx.lineTo(yAxisPosX + valueHop * (data.datasets[i].data.length - 1), xAxisPosY);
          ctx.lineTo(yAxisPosX, xAxisPosY);
          ctx.closePath();
          ctx.fillStyle = data.datasets[i].fillColor;
          ctx.fill()
        }else {
          ctx.closePath()
        }
        if(config.pointDot) {
          ctx.fillStyle = data.datasets[i].pointColor;
          ctx.strokeStyle = data.datasets[i].pointStrokeColor;
          ctx.lineWidth = config.pointDotStrokeWidth;
          for(var k = 0;k < data.datasets[i].data.length;k++) {
            ctx.beginPath();
            ctx.arc(yAxisPosX + valueHop * k, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[k], calculatedScale, scaleHop), config.pointDotRadius, 0, Math.PI * 2, true);
            ctx.fill();
            ctx.stroke()
          }
        }
      }
      function yPos(dataSet, iteration) {
        return xAxisPosY - animPc * calculateOffset(data.datasets[dataSet].data[iteration], calculatedScale, scaleHop)
      }
      function xPos(iteration) {
        return yAxisPosX + valueHop * iteration
      }
    }
    function drawScale() {
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(width - widestXLabel / 2 + 5, xAxisPosY);
      ctx.lineTo(width - widestXLabel / 2 - xAxisLength - 5, xAxisPosY);
      ctx.stroke();
      if(rotateLabels > 0) {
        ctx.save();
        ctx.textAlign = "right"
      }else {
        ctx.textAlign = "center"
      }
      ctx.fillStyle = config.scaleFontColor;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.save();
        if(rotateLabels > 0) {
          ctx.translate(yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize);
          ctx.rotate(-(rotateLabels * (Math.PI / 180)));
          ctx.fillText(data.labels[i], 0, 0);
          ctx.restore()
        }else {
          ctx.fillText(data.labels[i], yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize + 3)
        }
        ctx.beginPath();
        ctx.moveTo(yAxisPosX + i * valueHop, xAxisPosY + 3);
        if(config.scaleShowGridLines && i > 0) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + i * valueHop, 5)
        }else {
          ctx.lineTo(yAxisPosX + i * valueHop, xAxisPosY + 3)
        }
        ctx.stroke()
      }
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(yAxisPosX, xAxisPosY + 5);
      ctx.lineTo(yAxisPosX, 5);
      ctx.stroke();
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(var j = 0;j < calculatedScale.steps;j++) {
        ctx.beginPath();
        ctx.moveTo(yAxisPosX - 3, xAxisPosY - (j + 1) * scaleHop);
        if(config.scaleShowGridLines) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + xAxisLength + 5, xAxisPosY - (j + 1) * scaleHop)
        }else {
          ctx.lineTo(yAxisPosX - 0.5, xAxisPosY - (j + 1) * scaleHop)
        }
        ctx.stroke();
        if(config.scaleShowLabels) {
          ctx.fillText(calculatedScale.labels[j], yAxisPosX - 8, xAxisPosY - (j + 1) * scaleHop)
        }
      }
    }
    function calculateXAxisSize() {
      var longestText = 1;
      if(config.scaleShowLabels) {
        ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
        for(var i = 0;i < calculatedScale.labels.length;i++) {
          var measuredText = ctx.measureText(calculatedScale.labels[i]).width;
          longestText = measuredText > longestText ? measuredText : longestText
        }
        longestText += 10
      }
      xAxisLength = width - longestText - widestXLabel;
      valueHop = Math.floor(xAxisLength / (data.labels.length - 1));
      yAxisPosX = width - widestXLabel / 2 - xAxisLength;
      xAxisPosY = scaleHeight + config.scaleFontSize / 2
    }
    function calculateDrawingSizes() {
      maxSize = height;
      ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
      widestXLabel = 1;
      for(var i = 0;i < data.labels.length;i++) {
        var textLength = ctx.measureText(data.labels[i]).width;
        widestXLabel = textLength > widestXLabel ? textLength : widestXLabel
      }
      if(width / data.labels.length < widestXLabel) {
        rotateLabels = 45;
        if(width / data.labels.length < Math.cos(rotateLabels) * widestXLabel) {
          rotateLabels = 90;
          maxSize -= widestXLabel
        }else {
          maxSize -= Math.sin(rotateLabels) * widestXLabel
        }
      }else {
        maxSize -= config.scaleFontSize
      }
      maxSize -= 5;
      labelHeight = config.scaleFontSize;
      maxSize -= labelHeight;
      scaleHeight = maxSize
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  var Bar = function(data, config, ctx) {
    var maxSize, scaleHop, calculatedScale, labelHeight, scaleHeight, valueBounds, labelTemplateString, valueHop, widestXLabel, xAxisLength, yAxisPosX, xAxisPosY, barWidth, rotateLabels = 0;
    calculateDrawingSizes();
    valueBounds = getValueBounds();
    labelTemplateString = config.scaleShowLabels ? config.scaleLabel : "";
    if(!config.scaleOverride) {
      calculatedScale = calculateScale(scaleHeight, valueBounds.maxSteps, valueBounds.minSteps, valueBounds.maxValue, valueBounds.minValue, labelTemplateString)
    }else {
      calculatedScale = {steps:config.scaleSteps, stepValue:config.scaleStepWidth, graphMin:config.scaleStartValue, labels:[]};
      populateLabels(labelTemplateString, calculatedScale.labels, calculatedScale.steps, config.scaleStartValue, config.scaleStepWidth)
    }
    scaleHop = Math.floor(scaleHeight / calculatedScale.steps);
    calculateXAxisSize();
    animationLoop(config, drawScale, drawBars, ctx);
    function drawBars(animPc) {
      ctx.lineWidth = config.barStrokeWidth;
      for(var i = 0;i < data.datasets.length;i++) {
        ctx.fillStyle = data.datasets[i].fillColor;
        ctx.strokeStyle = data.datasets[i].strokeColor;
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          var barOffset = yAxisPosX + config.barValueSpacing + valueHop * j + barWidth * i + config.barDatasetSpacing * i + config.barStrokeWidth * i;
          ctx.beginPath();
          ctx.moveTo(barOffset, xAxisPosY);
          ctx.lineTo(barOffset, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop) + config.barStrokeWidth / 2);
          ctx.lineTo(barOffset + barWidth, xAxisPosY - animPc * calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop) + config.barStrokeWidth / 2);
          ctx.lineTo(barOffset + barWidth, xAxisPosY);
          if(config.barShowStroke) {
            ctx.stroke()
          }
          ctx.closePath();
          ctx.fill();
          if(animPc >= 1 && config.showTooltips) {
            var x = barOffset, height = calculateOffset(data.datasets[i].data[j], calculatedScale, scaleHop), y = xAxisPosY - height, width = barWidth;
            registerTooltip(ctx, {type:"rect", x:x, y:y, width:width, height:height}, {label:data.labels[j], value:data.datasets[i].data[j]}, "Bar")
          }
        }
      }
    }
    function drawScale() {
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(width - widestXLabel / 2 + 5, xAxisPosY);
      ctx.lineTo(width - widestXLabel / 2 - xAxisLength - 5, xAxisPosY);
      ctx.stroke();
      if(rotateLabels > 0) {
        ctx.save();
        ctx.textAlign = "right"
      }else {
        ctx.textAlign = "center"
      }
      ctx.fillStyle = config.scaleFontColor;
      for(var i = 0;i < data.labels.length;i++) {
        ctx.save();
        if(rotateLabels > 0) {
          ctx.translate(yAxisPosX + i * valueHop, xAxisPosY + config.scaleFontSize);
          ctx.rotate(-(rotateLabels * (Math.PI / 180)));
          ctx.fillText(data.labels[i], 0, 0);
          ctx.restore()
        }else {
          ctx.fillText(data.labels[i], yAxisPosX + i * valueHop + valueHop / 2, xAxisPosY + config.scaleFontSize + 3)
        }
        ctx.beginPath();
        ctx.moveTo(yAxisPosX + (i + 1) * valueHop, xAxisPosY + 3);
        ctx.lineWidth = config.scaleGridLineWidth;
        ctx.strokeStyle = config.scaleGridLineColor;
        ctx.lineTo(yAxisPosX + (i + 1) * valueHop, 5);
        ctx.stroke()
      }
      ctx.lineWidth = config.scaleLineWidth;
      ctx.strokeStyle = config.scaleLineColor;
      ctx.beginPath();
      ctx.moveTo(yAxisPosX, xAxisPosY + 5);
      ctx.lineTo(yAxisPosX, 5);
      ctx.stroke();
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(var j = 0;j < calculatedScale.steps;j++) {
        ctx.beginPath();
        ctx.moveTo(yAxisPosX - 3, xAxisPosY - (j + 1) * scaleHop);
        if(config.scaleShowGridLines) {
          ctx.lineWidth = config.scaleGridLineWidth;
          ctx.strokeStyle = config.scaleGridLineColor;
          ctx.lineTo(yAxisPosX + xAxisLength + 5, xAxisPosY - (j + 1) * scaleHop)
        }else {
          ctx.lineTo(yAxisPosX - 0.5, xAxisPosY - (j + 1) * scaleHop)
        }
        ctx.stroke();
        if(config.scaleShowLabels) {
          ctx.fillText(calculatedScale.labels[j], yAxisPosX - 8, xAxisPosY - (j + 1) * scaleHop)
        }
      }
    }
    function calculateXAxisSize() {
      var longestText = 1;
      if(config.scaleShowLabels) {
        ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
        for(var i = 0;i < calculatedScale.labels.length;i++) {
          var measuredText = ctx.measureText(calculatedScale.labels[i]).width;
          longestText = measuredText > longestText ? measuredText : longestText
        }
        longestText += 10
      }
      xAxisLength = width - longestText - widestXLabel;
      valueHop = Math.floor(xAxisLength / data.labels.length);
      barWidth = (valueHop - config.scaleGridLineWidth * 2 - config.barValueSpacing * 2 - (config.barDatasetSpacing * data.datasets.length - 1) - (config.barStrokeWidth / 2 * data.datasets.length - 1)) / data.datasets.length;
      yAxisPosX = width - widestXLabel / 2 - xAxisLength;
      xAxisPosY = scaleHeight + config.scaleFontSize / 2
    }
    function calculateDrawingSizes() {
      maxSize = height;
      ctx.font = config.scaleFontStyle + " " + config.scaleFontSize + "px " + config.scaleFontFamily;
      widestXLabel = 1;
      for(var i = 0;i < data.labels.length;i++) {
        var textLength = ctx.measureText(data.labels[i]).width;
        widestXLabel = textLength > widestXLabel ? textLength : widestXLabel
      }
      if(width / data.labels.length < widestXLabel) {
        rotateLabels = 45;
        if(width / data.labels.length < Math.cos(rotateLabels) * widestXLabel) {
          rotateLabels = 90;
          maxSize -= widestXLabel
        }else {
          maxSize -= Math.sin(rotateLabels) * widestXLabel
        }
      }else {
        maxSize -= config.scaleFontSize
      }
      maxSize -= 5;
      labelHeight = config.scaleFontSize;
      maxSize -= labelHeight;
      scaleHeight = maxSize
    }
    function getValueBounds() {
      var upperValue = Number.MIN_VALUE;
      var lowerValue = Number.MAX_VALUE;
      for(var i = 0;i < data.datasets.length;i++) {
        for(var j = 0;j < data.datasets[i].data.length;j++) {
          if(data.datasets[i].data[j] > upperValue) {
            upperValue = data.datasets[i].data[j]
          }
          if(data.datasets[i].data[j] < lowerValue) {
            lowerValue = data.datasets[i].data[j]
          }
        }
      }
      var maxSteps = Math.floor(scaleHeight / (labelHeight * 0.66));
      var minSteps = Math.floor(scaleHeight / labelHeight * 0.5);
      return{maxValue:upperValue, minValue:lowerValue, maxSteps:maxSteps, minSteps:minSteps}
    }
  };
  function calculateOffset(val, calculatedScale, scaleHop) {
    var outerValue = calculatedScale.steps * calculatedScale.stepValue;
    var adjustedValue = val - calculatedScale.graphMin;
    var scalingFactor = CapValue(adjustedValue / outerValue, 1, 0);
    return scaleHop * calculatedScale.steps * scalingFactor
  }
  function animationLoop(config, drawScale, drawData, ctx) {
    var animFrameAmount = config.animation ? 1 / CapValue(config.animationSteps, Number.MAX_VALUE, 1) : 1, easingFunction = animationOptions[config.animationEasing], percentAnimComplete = config.animation ? 0 : 1;
    if(typeof drawScale !== "function") {
      drawScale = function() {
      }
    }
    requestAnimFrame(animLoop);
    function animateFrame() {
      var easeAdjustedAnimationPercent = config.animation ? CapValue(easingFunction(percentAnimComplete), null, 0) : 1;
      clear(ctx);
      if(config.scaleOverlay) {
        drawData(easeAdjustedAnimationPercent);
        drawScale()
      }else {
        drawScale();
        drawData(easeAdjustedAnimationPercent)
      }
    }
    function animLoop() {
      percentAnimComplete += animFrameAmount;
      animateFrame();
      if(percentAnimComplete <= 1) {
        requestAnimFrame(animLoop)
      }else {
        if(typeof config.onAnimationComplete == "function") {
          config.onAnimationComplete()
        }
      }
    }
  }
  var requestAnimFrame = function() {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
      window.setTimeout(callback, 1E3 / 60)
    }
  }();
  function calculateScale(drawingHeight, maxSteps, minSteps, maxValue, minValue, labelTemplateString) {
    var graphMin, graphMax, graphRange, stepValue, numberOfSteps, valueRange, rangeOrderOfMagnitude, decimalNum;
    valueRange = maxValue - minValue;
    rangeOrderOfMagnitude = calculateOrderOfMagnitude(valueRange);
    graphMin = Math.floor(minValue / (1 * Math.pow(10, rangeOrderOfMagnitude))) * Math.pow(10, rangeOrderOfMagnitude);
    graphMax = Math.ceil(maxValue / (1 * Math.pow(10, rangeOrderOfMagnitude))) * Math.pow(10, rangeOrderOfMagnitude);
    graphRange = graphMax - graphMin;
    stepValue = Math.pow(10, rangeOrderOfMagnitude);
    numberOfSteps = Math.round(graphRange / stepValue);
    while(numberOfSteps < minSteps || numberOfSteps > maxSteps) {
      if(numberOfSteps < minSteps) {
        stepValue /= 2;
        numberOfSteps = Math.round(graphRange / stepValue)
      }else {
        stepValue *= 2;
        numberOfSteps = Math.round(graphRange / stepValue)
      }
    }
    var labels = [];
    populateLabels(labelTemplateString, labels, numberOfSteps, graphMin, stepValue);
    return{steps:numberOfSteps, stepValue:stepValue, graphMin:graphMin, labels:labels};
    function calculateOrderOfMagnitude(val) {
      return Math.floor(Math.log(val) / Math.LN10)
    }
  }
  function populateLabels(labelTemplateString, labels, numberOfSteps, graphMin, stepValue) {
    if(labelTemplateString) {
      for(var i = 1;i < numberOfSteps + 1;i++) {
        labels.push(tmpl(labelTemplateString, {value:(graphMin + stepValue * i).toFixed(getDecimalPlaces(stepValue))}))
      }
    }
  }
  function populateLabels(labelTemplateString, labels, numberOfSteps, graphMin, stepValue) {
    if(labelTemplateString) {
      for(var i = 1;i < numberOfSteps + 1;i++) {
        labels.push(tmpl(labelTemplateString, {value:(graphMin + stepValue * i).toFixed(getDecimalPlaces(stepValue))}))
      }
    }
  }
  function Max(array) {
    return Math.max.apply(Math, array)
  }
  function Min(array) {
    return Math.min.apply(Math, array)
  }
  function Default(userDeclared, valueIfFalse) {
    if(!userDeclared) {
      return valueIfFalse
    }else {
      return userDeclared
    }
  }
  function isNumber(n) {
    return!isNaN(parseFloat(n)) && isFinite(n)
  }
  function CapValue(valueToCap, maxValue, minValue) {
    if(isNumber(maxValue)) {
      if(valueToCap > maxValue) {
        return maxValue
      }
    }
    if(isNumber(minValue)) {
      if(valueToCap < minValue) {
        return minValue
      }
    }
    return valueToCap
  }
  function getDecimalPlaces(num) {
    var numberOfDecimalPlaces;
    if(num % 1 != 0) {
      return num.toString().split(".")[1].length
    }else {
      return 0
    }
  }
  function mergeChartConfig(defaults, userDefined) {
    var returnObj = {};
    for(var attrname in defaults) {
      returnObj[attrname] = defaults[attrname]
    }
    for(var attrname in userDefined) {
      if(typeof userDefined[attrname] === "object" && defaults[attrname]) {
        returnObj[attrname] = mergeChartConfig(defaults[attrname], userDefined[attrname])
      }else {
        returnObj[attrname] = userDefined[attrname]
      }
    }
    return returnObj
  }
  var cache = {};
  function tmpl(str, data) {
    var fn = !/\W/.test(str) ? cache[str] = cache[str] || tmpl(document.getElementById(str).innerHTML) : new Function("obj", "var p=[],print=function(){p.push.apply(p,arguments);};" + "with(obj){p.push('" + str.replace(/[\r\t\n]/g, " ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g, "$1\r").replace(/\t=(.*?)%>/g, "',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'") + "');}return p.join('');");
    return data ? fn(data) : fn
  }
  function getFadeColor(percent, primColor, secColor) {
    var pseudoEl = document.createElement("div"), rgbPrim, rgbSec;
    pseudoEl.style.color = primColor;
    document.body.appendChild(pseudoEl);
    rgbPrim = window.getComputedStyle(pseudoEl).color;
    pseudoEl.style.color = secColor;
    rgbSec = window.getComputedStyle(pseudoEl).color;
    var regex = /rgb *\( *([0-9]{1,3}) *, *([0-9]{1,3}) *, *([0-9]{1,3}) *\)/, valuesP = regex.exec(rgbPrim), valuesS = regex.exec(rgbSec), rP = Math.round(parseFloat(valuesP[1])), gP = Math.round(parseFloat(valuesP[2])), bP = Math.round(parseFloat(valuesP[3])), rS = Math.round(parseFloat(valuesS[1])), gS = Math.round(parseFloat(valuesS[2])), bS = Math.round(parseFloat(valuesS[3])), rCur = parseInt((rP - rS) * percent + rS), gCur = parseInt((gP - gS) * percent + gS), bCur = parseInt((bP - bS) * percent + 
    bS);
    pseudoEl.parentNode.removeChild(pseudoEl);
    return"rgb(" + rCur + "," + gCur + "," + bCur + ")"
  }
};
(function(a, b) {
  function cy(a) {
    return f.isWindow(a) ? a : a.nodeType === 9 ? a.defaultView || a.parentWindow : !1
  }
  function cu(a) {
    if(!cj[a]) {
      var b = c.body, d = f("<" + a + ">").appendTo(b), e = d.css("display");
      d.remove();
      if(e === "none" || e === "") {
        ck || (ck = c.createElement("iframe"), ck.frameBorder = ck.width = ck.height = 0), b.appendChild(ck);
        if(!cl || !ck.createElement) {
          cl = (ck.contentWindow || ck.contentDocument).document, cl.write((f.support.boxModel ? "<!doctype html>" : "") + "<html><body>"), cl.close()
        }
        d = cl.createElement(a), cl.body.appendChild(d), e = f.css(d, "display"), b.removeChild(ck)
      }
      cj[a] = e
    }
    return cj[a]
  }
  function ct(a, b) {
    var c = {};
    f.each(cp.concat.apply([], cp.slice(0, b)), function() {
      c[this] = a
    });
    return c
  }
  function cs() {
    cq = b
  }
  function cr() {
    setTimeout(cs, 0);
    return cq = f.now()
  }
  function ci() {
    try {
      return new a.ActiveXObject("Microsoft.XMLHTTP")
    }catch(b) {
    }
  }
  function ch() {
    try {
      return new a.XMLHttpRequest
    }catch(b) {
    }
  }
  function cb(a, c) {
    a.dataFilter && (c = a.dataFilter(c, a.dataType));
    var d = a.dataTypes, e = {}, g, h, i = d.length, j, k = d[0], l, m, n, o, p;
    for(g = 1;g < i;g++) {
      if(g === 1) {
        for(h in a.converters) {
          typeof h == "string" && (e[h.toLowerCase()] = a.converters[h])
        }
      }
      l = k, k = d[g];
      if(k === "*") {
        k = l
      }else {
        if(l !== "*" && l !== k) {
          m = l + " " + k, n = e[m] || e["* " + k];
          if(!n) {
            p = b;
            for(o in e) {
              j = o.split(" ");
              if(j[0] === l || j[0] === "*") {
                p = e[j[1] + " " + k];
                if(p) {
                  o = e[o], o === !0 ? n = p : p === !0 && (n = o);
                  break
                }
              }
            }
          }
          !n && !p && f.error("No conversion from " + m.replace(" ", " to ")), n !== !0 && (c = n ? n(c) : p(o(c)))
        }
      }
    }
    return c
  }
  function ca(a, c, d) {
    var e = a.contents, f = a.dataTypes, g = a.responseFields, h, i, j, k;
    for(i in g) {
      i in d && (c[g[i]] = d[i])
    }
    while(f[0] === "*") {
      f.shift(), h === b && (h = a.mimeType || c.getResponseHeader("content-type"))
    }
    if(h) {
      for(i in e) {
        if(e[i] && e[i].test(h)) {
          f.unshift(i);
          break
        }
      }
    }
    if(f[0] in d) {
      j = f[0]
    }else {
      for(i in d) {
        if(!f[0] || a.converters[i + " " + f[0]]) {
          j = i;
          break
        }
        k || (k = i)
      }
      j = j || k
    }
    if(j) {
      j !== f[0] && f.unshift(j);
      return d[j]
    }
  }
  function b_(a, b, c, d) {
    if(f.isArray(b)) {
      f.each(b, function(b, e) {
        c || bD.test(a) ? d(a, e) : b_(a + "[" + (typeof e == "object" ? b : "") + "]", e, c, d)
      })
    }else {
      if(!c && f.type(b) === "object") {
        for(var e in b) {
          b_(a + "[" + e + "]", b[e], c, d)
        }
      }else {
        d(a, b)
      }
    }
  }
  function b$(a, c) {
    var d, e, g = f.ajaxSettings.flatOptions || {};
    for(d in c) {
      c[d] !== b && ((g[d] ? a : e || (e = {}))[d] = c[d])
    }
    e && f.extend(!0, a, e)
  }
  function bZ(a, c, d, e, f, g) {
    f = f || c.dataTypes[0], g = g || {}, g[f] = !0;
    var h = a[f], i = 0, j = h ? h.length : 0, k = a === bS, l;
    for(;i < j && (k || !l);i++) {
      l = h[i](c, d, e), typeof l == "string" && (!k || g[l] ? l = b : (c.dataTypes.unshift(l), l = bZ(a, c, d, e, l, g)))
    }
    (k || !l) && !g["*"] && (l = bZ(a, c, d, e, "*", g));
    return l
  }
  function bY(a) {
    return function(b, c) {
      typeof b != "string" && (c = b, b = "*");
      if(f.isFunction(c)) {
        var d = b.toLowerCase().split(bO), e = 0, g = d.length, h, i, j;
        for(;e < g;e++) {
          h = d[e], j = /^\+/.test(h), j && (h = h.substr(1) || "*"), i = a[h] = a[h] || [], i[j ? "unshift" : "push"](c)
        }
      }
    }
  }
  function bB(a, b, c) {
    var d = b === "width" ? a.offsetWidth : a.offsetHeight, e = b === "width" ? 1 : 0, g = 4;
    if(d > 0) {
      if(c !== "border") {
        for(;e < g;e += 2) {
          c || (d -= parseFloat(f.css(a, "padding" + bx[e])) || 0), c === "margin" ? d += parseFloat(f.css(a, c + bx[e])) || 0 : d -= parseFloat(f.css(a, "border" + bx[e] + "Width")) || 0
        }
      }
      return d + "px"
    }
    d = by(a, b);
    if(d < 0 || d == null) {
      d = a.style[b]
    }
    if(bt.test(d)) {
      return d
    }
    d = parseFloat(d) || 0;
    if(c) {
      for(;e < g;e += 2) {
        d += parseFloat(f.css(a, "padding" + bx[e])) || 0, c !== "padding" && (d += parseFloat(f.css(a, "border" + bx[e] + "Width")) || 0), c === "margin" && (d += parseFloat(f.css(a, c + bx[e])) || 0)
      }
    }
    return d + "px"
  }
  function bo(a) {
    var b = c.createElement("div");
    bh.appendChild(b), b.innerHTML = a.outerHTML;
    return b.firstChild
  }
  function bn(a) {
    var b = (a.nodeName || "").toLowerCase();
    b === "input" ? bm(a) : b !== "script" && typeof a.getElementsByTagName != "undefined" && f.grep(a.getElementsByTagName("input"), bm)
  }
  function bm(a) {
    if(a.type === "checkbox" || a.type === "radio") {
      a.defaultChecked = a.checked
    }
  }
  function bl(a) {
    return typeof a.getElementsByTagName != "undefined" ? a.getElementsByTagName("*") : typeof a.querySelectorAll != "undefined" ? a.querySelectorAll("*") : []
  }
  function bk(a, b) {
    var c;
    b.nodeType === 1 && (b.clearAttributes && b.clearAttributes(), b.mergeAttributes && b.mergeAttributes(a), c = b.nodeName.toLowerCase(), c === "object" ? b.outerHTML = a.outerHTML : c !== "input" || a.type !== "checkbox" && a.type !== "radio" ? c === "option" ? b.selected = a.defaultSelected : c === "input" || c === "textarea" ? b.defaultValue = a.defaultValue : c === "script" && b.text !== a.text && (b.text = a.text) : (a.checked && (b.defaultChecked = b.checked = a.checked), b.value !== a.value && 
    (b.value = a.value)), b.removeAttribute(f.expando), b.removeAttribute("_submit_attached"), b.removeAttribute("_change_attached"))
  }
  function bj(a, b) {
    if(b.nodeType === 1 && !!f.hasData(a)) {
      var c, d, e, g = f._data(a), h = f._data(b, g), i = g.events;
      if(i) {
        delete h.handle, h.events = {};
        for(c in i) {
          for(d = 0, e = i[c].length;d < e;d++) {
            f.event.add(b, c, i[c][d])
          }
        }
      }
      h.data && (h.data = f.extend({}, h.data))
    }
  }
  function bi(a, b) {
    return f.nodeName(a, "table") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a
  }
  function U(a) {
    var b = V.split("|"), c = a.createDocumentFragment();
    if(c.createElement) {
      while(b.length) {
        c.createElement(b.pop())
      }
    }
    return c
  }
  function T(a, b, c) {
    b = b || 0;
    if(f.isFunction(b)) {
      return f.grep(a, function(a, d) {
        var e = !!b.call(a, d, a);
        return e === c
      })
    }
    if(b.nodeType) {
      return f.grep(a, function(a, d) {
        return a === b === c
      })
    }
    if(typeof b == "string") {
      var d = f.grep(a, function(a) {
        return a.nodeType === 1
      });
      if(O.test(b)) {
        return f.filter(b, d, !c)
      }
      b = f.filter(b, d)
    }
    return f.grep(a, function(a, d) {
      return f.inArray(a, b) >= 0 === c
    })
  }
  function S(a) {
    return!a || !a.parentNode || a.parentNode.nodeType === 11
  }
  function K() {
    return!0
  }
  function J() {
    return!1
  }
  function n(a, b, c) {
    var d = b + "defer", e = b + "queue", g = b + "mark", h = f._data(a, d);
    h && (c === "queue" || !f._data(a, e)) && (c === "mark" || !f._data(a, g)) && setTimeout(function() {
      !f._data(a, e) && !f._data(a, g) && (f.removeData(a, d, !0), h.fire())
    }, 0)
  }
  function m(a) {
    for(var b in a) {
      if(b === "data" && f.isEmptyObject(a[b])) {
        continue
      }
      if(b !== "toJSON") {
        return!1
      }
    }
    return!0
  }
  function l(a, c, d) {
    if(d === b && a.nodeType === 1) {
      var e = "data-" + c.replace(k, "-$1").toLowerCase();
      d = a.getAttribute(e);
      if(typeof d == "string") {
        try {
          d = d === "true" ? !0 : d === "false" ? !1 : d === "null" ? null : f.isNumeric(d) ? +d : j.test(d) ? f.parseJSON(d) : d
        }catch(g) {
        }
        f.data(a, c, d)
      }else {
        d = b
      }
    }
    return d
  }
  function h(a) {
    var b = g[a] = {}, c, d;
    a = a.split(/\s+/);
    for(c = 0, d = a.length;c < d;c++) {
      b[a[c]] = !0
    }
    return b
  }
  var c = a.document, d = a.navigator, e = a.location, f = function() {
    function J() {
      if(!e.isReady) {
        try {
          c.documentElement.doScroll("left")
        }catch(a) {
          setTimeout(J, 1);
          return
        }
        e.ready()
      }
    }
    var e = function(a, b) {
      return new e.fn.init(a, b, h)
    }, f = a.jQuery, g = a.$, h, i = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, j = /\S/, k = /^\s+/, l = /\s+$/, m = /^<(\w+)\s*\/?>(?:<\/\1>)?$/, n = /^[\],:{}\s]*$/, o = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, p = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, q = /(?:^|:|,)(?:\s*\[)+/g, r = /(webkit)[ \/]([\w.]+)/, s = /(opera)(?:.*version)?[ \/]([\w.]+)/, t = /(msie) ([\w.]+)/, u = /(mozilla)(?:.*? rv:([\w.]+))?/, v = /-([a-z]|[0-9])/ig, w = /^-ms-/, x = function(a, b) {
      return(b + "").toUpperCase()
    }, y = d.userAgent, z, A, B, C = Object.prototype.toString, D = Object.prototype.hasOwnProperty, E = Array.prototype.push, F = Array.prototype.slice, G = String.prototype.trim, H = Array.prototype.indexOf, I = {};
    e.fn = e.prototype = {constructor:e, init:function(a, d, f) {
      var g, h, j, k;
      if(!a) {
        return this
      }
      if(a.nodeType) {
        this.context = this[0] = a, this.length = 1;
        return this
      }
      if(a === "body" && !d && c.body) {
        this.context = c, this[0] = c.body, this.selector = a, this.length = 1;
        return this
      }
      if(typeof a == "string") {
        a.charAt(0) !== "<" || a.charAt(a.length - 1) !== ">" || a.length < 3 ? g = i.exec(a) : g = [null, a, null];
        if(g && (g[1] || !d)) {
          if(g[1]) {
            d = d instanceof e ? d[0] : d, k = d ? d.ownerDocument || d : c, j = m.exec(a), j ? e.isPlainObject(d) ? (a = [c.createElement(j[1])], e.fn.attr.call(a, d, !0)) : a = [k.createElement(j[1])] : (j = e.buildFragment([g[1]], [k]), a = (j.cacheable ? e.clone(j.fragment) : j.fragment).childNodes);
            return e.merge(this, a)
          }
          h = c.getElementById(g[2]);
          if(h && h.parentNode) {
            if(h.id !== g[2]) {
              return f.find(a)
            }
            this.length = 1, this[0] = h
          }
          this.context = c, this.selector = a;
          return this
        }
        return!d || d.jquery ? (d || f).find(a) : this.constructor(d).find(a)
      }
      if(e.isFunction(a)) {
        return f.ready(a)
      }
      a.selector !== b && (this.selector = a.selector, this.context = a.context);
      return e.makeArray(a, this)
    }, selector:"", jquery:"1.7.2", length:0, size:function() {
      return this.length
    }, toArray:function() {
      return F.call(this, 0)
    }, get:function(a) {
      return a == null ? this.toArray() : a < 0 ? this[this.length + a] : this[a]
    }, pushStack:function(a, b, c) {
      var d = this.constructor();
      e.isArray(a) ? E.apply(d, a) : e.merge(d, a), d.prevObject = this, d.context = this.context, b === "find" ? d.selector = this.selector + (this.selector ? " " : "") + c : b && (d.selector = this.selector + "." + b + "(" + c + ")");
      return d
    }, each:function(a, b) {
      return e.each(this, a, b)
    }, ready:function(a) {
      e.bindReady(), A.add(a);
      return this
    }, eq:function(a) {
      a = +a;
      return a === -1 ? this.slice(a) : this.slice(a, a + 1)
    }, first:function() {
      return this.eq(0)
    }, last:function() {
      return this.eq(-1)
    }, slice:function() {
      return this.pushStack(F.apply(this, arguments), "slice", F.call(arguments).join(","))
    }, map:function(a) {
      return this.pushStack(e.map(this, function(b, c) {
        return a.call(b, c, b)
      }))
    }, end:function() {
      return this.prevObject || this.constructor(null)
    }, push:E, sort:[].sort, splice:[].splice}, e.fn.init.prototype = e.fn, e.extend = e.fn.extend = function() {
      var a, c, d, f, g, h, i = arguments[0] || {}, j = 1, k = arguments.length, l = !1;
      typeof i == "boolean" && (l = i, i = arguments[1] || {}, j = 2), typeof i != "object" && !e.isFunction(i) && (i = {}), k === j && (i = this, --j);
      for(;j < k;j++) {
        if((a = arguments[j]) != null) {
          for(c in a) {
            d = i[c], f = a[c];
            if(i === f) {
              continue
            }
            l && f && (e.isPlainObject(f) || (g = e.isArray(f))) ? (g ? (g = !1, h = d && e.isArray(d) ? d : []) : h = d && e.isPlainObject(d) ? d : {}, i[c] = e.extend(l, h, f)) : f !== b && (i[c] = f)
          }
        }
      }
      return i
    }, e.extend({noConflict:function(b) {
      a.$ === e && (a.$ = g), b && a.jQuery === e && (a.jQuery = f);
      return e
    }, isReady:!1, readyWait:1, holdReady:function(a) {
      a ? e.readyWait++ : e.ready(!0)
    }, ready:function(a) {
      if(a === !0 && !--e.readyWait || a !== !0 && !e.isReady) {
        if(!c.body) {
          return setTimeout(e.ready, 1)
        }
        e.isReady = !0;
        if(a !== !0 && --e.readyWait > 0) {
          return
        }
        A.fireWith(c, [e]), e.fn.trigger && e(c).trigger("ready").off("ready")
      }
    }, bindReady:function() {
      if(!A) {
        A = e.Callbacks("once memory");
        if(c.readyState === "complete") {
          return setTimeout(e.ready, 1)
        }
        if(c.addEventListener) {
          c.addEventListener("DOMContentLoaded", B, !1), a.addEventListener("load", e.ready, !1)
        }else {
          if(c.attachEvent) {
            c.attachEvent("onreadystatechange", B), a.attachEvent("onload", e.ready);
            var b = !1;
            try {
              b = a.frameElement == null
            }catch(d) {
            }
            c.documentElement.doScroll && b && J()
          }
        }
      }
    }, isFunction:function(a) {
      return e.type(a) === "function"
    }, isArray:Array.isArray || function(a) {
      return e.type(a) === "array"
    }, isWindow:function(a) {
      return a != null && a == a.window
    }, isNumeric:function(a) {
      return!isNaN(parseFloat(a)) && isFinite(a)
    }, type:function(a) {
      return a == null ? String(a) : I[C.call(a)] || "object"
    }, isPlainObject:function(a) {
      if(!a || e.type(a) !== "object" || a.nodeType || e.isWindow(a)) {
        return!1
      }
      try {
        if(a.constructor && !D.call(a, "constructor") && !D.call(a.constructor.prototype, "isPrototypeOf")) {
          return!1
        }
      }catch(c) {
        return!1
      }
      var d;
      for(d in a) {
      }
      return d === b || D.call(a, d)
    }, isEmptyObject:function(a) {
      for(var b in a) {
        return!1
      }
      return!0
    }, error:function(a) {
      throw new Error(a);
    }, parseJSON:function(b) {
      if(typeof b != "string" || !b) {
        return null
      }
      b = e.trim(b);
      if(a.JSON && a.JSON.parse) {
        return a.JSON.parse(b)
      }
      if(n.test(b.replace(o, "@").replace(p, "]").replace(q, ""))) {
        return(new Function("return " + b))()
      }
      e.error("Invalid JSON: " + b)
    }, parseXML:function(c) {
      if(typeof c != "string" || !c) {
        return null
      }
      var d, f;
      try {
        a.DOMParser ? (f = new DOMParser, d = f.parseFromString(c, "text/xml")) : (d = new ActiveXObject("Microsoft.XMLDOM"), d.async = "false", d.loadXML(c))
      }catch(g) {
        d = b
      }
      (!d || !d.documentElement || d.getElementsByTagName("parsererror").length) && e.error("Invalid XML: " + c);
      return d
    }, noop:function() {
    }, globalEval:function(b) {
      b && j.test(b) && (a.execScript || function(b) {
        a.eval.call(a, b)
      })(b)
    }, camelCase:function(a) {
      return a.replace(w, "ms-").replace(v, x)
    }, nodeName:function(a, b) {
      return a.nodeName && a.nodeName.toUpperCase() === b.toUpperCase()
    }, each:function(a, c, d) {
      var f, g = 0, h = a.length, i = h === b || e.isFunction(a);
      if(d) {
        if(i) {
          for(f in a) {
            if(c.apply(a[f], d) === !1) {
              break
            }
          }
        }else {
          for(;g < h;) {
            if(c.apply(a[g++], d) === !1) {
              break
            }
          }
        }
      }else {
        if(i) {
          for(f in a) {
            if(c.call(a[f], f, a[f]) === !1) {
              break
            }
          }
        }else {
          for(;g < h;) {
            if(c.call(a[g], g, a[g++]) === !1) {
              break
            }
          }
        }
      }
      return a
    }, trim:G ? function(a) {
      return a == null ? "" : G.call(a)
    } : function(a) {
      return a == null ? "" : (a + "").replace(k, "").replace(l, "")
    }, makeArray:function(a, b) {
      var c = b || [];
      if(a != null) {
        var d = e.type(a);
        a.length == null || d === "string" || d === "function" || d === "regexp" || e.isWindow(a) ? E.call(c, a) : e.merge(c, a)
      }
      return c
    }, inArray:function(a, b, c) {
      var d;
      if(b) {
        if(H) {
          return H.call(b, a, c)
        }
        d = b.length, c = c ? c < 0 ? Math.max(0, d + c) : c : 0;
        for(;c < d;c++) {
          if(c in b && b[c] === a) {
            return c
          }
        }
      }
      return-1
    }, merge:function(a, c) {
      var d = a.length, e = 0;
      if(typeof c.length == "number") {
        for(var f = c.length;e < f;e++) {
          a[d++] = c[e]
        }
      }else {
        while(c[e] !== b) {
          a[d++] = c[e++]
        }
      }
      a.length = d;
      return a
    }, grep:function(a, b, c) {
      var d = [], e;
      c = !!c;
      for(var f = 0, g = a.length;f < g;f++) {
        e = !!b(a[f], f), c !== e && d.push(a[f])
      }
      return d
    }, map:function(a, c, d) {
      var f, g, h = [], i = 0, j = a.length, k = a instanceof e || j !== b && typeof j == "number" && (j > 0 && a[0] && a[j - 1] || j === 0 || e.isArray(a));
      if(k) {
        for(;i < j;i++) {
          f = c(a[i], i, d), f != null && (h[h.length] = f)
        }
      }else {
        for(g in a) {
          f = c(a[g], g, d), f != null && (h[h.length] = f)
        }
      }
      return h.concat.apply([], h)
    }, guid:1, proxy:function(a, c) {
      if(typeof c == "string") {
        var d = a[c];
        c = a, a = d
      }
      if(!e.isFunction(a)) {
        return b
      }
      var f = F.call(arguments, 2), g = function() {
        return a.apply(c, f.concat(F.call(arguments)))
      };
      g.guid = a.guid = a.guid || g.guid || e.guid++;
      return g
    }, access:function(a, c, d, f, g, h, i) {
      var j, k = d == null, l = 0, m = a.length;
      if(d && typeof d == "object") {
        for(l in d) {
          e.access(a, c, l, d[l], 1, h, f)
        }
        g = 1
      }else {
        if(f !== b) {
          j = i === b && e.isFunction(f), k && (j ? (j = c, c = function(a, b, c) {
            return j.call(e(a), c)
          }) : (c.call(a, f), c = null));
          if(c) {
            for(;l < m;l++) {
              c(a[l], d, j ? f.call(a[l], l, c(a[l], d)) : f, i)
            }
          }
          g = 1
        }
      }
      return g ? a : k ? c.call(a) : m ? c(a[0], d) : h
    }, now:function() {
      return(new Date).getTime()
    }, uaMatch:function(a) {
      a = a.toLowerCase();
      var b = r.exec(a) || s.exec(a) || t.exec(a) || a.indexOf("compatible") < 0 && u.exec(a) || [];
      return{browser:b[1] || "", version:b[2] || "0"}
    }, sub:function() {
      function a(b, c) {
        return new a.fn.init(b, c)
      }
      e.extend(!0, a, this), a.superclass = this, a.fn = a.prototype = this(), a.fn.constructor = a, a.sub = this.sub, a.fn.init = function(d, f) {
        f && f instanceof e && !(f instanceof a) && (f = a(f));
        return e.fn.init.call(this, d, f, b)
      }, a.fn.init.prototype = a.fn;
      var b = a(c);
      return a
    }, browser:{}}), e.each("Boolean Number String Function Array Date RegExp Object".split(" "), function(a, b) {
      I["[object " + b + "]"] = b.toLowerCase()
    }), z = e.uaMatch(y), z.browser && (e.browser[z.browser] = !0, e.browser.version = z.version), e.browser.webkit && (e.browser.safari = !0), j.test("\u00a0") && (k = /^[\s\xA0]+/, l = /[\s\xA0]+$/), h = e(c), c.addEventListener ? B = function() {
      c.removeEventListener("DOMContentLoaded", B, !1), e.ready()
    } : c.attachEvent && (B = function() {
      c.readyState === "complete" && (c.detachEvent("onreadystatechange", B), e.ready())
    });
    return e
  }(), g = {};
  f.Callbacks = function(a) {
    a = a ? g[a] || h(a) : {};
    var c = [], d = [], e, i, j, k, l, m, n = function(b) {
      var d, e, g, h, i;
      for(d = 0, e = b.length;d < e;d++) {
        g = b[d], h = f.type(g), h === "array" ? n(g) : h === "function" && (!a.unique || !p.has(g)) && c.push(g)
      }
    }, o = function(b, f) {
      f = f || [], e = !a.memory || [b, f], i = !0, j = !0, m = k || 0, k = 0, l = c.length;
      for(;c && m < l;m++) {
        if(c[m].apply(b, f) === !1 && a.stopOnFalse) {
          e = !0;
          break
        }
      }
      j = !1, c && (a.once ? e === !0 ? p.disable() : c = [] : d && d.length && (e = d.shift(), p.fireWith(e[0], e[1])))
    }, p = {add:function() {
      if(c) {
        var a = c.length;
        n(arguments), j ? l = c.length : e && e !== !0 && (k = a, o(e[0], e[1]))
      }
      return this
    }, remove:function() {
      if(c) {
        var b = arguments, d = 0, e = b.length;
        for(;d < e;d++) {
          for(var f = 0;f < c.length;f++) {
            if(b[d] === c[f]) {
              j && f <= l && (l--, f <= m && m--), c.splice(f--, 1);
              if(a.unique) {
                break
              }
            }
          }
        }
      }
      return this
    }, has:function(a) {
      if(c) {
        var b = 0, d = c.length;
        for(;b < d;b++) {
          if(a === c[b]) {
            return!0
          }
        }
      }
      return!1
    }, empty:function() {
      c = [];
      return this
    }, disable:function() {
      c = d = e = b;
      return this
    }, disabled:function() {
      return!c
    }, lock:function() {
      d = b, (!e || e === !0) && p.disable();
      return this
    }, locked:function() {
      return!d
    }, fireWith:function(b, c) {
      d && (j ? a.once || d.push([b, c]) : (!a.once || !e) && o(b, c));
      return this
    }, fire:function() {
      p.fireWith(this, arguments);
      return this
    }, fired:function() {
      return!!i
    }};
    return p
  };
  var i = [].slice;
  f.extend({Deferred:function(a) {
    var b = f.Callbacks("once memory"), c = f.Callbacks("once memory"), d = f.Callbacks("memory"), e = "pending", g = {resolve:b, reject:c, notify:d}, h = {done:b.add, fail:c.add, progress:d.add, state:function() {
      return e
    }, isResolved:b.fired, isRejected:c.fired, then:function(a, b, c) {
      i.done(a).fail(b).progress(c);
      return this
    }, always:function() {
      i.done.apply(i, arguments).fail.apply(i, arguments);
      return this
    }, pipe:function(a, b, c) {
      return f.Deferred(function(d) {
        f.each({done:[a, "resolve"], fail:[b, "reject"], progress:[c, "notify"]}, function(a, b) {
          var c = b[0], e = b[1], g;
          f.isFunction(c) ? i[a](function() {
            g = c.apply(this, arguments), g && f.isFunction(g.promise) ? g.promise().then(d.resolve, d.reject, d.notify) : d[e + "With"](this === i ? d : this, [g])
          }) : i[a](d[e])
        })
      }).promise()
    }, promise:function(a) {
      if(a == null) {
        a = h
      }else {
        for(var b in h) {
          a[b] = h[b]
        }
      }
      return a
    }}, i = h.promise({}), j;
    for(j in g) {
      i[j] = g[j].fire, i[j + "With"] = g[j].fireWith
    }
    i.done(function() {
      e = "resolved"
    }, c.disable, d.lock).fail(function() {
      e = "rejected"
    }, b.disable, d.lock), a && a.call(i, i);
    return i
  }, when:function(a) {
    function m(a) {
      return function(b) {
        e[a] = arguments.length > 1 ? i.call(arguments, 0) : b, j.notifyWith(k, e)
      }
    }
    function l(a) {
      return function(c) {
        b[a] = arguments.length > 1 ? i.call(arguments, 0) : c, --g || j.resolveWith(j, b)
      }
    }
    var b = i.call(arguments, 0), c = 0, d = b.length, e = Array(d), g = d, h = d, j = d <= 1 && a && f.isFunction(a.promise) ? a : f.Deferred(), k = j.promise();
    if(d > 1) {
      for(;c < d;c++) {
        b[c] && b[c].promise && f.isFunction(b[c].promise) ? b[c].promise().then(l(c), j.reject, m(c)) : --g
      }
      g || j.resolveWith(j, b)
    }else {
      j !== a && j.resolveWith(j, d ? [a] : [])
    }
    return k
  }}), f.support = function() {
    var b, d, e, g, h, i, j, k, l, m, n, o, p = c.createElement("div"), q = c.documentElement;
    p.setAttribute("className", "t"), p.innerHTML = "   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>", d = p.getElementsByTagName("*"), e = p.getElementsByTagName("a")[0];
    if(!d || !d.length || !e) {
      return{}
    }
    g = c.createElement("select"), h = g.appendChild(c.createElement("option")), i = p.getElementsByTagName("input")[0], b = {leadingWhitespace:p.firstChild.nodeType === 3, tbody:!p.getElementsByTagName("tbody").length, htmlSerialize:!!p.getElementsByTagName("link").length, style:/top/.test(e.getAttribute("style")), hrefNormalized:e.getAttribute("href") === "/a", opacity:/^0.55/.test(e.style.opacity), cssFloat:!!e.style.cssFloat, checkOn:i.value === "on", optSelected:h.selected, getSetAttribute:p.className !== 
    "t", enctype:!!c.createElement("form").enctype, html5Clone:c.createElement("nav").cloneNode(!0).outerHTML !== "<:nav></:nav>", submitBubbles:!0, changeBubbles:!0, focusinBubbles:!1, deleteExpando:!0, noCloneEvent:!0, inlineBlockNeedsLayout:!1, shrinkWrapBlocks:!1, reliableMarginRight:!0, pixelMargin:!0}, f.boxModel = b.boxModel = c.compatMode === "CSS1Compat", i.checked = !0, b.noCloneChecked = i.cloneNode(!0).checked, g.disabled = !0, b.optDisabled = !h.disabled;
    try {
      delete p.test
    }catch(r) {
      b.deleteExpando = !1
    }
    !p.addEventListener && p.attachEvent && p.fireEvent && (p.attachEvent("onclick", function() {
      b.noCloneEvent = !1
    }), p.cloneNode(!0).fireEvent("onclick")), i = c.createElement("input"), i.value = "t", i.setAttribute("type", "radio"), b.radioValue = i.value === "t", i.setAttribute("checked", "checked"), i.setAttribute("name", "t"), p.appendChild(i), j = c.createDocumentFragment(), j.appendChild(p.lastChild), b.checkClone = j.cloneNode(!0).cloneNode(!0).lastChild.checked, b.appendChecked = i.checked, j.removeChild(i), j.appendChild(p);
    if(p.attachEvent) {
      for(n in{submit:1, change:1, focusin:1}) {
        m = "on" + n, o = m in p, o || (p.setAttribute(m, "return;"), o = typeof p[m] == "function"), b[n + "Bubbles"] = o
      }
    }
    j.removeChild(p), j = g = h = p = i = null, f(function() {
      var d, e, g, h, i, j, l, m, n, q, r, s, t, u = c.getElementsByTagName("body")[0];
      !u || (m = 1, t = "padding:0;margin:0;border:", r = "position:absolute;top:0;left:0;width:1px;height:1px;", s = t + "0;visibility:hidden;", n = "style='" + r + t + "5px solid #000;", q = "<div " + n + "display:block;'><div style='" + t + "0;display:block;overflow:hidden;'></div></div>" + "<table " + n + "' cellpadding='0' cellspacing='0'>" + "<tr><td></td></tr></table>", d = c.createElement("div"), d.style.cssText = s + "width:0;height:0;position:static;top:0;margin-top:" + m + "px", u.insertBefore(d, 
      u.firstChild), p = c.createElement("div"), d.appendChild(p), p.innerHTML = "<table><tr><td style='" + t + "0;display:none'></td><td>t</td></tr></table>", k = p.getElementsByTagName("td"), o = k[0].offsetHeight === 0, k[0].style.display = "", k[1].style.display = "none", b.reliableHiddenOffsets = o && k[0].offsetHeight === 0, a.getComputedStyle && (p.innerHTML = "", l = c.createElement("div"), l.style.width = "0", l.style.marginRight = "0", p.style.width = "2px", p.appendChild(l), b.reliableMarginRight = 
      (parseInt((a.getComputedStyle(l, null) || {marginRight:0}).marginRight, 10) || 0) === 0), typeof p.style.zoom != "undefined" && (p.innerHTML = "", p.style.width = p.style.padding = "1px", p.style.border = 0, p.style.overflow = "hidden", p.style.display = "inline", p.style.zoom = 1, b.inlineBlockNeedsLayout = p.offsetWidth === 3, p.style.display = "block", p.style.overflow = "visible", p.innerHTML = "<div style='width:5px;'></div>", b.shrinkWrapBlocks = p.offsetWidth !== 3), p.style.cssText = 
      r + s, p.innerHTML = q, e = p.firstChild, g = e.firstChild, i = e.nextSibling.firstChild.firstChild, j = {doesNotAddBorder:g.offsetTop !== 5, doesAddBorderForTableAndCells:i.offsetTop === 5}, g.style.position = "fixed", g.style.top = "20px", j.fixedPosition = g.offsetTop === 20 || g.offsetTop === 15, g.style.position = g.style.top = "", e.style.overflow = "hidden", e.style.position = "relative", j.subtractsBorderForOverflowNotVisible = g.offsetTop === -5, j.doesNotIncludeMarginInBodyOffset = 
      u.offsetTop !== m, a.getComputedStyle && (p.style.marginTop = "1%", b.pixelMargin = (a.getComputedStyle(p, null) || {marginTop:0}).marginTop !== "1%"), typeof d.style.zoom != "undefined" && (d.style.zoom = 1), u.removeChild(d), l = p = d = null, f.extend(b, j))
    });
    return b
  }();
  var j = /^(?:\{.*\}|\[.*\])$/, k = /([A-Z])/g;
  f.extend({cache:{}, uuid:0, expando:"jQuery" + (f.fn.jquery + Math.random()).replace(/\D/g, ""), noData:{embed:!0, object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000", applet:!0}, hasData:function(a) {
    a = a.nodeType ? f.cache[a[f.expando]] : a[f.expando];
    return!!a && !m(a)
  }, data:function(a, c, d, e) {
    if(!!f.acceptData(a)) {
      var g, h, i, j = f.expando, k = typeof c == "string", l = a.nodeType, m = l ? f.cache : a, n = l ? a[j] : a[j] && j, o = c === "events";
      if((!n || !m[n] || !o && !e && !m[n].data) && k && d === b) {
        return
      }
      n || (l ? a[j] = n = ++f.uuid : n = j), m[n] || (m[n] = {}, l || (m[n].toJSON = f.noop));
      if(typeof c == "object" || typeof c == "function") {
        e ? m[n] = f.extend(m[n], c) : m[n].data = f.extend(m[n].data, c)
      }
      g = h = m[n], e || (h.data || (h.data = {}), h = h.data), d !== b && (h[f.camelCase(c)] = d);
      if(o && !h[c]) {
        return g.events
      }
      k ? (i = h[c], i == null && (i = h[f.camelCase(c)])) : i = h;
      return i
    }
  }, removeData:function(a, b, c) {
    if(!!f.acceptData(a)) {
      var d, e, g, h = f.expando, i = a.nodeType, j = i ? f.cache : a, k = i ? a[h] : h;
      if(!j[k]) {
        return
      }
      if(b) {
        d = c ? j[k] : j[k].data;
        if(d) {
          f.isArray(b) || (b in d ? b = [b] : (b = f.camelCase(b), b in d ? b = [b] : b = b.split(" ")));
          for(e = 0, g = b.length;e < g;e++) {
            delete d[b[e]]
          }
          if(!(c ? m : f.isEmptyObject)(d)) {
            return
          }
        }
      }
      if(!c) {
        delete j[k].data;
        if(!m(j[k])) {
          return
        }
      }
      f.support.deleteExpando || !j.setInterval ? delete j[k] : j[k] = null, i && (f.support.deleteExpando ? delete a[h] : a.removeAttribute ? a.removeAttribute(h) : a[h] = null)
    }
  }, _data:function(a, b, c) {
    return f.data(a, b, c, !0)
  }, acceptData:function(a) {
    if(a.nodeName) {
      var b = f.noData[a.nodeName.toLowerCase()];
      if(b) {
        return b !== !0 && a.getAttribute("classid") === b
      }
    }
    return!0
  }}), f.fn.extend({data:function(a, c) {
    var d, e, g, h, i, j = this[0], k = 0, m = null;
    if(a === b) {
      if(this.length) {
        m = f.data(j);
        if(j.nodeType === 1 && !f._data(j, "parsedAttrs")) {
          g = j.attributes;
          for(i = g.length;k < i;k++) {
            h = g[k].name, h.indexOf("data-") === 0 && (h = f.camelCase(h.substring(5)), l(j, h, m[h]))
          }
          f._data(j, "parsedAttrs", !0)
        }
      }
      return m
    }
    if(typeof a == "object") {
      return this.each(function() {
        f.data(this, a)
      })
    }
    d = a.split(".", 2), d[1] = d[1] ? "." + d[1] : "", e = d[1] + "!";
    return f.access(this, function(c) {
      if(c === b) {
        m = this.triggerHandler("getData" + e, [d[0]]), m === b && j && (m = f.data(j, a), m = l(j, a, m));
        return m === b && d[1] ? this.data(d[0]) : m
      }
      d[1] = c, this.each(function() {
        var b = f(this);
        b.triggerHandler("setData" + e, d), f.data(this, a, c), b.triggerHandler("changeData" + e, d)
      })
    }, null, c, arguments.length > 1, null, !1)
  }, removeData:function(a) {
    return this.each(function() {
      f.removeData(this, a)
    })
  }}), f.extend({_mark:function(a, b) {
    a && (b = (b || "fx") + "mark", f._data(a, b, (f._data(a, b) || 0) + 1))
  }, _unmark:function(a, b, c) {
    a !== !0 && (c = b, b = a, a = !1);
    if(b) {
      c = c || "fx";
      var d = c + "mark", e = a ? 0 : (f._data(b, d) || 1) - 1;
      e ? f._data(b, d, e) : (f.removeData(b, d, !0), n(b, c, "mark"))
    }
  }, queue:function(a, b, c) {
    var d;
    if(a) {
      b = (b || "fx") + "queue", d = f._data(a, b), c && (!d || f.isArray(c) ? d = f._data(a, b, f.makeArray(c)) : d.push(c));
      return d || []
    }
  }, dequeue:function(a, b) {
    b = b || "fx";
    var c = f.queue(a, b), d = c.shift(), e = {};
    d === "inprogress" && (d = c.shift()), d && (b === "fx" && c.unshift("inprogress"), f._data(a, b + ".run", e), d.call(a, function() {
      f.dequeue(a, b)
    }, e)), c.length || (f.removeData(a, b + "queue " + b + ".run", !0), n(a, b, "queue"))
  }}), f.fn.extend({queue:function(a, c) {
    var d = 2;
    typeof a != "string" && (c = a, a = "fx", d--);
    if(arguments.length < d) {
      return f.queue(this[0], a)
    }
    return c === b ? this : this.each(function() {
      var b = f.queue(this, a, c);
      a === "fx" && b[0] !== "inprogress" && f.dequeue(this, a)
    })
  }, dequeue:function(a) {
    return this.each(function() {
      f.dequeue(this, a)
    })
  }, delay:function(a, b) {
    a = f.fx ? f.fx.speeds[a] || a : a, b = b || "fx";
    return this.queue(b, function(b, c) {
      var d = setTimeout(b, a);
      c.stop = function() {
        clearTimeout(d)
      }
    })
  }, clearQueue:function(a) {
    return this.queue(a || "fx", [])
  }, promise:function(a, c) {
    function m() {
      --h || d.resolveWith(e, [e])
    }
    typeof a != "string" && (c = a, a = b), a = a || "fx";
    var d = f.Deferred(), e = this, g = e.length, h = 1, i = a + "defer", j = a + "queue", k = a + "mark", l;
    while(g--) {
      if(l = f.data(e[g], i, b, !0) || (f.data(e[g], j, b, !0) || f.data(e[g], k, b, !0)) && f.data(e[g], i, f.Callbacks("once memory"), !0)) {
        h++, l.add(m)
      }
    }
    m();
    return d.promise(c)
  }});
  var o = /[\n\t\r]/g, p = /\s+/, q = /\r/g, r = /^(?:button|input)$/i, s = /^(?:button|input|object|select|textarea)$/i, t = /^a(?:rea)?$/i, u = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i, v = f.support.getSetAttribute, w, x, y;
  f.fn.extend({attr:function(a, b) {
    return f.access(this, f.attr, a, b, arguments.length > 1)
  }, removeAttr:function(a) {
    return this.each(function() {
      f.removeAttr(this, a)
    })
  }, prop:function(a, b) {
    return f.access(this, f.prop, a, b, arguments.length > 1)
  }, removeProp:function(a) {
    a = f.propFix[a] || a;
    return this.each(function() {
      try {
        this[a] = b, delete this[a]
      }catch(c) {
      }
    })
  }, addClass:function(a) {
    var b, c, d, e, g, h, i;
    if(f.isFunction(a)) {
      return this.each(function(b) {
        f(this).addClass(a.call(this, b, this.className))
      })
    }
    if(a && typeof a == "string") {
      b = a.split(p);
      for(c = 0, d = this.length;c < d;c++) {
        e = this[c];
        if(e.nodeType === 1) {
          if(!e.className && b.length === 1) {
            e.className = a
          }else {
            g = " " + e.className + " ";
            for(h = 0, i = b.length;h < i;h++) {
              ~g.indexOf(" " + b[h] + " ") || (g += b[h] + " ")
            }
            e.className = f.trim(g)
          }
        }
      }
    }
    return this
  }, removeClass:function(a) {
    var c, d, e, g, h, i, j;
    if(f.isFunction(a)) {
      return this.each(function(b) {
        f(this).removeClass(a.call(this, b, this.className))
      })
    }
    if(a && typeof a == "string" || a === b) {
      c = (a || "").split(p);
      for(d = 0, e = this.length;d < e;d++) {
        g = this[d];
        if(g.nodeType === 1 && g.className) {
          if(a) {
            h = (" " + g.className + " ").replace(o, " ");
            for(i = 0, j = c.length;i < j;i++) {
              h = h.replace(" " + c[i] + " ", " ")
            }
            g.className = f.trim(h)
          }else {
            g.className = ""
          }
        }
      }
    }
    return this
  }, toggleClass:function(a, b) {
    var c = typeof a, d = typeof b == "boolean";
    if(f.isFunction(a)) {
      return this.each(function(c) {
        f(this).toggleClass(a.call(this, c, this.className, b), b)
      })
    }
    return this.each(function() {
      if(c === "string") {
        var e, g = 0, h = f(this), i = b, j = a.split(p);
        while(e = j[g++]) {
          i = d ? i : !h.hasClass(e), h[i ? "addClass" : "removeClass"](e)
        }
      }else {
        if(c === "undefined" || c === "boolean") {
          this.className && f._data(this, "__className__", this.className), this.className = this.className || a === !1 ? "" : f._data(this, "__className__") || ""
        }
      }
    })
  }, hasClass:function(a) {
    var b = " " + a + " ", c = 0, d = this.length;
    for(;c < d;c++) {
      if(this[c].nodeType === 1 && (" " + this[c].className + " ").replace(o, " ").indexOf(b) > -1) {
        return!0
      }
    }
    return!1
  }, val:function(a) {
    var c, d, e, g = this[0];
    if(!!arguments.length) {
      e = f.isFunction(a);
      return this.each(function(d) {
        var g = f(this), h;
        if(this.nodeType === 1) {
          e ? h = a.call(this, d, g.val()) : h = a, h == null ? h = "" : typeof h == "number" ? h += "" : f.isArray(h) && (h = f.map(h, function(a) {
            return a == null ? "" : a + ""
          })), c = f.valHooks[this.type] || f.valHooks[this.nodeName.toLowerCase()];
          if(!c || !("set" in c) || c.set(this, h, "value") === b) {
            this.value = h
          }
        }
      })
    }
    if(g) {
      c = f.valHooks[g.type] || f.valHooks[g.nodeName.toLowerCase()];
      if(c && "get" in c && (d = c.get(g, "value")) !== b) {
        return d
      }
      d = g.value;
      return typeof d == "string" ? d.replace(q, "") : d == null ? "" : d
    }
  }}), f.extend({valHooks:{option:{get:function(a) {
    var b = a.attributes.value;
    return!b || b.specified ? a.value : a.text
  }}, select:{get:function(a) {
    var b, c, d, e, g = a.selectedIndex, h = [], i = a.options, j = a.type === "select-one";
    if(g < 0) {
      return null
    }
    c = j ? g : 0, d = j ? g + 1 : i.length;
    for(;c < d;c++) {
      e = i[c];
      if(e.selected && (f.support.optDisabled ? !e.disabled : e.getAttribute("disabled") === null) && (!e.parentNode.disabled || !f.nodeName(e.parentNode, "optgroup"))) {
        b = f(e).val();
        if(j) {
          return b
        }
        h.push(b)
      }
    }
    if(j && !h.length && i.length) {
      return f(i[g]).val()
    }
    return h
  }, set:function(a, b) {
    var c = f.makeArray(b);
    f(a).find("option").each(function() {
      this.selected = f.inArray(f(this).val(), c) >= 0
    }), c.length || (a.selectedIndex = -1);
    return c
  }}}, attrFn:{val:!0, css:!0, html:!0, text:!0, data:!0, width:!0, height:!0, offset:!0}, attr:function(a, c, d, e) {
    var g, h, i, j = a.nodeType;
    if(!!a && j !== 3 && j !== 8 && j !== 2) {
      if(e && c in f.attrFn) {
        return f(a)[c](d)
      }
      if(typeof a.getAttribute == "undefined") {
        return f.prop(a, c, d)
      }
      i = j !== 1 || !f.isXMLDoc(a), i && (c = c.toLowerCase(), h = f.attrHooks[c] || (u.test(c) ? x : w));
      if(d !== b) {
        if(d === null) {
          f.removeAttr(a, c);
          return
        }
        if(h && "set" in h && i && (g = h.set(a, d, c)) !== b) {
          return g
        }
        a.setAttribute(c, "" + d);
        return d
      }
      if(h && "get" in h && i && (g = h.get(a, c)) !== null) {
        return g
      }
      g = a.getAttribute(c);
      return g === null ? b : g
    }
  }, removeAttr:function(a, b) {
    var c, d, e, g, h, i = 0;
    if(b && a.nodeType === 1) {
      d = b.toLowerCase().split(p), g = d.length;
      for(;i < g;i++) {
        e = d[i], e && (c = f.propFix[e] || e, h = u.test(e), h || f.attr(a, e, ""), a.removeAttribute(v ? e : c), h && c in a && (a[c] = !1))
      }
    }
  }, attrHooks:{type:{set:function(a, b) {
    if(r.test(a.nodeName) && a.parentNode) {
      f.error("type property can't be changed")
    }else {
      if(!f.support.radioValue && b === "radio" && f.nodeName(a, "input")) {
        var c = a.value;
        a.setAttribute("type", b), c && (a.value = c);
        return b
      }
    }
  }}, value:{get:function(a, b) {
    if(w && f.nodeName(a, "button")) {
      return w.get(a, b)
    }
    return b in a ? a.value : null
  }, set:function(a, b, c) {
    if(w && f.nodeName(a, "button")) {
      return w.set(a, b, c)
    }
    a.value = b
  }}}, propFix:{tabindex:"tabIndex", readonly:"readOnly", "for":"htmlFor", "class":"className", maxlength:"maxLength", cellspacing:"cellSpacing", cellpadding:"cellPadding", rowspan:"rowSpan", colspan:"colSpan", usemap:"useMap", frameborder:"frameBorder", contenteditable:"contentEditable"}, prop:function(a, c, d) {
    var e, g, h, i = a.nodeType;
    if(!!a && i !== 3 && i !== 8 && i !== 2) {
      h = i !== 1 || !f.isXMLDoc(a), h && (c = f.propFix[c] || c, g = f.propHooks[c]);
      return d !== b ? g && "set" in g && (e = g.set(a, d, c)) !== b ? e : a[c] = d : g && "get" in g && (e = g.get(a, c)) !== null ? e : a[c]
    }
  }, propHooks:{tabIndex:{get:function(a) {
    var c = a.getAttributeNode("tabindex");
    return c && c.specified ? parseInt(c.value, 10) : s.test(a.nodeName) || t.test(a.nodeName) && a.href ? 0 : b
  }}}}), f.attrHooks.tabindex = f.propHooks.tabIndex, x = {get:function(a, c) {
    var d, e = f.prop(a, c);
    return e === !0 || typeof e != "boolean" && (d = a.getAttributeNode(c)) && d.nodeValue !== !1 ? c.toLowerCase() : b
  }, set:function(a, b, c) {
    var d;
    b === !1 ? f.removeAttr(a, c) : (d = f.propFix[c] || c, d in a && (a[d] = !0), a.setAttribute(c, c.toLowerCase()));
    return c
  }}, v || (y = {name:!0, id:!0, coords:!0}, w = f.valHooks.button = {get:function(a, c) {
    var d;
    d = a.getAttributeNode(c);
    return d && (y[c] ? d.nodeValue !== "" : d.specified) ? d.nodeValue : b
  }, set:function(a, b, d) {
    var e = a.getAttributeNode(d);
    e || (e = c.createAttribute(d), a.setAttributeNode(e));
    return e.nodeValue = b + ""
  }}, f.attrHooks.tabindex.set = w.set, f.each(["width", "height"], function(a, b) {
    f.attrHooks[b] = f.extend(f.attrHooks[b], {set:function(a, c) {
      if(c === "") {
        a.setAttribute(b, "auto");
        return c
      }
    }})
  }), f.attrHooks.contenteditable = {get:w.get, set:function(a, b, c) {
    b === "" && (b = "false"), w.set(a, b, c)
  }}), f.support.hrefNormalized || f.each(["href", "src", "width", "height"], function(a, c) {
    f.attrHooks[c] = f.extend(f.attrHooks[c], {get:function(a) {
      var d = a.getAttribute(c, 2);
      return d === null ? b : d
    }})
  }), f.support.style || (f.attrHooks.style = {get:function(a) {
    return a.style.cssText.toLowerCase() || b
  }, set:function(a, b) {
    return a.style.cssText = "" + b
  }}), f.support.optSelected || (f.propHooks.selected = f.extend(f.propHooks.selected, {get:function(a) {
    var b = a.parentNode;
    b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex);
    return null
  }})), f.support.enctype || (f.propFix.enctype = "encoding"), f.support.checkOn || f.each(["radio", "checkbox"], function() {
    f.valHooks[this] = {get:function(a) {
      return a.getAttribute("value") === null ? "on" : a.value
    }}
  }), f.each(["radio", "checkbox"], function() {
    f.valHooks[this] = f.extend(f.valHooks[this], {set:function(a, b) {
      if(f.isArray(b)) {
        return a.checked = f.inArray(f(a).val(), b) >= 0
      }
    }})
  });
  var z = /^(?:textarea|input|select)$/i, A = /^([^\.]*)?(?:\.(.+))?$/, B = /(?:^|\s)hover(\.\S+)?\b/, C = /^key/, D = /^(?:mouse|contextmenu)|click/, E = /^(?:focusinfocus|focusoutblur)$/, F = /^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/, G = function(a) {
    var b = F.exec(a);
    b && (b[1] = (b[1] || "").toLowerCase(), b[3] = b[3] && new RegExp("(?:^|\\s)" + b[3] + "(?:\\s|$)"));
    return b
  }, H = function(a, b) {
    var c = a.attributes || {};
    return(!b[1] || a.nodeName.toLowerCase() === b[1]) && (!b[2] || (c.id || {}).value === b[2]) && (!b[3] || b[3].test((c["class"] || {}).value))
  }, I = function(a) {
    return f.event.special.hover ? a : a.replace(B, "mouseenter$1 mouseleave$1")
  };
  f.event = {add:function(a, c, d, e, g) {
    var h, i, j, k, l, m, n, o, p, q, r, s;
    if(!(a.nodeType === 3 || a.nodeType === 8 || !c || !d || !(h = f._data(a)))) {
      d.handler && (p = d, d = p.handler, g = p.selector), d.guid || (d.guid = f.guid++), j = h.events, j || (h.events = j = {}), i = h.handle, i || (h.handle = i = function(a) {
        return typeof f != "undefined" && (!a || f.event.triggered !== a.type) ? f.event.dispatch.apply(i.elem, arguments) : b
      }, i.elem = a), c = f.trim(I(c)).split(" ");
      for(k = 0;k < c.length;k++) {
        l = A.exec(c[k]) || [], m = l[1], n = (l[2] || "").split(".").sort(), s = f.event.special[m] || {}, m = (g ? s.delegateType : s.bindType) || m, s = f.event.special[m] || {}, o = f.extend({type:m, origType:l[1], data:e, handler:d, guid:d.guid, selector:g, quick:g && G(g), namespace:n.join(".")}, p), r = j[m];
        if(!r) {
          r = j[m] = [], r.delegateCount = 0;
          if(!s.setup || s.setup.call(a, e, n, i) === !1) {
            a.addEventListener ? a.addEventListener(m, i, !1) : a.attachEvent && a.attachEvent("on" + m, i)
          }
        }
        s.add && (s.add.call(a, o), o.handler.guid || (o.handler.guid = d.guid)), g ? r.splice(r.delegateCount++, 0, o) : r.push(o), f.event.global[m] = !0
      }
      a = null
    }
  }, global:{}, remove:function(a, b, c, d, e) {
    var g = f.hasData(a) && f._data(a), h, i, j, k, l, m, n, o, p, q, r, s;
    if(!!g && !!(o = g.events)) {
      b = f.trim(I(b || "")).split(" ");
      for(h = 0;h < b.length;h++) {
        i = A.exec(b[h]) || [], j = k = i[1], l = i[2];
        if(!j) {
          for(j in o) {
            f.event.remove(a, j + b[h], c, d, !0)
          }
          continue
        }
        p = f.event.special[j] || {}, j = (d ? p.delegateType : p.bindType) || j, r = o[j] || [], m = r.length, l = l ? new RegExp("(^|\\.)" + l.split(".").sort().join("\\.(?:.*\\.)?") + "(\\.|$)") : null;
        for(n = 0;n < r.length;n++) {
          s = r[n], (e || k === s.origType) && (!c || c.guid === s.guid) && (!l || l.test(s.namespace)) && (!d || d === s.selector || d === "**" && s.selector) && (r.splice(n--, 1), s.selector && r.delegateCount--, p.remove && p.remove.call(a, s))
        }
        r.length === 0 && m !== r.length && ((!p.teardown || p.teardown.call(a, l) === !1) && f.removeEvent(a, j, g.handle), delete o[j])
      }
      f.isEmptyObject(o) && (q = g.handle, q && (q.elem = null), f.removeData(a, ["events", "handle"], !0))
    }
  }, customEvent:{getData:!0, setData:!0, changeData:!0}, trigger:function(c, d, e, g) {
    if(!e || e.nodeType !== 3 && e.nodeType !== 8) {
      var h = c.type || c, i = [], j, k, l, m, n, o, p, q, r, s;
      if(E.test(h + f.event.triggered)) {
        return
      }
      h.indexOf("!") >= 0 && (h = h.slice(0, -1), k = !0), h.indexOf(".") >= 0 && (i = h.split("."), h = i.shift(), i.sort());
      if((!e || f.event.customEvent[h]) && !f.event.global[h]) {
        return
      }
      c = typeof c == "object" ? c[f.expando] ? c : new f.Event(h, c) : new f.Event(h), c.type = h, c.isTrigger = !0, c.exclusive = k, c.namespace = i.join("."), c.namespace_re = c.namespace ? new RegExp("(^|\\.)" + i.join("\\.(?:.*\\.)?") + "(\\.|$)") : null, o = h.indexOf(":") < 0 ? "on" + h : "";
      if(!e) {
        j = f.cache;
        for(l in j) {
          j[l].events && j[l].events[h] && f.event.trigger(c, d, j[l].handle.elem, !0)
        }
        return
      }
      c.result = b, c.target || (c.target = e), d = d != null ? f.makeArray(d) : [], d.unshift(c), p = f.event.special[h] || {};
      if(p.trigger && p.trigger.apply(e, d) === !1) {
        return
      }
      r = [[e, p.bindType || h]];
      if(!g && !p.noBubble && !f.isWindow(e)) {
        s = p.delegateType || h, m = E.test(s + h) ? e : e.parentNode, n = null;
        for(;m;m = m.parentNode) {
          r.push([m, s]), n = m
        }
        n && n === e.ownerDocument && r.push([n.defaultView || n.parentWindow || a, s])
      }
      for(l = 0;l < r.length && !c.isPropagationStopped();l++) {
        m = r[l][0], c.type = r[l][1], q = (f._data(m, "events") || {})[c.type] && f._data(m, "handle"), q && q.apply(m, d), q = o && m[o], q && f.acceptData(m) && q.apply(m, d) === !1 && c.preventDefault()
      }
      c.type = h, !g && !c.isDefaultPrevented() && (!p._default || p._default.apply(e.ownerDocument, d) === !1) && (h !== "click" || !f.nodeName(e, "a")) && f.acceptData(e) && o && e[h] && (h !== "focus" && h !== "blur" || c.target.offsetWidth !== 0) && !f.isWindow(e) && (n = e[o], n && (e[o] = null), f.event.triggered = h, e[h](), f.event.triggered = b, n && (e[o] = n));
      return c.result
    }
  }, dispatch:function(c) {
    c = f.event.fix(c || a.event);
    var d = (f._data(this, "events") || {})[c.type] || [], e = d.delegateCount, g = [].slice.call(arguments, 0), h = !c.exclusive && !c.namespace, i = f.event.special[c.type] || {}, j = [], k, l, m, n, o, p, q, r, s, t, u;
    g[0] = c, c.delegateTarget = this;
    if(!i.preDispatch || i.preDispatch.call(this, c) !== !1) {
      if(e && (!c.button || c.type !== "click")) {
        n = f(this), n.context = this.ownerDocument || this;
        for(m = c.target;m != this;m = m.parentNode || this) {
          if(m.disabled !== !0) {
            p = {}, r = [], n[0] = m;
            for(k = 0;k < e;k++) {
              s = d[k], t = s.selector, p[t] === b && (p[t] = s.quick ? H(m, s.quick) : n.is(t)), p[t] && r.push(s)
            }
            r.length && j.push({elem:m, matches:r})
          }
        }
      }
      d.length > e && j.push({elem:this, matches:d.slice(e)});
      for(k = 0;k < j.length && !c.isPropagationStopped();k++) {
        q = j[k], c.currentTarget = q.elem;
        for(l = 0;l < q.matches.length && !c.isImmediatePropagationStopped();l++) {
          s = q.matches[l];
          if(h || !c.namespace && !s.namespace || c.namespace_re && c.namespace_re.test(s.namespace)) {
            c.data = s.data, c.handleObj = s, o = ((f.event.special[s.origType] || {}).handle || s.handler).apply(q.elem, g), o !== b && (c.result = o, o === !1 && (c.preventDefault(), c.stopPropagation()))
          }
        }
      }
      i.postDispatch && i.postDispatch.call(this, c);
      return c.result
    }
  }, props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks:{}, keyHooks:{props:"char charCode key keyCode".split(" "), filter:function(a, b) {
    a.which == null && (a.which = b.charCode != null ? b.charCode : b.keyCode);
    return a
  }}, mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter:function(a, d) {
    var e, f, g, h = d.button, i = d.fromElement;
    a.pageX == null && d.clientX != null && (e = a.target.ownerDocument || c, f = e.documentElement, g = e.body, a.pageX = d.clientX + (f && f.scrollLeft || g && g.scrollLeft || 0) - (f && f.clientLeft || g && g.clientLeft || 0), a.pageY = d.clientY + (f && f.scrollTop || g && g.scrollTop || 0) - (f && f.clientTop || g && g.clientTop || 0)), !a.relatedTarget && i && (a.relatedTarget = i === a.target ? d.toElement : i), !a.which && h !== b && (a.which = h & 1 ? 1 : h & 2 ? 3 : h & 4 ? 2 : 0);
    return a
  }}, fix:function(a) {
    if(a[f.expando]) {
      return a
    }
    var d, e, g = a, h = f.event.fixHooks[a.type] || {}, i = h.props ? this.props.concat(h.props) : this.props;
    a = f.Event(g);
    for(d = i.length;d;) {
      e = i[--d], a[e] = g[e]
    }
    a.target || (a.target = g.srcElement || c), a.target.nodeType === 3 && (a.target = a.target.parentNode), a.metaKey === b && (a.metaKey = a.ctrlKey);
    return h.filter ? h.filter(a, g) : a
  }, special:{ready:{setup:f.bindReady}, load:{noBubble:!0}, focus:{delegateType:"focusin"}, blur:{delegateType:"focusout"}, beforeunload:{setup:function(a, b, c) {
    f.isWindow(this) && (this.onbeforeunload = c)
  }, teardown:function(a, b) {
    this.onbeforeunload === b && (this.onbeforeunload = null)
  }}}, simulate:function(a, b, c, d) {
    var e = f.extend(new f.Event, c, {type:a, isSimulated:!0, originalEvent:{}});
    d ? f.event.trigger(e, null, b) : f.event.dispatch.call(b, e), e.isDefaultPrevented() && c.preventDefault()
  }}, f.event.handle = f.event.dispatch, f.removeEvent = c.removeEventListener ? function(a, b, c) {
    a.removeEventListener && a.removeEventListener(b, c, !1)
  } : function(a, b, c) {
    a.detachEvent && a.detachEvent("on" + b, c)
  }, f.Event = function(a, b) {
    if(!(this instanceof f.Event)) {
      return new f.Event(a, b)
    }
    a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || a.returnValue === !1 || a.getPreventDefault && a.getPreventDefault() ? K : J) : this.type = a, b && f.extend(this, b), this.timeStamp = a && a.timeStamp || f.now(), this[f.expando] = !0
  }, f.Event.prototype = {preventDefault:function() {
    this.isDefaultPrevented = K;
    var a = this.originalEvent;
    !a || (a.preventDefault ? a.preventDefault() : a.returnValue = !1)
  }, stopPropagation:function() {
    this.isPropagationStopped = K;
    var a = this.originalEvent;
    !a || (a.stopPropagation && a.stopPropagation(), a.cancelBubble = !0)
  }, stopImmediatePropagation:function() {
    this.isImmediatePropagationStopped = K, this.stopPropagation()
  }, isDefaultPrevented:J, isPropagationStopped:J, isImmediatePropagationStopped:J}, f.each({mouseenter:"mouseover", mouseleave:"mouseout"}, function(a, b) {
    f.event.special[a] = {delegateType:b, bindType:b, handle:function(a) {
      var c = this, d = a.relatedTarget, e = a.handleObj, g = e.selector, h;
      if(!d || d !== c && !f.contains(c, d)) {
        a.type = e.origType, h = e.handler.apply(this, arguments), a.type = b
      }
      return h
    }}
  }), f.support.submitBubbles || (f.event.special.submit = {setup:function() {
    if(f.nodeName(this, "form")) {
      return!1
    }
    f.event.add(this, "click._submit keypress._submit", function(a) {
      var c = a.target, d = f.nodeName(c, "input") || f.nodeName(c, "button") ? c.form : b;
      d && !d._submit_attached && (f.event.add(d, "submit._submit", function(a) {
        a._submit_bubble = !0
      }), d._submit_attached = !0)
    })
  }, postDispatch:function(a) {
    a._submit_bubble && (delete a._submit_bubble, this.parentNode && !a.isTrigger && f.event.simulate("submit", this.parentNode, a, !0))
  }, teardown:function() {
    if(f.nodeName(this, "form")) {
      return!1
    }
    f.event.remove(this, "._submit")
  }}), f.support.changeBubbles || (f.event.special.change = {setup:function() {
    if(z.test(this.nodeName)) {
      if(this.type === "checkbox" || this.type === "radio") {
        f.event.add(this, "propertychange._change", function(a) {
          a.originalEvent.propertyName === "checked" && (this._just_changed = !0)
        }), f.event.add(this, "click._change", function(a) {
          this._just_changed && !a.isTrigger && (this._just_changed = !1, f.event.simulate("change", this, a, !0))
        })
      }
      return!1
    }
    f.event.add(this, "beforeactivate._change", function(a) {
      var b = a.target;
      z.test(b.nodeName) && !b._change_attached && (f.event.add(b, "change._change", function(a) {
        this.parentNode && !a.isSimulated && !a.isTrigger && f.event.simulate("change", this.parentNode, a, !0)
      }), b._change_attached = !0)
    })
  }, handle:function(a) {
    var b = a.target;
    if(this !== b || a.isSimulated || a.isTrigger || b.type !== "radio" && b.type !== "checkbox") {
      return a.handleObj.handler.apply(this, arguments)
    }
  }, teardown:function() {
    f.event.remove(this, "._change");
    return z.test(this.nodeName)
  }}), f.support.focusinBubbles || f.each({focus:"focusin", blur:"focusout"}, function(a, b) {
    var d = 0, e = function(a) {
      f.event.simulate(b, a.target, f.event.fix(a), !0)
    };
    f.event.special[b] = {setup:function() {
      d++ === 0 && c.addEventListener(a, e, !0)
    }, teardown:function() {
      --d === 0 && c.removeEventListener(a, e, !0)
    }}
  }), f.fn.extend({on:function(a, c, d, e, g) {
    var h, i;
    if(typeof a == "object") {
      typeof c != "string" && (d = d || c, c = b);
      for(i in a) {
        this.on(i, c, d, a[i], g)
      }
      return this
    }
    d == null && e == null ? (e = c, d = c = b) : e == null && (typeof c == "string" ? (e = d, d = b) : (e = d, d = c, c = b));
    if(e === !1) {
      e = J
    }else {
      if(!e) {
        return this
      }
    }
    g === 1 && (h = e, e = function(a) {
      f().off(a);
      return h.apply(this, arguments)
    }, e.guid = h.guid || (h.guid = f.guid++));
    return this.each(function() {
      f.event.add(this, a, e, d, c)
    })
  }, one:function(a, b, c, d) {
    return this.on(a, b, c, d, 1)
  }, off:function(a, c, d) {
    if(a && a.preventDefault && a.handleObj) {
      var e = a.handleObj;
      f(a.delegateTarget).off(e.namespace ? e.origType + "." + e.namespace : e.origType, e.selector, e.handler);
      return this
    }
    if(typeof a == "object") {
      for(var g in a) {
        this.off(g, c, a[g])
      }
      return this
    }
    if(c === !1 || typeof c == "function") {
      d = c, c = b
    }
    d === !1 && (d = J);
    return this.each(function() {
      f.event.remove(this, a, d, c)
    })
  }, bind:function(a, b, c) {
    return this.on(a, null, b, c)
  }, unbind:function(a, b) {
    return this.off(a, null, b)
  }, live:function(a, b, c) {
    f(this.context).on(a, this.selector, b, c);
    return this
  }, die:function(a, b) {
    f(this.context).off(a, this.selector || "**", b);
    return this
  }, delegate:function(a, b, c, d) {
    return this.on(b, a, c, d)
  }, undelegate:function(a, b, c) {
    return arguments.length == 1 ? this.off(a, "**") : this.off(b, a, c)
  }, trigger:function(a, b) {
    return this.each(function() {
      f.event.trigger(a, b, this)
    })
  }, triggerHandler:function(a, b) {
    if(this[0]) {
      return f.event.trigger(a, b, this[0], !0)
    }
  }, toggle:function(a) {
    var b = arguments, c = a.guid || f.guid++, d = 0, e = function(c) {
      var e = (f._data(this, "lastToggle" + a.guid) || 0) % d;
      f._data(this, "lastToggle" + a.guid, e + 1), c.preventDefault();
      return b[e].apply(this, arguments) || !1
    };
    e.guid = c;
    while(d < b.length) {
      b[d++].guid = c
    }
    return this.click(e)
  }, hover:function(a, b) {
    return this.mouseenter(a).mouseleave(b || a)
  }}), f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function(a, b) {
    f.fn[b] = function(a, c) {
      c == null && (c = a, a = null);
      return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b)
    }, f.attrFn && (f.attrFn[b] = !0), C.test(b) && (f.event.fixHooks[b] = f.event.keyHooks), D.test(b) && (f.event.fixHooks[b] = f.event.mouseHooks)
  }), function() {
    function x(a, b, c, e, f, g) {
      for(var h = 0, i = e.length;h < i;h++) {
        var j = e[h];
        if(j) {
          var k = !1;
          j = j[a];
          while(j) {
            if(j[d] === c) {
              k = e[j.sizset];
              break
            }
            if(j.nodeType === 1) {
              g || (j[d] = c, j.sizset = h);
              if(typeof b != "string") {
                if(j === b) {
                  k = !0;
                  break
                }
              }else {
                if(m.filter(b, [j]).length > 0) {
                  k = j;
                  break
                }
              }
            }
            j = j[a]
          }
          e[h] = k
        }
      }
    }
    function w(a, b, c, e, f, g) {
      for(var h = 0, i = e.length;h < i;h++) {
        var j = e[h];
        if(j) {
          var k = !1;
          j = j[a];
          while(j) {
            if(j[d] === c) {
              k = e[j.sizset];
              break
            }
            j.nodeType === 1 && !g && (j[d] = c, j.sizset = h);
            if(j.nodeName.toLowerCase() === b) {
              k = j;
              break
            }
            j = j[a]
          }
          e[h] = k
        }
      }
    }
    var a = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g, d = "sizcache" + (Math.random() + "").replace(".", ""), e = 0, g = Object.prototype.toString, h = !1, i = !0, j = /\\/g, k = /\r\n/g, l = /\W/;
    [0, 0].sort(function() {
      i = !1;
      return 0
    });
    var m = function(b, d, e, f) {
      e = e || [], d = d || c;
      var h = d;
      if(d.nodeType !== 1 && d.nodeType !== 9) {
        return[]
      }
      if(!b || typeof b != "string") {
        return e
      }
      var i, j, k, l, n, q, r, t, u = !0, v = m.isXML(d), w = [], x = b;
      do {
        a.exec(""), i = a.exec(x);
        if(i) {
          x = i[3], w.push(i[1]);
          if(i[2]) {
            l = i[3];
            break
          }
        }
      }while(i);
      if(w.length > 1 && p.exec(b)) {
        if(w.length === 2 && o.relative[w[0]]) {
          j = y(w[0] + w[1], d, f)
        }else {
          j = o.relative[w[0]] ? [d] : m(w.shift(), d);
          while(w.length) {
            b = w.shift(), o.relative[b] && (b += w.shift()), j = y(b, j, f)
          }
        }
      }else {
        !f && w.length > 1 && d.nodeType === 9 && !v && o.match.ID.test(w[0]) && !o.match.ID.test(w[w.length - 1]) && (n = m.find(w.shift(), d, v), d = n.expr ? m.filter(n.expr, n.set)[0] : n.set[0]);
        if(d) {
          n = f ? {expr:w.pop(), set:s(f)} : m.find(w.pop(), w.length === 1 && (w[0] === "~" || w[0] === "+") && d.parentNode ? d.parentNode : d, v), j = n.expr ? m.filter(n.expr, n.set) : n.set, w.length > 0 ? k = s(j) : u = !1;
          while(w.length) {
            q = w.pop(), r = q, o.relative[q] ? r = w.pop() : q = "", r == null && (r = d), o.relative[q](k, r, v)
          }
        }else {
          k = w = []
        }
      }
      k || (k = j), k || m.error(q || b);
      if(g.call(k) === "[object Array]") {
        if(!u) {
          e.push.apply(e, k)
        }else {
          if(d && d.nodeType === 1) {
            for(t = 0;k[t] != null;t++) {
              k[t] && (k[t] === !0 || k[t].nodeType === 1 && m.contains(d, k[t])) && e.push(j[t])
            }
          }else {
            for(t = 0;k[t] != null;t++) {
              k[t] && k[t].nodeType === 1 && e.push(j[t])
            }
          }
        }
      }else {
        s(k, e)
      }
      l && (m(l, h, e, f), m.uniqueSort(e));
      return e
    };
    m.uniqueSort = function(a) {
      if(u) {
        h = i, a.sort(u);
        if(h) {
          for(var b = 1;b < a.length;b++) {
            a[b] === a[b - 1] && a.splice(b--, 1)
          }
        }
      }
      return a
    }, m.matches = function(a, b) {
      return m(a, null, null, b)
    }, m.matchesSelector = function(a, b) {
      return m(b, null, null, [a]).length > 0
    }, m.find = function(a, b, c) {
      var d, e, f, g, h, i;
      if(!a) {
        return[]
      }
      for(e = 0, f = o.order.length;e < f;e++) {
        h = o.order[e];
        if(g = o.leftMatch[h].exec(a)) {
          i = g[1], g.splice(1, 1);
          if(i.substr(i.length - 1) !== "\\") {
            g[1] = (g[1] || "").replace(j, ""), d = o.find[h](g, b, c);
            if(d != null) {
              a = a.replace(o.match[h], "");
              break
            }
          }
        }
      }
      d || (d = typeof b.getElementsByTagName != "undefined" ? b.getElementsByTagName("*") : []);
      return{set:d, expr:a}
    }, m.filter = function(a, c, d, e) {
      var f, g, h, i, j, k, l, n, p, q = a, r = [], s = c, t = c && c[0] && m.isXML(c[0]);
      while(a && c.length) {
        for(h in o.filter) {
          if((f = o.leftMatch[h].exec(a)) != null && f[2]) {
            k = o.filter[h], l = f[1], g = !1, f.splice(1, 1);
            if(l.substr(l.length - 1) === "\\") {
              continue
            }
            s === r && (r = []);
            if(o.preFilter[h]) {
              f = o.preFilter[h](f, s, d, r, e, t);
              if(!f) {
                g = i = !0
              }else {
                if(f === !0) {
                  continue
                }
              }
            }
            if(f) {
              for(n = 0;(j = s[n]) != null;n++) {
                j && (i = k(j, f, n, s), p = e ^ i, d && i != null ? p ? g = !0 : s[n] = !1 : p && (r.push(j), g = !0))
              }
            }
            if(i !== b) {
              d || (s = r), a = a.replace(o.match[h], "");
              if(!g) {
                return[]
              }
              break
            }
          }
        }
        if(a === q) {
          if(g == null) {
            m.error(a)
          }else {
            break
          }
        }
        q = a
      }
      return s
    }, m.error = function(a) {
      throw new Error("Syntax error, unrecognized expression: " + a);
    };
    var n = m.getText = function(a) {
      var b, c, d = a.nodeType, e = "";
      if(d) {
        if(d === 1 || d === 9 || d === 11) {
          if(typeof a.textContent == "string") {
            return a.textContent
          }
          if(typeof a.innerText == "string") {
            return a.innerText.replace(k, "")
          }
          for(a = a.firstChild;a;a = a.nextSibling) {
            e += n(a)
          }
        }else {
          if(d === 3 || d === 4) {
            return a.nodeValue
          }
        }
      }else {
        for(b = 0;c = a[b];b++) {
          c.nodeType !== 8 && (e += n(c))
        }
      }
      return e
    }, o = m.selectors = {order:["ID", "NAME", "TAG"], match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/, CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/, NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/, ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/, TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/, CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/, POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/, 
    PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/}, leftMatch:{}, attrMap:{"class":"className", "for":"htmlFor"}, attrHandle:{href:function(a) {
      return a.getAttribute("href")
    }, type:function(a) {
      return a.getAttribute("type")
    }}, relative:{"+":function(a, b) {
      var c = typeof b == "string", d = c && !l.test(b), e = c && !d;
      d && (b = b.toLowerCase());
      for(var f = 0, g = a.length, h;f < g;f++) {
        if(h = a[f]) {
          while((h = h.previousSibling) && h.nodeType !== 1) {
          }
          a[f] = e || h && h.nodeName.toLowerCase() === b ? h || !1 : h === b
        }
      }
      e && m.filter(b, a, !0)
    }, ">":function(a, b) {
      var c, d = typeof b == "string", e = 0, f = a.length;
      if(d && !l.test(b)) {
        b = b.toLowerCase();
        for(;e < f;e++) {
          c = a[e];
          if(c) {
            var g = c.parentNode;
            a[e] = g.nodeName.toLowerCase() === b ? g : !1
          }
        }
      }else {
        for(;e < f;e++) {
          c = a[e], c && (a[e] = d ? c.parentNode : c.parentNode === b)
        }
        d && m.filter(b, a, !0)
      }
    }, "":function(a, b, c) {
      var d, f = e++, g = x;
      typeof b == "string" && !l.test(b) && (b = b.toLowerCase(), d = b, g = w), g("parentNode", b, f, a, d, c)
    }, "~":function(a, b, c) {
      var d, f = e++, g = x;
      typeof b == "string" && !l.test(b) && (b = b.toLowerCase(), d = b, g = w), g("previousSibling", b, f, a, d, c)
    }}, find:{ID:function(a, b, c) {
      if(typeof b.getElementById != "undefined" && !c) {
        var d = b.getElementById(a[1]);
        return d && d.parentNode ? [d] : []
      }
    }, NAME:function(a, b) {
      if(typeof b.getElementsByName != "undefined") {
        var c = [], d = b.getElementsByName(a[1]);
        for(var e = 0, f = d.length;e < f;e++) {
          d[e].getAttribute("name") === a[1] && c.push(d[e])
        }
        return c.length === 0 ? null : c
      }
    }, TAG:function(a, b) {
      if(typeof b.getElementsByTagName != "undefined") {
        return b.getElementsByTagName(a[1])
      }
    }}, preFilter:{CLASS:function(a, b, c, d, e, f) {
      a = " " + a[1].replace(j, "") + " ";
      if(f) {
        return a
      }
      for(var g = 0, h;(h = b[g]) != null;g++) {
        h && (e ^ (h.className && (" " + h.className + " ").replace(/[\t\n\r]/g, " ").indexOf(a) >= 0) ? c || d.push(h) : c && (b[g] = !1))
      }
      return!1
    }, ID:function(a) {
      return a[1].replace(j, "")
    }, TAG:function(a, b) {
      return a[1].replace(j, "").toLowerCase()
    }, CHILD:function(a) {
      if(a[1] === "nth") {
        a[2] || m.error(a[0]), a[2] = a[2].replace(/^\+|\s*/g, "");
        var b = /(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2] === "even" && "2n" || a[2] === "odd" && "2n+1" || !/\D/.test(a[2]) && "0n+" + a[2] || a[2]);
        a[2] = b[1] + (b[2] || 1) - 0, a[3] = b[3] - 0
      }else {
        a[2] && m.error(a[0])
      }
      a[0] = e++;
      return a
    }, ATTR:function(a, b, c, d, e, f) {
      var g = a[1] = a[1].replace(j, "");
      !f && o.attrMap[g] && (a[1] = o.attrMap[g]), a[4] = (a[4] || a[5] || "").replace(j, ""), a[2] === "~=" && (a[4] = " " + a[4] + " ");
      return a
    }, PSEUDO:function(b, c, d, e, f) {
      if(b[1] === "not") {
        if((a.exec(b[3]) || "").length > 1 || /^\w/.test(b[3])) {
          b[3] = m(b[3], null, null, c)
        }else {
          var g = m.filter(b[3], c, d, !0 ^ f);
          d || e.push.apply(e, g);
          return!1
        }
      }else {
        if(o.match.POS.test(b[0]) || o.match.CHILD.test(b[0])) {
          return!0
        }
      }
      return b
    }, POS:function(a) {
      a.unshift(!0);
      return a
    }}, filters:{enabled:function(a) {
      return a.disabled === !1 && a.type !== "hidden"
    }, disabled:function(a) {
      return a.disabled === !0
    }, checked:function(a) {
      return a.checked === !0
    }, selected:function(a) {
      a.parentNode && a.parentNode.selectedIndex;
      return a.selected === !0
    }, parent:function(a) {
      return!!a.firstChild
    }, empty:function(a) {
      return!a.firstChild
    }, has:function(a, b, c) {
      return!!m(c[3], a).length
    }, header:function(a) {
      return/h\d/i.test(a.nodeName)
    }, text:function(a) {
      var b = a.getAttribute("type"), c = a.type;
      return a.nodeName.toLowerCase() === "input" && "text" === c && (b === c || b === null)
    }, radio:function(a) {
      return a.nodeName.toLowerCase() === "input" && "radio" === a.type
    }, checkbox:function(a) {
      return a.nodeName.toLowerCase() === "input" && "checkbox" === a.type
    }, file:function(a) {
      return a.nodeName.toLowerCase() === "input" && "file" === a.type
    }, password:function(a) {
      return a.nodeName.toLowerCase() === "input" && "password" === a.type
    }, submit:function(a) {
      var b = a.nodeName.toLowerCase();
      return(b === "input" || b === "button") && "submit" === a.type
    }, image:function(a) {
      return a.nodeName.toLowerCase() === "input" && "image" === a.type
    }, reset:function(a) {
      var b = a.nodeName.toLowerCase();
      return(b === "input" || b === "button") && "reset" === a.type
    }, button:function(a) {
      var b = a.nodeName.toLowerCase();
      return b === "input" && "button" === a.type || b === "button"
    }, input:function(a) {
      return/input|select|textarea|button/i.test(a.nodeName)
    }, focus:function(a) {
      return a === a.ownerDocument.activeElement
    }}, setFilters:{first:function(a, b) {
      return b === 0
    }, last:function(a, b, c, d) {
      return b === d.length - 1
    }, even:function(a, b) {
      return b % 2 === 0
    }, odd:function(a, b) {
      return b % 2 === 1
    }, lt:function(a, b, c) {
      return b < c[3] - 0
    }, gt:function(a, b, c) {
      return b > c[3] - 0
    }, nth:function(a, b, c) {
      return c[3] - 0 === b
    }, eq:function(a, b, c) {
      return c[3] - 0 === b
    }}, filter:{PSEUDO:function(a, b, c, d) {
      var e = b[1], f = o.filters[e];
      if(f) {
        return f(a, c, b, d)
      }
      if(e === "contains") {
        return(a.textContent || a.innerText || n([a]) || "").indexOf(b[3]) >= 0
      }
      if(e === "not") {
        var g = b[3];
        for(var h = 0, i = g.length;h < i;h++) {
          if(g[h] === a) {
            return!1
          }
        }
        return!0
      }
      m.error(e)
    }, CHILD:function(a, b) {
      var c, e, f, g, h, i, j, k = b[1], l = a;
      switch(k) {
        case "only":
        ;
        case "first":
          while(l = l.previousSibling) {
            if(l.nodeType === 1) {
              return!1
            }
          }
          if(k === "first") {
            return!0
          }
          l = a;
        case "last":
          while(l = l.nextSibling) {
            if(l.nodeType === 1) {
              return!1
            }
          }
          return!0;
        case "nth":
          c = b[2], e = b[3];
          if(c === 1 && e === 0) {
            return!0
          }
          f = b[0], g = a.parentNode;
          if(g && (g[d] !== f || !a.nodeIndex)) {
            i = 0;
            for(l = g.firstChild;l;l = l.nextSibling) {
              l.nodeType === 1 && (l.nodeIndex = ++i)
            }
            g[d] = f
          }
          j = a.nodeIndex - e;
          return c === 0 ? j === 0 : j % c === 0 && j / c >= 0
      }
    }, ID:function(a, b) {
      return a.nodeType === 1 && a.getAttribute("id") === b
    }, TAG:function(a, b) {
      return b === "*" && a.nodeType === 1 || !!a.nodeName && a.nodeName.toLowerCase() === b
    }, CLASS:function(a, b) {
      return(" " + (a.className || a.getAttribute("class")) + " ").indexOf(b) > -1
    }, ATTR:function(a, b) {
      var c = b[1], d = m.attr ? m.attr(a, c) : o.attrHandle[c] ? o.attrHandle[c](a) : a[c] != null ? a[c] : a.getAttribute(c), e = d + "", f = b[2], g = b[4];
      return d == null ? f === "!=" : !f && m.attr ? d != null : f === "=" ? e === g : f === "*=" ? e.indexOf(g) >= 0 : f === "~=" ? (" " + e + " ").indexOf(g) >= 0 : g ? f === "!=" ? e !== g : f === "^=" ? e.indexOf(g) === 0 : f === "$=" ? e.substr(e.length - g.length) === g : f === "|=" ? e === g || e.substr(0, g.length + 1) === g + "-" : !1 : e && d !== !1
    }, POS:function(a, b, c, d) {
      var e = b[2], f = o.setFilters[e];
      if(f) {
        return f(a, c, b, d)
      }
    }}}, p = o.match.POS, q = function(a, b) {
      return"\\" + (b - 0 + 1)
    };
    for(var r in o.match) {
      o.match[r] = new RegExp(o.match[r].source + /(?![^\[]*\])(?![^\(]*\))/.source), o.leftMatch[r] = new RegExp(/(^(?:.|\r|\n)*?)/.source + o.match[r].source.replace(/\\(\d+)/g, q))
    }
    o.match.globalPOS = p;
    var s = function(a, b) {
      a = Array.prototype.slice.call(a, 0);
      if(b) {
        b.push.apply(b, a);
        return b
      }
      return a
    };
    try {
      Array.prototype.slice.call(c.documentElement.childNodes, 0)[0].nodeType
    }catch(t) {
      s = function(a, b) {
        var c = 0, d = b || [];
        if(g.call(a) === "[object Array]") {
          Array.prototype.push.apply(d, a)
        }else {
          if(typeof a.length == "number") {
            for(var e = a.length;c < e;c++) {
              d.push(a[c])
            }
          }else {
            for(;a[c];c++) {
              d.push(a[c])
            }
          }
        }
        return d
      }
    }
    var u, v;
    c.documentElement.compareDocumentPosition ? u = function(a, b) {
      if(a === b) {
        h = !0;
        return 0
      }
      if(!a.compareDocumentPosition || !b.compareDocumentPosition) {
        return a.compareDocumentPosition ? -1 : 1
      }
      return a.compareDocumentPosition(b) & 4 ? -1 : 1
    } : (u = function(a, b) {
      if(a === b) {
        h = !0;
        return 0
      }
      if(a.sourceIndex && b.sourceIndex) {
        return a.sourceIndex - b.sourceIndex
      }
      var c, d, e = [], f = [], g = a.parentNode, i = b.parentNode, j = g;
      if(g === i) {
        return v(a, b)
      }
      if(!g) {
        return-1
      }
      if(!i) {
        return 1
      }
      while(j) {
        e.unshift(j), j = j.parentNode
      }
      j = i;
      while(j) {
        f.unshift(j), j = j.parentNode
      }
      c = e.length, d = f.length;
      for(var k = 0;k < c && k < d;k++) {
        if(e[k] !== f[k]) {
          return v(e[k], f[k])
        }
      }
      return k === c ? v(a, f[k], -1) : v(e[k], b, 1)
    }, v = function(a, b, c) {
      if(a === b) {
        return c
      }
      var d = a.nextSibling;
      while(d) {
        if(d === b) {
          return-1
        }
        d = d.nextSibling
      }
      return 1
    }), function() {
      var a = c.createElement("div"), d = "script" + (new Date).getTime(), e = c.documentElement;
      a.innerHTML = "<a name='" + d + "'/>", e.insertBefore(a, e.firstChild), c.getElementById(d) && (o.find.ID = function(a, c, d) {
        if(typeof c.getElementById != "undefined" && !d) {
          var e = c.getElementById(a[1]);
          return e ? e.id === a[1] || typeof e.getAttributeNode != "undefined" && e.getAttributeNode("id").nodeValue === a[1] ? [e] : b : []
        }
      }, o.filter.ID = function(a, b) {
        var c = typeof a.getAttributeNode != "undefined" && a.getAttributeNode("id");
        return a.nodeType === 1 && c && c.nodeValue === b
      }), e.removeChild(a), e = a = null
    }(), function() {
      var a = c.createElement("div");
      a.appendChild(c.createComment("")), a.getElementsByTagName("*").length > 0 && (o.find.TAG = function(a, b) {
        var c = b.getElementsByTagName(a[1]);
        if(a[1] === "*") {
          var d = [];
          for(var e = 0;c[e];e++) {
            c[e].nodeType === 1 && d.push(c[e])
          }
          c = d
        }
        return c
      }), a.innerHTML = "<a href='#'></a>", a.firstChild && typeof a.firstChild.getAttribute != "undefined" && a.firstChild.getAttribute("href") !== "#" && (o.attrHandle.href = function(a) {
        return a.getAttribute("href", 2)
      }), a = null
    }(), c.querySelectorAll && function() {
      var a = m, b = c.createElement("div"), d = "__sizzle__";
      b.innerHTML = "<p class='TEST'></p>";
      if(!b.querySelectorAll || b.querySelectorAll(".TEST").length !== 0) {
        m = function(b, e, f, g) {
          e = e || c;
          if(!g && !m.isXML(e)) {
            var h = /^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);
            if(h && (e.nodeType === 1 || e.nodeType === 9)) {
              if(h[1]) {
                return s(e.getElementsByTagName(b), f)
              }
              if(h[2] && o.find.CLASS && e.getElementsByClassName) {
                return s(e.getElementsByClassName(h[2]), f)
              }
            }
            if(e.nodeType === 9) {
              if(b === "body" && e.body) {
                return s([e.body], f)
              }
              if(h && h[3]) {
                var i = e.getElementById(h[3]);
                if(!i || !i.parentNode) {
                  return s([], f)
                }
                if(i.id === h[3]) {
                  return s([i], f)
                }
              }
              try {
                return s(e.querySelectorAll(b), f)
              }catch(j) {
              }
            }else {
              if(e.nodeType === 1 && e.nodeName.toLowerCase() !== "object") {
                var k = e, l = e.getAttribute("id"), n = l || d, p = e.parentNode, q = /^\s*[+~]/.test(b);
                l ? n = n.replace(/'/g, "\\$&") : e.setAttribute("id", n), q && p && (e = e.parentNode);
                try {
                  if(!q || p) {
                    return s(e.querySelectorAll("[id='" + n + "'] " + b), f)
                  }
                }catch(r) {
                }finally {
                  l || k.removeAttribute("id")
                }
              }
            }
          }
          return a(b, e, f, g)
        };
        for(var e in a) {
          m[e] = a[e]
        }
        b = null
      }
    }(), function() {
      var a = c.documentElement, b = a.matchesSelector || a.mozMatchesSelector || a.webkitMatchesSelector || a.msMatchesSelector;
      if(b) {
        var d = !b.call(c.createElement("div"), "div"), e = !1;
        try {
          b.call(c.documentElement, "[test!='']:sizzle")
        }catch(f) {
          e = !0
        }
        m.matchesSelector = function(a, c) {
          c = c.replace(/\=\s*([^'"\]]*)\s*\]/g, "='$1']");
          if(!m.isXML(a)) {
            try {
              if(e || !o.match.PSEUDO.test(c) && !/!=/.test(c)) {
                var f = b.call(a, c);
                if(f || !d || a.document && a.document.nodeType !== 11) {
                  return f
                }
              }
            }catch(g) {
            }
          }
          return m(c, null, null, [a]).length > 0
        }
      }
    }(), function() {
      var a = c.createElement("div");
      a.innerHTML = "<div class='test e'></div><div class='test'></div>";
      if(!!a.getElementsByClassName && a.getElementsByClassName("e").length !== 0) {
        a.lastChild.className = "e";
        if(a.getElementsByClassName("e").length === 1) {
          return
        }
        o.order.splice(1, 0, "CLASS"), o.find.CLASS = function(a, b, c) {
          if(typeof b.getElementsByClassName != "undefined" && !c) {
            return b.getElementsByClassName(a[1])
          }
        }, a = null
      }
    }(), c.documentElement.contains ? m.contains = function(a, b) {
      return a !== b && (a.contains ? a.contains(b) : !0)
    } : c.documentElement.compareDocumentPosition ? m.contains = function(a, b) {
      return!!(a.compareDocumentPosition(b) & 16)
    } : m.contains = function() {
      return!1
    }, m.isXML = function(a) {
      var b = (a ? a.ownerDocument || a : 0).documentElement;
      return b ? b.nodeName !== "HTML" : !1
    };
    var y = function(a, b, c) {
      var d, e = [], f = "", g = b.nodeType ? [b] : b;
      while(d = o.match.PSEUDO.exec(a)) {
        f += d[0], a = a.replace(o.match.PSEUDO, "")
      }
      a = o.relative[a] ? a + "*" : a;
      for(var h = 0, i = g.length;h < i;h++) {
        m(a, g[h], e, c)
      }
      return m.filter(f, e)
    };
    m.attr = f.attr, m.selectors.attrMap = {}, f.find = m, f.expr = m.selectors, f.expr[":"] = f.expr.filters, f.unique = m.uniqueSort, f.text = m.getText, f.isXMLDoc = m.isXML, f.contains = m.contains
  }();
  var L = /Until$/, M = /^(?:parents|prevUntil|prevAll)/, N = /,/, O = /^.[^:#\[\.,]*$/, P = Array.prototype.slice, Q = f.expr.match.globalPOS, R = {children:!0, contents:!0, next:!0, prev:!0};
  f.fn.extend({find:function(a) {
    var b = this, c, d;
    if(typeof a != "string") {
      return f(a).filter(function() {
        for(c = 0, d = b.length;c < d;c++) {
          if(f.contains(b[c], this)) {
            return!0
          }
        }
      })
    }
    var e = this.pushStack("", "find", a), g, h, i;
    for(c = 0, d = this.length;c < d;c++) {
      g = e.length, f.find(a, this[c], e);
      if(c > 0) {
        for(h = g;h < e.length;h++) {
          for(i = 0;i < g;i++) {
            if(e[i] === e[h]) {
              e.splice(h--, 1);
              break
            }
          }
        }
      }
    }
    return e
  }, has:function(a) {
    var b = f(a);
    return this.filter(function() {
      for(var a = 0, c = b.length;a < c;a++) {
        if(f.contains(this, b[a])) {
          return!0
        }
      }
    })
  }, not:function(a) {
    return this.pushStack(T(this, a, !1), "not", a)
  }, filter:function(a) {
    return this.pushStack(T(this, a, !0), "filter", a)
  }, is:function(a) {
    return!!a && (typeof a == "string" ? Q.test(a) ? f(a, this.context).index(this[0]) >= 0 : f.filter(a, this).length > 0 : this.filter(a).length > 0)
  }, closest:function(a, b) {
    var c = [], d, e, g = this[0];
    if(f.isArray(a)) {
      var h = 1;
      while(g && g.ownerDocument && g !== b) {
        for(d = 0;d < a.length;d++) {
          f(g).is(a[d]) && c.push({selector:a[d], elem:g, level:h})
        }
        g = g.parentNode, h++
      }
      return c
    }
    var i = Q.test(a) || typeof a != "string" ? f(a, b || this.context) : 0;
    for(d = 0, e = this.length;d < e;d++) {
      g = this[d];
      while(g) {
        if(i ? i.index(g) > -1 : f.find.matchesSelector(g, a)) {
          c.push(g);
          break
        }
        g = g.parentNode;
        if(!g || !g.ownerDocument || g === b || g.nodeType === 11) {
          break
        }
      }
    }
    c = c.length > 1 ? f.unique(c) : c;
    return this.pushStack(c, "closest", a)
  }, index:function(a) {
    if(!a) {
      return this[0] && this[0].parentNode ? this.prevAll().length : -1
    }
    if(typeof a == "string") {
      return f.inArray(this[0], f(a))
    }
    return f.inArray(a.jquery ? a[0] : a, this)
  }, add:function(a, b) {
    var c = typeof a == "string" ? f(a, b) : f.makeArray(a && a.nodeType ? [a] : a), d = f.merge(this.get(), c);
    return this.pushStack(S(c[0]) || S(d[0]) ? d : f.unique(d))
  }, andSelf:function() {
    return this.add(this.prevObject)
  }}), f.each({parent:function(a) {
    var b = a.parentNode;
    return b && b.nodeType !== 11 ? b : null
  }, parents:function(a) {
    return f.dir(a, "parentNode")
  }, parentsUntil:function(a, b, c) {
    return f.dir(a, "parentNode", c)
  }, next:function(a) {
    return f.nth(a, 2, "nextSibling")
  }, prev:function(a) {
    return f.nth(a, 2, "previousSibling")
  }, nextAll:function(a) {
    return f.dir(a, "nextSibling")
  }, prevAll:function(a) {
    return f.dir(a, "previousSibling")
  }, nextUntil:function(a, b, c) {
    return f.dir(a, "nextSibling", c)
  }, prevUntil:function(a, b, c) {
    return f.dir(a, "previousSibling", c)
  }, siblings:function(a) {
    return f.sibling((a.parentNode || {}).firstChild, a)
  }, children:function(a) {
    return f.sibling(a.firstChild)
  }, contents:function(a) {
    return f.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : f.makeArray(a.childNodes)
  }}, function(a, b) {
    f.fn[a] = function(c, d) {
      var e = f.map(this, b, c);
      L.test(a) || (d = c), d && typeof d == "string" && (e = f.filter(d, e)), e = this.length > 1 && !R[a] ? f.unique(e) : e, (this.length > 1 || N.test(d)) && M.test(a) && (e = e.reverse());
      return this.pushStack(e, a, P.call(arguments).join(","))
    }
  }), f.extend({filter:function(a, b, c) {
    c && (a = ":not(" + a + ")");
    return b.length === 1 ? f.find.matchesSelector(b[0], a) ? [b[0]] : [] : f.find.matches(a, b)
  }, dir:function(a, c, d) {
    var e = [], g = a[c];
    while(g && g.nodeType !== 9 && (d === b || g.nodeType !== 1 || !f(g).is(d))) {
      g.nodeType === 1 && e.push(g), g = g[c]
    }
    return e
  }, nth:function(a, b, c, d) {
    b = b || 1;
    var e = 0;
    for(;a;a = a[c]) {
      if(a.nodeType === 1 && ++e === b) {
        break
      }
    }
    return a
  }, sibling:function(a, b) {
    var c = [];
    for(;a;a = a.nextSibling) {
      a.nodeType === 1 && a !== b && c.push(a)
    }
    return c
  }});
  var V = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", W = / jQuery\d+="(?:\d+|null)"/g, X = /^\s+/, Y = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig, Z = /<([\w:]+)/, $ = /<tbody/i, _ = /<|&#?\w+;/, ba = /<(?:script|style)/i, bb = /<(?:script|object|embed|option|style)/i, bc = new RegExp("<(?:" + V + ")[\\s/>]", "i"), bd = /checked\s*(?:[^=]|=\s*.checked.)/i, 
  be = /\/(java|ecma)script/i, bf = /^\s*<!(?:\[CDATA\[|\-\-)/, bg = {option:[1, "<select multiple='multiple'>", "</select>"], legend:[1, "<fieldset>", "</fieldset>"], thead:[1, "<table>", "</table>"], tr:[2, "<table><tbody>", "</tbody></table>"], td:[3, "<table><tbody><tr>", "</tr></tbody></table>"], col:[2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], area:[1, "<map>", "</map>"], _default:[0, "", ""]}, bh = U(c);
  bg.optgroup = bg.option, bg.tbody = bg.tfoot = bg.colgroup = bg.caption = bg.thead, bg.th = bg.td, f.support.htmlSerialize || (bg._default = [1, "div<div>", "</div>"]), f.fn.extend({text:function(a) {
    return f.access(this, function(a) {
      return a === b ? f.text(this) : this.empty().append((this[0] && this[0].ownerDocument || c).createTextNode(a))
    }, null, a, arguments.length)
  }, wrapAll:function(a) {
    if(f.isFunction(a)) {
      return this.each(function(b) {
        f(this).wrapAll(a.call(this, b))
      })
    }
    if(this[0]) {
      var b = f(a, this[0].ownerDocument).eq(0).clone(!0);
      this[0].parentNode && b.insertBefore(this[0]), b.map(function() {
        var a = this;
        while(a.firstChild && a.firstChild.nodeType === 1) {
          a = a.firstChild
        }
        return a
      }).append(this)
    }
    return this
  }, wrapInner:function(a) {
    if(f.isFunction(a)) {
      return this.each(function(b) {
        f(this).wrapInner(a.call(this, b))
      })
    }
    return this.each(function() {
      var b = f(this), c = b.contents();
      c.length ? c.wrapAll(a) : b.append(a)
    })
  }, wrap:function(a) {
    var b = f.isFunction(a);
    return this.each(function(c) {
      f(this).wrapAll(b ? a.call(this, c) : a)
    })
  }, unwrap:function() {
    return this.parent().each(function() {
      f.nodeName(this, "body") || f(this).replaceWith(this.childNodes)
    }).end()
  }, append:function() {
    return this.domManip(arguments, !0, function(a) {
      this.nodeType === 1 && this.appendChild(a)
    })
  }, prepend:function() {
    return this.domManip(arguments, !0, function(a) {
      this.nodeType === 1 && this.insertBefore(a, this.firstChild)
    })
  }, before:function() {
    if(this[0] && this[0].parentNode) {
      return this.domManip(arguments, !1, function(a) {
        this.parentNode.insertBefore(a, this)
      })
    }
    if(arguments.length) {
      var a = f.clean(arguments);
      a.push.apply(a, this.toArray());
      return this.pushStack(a, "before", arguments)
    }
  }, after:function() {
    if(this[0] && this[0].parentNode) {
      return this.domManip(arguments, !1, function(a) {
        this.parentNode.insertBefore(a, this.nextSibling)
      })
    }
    if(arguments.length) {
      var a = this.pushStack(this, "after", arguments);
      a.push.apply(a, f.clean(arguments));
      return a
    }
  }, remove:function(a, b) {
    for(var c = 0, d;(d = this[c]) != null;c++) {
      if(!a || f.filter(a, [d]).length) {
        !b && d.nodeType === 1 && (f.cleanData(d.getElementsByTagName("*")), f.cleanData([d])), d.parentNode && d.parentNode.removeChild(d)
      }
    }
    return this
  }, empty:function() {
    for(var a = 0, b;(b = this[a]) != null;a++) {
      b.nodeType === 1 && f.cleanData(b.getElementsByTagName("*"));
      while(b.firstChild) {
        b.removeChild(b.firstChild)
      }
    }
    return this
  }, clone:function(a, b) {
    a = a == null ? !1 : a, b = b == null ? a : b;
    return this.map(function() {
      return f.clone(this, a, b)
    })
  }, html:function(a) {
    return f.access(this, function(a) {
      var c = this[0] || {}, d = 0, e = this.length;
      if(a === b) {
        return c.nodeType === 1 ? c.innerHTML.replace(W, "") : null
      }
      if(typeof a == "string" && !ba.test(a) && (f.support.leadingWhitespace || !X.test(a)) && !bg[(Z.exec(a) || ["", ""])[1].toLowerCase()]) {
        a = a.replace(Y, "<$1></$2>");
        try {
          for(;d < e;d++) {
            c = this[d] || {}, c.nodeType === 1 && (f.cleanData(c.getElementsByTagName("*")), c.innerHTML = a)
          }
          c = 0
        }catch(g) {
        }
      }
      c && this.empty().append(a)
    }, null, a, arguments.length)
  }, replaceWith:function(a) {
    if(this[0] && this[0].parentNode) {
      if(f.isFunction(a)) {
        return this.each(function(b) {
          var c = f(this), d = c.html();
          c.replaceWith(a.call(this, b, d))
        })
      }
      typeof a != "string" && (a = f(a).detach());
      return this.each(function() {
        var b = this.nextSibling, c = this.parentNode;
        f(this).remove(), b ? f(b).before(a) : f(c).append(a)
      })
    }
    return this.length ? this.pushStack(f(f.isFunction(a) ? a() : a), "replaceWith", a) : this
  }, detach:function(a) {
    return this.remove(a, !0)
  }, domManip:function(a, c, d) {
    var e, g, h, i, j = a[0], k = [];
    if(!f.support.checkClone && arguments.length === 3 && typeof j == "string" && bd.test(j)) {
      return this.each(function() {
        f(this).domManip(a, c, d, !0)
      })
    }
    if(f.isFunction(j)) {
      return this.each(function(e) {
        var g = f(this);
        a[0] = j.call(this, e, c ? g.html() : b), g.domManip(a, c, d)
      })
    }
    if(this[0]) {
      i = j && j.parentNode, f.support.parentNode && i && i.nodeType === 11 && i.childNodes.length === this.length ? e = {fragment:i} : e = f.buildFragment(a, this, k), h = e.fragment, h.childNodes.length === 1 ? g = h = h.firstChild : g = h.firstChild;
      if(g) {
        c = c && f.nodeName(g, "tr");
        for(var l = 0, m = this.length, n = m - 1;l < m;l++) {
          d.call(c ? bi(this[l], g) : this[l], e.cacheable || m > 1 && l < n ? f.clone(h, !0, !0) : h)
        }
      }
      k.length && f.each(k, function(a, b) {
        b.src ? f.ajax({type:"GET", global:!1, url:b.src, async:!1, dataType:"script"}) : f.globalEval((b.text || b.textContent || b.innerHTML || "").replace(bf, "/*$0*/")), b.parentNode && b.parentNode.removeChild(b)
      })
    }
    return this
  }}), f.buildFragment = function(a, b, d) {
    var e, g, h, i, j = a[0];
    b && b[0] && (i = b[0].ownerDocument || b[0]), i.createDocumentFragment || (i = c), a.length === 1 && typeof j == "string" && j.length < 512 && i === c && j.charAt(0) === "<" && !bb.test(j) && (f.support.checkClone || !bd.test(j)) && (f.support.html5Clone || !bc.test(j)) && (g = !0, h = f.fragments[j], h && h !== 1 && (e = h)), e || (e = i.createDocumentFragment(), f.clean(a, i, e, d)), g && (f.fragments[j] = h ? e : 1);
    return{fragment:e, cacheable:g}
  }, f.fragments = {}, f.each({appendTo:"append", prependTo:"prepend", insertBefore:"before", insertAfter:"after", replaceAll:"replaceWith"}, function(a, b) {
    f.fn[a] = function(c) {
      var d = [], e = f(c), g = this.length === 1 && this[0].parentNode;
      if(g && g.nodeType === 11 && g.childNodes.length === 1 && e.length === 1) {
        e[b](this[0]);
        return this
      }
      for(var h = 0, i = e.length;h < i;h++) {
        var j = (h > 0 ? this.clone(!0) : this).get();
        f(e[h])[b](j), d = d.concat(j)
      }
      return this.pushStack(d, a, e.selector)
    }
  }), f.extend({clone:function(a, b, c) {
    var d, e, g, h = f.support.html5Clone || f.isXMLDoc(a) || !bc.test("<" + a.nodeName + ">") ? a.cloneNode(!0) : bo(a);
    if((!f.support.noCloneEvent || !f.support.noCloneChecked) && (a.nodeType === 1 || a.nodeType === 11) && !f.isXMLDoc(a)) {
      bk(a, h), d = bl(a), e = bl(h);
      for(g = 0;d[g];++g) {
        e[g] && bk(d[g], e[g])
      }
    }
    if(b) {
      bj(a, h);
      if(c) {
        d = bl(a), e = bl(h);
        for(g = 0;d[g];++g) {
          bj(d[g], e[g])
        }
      }
    }
    d = e = null;
    return h
  }, clean:function(a, b, d, e) {
    var g, h, i, j = [];
    b = b || c, typeof b.createElement == "undefined" && (b = b.ownerDocument || b[0] && b[0].ownerDocument || c);
    for(var k = 0, l;(l = a[k]) != null;k++) {
      typeof l == "number" && (l += "");
      if(!l) {
        continue
      }
      if(typeof l == "string") {
        if(!_.test(l)) {
          l = b.createTextNode(l)
        }else {
          l = l.replace(Y, "<$1></$2>");
          var m = (Z.exec(l) || ["", ""])[1].toLowerCase(), n = bg[m] || bg._default, o = n[0], p = b.createElement("div"), q = bh.childNodes, r;
          b === c ? bh.appendChild(p) : U(b).appendChild(p), p.innerHTML = n[1] + l + n[2];
          while(o--) {
            p = p.lastChild
          }
          if(!f.support.tbody) {
            var s = $.test(l), t = m === "table" && !s ? p.firstChild && p.firstChild.childNodes : n[1] === "<table>" && !s ? p.childNodes : [];
            for(i = t.length - 1;i >= 0;--i) {
              f.nodeName(t[i], "tbody") && !t[i].childNodes.length && t[i].parentNode.removeChild(t[i])
            }
          }
          !f.support.leadingWhitespace && X.test(l) && p.insertBefore(b.createTextNode(X.exec(l)[0]), p.firstChild), l = p.childNodes, p && (p.parentNode.removeChild(p), q.length > 0 && (r = q[q.length - 1], r && r.parentNode && r.parentNode.removeChild(r)))
        }
      }
      var u;
      if(!f.support.appendChecked) {
        if(l[0] && typeof(u = l.length) == "number") {
          for(i = 0;i < u;i++) {
            bn(l[i])
          }
        }else {
          bn(l)
        }
      }
      l.nodeType ? j.push(l) : j = f.merge(j, l)
    }
    if(d) {
      g = function(a) {
        return!a.type || be.test(a.type)
      };
      for(k = 0;j[k];k++) {
        h = j[k];
        if(e && f.nodeName(h, "script") && (!h.type || be.test(h.type))) {
          e.push(h.parentNode ? h.parentNode.removeChild(h) : h)
        }else {
          if(h.nodeType === 1) {
            var v = f.grep(h.getElementsByTagName("script"), g);
            j.splice.apply(j, [k + 1, 0].concat(v))
          }
          d.appendChild(h)
        }
      }
    }
    return j
  }, cleanData:function(a) {
    var b, c, d = f.cache, e = f.event.special, g = f.support.deleteExpando;
    for(var h = 0, i;(i = a[h]) != null;h++) {
      if(i.nodeName && f.noData[i.nodeName.toLowerCase()]) {
        continue
      }
      c = i[f.expando];
      if(c) {
        b = d[c];
        if(b && b.events) {
          for(var j in b.events) {
            e[j] ? f.event.remove(i, j) : f.removeEvent(i, j, b.handle)
          }
          b.handle && (b.handle.elem = null)
        }
        g ? delete i[f.expando] : i.removeAttribute && i.removeAttribute(f.expando), delete d[c]
      }
    }
  }});
  var bp = /alpha\([^)]*\)/i, bq = /opacity=([^)]*)/, br = /([A-Z]|^ms)/g, bs = /^[\-+]?(?:\d*\.)?\d+$/i, bt = /^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i, bu = /^([\-+])=([\-+.\de]+)/, bv = /^margin/, bw = {position:"absolute", visibility:"hidden", display:"block"}, bx = ["Top", "Right", "Bottom", "Left"], by, bz, bA;
  f.fn.css = function(a, c) {
    return f.access(this, function(a, c, d) {
      return d !== b ? f.style(a, c, d) : f.css(a, c)
    }, a, c, arguments.length > 1)
  }, f.extend({cssHooks:{opacity:{get:function(a, b) {
    if(b) {
      var c = by(a, "opacity");
      return c === "" ? "1" : c
    }
    return a.style.opacity
  }}}, cssNumber:{fillOpacity:!0, fontWeight:!0, lineHeight:!0, opacity:!0, orphans:!0, widows:!0, zIndex:!0, zoom:!0}, cssProps:{"float":f.support.cssFloat ? "cssFloat" : "styleFloat"}, style:function(a, c, d, e) {
    if(!!a && a.nodeType !== 3 && a.nodeType !== 8 && !!a.style) {
      var g, h, i = f.camelCase(c), j = a.style, k = f.cssHooks[i];
      c = f.cssProps[i] || i;
      if(d === b) {
        if(k && "get" in k && (g = k.get(a, !1, e)) !== b) {
          return g
        }
        return j[c]
      }
      h = typeof d, h === "string" && (g = bu.exec(d)) && (d = +(g[1] + 1) * +g[2] + parseFloat(f.css(a, c)), h = "number");
      if(d == null || h === "number" && isNaN(d)) {
        return
      }
      h === "number" && !f.cssNumber[i] && (d += "px");
      if(!k || !("set" in k) || (d = k.set(a, d)) !== b) {
        try {
          j[c] = d
        }catch(l) {
        }
      }
    }
  }, css:function(a, c, d) {
    var e, g;
    c = f.camelCase(c), g = f.cssHooks[c], c = f.cssProps[c] || c, c === "cssFloat" && (c = "float");
    if(g && "get" in g && (e = g.get(a, !0, d)) !== b) {
      return e
    }
    if(by) {
      return by(a, c)
    }
  }, swap:function(a, b, c) {
    var d = {}, e, f;
    for(f in b) {
      d[f] = a.style[f], a.style[f] = b[f]
    }
    e = c.call(a);
    for(f in b) {
      a.style[f] = d[f]
    }
    return e
  }}), f.curCSS = f.css, c.defaultView && c.defaultView.getComputedStyle && (bz = function(a, b) {
    var c, d, e, g, h = a.style;
    b = b.replace(br, "-$1").toLowerCase(), (d = a.ownerDocument.defaultView) && (e = d.getComputedStyle(a, null)) && (c = e.getPropertyValue(b), c === "" && !f.contains(a.ownerDocument.documentElement, a) && (c = f.style(a, b))), !f.support.pixelMargin && e && bv.test(b) && bt.test(c) && (g = h.width, h.width = c, c = e.width, h.width = g);
    return c
  }), c.documentElement.currentStyle && (bA = function(a, b) {
    var c, d, e, f = a.currentStyle && a.currentStyle[b], g = a.style;
    f == null && g && (e = g[b]) && (f = e), bt.test(f) && (c = g.left, d = a.runtimeStyle && a.runtimeStyle.left, d && (a.runtimeStyle.left = a.currentStyle.left), g.left = b === "fontSize" ? "1em" : f, f = g.pixelLeft + "px", g.left = c, d && (a.runtimeStyle.left = d));
    return f === "" ? "auto" : f
  }), by = bz || bA, f.each(["height", "width"], function(a, b) {
    f.cssHooks[b] = {get:function(a, c, d) {
      if(c) {
        return a.offsetWidth !== 0 ? bB(a, b, d) : f.swap(a, bw, function() {
          return bB(a, b, d)
        })
      }
    }, set:function(a, b) {
      return bs.test(b) ? b + "px" : b
    }}
  }), f.support.opacity || (f.cssHooks.opacity = {get:function(a, b) {
    return bq.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? parseFloat(RegExp.$1) / 100 + "" : b ? "1" : ""
  }, set:function(a, b) {
    var c = a.style, d = a.currentStyle, e = f.isNumeric(b) ? "alpha(opacity=" + b * 100 + ")" : "", g = d && d.filter || c.filter || "";
    c.zoom = 1;
    if(b >= 1 && f.trim(g.replace(bp, "")) === "") {
      c.removeAttribute("filter");
      if(d && !d.filter) {
        return
      }
    }
    c.filter = bp.test(g) ? g.replace(bp, e) : g + " " + e
  }}), f(function() {
    f.support.reliableMarginRight || (f.cssHooks.marginRight = {get:function(a, b) {
      return f.swap(a, {display:"inline-block"}, function() {
        return b ? by(a, "margin-right") : a.style.marginRight
      })
    }})
  }), f.expr && f.expr.filters && (f.expr.filters.hidden = function(a) {
    var b = a.offsetWidth, c = a.offsetHeight;
    return b === 0 && c === 0 || !f.support.reliableHiddenOffsets && (a.style && a.style.display || f.css(a, "display")) === "none"
  }, f.expr.filters.visible = function(a) {
    return!f.expr.filters.hidden(a)
  }), f.each({margin:"", padding:"", border:"Width"}, function(a, b) {
    f.cssHooks[a + b] = {expand:function(c) {
      var d, e = typeof c == "string" ? c.split(" ") : [c], f = {};
      for(d = 0;d < 4;d++) {
        f[a + bx[d] + b] = e[d] || e[d - 2] || e[0]
      }
      return f
    }}
  });
  var bC = /%20/g, bD = /\[\]$/, bE = /\r?\n/g, bF = /#.*$/, bG = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg, bH = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i, bI = /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/, bJ = /^(?:GET|HEAD)$/, bK = /^\/\//, bL = /\?/, bM = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, bN = /^(?:select|textarea)/i, bO = /\s+/, bP = /([?&])_=[^&]*/, bQ = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/, 
  bR = f.fn.load, bS = {}, bT = {}, bU, bV, bW = ["*/"] + ["*"];
  try {
    bU = e.href
  }catch(bX) {
    bU = c.createElement("a"), bU.href = "", bU = bU.href
  }
  bV = bQ.exec(bU.toLowerCase()) || [], f.fn.extend({load:function(a, c, d) {
    if(typeof a != "string" && bR) {
      return bR.apply(this, arguments)
    }
    if(!this.length) {
      return this
    }
    var e = a.indexOf(" ");
    if(e >= 0) {
      var g = a.slice(e, a.length);
      a = a.slice(0, e)
    }
    var h = "GET";
    c && (f.isFunction(c) ? (d = c, c = b) : typeof c == "object" && (c = f.param(c, f.ajaxSettings.traditional), h = "POST"));
    var i = this;
    f.ajax({url:a, type:h, dataType:"html", data:c, complete:function(a, b, c) {
      c = a.responseText, a.isResolved() && (a.done(function(a) {
        c = a
      }), i.html(g ? f("<div>").append(c.replace(bM, "")).find(g) : c)), d && i.each(d, [c, b, a])
    }});
    return this
  }, serialize:function() {
    return f.param(this.serializeArray())
  }, serializeArray:function() {
    return this.map(function() {
      return this.elements ? f.makeArray(this.elements) : this
    }).filter(function() {
      return this.name && !this.disabled && (this.checked || bN.test(this.nodeName) || bH.test(this.type))
    }).map(function(a, b) {
      var c = f(this).val();
      return c == null ? null : f.isArray(c) ? f.map(c, function(a, c) {
        return{name:b.name, value:a.replace(bE, "\r\n")}
      }) : {name:b.name, value:c.replace(bE, "\r\n")}
    }).get()
  }}), f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "), function(a, b) {
    f.fn[b] = function(a) {
      return this.on(b, a)
    }
  }), f.each(["get", "post"], function(a, c) {
    f[c] = function(a, d, e, g) {
      f.isFunction(d) && (g = g || e, e = d, d = b);
      return f.ajax({type:c, url:a, data:d, success:e, dataType:g})
    }
  }), f.extend({getScript:function(a, c) {
    return f.get(a, b, c, "script")
  }, getJSON:function(a, b, c) {
    return f.get(a, b, c, "json")
  }, ajaxSetup:function(a, b) {
    b ? b$(a, f.ajaxSettings) : (b = a, a = f.ajaxSettings), b$(a, b);
    return a
  }, ajaxSettings:{url:bU, isLocal:bI.test(bV[1]), global:!0, type:"GET", contentType:"application/x-www-form-urlencoded; charset=UTF-8", processData:!0, async:!0, accepts:{xml:"application/xml, text/xml", html:"text/html", text:"text/plain", json:"application/json, text/javascript", "*":bW}, contents:{xml:/xml/, html:/html/, json:/json/}, responseFields:{xml:"responseXML", text:"responseText"}, converters:{"* text":a.String, "text html":!0, "text json":f.parseJSON, "text xml":f.parseXML}, flatOptions:{context:!0, 
  url:!0}}, ajaxPrefilter:bY(bS), ajaxTransport:bY(bT), ajax:function(a, c) {
    function w(a, c, l, m) {
      if(s !== 2) {
        s = 2, q && clearTimeout(q), p = b, n = m || "", v.readyState = a > 0 ? 4 : 0;
        var o, r, u, w = c, x = l ? ca(d, v, l) : b, y, z;
        if(a >= 200 && a < 300 || a === 304) {
          if(d.ifModified) {
            if(y = v.getResponseHeader("Last-Modified")) {
              f.lastModified[k] = y
            }
            if(z = v.getResponseHeader("Etag")) {
              f.etag[k] = z
            }
          }
          if(a === 304) {
            w = "notmodified", o = !0
          }else {
            try {
              r = cb(d, x), w = "success", o = !0
            }catch(A) {
              w = "parsererror", u = A
            }
          }
        }else {
          u = w;
          if(!w || a) {
            w = "error", a < 0 && (a = 0)
          }
        }
        v.status = a, v.statusText = "" + (c || w), o ? h.resolveWith(e, [r, w, v]) : h.rejectWith(e, [v, w, u]), v.statusCode(j), j = b, t && g.trigger("ajax" + (o ? "Success" : "Error"), [v, d, o ? r : u]), i.fireWith(e, [v, w]), t && (g.trigger("ajaxComplete", [v, d]), --f.active || f.event.trigger("ajaxStop"))
      }
    }
    typeof a == "object" && (c = a, a = b), c = c || {};
    var d = f.ajaxSetup({}, c), e = d.context || d, g = e !== d && (e.nodeType || e instanceof f) ? f(e) : f.event, h = f.Deferred(), i = f.Callbacks("once memory"), j = d.statusCode || {}, k, l = {}, m = {}, n, o, p, q, r, s = 0, t, u, v = {readyState:0, setRequestHeader:function(a, b) {
      if(!s) {
        var c = a.toLowerCase();
        a = m[c] = m[c] || a, l[a] = b
      }
      return this
    }, getAllResponseHeaders:function() {
      return s === 2 ? n : null
    }, getResponseHeader:function(a) {
      var c;
      if(s === 2) {
        if(!o) {
          o = {};
          while(c = bG.exec(n)) {
            o[c[1].toLowerCase()] = c[2]
          }
        }
        c = o[a.toLowerCase()]
      }
      return c === b ? null : c
    }, overrideMimeType:function(a) {
      s || (d.mimeType = a);
      return this
    }, abort:function(a) {
      a = a || "abort", p && p.abort(a), w(0, a);
      return this
    }};
    h.promise(v), v.success = v.done, v.error = v.fail, v.complete = i.add, v.statusCode = function(a) {
      if(a) {
        var b;
        if(s < 2) {
          for(b in a) {
            j[b] = [j[b], a[b]]
          }
        }else {
          b = a[v.status], v.then(b, b)
        }
      }
      return this
    }, d.url = ((a || d.url) + "").replace(bF, "").replace(bK, bV[1] + "//"), d.dataTypes = f.trim(d.dataType || "*").toLowerCase().split(bO), d.crossDomain == null && (r = bQ.exec(d.url.toLowerCase()), d.crossDomain = !(!r || r[1] == bV[1] && r[2] == bV[2] && (r[3] || (r[1] === "http:" ? 80 : 443)) == (bV[3] || (bV[1] === "http:" ? 80 : 443)))), d.data && d.processData && typeof d.data != "string" && (d.data = f.param(d.data, d.traditional)), bZ(bS, d, c, v);
    if(s === 2) {
      return!1
    }
    t = d.global, d.type = d.type.toUpperCase(), d.hasContent = !bJ.test(d.type), t && f.active++ === 0 && f.event.trigger("ajaxStart");
    if(!d.hasContent) {
      d.data && (d.url += (bL.test(d.url) ? "&" : "?") + d.data, delete d.data), k = d.url;
      if(d.cache === !1) {
        var x = f.now(), y = d.url.replace(bP, "$1_=" + x);
        d.url = y + (y === d.url ? (bL.test(d.url) ? "&" : "?") + "_=" + x : "")
      }
    }
    (d.data && d.hasContent && d.contentType !== !1 || c.contentType) && v.setRequestHeader("Content-Type", d.contentType), d.ifModified && (k = k || d.url, f.lastModified[k] && v.setRequestHeader("If-Modified-Since", f.lastModified[k]), f.etag[k] && v.setRequestHeader("If-None-Match", f.etag[k])), v.setRequestHeader("Accept", d.dataTypes[0] && d.accepts[d.dataTypes[0]] ? d.accepts[d.dataTypes[0]] + (d.dataTypes[0] !== "*" ? ", " + bW + "; q=0.01" : "") : d.accepts["*"]);
    for(u in d.headers) {
      v.setRequestHeader(u, d.headers[u])
    }
    if(d.beforeSend && (d.beforeSend.call(e, v, d) === !1 || s === 2)) {
      v.abort();
      return!1
    }
    for(u in{success:1, error:1, complete:1}) {
      v[u](d[u])
    }
    p = bZ(bT, d, c, v);
    if(!p) {
      w(-1, "No Transport")
    }else {
      v.readyState = 1, t && g.trigger("ajaxSend", [v, d]), d.async && d.timeout > 0 && (q = setTimeout(function() {
        v.abort("timeout")
      }, d.timeout));
      try {
        s = 1, p.send(l, w)
      }catch(z) {
        if(s < 2) {
          w(-1, z)
        }else {
          throw z;
        }
      }
    }
    return v
  }, param:function(a, c) {
    var d = [], e = function(a, b) {
      b = f.isFunction(b) ? b() : b, d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b)
    };
    c === b && (c = f.ajaxSettings.traditional);
    if(f.isArray(a) || a.jquery && !f.isPlainObject(a)) {
      f.each(a, function() {
        e(this.name, this.value)
      })
    }else {
      for(var g in a) {
        b_(g, a[g], c, e)
      }
    }
    return d.join("&").replace(bC, "+")
  }}), f.extend({active:0, lastModified:{}, etag:{}});
  var cc = f.now(), cd = /(\=)\?(&|$)|\?\?/i;
  f.ajaxSetup({jsonp:"callback", jsonpCallback:function() {
    return f.expando + "_" + cc++
  }}), f.ajaxPrefilter("json jsonp", function(b, c, d) {
    var e = typeof b.data == "string" && /^application\/x\-www\-form\-urlencoded/.test(b.contentType);
    if(b.dataTypes[0] === "jsonp" || b.jsonp !== !1 && (cd.test(b.url) || e && cd.test(b.data))) {
      var g, h = b.jsonpCallback = f.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, i = a[h], j = b.url, k = b.data, l = "$1" + h + "$2";
      b.jsonp !== !1 && (j = j.replace(cd, l), b.url === j && (e && (k = k.replace(cd, l)), b.data === k && (j += (/\?/.test(j) ? "&" : "?") + b.jsonp + "=" + h))), b.url = j, b.data = k, a[h] = function(a) {
        g = [a]
      }, d.always(function() {
        a[h] = i, g && f.isFunction(i) && a[h](g[0])
      }), b.converters["script json"] = function() {
        g || f.error(h + " was not called");
        return g[0]
      }, b.dataTypes[0] = "json";
      return"script"
    }
  }), f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents:{script:/javascript|ecmascript/}, converters:{"text script":function(a) {
    f.globalEval(a);
    return a
  }}}), f.ajaxPrefilter("script", function(a) {
    a.cache === b && (a.cache = !1), a.crossDomain && (a.type = "GET", a.global = !1)
  }), f.ajaxTransport("script", function(a) {
    if(a.crossDomain) {
      var d, e = c.head || c.getElementsByTagName("head")[0] || c.documentElement;
      return{send:function(f, g) {
        d = c.createElement("script"), d.async = "async", a.scriptCharset && (d.charset = a.scriptCharset), d.src = a.url, d.onload = d.onreadystatechange = function(a, c) {
          if(c || !d.readyState || /loaded|complete/.test(d.readyState)) {
            d.onload = d.onreadystatechange = null, e && d.parentNode && e.removeChild(d), d = b, c || g(200, "success")
          }
        }, e.insertBefore(d, e.firstChild)
      }, abort:function() {
        d && d.onload(0, 1)
      }}
    }
  });
  var ce = a.ActiveXObject ? function() {
    for(var a in cg) {
      cg[a](0, 1)
    }
  } : !1, cf = 0, cg;
  f.ajaxSettings.xhr = a.ActiveXObject ? function() {
    return!this.isLocal && ch() || ci()
  } : ch, function(a) {
    f.extend(f.support, {ajax:!!a, cors:!!a && "withCredentials" in a})
  }(f.ajaxSettings.xhr()), f.support.ajax && f.ajaxTransport(function(c) {
    if(!c.crossDomain || f.support.cors) {
      var d;
      return{send:function(e, g) {
        var h = c.xhr(), i, j;
        c.username ? h.open(c.type, c.url, c.async, c.username, c.password) : h.open(c.type, c.url, c.async);
        if(c.xhrFields) {
          for(j in c.xhrFields) {
            h[j] = c.xhrFields[j]
          }
        }
        c.mimeType && h.overrideMimeType && h.overrideMimeType(c.mimeType), !c.crossDomain && !e["X-Requested-With"] && (e["X-Requested-With"] = "XMLHttpRequest");
        try {
          for(j in e) {
            h.setRequestHeader(j, e[j])
          }
        }catch(k) {
        }
        h.send(c.hasContent && c.data || null), d = function(a, e) {
          var j, k, l, m, n;
          try {
            if(d && (e || h.readyState === 4)) {
              d = b, i && (h.onreadystatechange = f.noop, ce && delete cg[i]);
              if(e) {
                h.readyState !== 4 && h.abort()
              }else {
                j = h.status, l = h.getAllResponseHeaders(), m = {}, n = h.responseXML, n && n.documentElement && (m.xml = n);
                try {
                  m.text = h.responseText
                }catch(a) {
                }
                try {
                  k = h.statusText
                }catch(o) {
                  k = ""
                }
                !j && c.isLocal && !c.crossDomain ? j = m.text ? 200 : 404 : j === 1223 && (j = 204)
              }
            }
          }catch(p) {
            e || g(-1, p)
          }
          m && g(j, k, m, l)
        }, !c.async || h.readyState === 4 ? d() : (i = ++cf, ce && (cg || (cg = {}, f(a).unload(ce)), cg[i] = d), h.onreadystatechange = d)
      }, abort:function() {
        d && d(0, 1)
      }}
    }
  });
  var cj = {}, ck, cl, cm = /^(?:toggle|show|hide)$/, cn = /^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i, co, cp = [["height", "marginTop", "marginBottom", "paddingTop", "paddingBottom"], ["width", "marginLeft", "marginRight", "paddingLeft", "paddingRight"], ["opacity"]], cq;
  f.fn.extend({show:function(a, b, c) {
    var d, e;
    if(a || a === 0) {
      return this.animate(ct("show", 3), a, b, c)
    }
    for(var g = 0, h = this.length;g < h;g++) {
      d = this[g], d.style && (e = d.style.display, !f._data(d, "olddisplay") && e === "none" && (e = d.style.display = ""), (e === "" && f.css(d, "display") === "none" || !f.contains(d.ownerDocument.documentElement, d)) && f._data(d, "olddisplay", cu(d.nodeName)))
    }
    for(g = 0;g < h;g++) {
      d = this[g];
      if(d.style) {
        e = d.style.display;
        if(e === "" || e === "none") {
          d.style.display = f._data(d, "olddisplay") || ""
        }
      }
    }
    return this
  }, hide:function(a, b, c) {
    if(a || a === 0) {
      return this.animate(ct("hide", 3), a, b, c)
    }
    var d, e, g = 0, h = this.length;
    for(;g < h;g++) {
      d = this[g], d.style && (e = f.css(d, "display"), e !== "none" && !f._data(d, "olddisplay") && f._data(d, "olddisplay", e))
    }
    for(g = 0;g < h;g++) {
      this[g].style && (this[g].style.display = "none")
    }
    return this
  }, _toggle:f.fn.toggle, toggle:function(a, b, c) {
    var d = typeof a == "boolean";
    f.isFunction(a) && f.isFunction(b) ? this._toggle.apply(this, arguments) : a == null || d ? this.each(function() {
      var b = d ? a : f(this).is(":hidden");
      f(this)[b ? "show" : "hide"]()
    }) : this.animate(ct("toggle", 3), a, b, c);
    return this
  }, fadeTo:function(a, b, c, d) {
    return this.filter(":hidden").css("opacity", 0).show().end().animate({opacity:b}, a, c, d)
  }, animate:function(a, b, c, d) {
    function g() {
      e.queue === !1 && f._mark(this);
      var b = f.extend({}, e), c = this.nodeType === 1, d = c && f(this).is(":hidden"), g, h, i, j, k, l, m, n, o, p, q;
      b.animatedProperties = {};
      for(i in a) {
        g = f.camelCase(i), i !== g && (a[g] = a[i], delete a[i]);
        if((k = f.cssHooks[g]) && "expand" in k) {
          l = k.expand(a[g]), delete a[g];
          for(i in l) {
            i in a || (a[i] = l[i])
          }
        }
      }
      for(g in a) {
        h = a[g], f.isArray(h) ? (b.animatedProperties[g] = h[1], h = a[g] = h[0]) : b.animatedProperties[g] = b.specialEasing && b.specialEasing[g] || b.easing || "swing";
        if(h === "hide" && d || h === "show" && !d) {
          return b.complete.call(this)
        }
        c && (g === "height" || g === "width") && (b.overflow = [this.style.overflow, this.style.overflowX, this.style.overflowY], f.css(this, "display") === "inline" && f.css(this, "float") === "none" && (!f.support.inlineBlockNeedsLayout || cu(this.nodeName) === "inline" ? this.style.display = "inline-block" : this.style.zoom = 1))
      }
      b.overflow != null && (this.style.overflow = "hidden");
      for(i in a) {
        j = new f.fx(this, b, i), h = a[i], cm.test(h) ? (q = f._data(this, "toggle" + i) || (h === "toggle" ? d ? "show" : "hide" : 0), q ? (f._data(this, "toggle" + i, q === "show" ? "hide" : "show"), j[q]()) : j[h]()) : (m = cn.exec(h), n = j.cur(), m ? (o = parseFloat(m[2]), p = m[3] || (f.cssNumber[i] ? "" : "px"), p !== "px" && (f.style(this, i, (o || 1) + p), n = (o || 1) / j.cur() * n, f.style(this, i, n + p)), m[1] && (o = (m[1] === "-=" ? -1 : 1) * o + n), j.custom(n, o, p)) : j.custom(n, 
        h, ""))
      }
      return!0
    }
    var e = f.speed(b, c, d);
    if(f.isEmptyObject(a)) {
      return this.each(e.complete, [!1])
    }
    a = f.extend({}, a);
    return e.queue === !1 ? this.each(g) : this.queue(e.queue, g)
  }, stop:function(a, c, d) {
    typeof a != "string" && (d = c, c = a, a = b), c && a !== !1 && this.queue(a || "fx", []);
    return this.each(function() {
      function h(a, b, c) {
        var e = b[c];
        f.removeData(a, c, !0), e.stop(d)
      }
      var b, c = !1, e = f.timers, g = f._data(this);
      d || f._unmark(!0, this);
      if(a == null) {
        for(b in g) {
          g[b] && g[b].stop && b.indexOf(".run") === b.length - 4 && h(this, g, b)
        }
      }else {
        g[b = a + ".run"] && g[b].stop && h(this, g, b)
      }
      for(b = e.length;b--;) {
        e[b].elem === this && (a == null || e[b].queue === a) && (d ? e[b](!0) : e[b].saveState(), c = !0, e.splice(b, 1))
      }
      (!d || !c) && f.dequeue(this, a)
    })
  }}), f.each({slideDown:ct("show", 1), slideUp:ct("hide", 1), slideToggle:ct("toggle", 1), fadeIn:{opacity:"show"}, fadeOut:{opacity:"hide"}, fadeToggle:{opacity:"toggle"}}, function(a, b) {
    f.fn[a] = function(a, c, d) {
      return this.animate(b, a, c, d)
    }
  }), f.extend({speed:function(a, b, c) {
    var d = a && typeof a == "object" ? f.extend({}, a) : {complete:c || !c && b || f.isFunction(a) && a, duration:a, easing:c && b || b && !f.isFunction(b) && b};
    d.duration = f.fx.off ? 0 : typeof d.duration == "number" ? d.duration : d.duration in f.fx.speeds ? f.fx.speeds[d.duration] : f.fx.speeds._default;
    if(d.queue == null || d.queue === !0) {
      d.queue = "fx"
    }
    d.old = d.complete, d.complete = function(a) {
      f.isFunction(d.old) && d.old.call(this), d.queue ? f.dequeue(this, d.queue) : a !== !1 && f._unmark(this)
    };
    return d
  }, easing:{linear:function(a) {
    return a
  }, swing:function(a) {
    return-Math.cos(a * Math.PI) / 2 + 0.5
  }}, timers:[], fx:function(a, b, c) {
    this.options = b, this.elem = a, this.prop = c, b.orig = b.orig || {}
  }}), f.fx.prototype = {update:function() {
    this.options.step && this.options.step.call(this.elem, this.now, this), (f.fx.step[this.prop] || f.fx.step._default)(this)
  }, cur:function() {
    if(this.elem[this.prop] != null && (!this.elem.style || this.elem.style[this.prop] == null)) {
      return this.elem[this.prop]
    }
    var a, b = f.css(this.elem, this.prop);
    return isNaN(a = parseFloat(b)) ? !b || b === "auto" ? 0 : b : a
  }, custom:function(a, c, d) {
    function h(a) {
      return e.step(a)
    }
    var e = this, g = f.fx;
    this.startTime = cq || cr(), this.end = c, this.now = this.start = a, this.pos = this.state = 0, this.unit = d || this.unit || (f.cssNumber[this.prop] ? "" : "px"), h.queue = this.options.queue, h.elem = this.elem, h.saveState = function() {
      f._data(e.elem, "fxshow" + e.prop) === b && (e.options.hide ? f._data(e.elem, "fxshow" + e.prop, e.start) : e.options.show && f._data(e.elem, "fxshow" + e.prop, e.end))
    }, h() && f.timers.push(h) && !co && (co = setInterval(g.tick, g.interval))
  }, show:function() {
    var a = f._data(this.elem, "fxshow" + this.prop);
    this.options.orig[this.prop] = a || f.style(this.elem, this.prop), this.options.show = !0, a !== b ? this.custom(this.cur(), a) : this.custom(this.prop === "width" || this.prop === "height" ? 1 : 0, this.cur()), f(this.elem).show()
  }, hide:function() {
    this.options.orig[this.prop] = f._data(this.elem, "fxshow" + this.prop) || f.style(this.elem, this.prop), this.options.hide = !0, this.custom(this.cur(), 0)
  }, step:function(a) {
    var b, c, d, e = cq || cr(), g = !0, h = this.elem, i = this.options;
    if(a || e >= i.duration + this.startTime) {
      this.now = this.end, this.pos = this.state = 1, this.update(), i.animatedProperties[this.prop] = !0;
      for(b in i.animatedProperties) {
        i.animatedProperties[b] !== !0 && (g = !1)
      }
      if(g) {
        i.overflow != null && !f.support.shrinkWrapBlocks && f.each(["", "X", "Y"], function(a, b) {
          h.style["overflow" + b] = i.overflow[a]
        }), i.hide && f(h).hide();
        if(i.hide || i.show) {
          for(b in i.animatedProperties) {
            f.style(h, b, i.orig[b]), f.removeData(h, "fxshow" + b, !0), f.removeData(h, "toggle" + b, !0)
          }
        }
        d = i.complete, d && (i.complete = !1, d.call(h))
      }
      return!1
    }
    i.duration == Infinity ? this.now = e : (c = e - this.startTime, this.state = c / i.duration, this.pos = f.easing[i.animatedProperties[this.prop]](this.state, c, 0, 1, i.duration), this.now = this.start + (this.end - this.start) * this.pos), this.update();
    return!0
  }}, f.extend(f.fx, {tick:function() {
    var a, b = f.timers, c = 0;
    for(;c < b.length;c++) {
      a = b[c], !a() && b[c] === a && b.splice(c--, 1)
    }
    b.length || f.fx.stop()
  }, interval:13, stop:function() {
    clearInterval(co), co = null
  }, speeds:{slow:600, fast:200, _default:400}, step:{opacity:function(a) {
    f.style(a.elem, "opacity", a.now)
  }, _default:function(a) {
    a.elem.style && a.elem.style[a.prop] != null ? a.elem.style[a.prop] = a.now + a.unit : a.elem[a.prop] = a.now
  }}}), f.each(cp.concat.apply([], cp), function(a, b) {
    b.indexOf("margin") && (f.fx.step[b] = function(a) {
      f.style(a.elem, b, Math.max(0, a.now) + a.unit)
    })
  }), f.expr && f.expr.filters && (f.expr.filters.animated = function(a) {
    return f.grep(f.timers, function(b) {
      return a === b.elem
    }).length
  });
  var cv, cw = /^t(?:able|d|h)$/i, cx = /^(?:body|html)$/i;
  "getBoundingClientRect" in c.documentElement ? cv = function(a, b, c, d) {
    try {
      d = a.getBoundingClientRect()
    }catch(e) {
    }
    if(!d || !f.contains(c, a)) {
      return d ? {top:d.top, left:d.left} : {top:0, left:0}
    }
    var g = b.body, h = cy(b), i = c.clientTop || g.clientTop || 0, j = c.clientLeft || g.clientLeft || 0, k = h.pageYOffset || f.support.boxModel && c.scrollTop || g.scrollTop, l = h.pageXOffset || f.support.boxModel && c.scrollLeft || g.scrollLeft, m = d.top + k - i, n = d.left + l - j;
    return{top:m, left:n}
  } : cv = function(a, b, c) {
    var d, e = a.offsetParent, g = a, h = b.body, i = b.defaultView, j = i ? i.getComputedStyle(a, null) : a.currentStyle, k = a.offsetTop, l = a.offsetLeft;
    while((a = a.parentNode) && a !== h && a !== c) {
      if(f.support.fixedPosition && j.position === "fixed") {
        break
      }
      d = i ? i.getComputedStyle(a, null) : a.currentStyle, k -= a.scrollTop, l -= a.scrollLeft, a === e && (k += a.offsetTop, l += a.offsetLeft, f.support.doesNotAddBorder && (!f.support.doesAddBorderForTableAndCells || !cw.test(a.nodeName)) && (k += parseFloat(d.borderTopWidth) || 0, l += parseFloat(d.borderLeftWidth) || 0), g = e, e = a.offsetParent), f.support.subtractsBorderForOverflowNotVisible && d.overflow !== "visible" && (k += parseFloat(d.borderTopWidth) || 0, l += parseFloat(d.borderLeftWidth) || 
      0), j = d
    }
    if(j.position === "relative" || j.position === "static") {
      k += h.offsetTop, l += h.offsetLeft
    }
    f.support.fixedPosition && j.position === "fixed" && (k += Math.max(c.scrollTop, h.scrollTop), l += Math.max(c.scrollLeft, h.scrollLeft));
    return{top:k, left:l}
  }, f.fn.offset = function(a) {
    if(arguments.length) {
      return a === b ? this : this.each(function(b) {
        f.offset.setOffset(this, a, b)
      })
    }
    var c = this[0], d = c && c.ownerDocument;
    if(!d) {
      return null
    }
    if(c === d.body) {
      return f.offset.bodyOffset(c)
    }
    return cv(c, d, d.documentElement)
  }, f.offset = {bodyOffset:function(a) {
    var b = a.offsetTop, c = a.offsetLeft;
    f.support.doesNotIncludeMarginInBodyOffset && (b += parseFloat(f.css(a, "marginTop")) || 0, c += parseFloat(f.css(a, "marginLeft")) || 0);
    return{top:b, left:c}
  }, setOffset:function(a, b, c) {
    var d = f.css(a, "position");
    d === "static" && (a.style.position = "relative");
    var e = f(a), g = e.offset(), h = f.css(a, "top"), i = f.css(a, "left"), j = (d === "absolute" || d === "fixed") && f.inArray("auto", [h, i]) > -1, k = {}, l = {}, m, n;
    j ? (l = e.position(), m = l.top, n = l.left) : (m = parseFloat(h) || 0, n = parseFloat(i) || 0), f.isFunction(b) && (b = b.call(a, c, g)), b.top != null && (k.top = b.top - g.top + m), b.left != null && (k.left = b.left - g.left + n), "using" in b ? b.using.call(a, k) : e.css(k)
  }}, f.fn.extend({position:function() {
    if(!this[0]) {
      return null
    }
    var a = this[0], b = this.offsetParent(), c = this.offset(), d = cx.test(b[0].nodeName) ? {top:0, left:0} : b.offset();
    c.top -= parseFloat(f.css(a, "marginTop")) || 0, c.left -= parseFloat(f.css(a, "marginLeft")) || 0, d.top += parseFloat(f.css(b[0], "borderTopWidth")) || 0, d.left += parseFloat(f.css(b[0], "borderLeftWidth")) || 0;
    return{top:c.top - d.top, left:c.left - d.left}
  }, offsetParent:function() {
    return this.map(function() {
      var a = this.offsetParent || c.body;
      while(a && !cx.test(a.nodeName) && f.css(a, "position") === "static") {
        a = a.offsetParent
      }
      return a
    })
  }}), f.each({scrollLeft:"pageXOffset", scrollTop:"pageYOffset"}, function(a, c) {
    var d = /Y/.test(c);
    f.fn[a] = function(e) {
      return f.access(this, function(a, e, g) {
        var h = cy(a);
        if(g === b) {
          return h ? c in h ? h[c] : f.support.boxModel && h.document.documentElement[e] || h.document.body[e] : a[e]
        }
        h ? h.scrollTo(d ? f(h).scrollLeft() : g, d ? g : f(h).scrollTop()) : a[e] = g
      }, a, e, arguments.length, null)
    }
  }), f.each({Height:"height", Width:"width"}, function(a, c) {
    var d = "client" + a, e = "scroll" + a, g = "offset" + a;
    f.fn["inner" + a] = function() {
      var a = this[0];
      return a ? a.style ? parseFloat(f.css(a, c, "padding")) : this[c]() : null
    }, f.fn["outer" + a] = function(a) {
      var b = this[0];
      return b ? b.style ? parseFloat(f.css(b, c, a ? "margin" : "border")) : this[c]() : null
    }, f.fn[c] = function(a) {
      return f.access(this, function(a, c, h) {
        var i, j, k, l;
        if(f.isWindow(a)) {
          i = a.document, j = i.documentElement[d];
          return f.support.boxModel && j || i.body && i.body[d] || j
        }
        if(a.nodeType === 9) {
          i = a.documentElement;
          if(i[d] >= i[e]) {
            return i[d]
          }
          return Math.max(a.body[e], i[e], a.body[g], i[g])
        }
        if(h === b) {
          k = f.css(a, c), l = parseFloat(k);
          return f.isNumeric(l) ? l : k
        }
        f(a).css(c, h)
      }, c, a, arguments.length, null)
    }
  }), a.jQuery = a.$ = f, typeof define == "function" && define.amd && define.amd.jQuery && define("jquery", [], function() {
    return f
  })
})(window);
(function(e, t) {
  function i(t, n) {
    var r, i, o, u = t.nodeName.toLowerCase();
    return"area" === u ? (r = t.parentNode, i = r.name, !t.href || !i || r.nodeName.toLowerCase() !== "map" ? !1 : (o = e("img[usemap=#" + i + "]")[0], !!o && s(o))) : (/input|select|textarea|button|object/.test(u) ? !t.disabled : "a" === u ? t.href || n : n) && s(t)
  }
  function s(t) {
    return e.expr.filters.visible(t) && !e(t).parents().andSelf().filter(function() {
      return e.css(this, "visibility") === "hidden"
    }).length
  }
  var n = 0, r = /^ui-id-\d+$/;
  e.ui = e.ui || {};
  if(e.ui.version) {
    return
  }
  e.extend(e.ui, {version:"1.9.2", keyCode:{BACKSPACE:8, COMMA:188, DELETE:46, DOWN:40, END:35, ENTER:13, ESCAPE:27, HOME:36, LEFT:37, NUMPAD_ADD:107, NUMPAD_DECIMAL:110, NUMPAD_DIVIDE:111, NUMPAD_ENTER:108, NUMPAD_MULTIPLY:106, NUMPAD_SUBTRACT:109, PAGE_DOWN:34, PAGE_UP:33, PERIOD:190, RIGHT:39, SPACE:32, TAB:9, UP:38}}), e.fn.extend({_focus:e.fn.focus, focus:function(t, n) {
    return typeof t == "number" ? this.each(function() {
      var r = this;
      setTimeout(function() {
        e(r).focus(), n && n.call(r)
      }, t)
    }) : this._focus.apply(this, arguments)
  }, scrollParent:function() {
    var t;
    return e.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? t = this.parents().filter(function() {
      return/(relative|absolute|fixed)/.test(e.css(this, "position")) && /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
    }).eq(0) : t = this.parents().filter(function() {
      return/(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
    }).eq(0), /fixed/.test(this.css("position")) || !t.length ? e(document) : t
  }, zIndex:function(n) {
    if(n !== t) {
      return this.css("zIndex", n)
    }
    if(this.length) {
      var r = e(this[0]), i, s;
      while(r.length && r[0] !== document) {
        i = r.css("position");
        if(i === "absolute" || i === "relative" || i === "fixed") {
          s = parseInt(r.css("zIndex"), 10);
          if(!isNaN(s) && s !== 0) {
            return s
          }
        }
        r = r.parent()
      }
    }
    return 0
  }, uniqueId:function() {
    return this.each(function() {
      this.id || (this.id = "ui-id-" + ++n)
    })
  }, removeUniqueId:function() {
    return this.each(function() {
      r.test(this.id) && e(this).removeAttr("id")
    })
  }}), e.extend(e.expr[":"], {data:e.expr.createPseudo ? e.expr.createPseudo(function(t) {
    return function(n) {
      return!!e.data(n, t)
    }
  }) : function(t, n, r) {
    return!!e.data(t, r[3])
  }, focusable:function(t) {
    return i(t, !isNaN(e.attr(t, "tabindex")))
  }, tabbable:function(t) {
    var n = e.attr(t, "tabindex"), r = isNaN(n);
    return(r || n >= 0) && i(t, !r)
  }}), e(function() {
    var t = document.body, n = t.appendChild(n = document.createElement("div"));
    n.offsetHeight, e.extend(n.style, {minHeight:"100px", height:"auto", padding:0, borderWidth:0}), e.support.minHeight = n.offsetHeight === 100, e.support.selectstart = "onselectstart" in n, t.removeChild(n).style.display = "none"
  }), e("<a>").outerWidth(1).jquery || e.each(["Width", "Height"], function(n, r) {
    function u(t, n, r, s) {
      return e.each(i, function() {
        n -= parseFloat(e.css(t, "padding" + this)) || 0, r && (n -= parseFloat(e.css(t, "border" + this + "Width")) || 0), s && (n -= parseFloat(e.css(t, "margin" + this)) || 0)
      }), n
    }
    var i = r === "Width" ? ["Left", "Right"] : ["Top", "Bottom"], s = r.toLowerCase(), o = {innerWidth:e.fn.innerWidth, innerHeight:e.fn.innerHeight, outerWidth:e.fn.outerWidth, outerHeight:e.fn.outerHeight};
    e.fn["inner" + r] = function(n) {
      return n === t ? o["inner" + r].call(this) : this.each(function() {
        e(this).css(s, u(this, n) + "px")
      })
    }, e.fn["outer" + r] = function(t, n) {
      return typeof t != "number" ? o["outer" + r].call(this, t) : this.each(function() {
        e(this).css(s, u(this, t, !0, n) + "px")
      })
    }
  }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function(t) {
    return function(n) {
      return arguments.length ? t.call(this, e.camelCase(n)) : t.call(this)
    }
  }(e.fn.removeData)), function() {
    var t = /msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase()) || [];
    e.ui.ie = t.length ? !0 : !1, e.ui.ie6 = parseFloat(t[1], 10) === 6
  }(), e.fn.extend({disableSelection:function() {
    return this.bind((e.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function(e) {
      e.preventDefault()
    })
  }, enableSelection:function() {
    return this.unbind(".ui-disableSelection")
  }}), e.extend(e.ui, {plugin:{add:function(t, n, r) {
    var i, s = e.ui[t].prototype;
    for(i in r) {
      s.plugins[i] = s.plugins[i] || [], s.plugins[i].push([n, r[i]])
    }
  }, call:function(e, t, n) {
    var r, i = e.plugins[t];
    if(!i || !e.element[0].parentNode || e.element[0].parentNode.nodeType === 11) {
      return
    }
    for(r = 0;r < i.length;r++) {
      e.options[i[r][0]] && i[r][1].apply(e.element, n)
    }
  }}, contains:e.contains, hasScroll:function(t, n) {
    if(e(t).css("overflow") === "hidden") {
      return!1
    }
    var r = n && n === "left" ? "scrollLeft" : "scrollTop", i = !1;
    return t[r] > 0 ? !0 : (t[r] = 1, i = t[r] > 0, t[r] = 0, i)
  }, isOverAxis:function(e, t, n) {
    return e > t && e < t + n
  }, isOver:function(t, n, r, i, s, o) {
    return e.ui.isOverAxis(t, r, s) && e.ui.isOverAxis(n, i, o)
  }})
})(jQuery);
(function(e, t) {
  var n = 0, r = Array.prototype.slice, i = e.cleanData;
  e.cleanData = function(t) {
    for(var n = 0, r;(r = t[n]) != null;n++) {
      try {
        e(r).triggerHandler("remove")
      }catch(s) {
      }
    }
    i(t)
  }, e.widget = function(t, n, r) {
    var i, s, o, u, a = t.split(".")[0];
    t = t.split(".")[1], i = a + "-" + t, r || (r = n, n = e.Widget), e.expr[":"][i.toLowerCase()] = function(t) {
      return!!e.data(t, i)
    }, e[a] = e[a] || {}, s = e[a][t], o = e[a][t] = function(e, t) {
      if(!this._createWidget) {
        return new o(e, t)
      }
      arguments.length && this._createWidget(e, t)
    }, e.extend(o, s, {version:r.version, _proto:e.extend({}, r), _childConstructors:[]}), u = new n, u.options = e.widget.extend({}, u.options), e.each(r, function(t, i) {
      e.isFunction(i) && (r[t] = function() {
        var e = function() {
          return n.prototype[t].apply(this, arguments)
        }, r = function(e) {
          return n.prototype[t].apply(this, e)
        };
        return function() {
          var t = this._super, n = this._superApply, s;
          return this._super = e, this._superApply = r, s = i.apply(this, arguments), this._super = t, this._superApply = n, s
        }
      }())
    }), o.prototype = e.widget.extend(u, {widgetEventPrefix:s ? u.widgetEventPrefix : t}, r, {constructor:o, namespace:a, widgetName:t, widgetBaseClass:i, widgetFullName:i}), s ? (e.each(s._childConstructors, function(t, n) {
      var r = n.prototype;
      e.widget(r.namespace + "." + r.widgetName, o, n._proto)
    }), delete s._childConstructors) : n._childConstructors.push(o), e.widget.bridge(t, o)
  }, e.widget.extend = function(n) {
    var i = r.call(arguments, 1), s = 0, o = i.length, u, a;
    for(;s < o;s++) {
      for(u in i[s]) {
        a = i[s][u], i[s].hasOwnProperty(u) && a !== t && (e.isPlainObject(a) ? n[u] = e.isPlainObject(n[u]) ? e.widget.extend({}, n[u], a) : e.widget.extend({}, a) : n[u] = a)
      }
    }
    return n
  }, e.widget.bridge = function(n, i) {
    var s = i.prototype.widgetFullName || n;
    e.fn[n] = function(o) {
      var u = typeof o == "string", a = r.call(arguments, 1), f = this;
      return o = !u && a.length ? e.widget.extend.apply(null, [o].concat(a)) : o, u ? this.each(function() {
        var r, i = e.data(this, s);
        if(!i) {
          return e.error("cannot call methods on " + n + " prior to initialization; " + "attempted to call method '" + o + "'")
        }
        if(!e.isFunction(i[o]) || o.charAt(0) === "_") {
          return e.error("no such method '" + o + "' for " + n + " widget instance")
        }
        r = i[o].apply(i, a);
        if(r !== i && r !== t) {
          return f = r && r.jquery ? f.pushStack(r.get()) : r, !1
        }
      }) : this.each(function() {
        var t = e.data(this, s);
        t ? t.option(o || {})._init() : e.data(this, s, new i(o, this))
      }), f
    }
  }, e.Widget = function() {
  }, e.Widget._childConstructors = [], e.Widget.prototype = {widgetName:"widget", widgetEventPrefix:"", defaultElement:"<div>", options:{disabled:!1, create:null}, _createWidget:function(t, r) {
    r = e(r || this.defaultElement || this)[0], this.element = e(r), this.uuid = n++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t), this.bindings = e(), this.hoverable = e(), this.focusable = e(), r !== this && (e.data(r, this.widgetName, this), e.data(r, this.widgetFullName, this), this._on(!0, this.element, {remove:function(e) {
      e.target === r && this.destroy()
    }}), this.document = e(r.style ? r.ownerDocument : r.document || r), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
  }, _getCreateOptions:e.noop, _getCreateEventData:e.noop, _create:e.noop, _init:e.noop, destroy:function() {
    this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
  }, _destroy:e.noop, widget:function() {
    return this.element
  }, option:function(n, r) {
    var i = n, s, o, u;
    if(arguments.length === 0) {
      return e.widget.extend({}, this.options)
    }
    if(typeof n == "string") {
      i = {}, s = n.split("."), n = s.shift();
      if(s.length) {
        o = i[n] = e.widget.extend({}, this.options[n]);
        for(u = 0;u < s.length - 1;u++) {
          o[s[u]] = o[s[u]] || {}, o = o[s[u]]
        }
        n = s.pop();
        if(r === t) {
          return o[n] === t ? null : o[n]
        }
        o[n] = r
      }else {
        if(r === t) {
          return this.options[n] === t ? null : this.options[n]
        }
        i[n] = r
      }
    }
    return this._setOptions(i), this
  }, _setOptions:function(e) {
    var t;
    for(t in e) {
      this._setOption(t, e[t])
    }
    return this
  }, _setOption:function(e, t) {
    return this.options[e] = t, e === "disabled" && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!t).attr("aria-disabled", t), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")), this
  }, enable:function() {
    return this._setOption("disabled", !1)
  }, disable:function() {
    return this._setOption("disabled", !0)
  }, _on:function(t, n, r) {
    var i, s = this;
    typeof t != "boolean" && (r = n, n = t, t = !1), r ? (n = i = e(n), this.bindings = this.bindings.add(n)) : (r = n, n = this.element, i = this.widget()), e.each(r, function(r, o) {
      function u() {
        if(!t && (s.options.disabled === !0 || e(this).hasClass("ui-state-disabled"))) {
          return
        }
        return(typeof o == "string" ? s[o] : o).apply(s, arguments)
      }
      typeof o != "string" && (u.guid = o.guid = o.guid || u.guid || e.guid++);
      var a = r.match(/^(\w+)\s*(.*)$/), f = a[1] + s.eventNamespace, l = a[2];
      l ? i.delegate(l, f, u) : n.bind(f, u)
    })
  }, _off:function(e, t) {
    t = (t || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, e.unbind(t).undelegate(t)
  }, _delay:function(e, t) {
    function n() {
      return(typeof e == "string" ? r[e] : e).apply(r, arguments)
    }
    var r = this;
    return setTimeout(n, t || 0)
  }, _hoverable:function(t) {
    this.hoverable = this.hoverable.add(t), this._on(t, {mouseenter:function(t) {
      e(t.currentTarget).addClass("ui-state-hover")
    }, mouseleave:function(t) {
      e(t.currentTarget).removeClass("ui-state-hover")
    }})
  }, _focusable:function(t) {
    this.focusable = this.focusable.add(t), this._on(t, {focusin:function(t) {
      e(t.currentTarget).addClass("ui-state-focus")
    }, focusout:function(t) {
      e(t.currentTarget).removeClass("ui-state-focus")
    }})
  }, _trigger:function(t, n, r) {
    var i, s, o = this.options[t];
    r = r || {}, n = e.Event(n), n.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(), n.target = this.element[0], s = n.originalEvent;
    if(s) {
      for(i in s) {
        i in n || (n[i] = s[i])
      }
    }
    return this.element.trigger(n, r), !(e.isFunction(o) && o.apply(this.element[0], [n].concat(r)) === !1 || n.isDefaultPrevented())
  }}, e.each({show:"fadeIn", hide:"fadeOut"}, function(t, n) {
    e.Widget.prototype["_" + t] = function(r, i, s) {
      typeof i == "string" && (i = {effect:i});
      var o, u = i ? i === !0 || typeof i == "number" ? n : i.effect || n : t;
      i = i || {}, typeof i == "number" && (i = {duration:i}), o = !e.isEmptyObject(i), i.complete = s, i.delay && r.delay(i.delay), o && e.effects && (e.effects.effect[u] || e.uiBackCompat !== !1 && e.effects[u]) ? r[t](i) : u !== t && r[u] ? r[u](i.duration, i.easing, s) : r.queue(function(n) {
        e(this)[t](), s && s.call(r[0]), n()
      })
    }
  }), e.uiBackCompat !== !1 && (e.Widget.prototype._getCreateOptions = function() {
    return e.metadata && e.metadata.get(this.element[0])[this.widgetName]
  })
})(jQuery);
(function(e, t) {
  var n = !1;
  e(document).mouseup(function(e) {
    n = !1
  }), e.widget("ui.mouse", {version:"1.9.2", options:{cancel:"input,textarea,button,select,option", distance:1, delay:0}, _mouseInit:function() {
    var t = this;
    this.element.bind("mousedown." + this.widgetName, function(e) {
      return t._mouseDown(e)
    }).bind("click." + this.widgetName, function(n) {
      if(!0 === e.data(n.target, t.widgetName + ".preventClickEvent")) {
        return e.removeData(n.target, t.widgetName + ".preventClickEvent"), n.stopImmediatePropagation(), !1
      }
    }), this.started = !1
  }, _mouseDestroy:function() {
    this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && e(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
  }, _mouseDown:function(t) {
    if(n) {
      return
    }
    this._mouseStarted && this._mouseUp(t), this._mouseDownEvent = t;
    var r = this, i = t.which === 1, s = typeof this.options.cancel == "string" && t.target.nodeName ? e(t.target).closest(this.options.cancel).length : !1;
    if(!i || s || !this._mouseCapture(t)) {
      return!0
    }
    this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
      r.mouseDelayMet = !0
    }, this.options.delay));
    if(this._mouseDistanceMet(t) && this._mouseDelayMet(t)) {
      this._mouseStarted = this._mouseStart(t) !== !1;
      if(!this._mouseStarted) {
        return t.preventDefault(), !0
      }
    }
    return!0 === e.data(t.target, this.widgetName + ".preventClickEvent") && e.removeData(t.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function(e) {
      return r._mouseMove(e)
    }, this._mouseUpDelegate = function(e) {
      return r._mouseUp(e)
    }, e(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), t.preventDefault(), n = !0, !0
  }, _mouseMove:function(t) {
    return!e.ui.ie || document.documentMode >= 9 || !!t.button ? this._mouseStarted ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted) : this._mouseUp(t)
  }, _mouseUp:function(t) {
    return e(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, t.target === this._mouseDownEvent.target && e.data(t.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(t)), !1
  }, _mouseDistanceMet:function(e) {
    return Math.max(Math.abs(this._mouseDownEvent.pageX - e.pageX), Math.abs(this._mouseDownEvent.pageY - e.pageY)) >= this.options.distance
  }, _mouseDelayMet:function(e) {
    return this.mouseDelayMet
  }, _mouseStart:function(e) {
  }, _mouseDrag:function(e) {
  }, _mouseStop:function(e) {
  }, _mouseCapture:function(e) {
    return!0
  }})
})(jQuery);
(function(e, t) {
  function h(e, t, n) {
    return[parseInt(e[0], 10) * (l.test(e[0]) ? t / 100 : 1), parseInt(e[1], 10) * (l.test(e[1]) ? n / 100 : 1)]
  }
  function p(t, n) {
    return parseInt(e.css(t, n), 10) || 0
  }
  e.ui = e.ui || {};
  var n, r = Math.max, i = Math.abs, s = Math.round, o = /left|center|right/, u = /top|center|bottom/, a = /[\+\-]\d+%?/, f = /^\w+/, l = /%$/, c = e.fn.position;
  e.position = {scrollbarWidth:function() {
    if(n !== t) {
      return n
    }
    var r, i, s = e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"), o = s.children()[0];
    return e("body").append(s), r = o.offsetWidth, s.css("overflow", "scroll"), i = o.offsetWidth, r === i && (i = s[0].clientWidth), s.remove(), n = r - i
  }, getScrollInfo:function(t) {
    var n = t.isWindow ? "" : t.element.css("overflow-x"), r = t.isWindow ? "" : t.element.css("overflow-y"), i = n === "scroll" || n === "auto" && t.width < t.element[0].scrollWidth, s = r === "scroll" || r === "auto" && t.height < t.element[0].scrollHeight;
    return{width:i ? e.position.scrollbarWidth() : 0, height:s ? e.position.scrollbarWidth() : 0}
  }, getWithinInfo:function(t) {
    var n = e(t || window), r = e.isWindow(n[0]);
    return{element:n, isWindow:r, offset:n.offset() || {left:0, top:0}, scrollLeft:n.scrollLeft(), scrollTop:n.scrollTop(), width:r ? n.width() : n.outerWidth(), height:r ? n.height() : n.outerHeight()}
  }}, e.fn.position = function(t) {
    if(!t || !t.of) {
      return c.apply(this, arguments)
    }
    t = e.extend({}, t);
    var n, l, d, v, m, g = e(t.of), y = e.position.getWithinInfo(t.within), b = e.position.getScrollInfo(y), w = g[0], E = (t.collision || "flip").split(" "), S = {};
    return w.nodeType === 9 ? (l = g.width(), d = g.height(), v = {top:0, left:0}) : e.isWindow(w) ? (l = g.width(), d = g.height(), v = {top:g.scrollTop(), left:g.scrollLeft()}) : w.preventDefault ? (t.at = "left top", l = d = 0, v = {top:w.pageY, left:w.pageX}) : (l = g.outerWidth(), d = g.outerHeight(), v = g.offset()), m = e.extend({}, v), e.each(["my", "at"], function() {
      var e = (t[this] || "").split(" "), n, r;
      e.length === 1 && (e = o.test(e[0]) ? e.concat(["center"]) : u.test(e[0]) ? ["center"].concat(e) : ["center", "center"]), e[0] = o.test(e[0]) ? e[0] : "center", e[1] = u.test(e[1]) ? e[1] : "center", n = a.exec(e[0]), r = a.exec(e[1]), S[this] = [n ? n[0] : 0, r ? r[0] : 0], t[this] = [f.exec(e[0])[0], f.exec(e[1])[0]]
    }), E.length === 1 && (E[1] = E[0]), t.at[0] === "right" ? m.left += l : t.at[0] === "center" && (m.left += l / 2), t.at[1] === "bottom" ? m.top += d : t.at[1] === "center" && (m.top += d / 2), n = h(S.at, l, d), m.left += n[0], m.top += n[1], this.each(function() {
      var o, u, a = e(this), f = a.outerWidth(), c = a.outerHeight(), w = p(this, "marginLeft"), x = p(this, "marginTop"), T = f + w + p(this, "marginRight") + b.width, N = c + x + p(this, "marginBottom") + b.height, C = e.extend({}, m), k = h(S.my, a.outerWidth(), a.outerHeight());
      t.my[0] === "right" ? C.left -= f : t.my[0] === "center" && (C.left -= f / 2), t.my[1] === "bottom" ? C.top -= c : t.my[1] === "center" && (C.top -= c / 2), C.left += k[0], C.top += k[1], e.support.offsetFractions || (C.left = s(C.left), C.top = s(C.top)), o = {marginLeft:w, marginTop:x}, e.each(["left", "top"], function(r, i) {
        e.ui.position[E[r]] && e.ui.position[E[r]][i](C, {targetWidth:l, targetHeight:d, elemWidth:f, elemHeight:c, collisionPosition:o, collisionWidth:T, collisionHeight:N, offset:[n[0] + k[0], n[1] + k[1]], my:t.my, at:t.at, within:y, elem:a})
      }), e.fn.bgiframe && a.bgiframe(), t.using && (u = function(e) {
        var n = v.left - C.left, s = n + l - f, o = v.top - C.top, u = o + d - c, h = {target:{element:g, left:v.left, top:v.top, width:l, height:d}, element:{element:a, left:C.left, top:C.top, width:f, height:c}, horizontal:s < 0 ? "left" : n > 0 ? "right" : "center", vertical:u < 0 ? "top" : o > 0 ? "bottom" : "middle"};
        l < f && i(n + s) < l && (h.horizontal = "center"), d < c && i(o + u) < d && (h.vertical = "middle"), r(i(n), i(s)) > r(i(o), i(u)) ? h.important = "horizontal" : h.important = "vertical", t.using.call(this, e, h)
      }), a.offset(e.extend(C, {using:u}))
    })
  }, e.ui.position = {fit:{left:function(e, t) {
    var n = t.within, i = n.isWindow ? n.scrollLeft : n.offset.left, s = n.width, o = e.left - t.collisionPosition.marginLeft, u = i - o, a = o + t.collisionWidth - s - i, f;
    t.collisionWidth > s ? u > 0 && a <= 0 ? (f = e.left + u + t.collisionWidth - s - i, e.left += u - f) : a > 0 && u <= 0 ? e.left = i : u > a ? e.left = i + s - t.collisionWidth : e.left = i : u > 0 ? e.left += u : a > 0 ? e.left -= a : e.left = r(e.left - o, e.left)
  }, top:function(e, t) {
    var n = t.within, i = n.isWindow ? n.scrollTop : n.offset.top, s = t.within.height, o = e.top - t.collisionPosition.marginTop, u = i - o, a = o + t.collisionHeight - s - i, f;
    t.collisionHeight > s ? u > 0 && a <= 0 ? (f = e.top + u + t.collisionHeight - s - i, e.top += u - f) : a > 0 && u <= 0 ? e.top = i : u > a ? e.top = i + s - t.collisionHeight : e.top = i : u > 0 ? e.top += u : a > 0 ? e.top -= a : e.top = r(e.top - o, e.top)
  }}, flip:{left:function(e, t) {
    var n = t.within, r = n.offset.left + n.scrollLeft, s = n.width, o = n.isWindow ? n.scrollLeft : n.offset.left, u = e.left - t.collisionPosition.marginLeft, a = u - o, f = u + t.collisionWidth - s - o, l = t.my[0] === "left" ? -t.elemWidth : t.my[0] === "right" ? t.elemWidth : 0, c = t.at[0] === "left" ? t.targetWidth : t.at[0] === "right" ? -t.targetWidth : 0, h = -2 * t.offset[0], p, d;
    if(a < 0) {
      p = e.left + l + c + h + t.collisionWidth - s - r;
      if(p < 0 || p < i(a)) {
        e.left += l + c + h
      }
    }else {
      if(f > 0) {
        d = e.left - t.collisionPosition.marginLeft + l + c + h - o;
        if(d > 0 || i(d) < f) {
          e.left += l + c + h
        }
      }
    }
  }, top:function(e, t) {
    var n = t.within, r = n.offset.top + n.scrollTop, s = n.height, o = n.isWindow ? n.scrollTop : n.offset.top, u = e.top - t.collisionPosition.marginTop, a = u - o, f = u + t.collisionHeight - s - o, l = t.my[1] === "top", c = l ? -t.elemHeight : t.my[1] === "bottom" ? t.elemHeight : 0, h = t.at[1] === "top" ? t.targetHeight : t.at[1] === "bottom" ? -t.targetHeight : 0, p = -2 * t.offset[1], d, v;
    a < 0 ? (v = e.top + c + h + p + t.collisionHeight - s - r, e.top + c + h + p > a && (v < 0 || v < i(a)) && (e.top += c + h + p)) : f > 0 && (d = e.top - t.collisionPosition.marginTop + c + h + p - o, e.top + c + h + p > f && (d > 0 || i(d) < f) && (e.top += c + h + p))
  }}, flipfit:{left:function() {
    e.ui.position.flip.left.apply(this, arguments), e.ui.position.fit.left.apply(this, arguments)
  }, top:function() {
    e.ui.position.flip.top.apply(this, arguments), e.ui.position.fit.top.apply(this, arguments)
  }}}, function() {
    var t, n, r, i, s, o = document.getElementsByTagName("body")[0], u = document.createElement("div");
    t = document.createElement(o ? "div" : "body"), r = {visibility:"hidden", width:0, height:0, border:0, margin:0, background:"none"}, o && e.extend(r, {position:"absolute", left:"-1000px", top:"-1000px"});
    for(s in r) {
      t.style[s] = r[s]
    }
    t.appendChild(u), n = o || document.documentElement, n.insertBefore(t, n.firstChild), u.style.cssText = "position: absolute; left: 10.7432222px;", i = e(u).offset().left, e.support.offsetFractions = i > 10 && i < 11, t.innerHTML = "", n.removeChild(t)
  }(), e.uiBackCompat !== !1 && function(e) {
    var n = e.fn.position;
    e.fn.position = function(r) {
      if(!r || !r.offset) {
        return n.call(this, r)
      }
      var i = r.offset.split(" "), s = r.at.split(" ");
      return i.length === 1 && (i[1] = i[0]), /^\d/.test(i[0]) && (i[0] = "+" + i[0]), /^\d/.test(i[1]) && (i[1] = "+" + i[1]), s.length === 1 && (/left|center|right/.test(s[0]) ? s[1] = "center" : (s[1] = s[0], s[0] = "center")), n.call(this, e.extend(r, {at:s[0] + i[0] + " " + s[1] + i[1], offset:t}))
    }
  }(jQuery)
})(jQuery);
(function(e, t) {
  e.widget("ui.draggable", e.ui.mouse, {version:"1.9.2", widgetEventPrefix:"drag", options:{addClasses:!0, appendTo:"parent", axis:!1, connectToSortable:!1, containment:!1, cursor:"auto", cursorAt:!1, grid:!1, handle:!1, helper:"original", iframeFix:!1, opacity:!1, refreshPositions:!1, revert:!1, revertDuration:500, scope:"default", scroll:!0, scrollSensitivity:20, scrollSpeed:20, snap:!1, snapMode:"both", snapTolerance:20, stack:!1, zIndex:!1}, _create:function() {
    this.options.helper == "original" && !/^(?:r|a|f)/.test(this.element.css("position")) && (this.element[0].style.position = "relative"), this.options.addClasses && this.element.addClass("ui-draggable"), this.options.disabled && this.element.addClass("ui-draggable-disabled"), this._mouseInit()
  }, _destroy:function() {
    this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"), this._mouseDestroy()
  }, _mouseCapture:function(t) {
    var n = this.options;
    return this.helper || n.disabled || e(t.target).is(".ui-resizable-handle") ? !1 : (this.handle = this._getHandle(t), this.handle ? (e(n.iframeFix === !0 ? "iframe" : n.iframeFix).each(function() {
      e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth + "px", height:this.offsetHeight + "px", position:"absolute", opacity:"0.001", zIndex:1E3}).css(e(this).offset()).appendTo("body")
    }), !0) : !1)
  }, _mouseStart:function(t) {
    var n = this.options;
    return this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), e.ui.ddmanager && (e.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(), this.offset = this.positionAbs = this.element.offset(), this.offset = {top:this.offset.top - this.margins.top, left:this.offset.left - this.margins.left}, e.extend(this.offset, {click:{left:t.pageX - this.offset.left, 
    top:t.pageY - this.offset.top}, parent:this._getParentOffset(), relative:this._getRelativeOffset()}), this.originalPosition = this.position = this._generatePosition(t), this.originalPageX = t.pageX, this.originalPageY = t.pageY, n.cursorAt && this._adjustOffsetFromHelper(n.cursorAt), n.containment && this._setContainment(), this._trigger("start", t) === !1 ? (this._clear(), !1) : (this._cacheHelperProportions(), e.ui.ddmanager && !n.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this._mouseDrag(t, 
    !0), e.ui.ddmanager && e.ui.ddmanager.dragStart(this, t), !0)
  }, _mouseDrag:function(t, n) {
    this.position = this._generatePosition(t), this.positionAbs = this._convertPositionTo("absolute");
    if(!n) {
      var r = this._uiHash();
      if(this._trigger("drag", t, r) === !1) {
        return this._mouseUp({}), !1
      }
      this.position = r.position
    }
    if(!this.options.axis || this.options.axis != "y") {
      this.helper[0].style.left = this.position.left + "px"
    }
    if(!this.options.axis || this.options.axis != "x") {
      this.helper[0].style.top = this.position.top + "px"
    }
    return e.ui.ddmanager && e.ui.ddmanager.drag(this, t), !1
  }, _mouseStop:function(t) {
    var n = !1;
    e.ui.ddmanager && !this.options.dropBehaviour && (n = e.ui.ddmanager.drop(this, t)), this.dropped && (n = this.dropped, this.dropped = !1);
    var r = this.element[0], i = !1;
    while(r && (r = r.parentNode)) {
      r == document && (i = !0)
    }
    if(!i && this.options.helper === "original") {
      return!1
    }
    if(this.options.revert == "invalid" && !n || this.options.revert == "valid" && n || this.options.revert === !0 || e.isFunction(this.options.revert) && this.options.revert.call(this.element, n)) {
      var s = this;
      e(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
        s._trigger("stop", t) !== !1 && s._clear()
      })
    }else {
      this._trigger("stop", t) !== !1 && this._clear()
    }
    return!1
  }, _mouseUp:function(t) {
    return e("div.ui-draggable-iframeFix").each(function() {
      this.parentNode.removeChild(this)
    }), e.ui.ddmanager && e.ui.ddmanager.dragStop(this, t), e.ui.mouse.prototype._mouseUp.call(this, t)
  }, cancel:function() {
    return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this
  }, _getHandle:function(t) {
    var n = !this.options.handle || !e(this.options.handle, this.element).length ? !0 : !1;
    return e(this.options.handle, this.element).find("*").andSelf().each(function() {
      this == t.target && (n = !0)
    }), n
  }, _createHelper:function(t) {
    var n = this.options, r = e.isFunction(n.helper) ? e(n.helper.apply(this.element[0], [t])) : n.helper == "clone" ? this.element.clone().removeAttr("id") : this.element;
    return r.parents("body").length || r.appendTo(n.appendTo == "parent" ? this.element[0].parentNode : n.appendTo), r[0] != this.element[0] && !/(fixed|absolute)/.test(r.css("position")) && r.css("position", "absolute"), r
  }, _adjustOffsetFromHelper:function(t) {
    typeof t == "string" && (t = t.split(" ")), e.isArray(t) && (t = {left:+t[0], top:+t[1] || 0}), "left" in t && (this.offset.click.left = t.left + this.margins.left), "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left), "top" in t && (this.offset.click.top = t.top + this.margins.top), "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top)
  }, _getParentOffset:function() {
    this.offsetParent = this.helper.offsetParent();
    var t = this.offsetParent.offset();
    this.cssPosition == "absolute" && this.scrollParent[0] != document && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop());
    if(this.offsetParent[0] == document.body || this.offsetParent[0].tagName && this.offsetParent[0].tagName.toLowerCase() == "html" && e.ui.ie) {
      t = {top:0, left:0}
    }
    return{top:t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left:t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)}
  }, _getRelativeOffset:function() {
    if(this.cssPosition == "relative") {
      var e = this.element.position();
      return{top:e.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(), left:e.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()}
    }
    return{top:0, left:0}
  }, _cacheMargins:function() {
    this.margins = {left:parseInt(this.element.css("marginLeft"), 10) || 0, top:parseInt(this.element.css("marginTop"), 10) || 0, right:parseInt(this.element.css("marginRight"), 10) || 0, bottom:parseInt(this.element.css("marginBottom"), 10) || 0}
  }, _cacheHelperProportions:function() {
    this.helperProportions = {width:this.helper.outerWidth(), height:this.helper.outerHeight()}
  }, _setContainment:function() {
    var t = this.options;
    t.containment == "parent" && (t.containment = this.helper[0].parentNode);
    if(t.containment == "document" || t.containment == "window") {
      this.containment = [t.containment == "document" ? 0 : e(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t.containment == "document" ? 0 : e(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, (t.containment == "document" ? 0 : e(window).scrollLeft()) + e(t.containment == "document" ? document : window).width() - this.helperProportions.width - this.margins.left, (t.containment == "document" ? 0 : e(window).scrollTop()) + (e(t.containment == "document" ? 
      document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]
    }
    if(!/^(document|window|parent)$/.test(t.containment) && t.containment.constructor != Array) {
      var n = e(t.containment), r = n[0];
      if(!r) {
        return
      }
      var i = n.offset(), s = e(r).css("overflow") != "hidden";
      this.containment = [(parseInt(e(r).css("borderLeftWidth"), 10) || 0) + (parseInt(e(r).css("paddingLeft"), 10) || 0), (parseInt(e(r).css("borderTopWidth"), 10) || 0) + (parseInt(e(r).css("paddingTop"), 10) || 0), (s ? Math.max(r.scrollWidth, r.offsetWidth) : r.offsetWidth) - (parseInt(e(r).css("borderLeftWidth"), 10) || 0) - (parseInt(e(r).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (s ? Math.max(r.scrollHeight, r.offsetHeight) : r.offsetHeight) - 
      (parseInt(e(r).css("borderTopWidth"), 10) || 0) - (parseInt(e(r).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relative_container = n
    }else {
      t.containment.constructor == Array && (this.containment = t.containment)
    }
  }, _convertPositionTo:function(t, n) {
    n || (n = this.position);
    var r = t == "absolute" ? 1 : -1, i = this.options, s = this.cssPosition != "absolute" || this.scrollParent[0] != document && !!e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, o = /(html|body)/i.test(s[0].tagName);
    return{top:n.top + this.offset.relative.top * r + this.offset.parent.top * r - (this.cssPosition == "fixed" ? -this.scrollParent.scrollTop() : o ? 0 : s.scrollTop()) * r, left:n.left + this.offset.relative.left * r + this.offset.parent.left * r - (this.cssPosition == "fixed" ? -this.scrollParent.scrollLeft() : o ? 0 : s.scrollLeft()) * r}
  }, _generatePosition:function(t) {
    var n = this.options, r = this.cssPosition != "absolute" || this.scrollParent[0] != document && !!e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, i = /(html|body)/i.test(r[0].tagName), s = t.pageX, o = t.pageY;
    if(this.originalPosition) {
      var u;
      if(this.containment) {
        if(this.relative_container) {
          var a = this.relative_container.offset();
          u = [this.containment[0] + a.left, this.containment[1] + a.top, this.containment[2] + a.left, this.containment[3] + a.top]
        }else {
          u = this.containment
        }
        t.pageX - this.offset.click.left < u[0] && (s = u[0] + this.offset.click.left), t.pageY - this.offset.click.top < u[1] && (o = u[1] + this.offset.click.top), t.pageX - this.offset.click.left > u[2] && (s = u[2] + this.offset.click.left), t.pageY - this.offset.click.top > u[3] && (o = u[3] + this.offset.click.top)
      }
      if(n.grid) {
        var f = n.grid[1] ? this.originalPageY + Math.round((o - this.originalPageY) / n.grid[1]) * n.grid[1] : this.originalPageY;
        o = u ? f - this.offset.click.top < u[1] || f - this.offset.click.top > u[3] ? f - this.offset.click.top < u[1] ? f + n.grid[1] : f - n.grid[1] : f : f;
        var l = n.grid[0] ? this.originalPageX + Math.round((s - this.originalPageX) / n.grid[0]) * n.grid[0] : this.originalPageX;
        s = u ? l - this.offset.click.left < u[0] || l - this.offset.click.left > u[2] ? l - this.offset.click.left < u[0] ? l + n.grid[0] : l - n.grid[0] : l : l
      }
    }
    return{top:o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition == "fixed" ? -this.scrollParent.scrollTop() : i ? 0 : r.scrollTop()), left:s - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition == "fixed" ? -this.scrollParent.scrollLeft() : i ? 0 : r.scrollLeft())}
  }, _clear:function() {
    this.helper.removeClass("ui-draggable-dragging"), this.helper[0] != this.element[0] && !this.cancelHelperRemoval && this.helper.remove(), this.helper = null, this.cancelHelperRemoval = !1
  }, _trigger:function(t, n, r) {
    return r = r || this._uiHash(), e.ui.plugin.call(this, t, [n, r]), t == "drag" && (this.positionAbs = this._convertPositionTo("absolute")), e.Widget.prototype._trigger.call(this, t, n, r)
  }, plugins:{}, _uiHash:function(e) {
    return{helper:this.helper, position:this.position, originalPosition:this.originalPosition, offset:this.positionAbs}
  }}), e.ui.plugin.add("draggable", "connectToSortable", {start:function(t, n) {
    var r = e(this).data("draggable"), i = r.options, s = e.extend({}, n, {item:r.element});
    r.sortables = [], e(i.connectToSortable).each(function() {
      var n = e.data(this, "sortable");
      n && !n.options.disabled && (r.sortables.push({instance:n, shouldRevert:n.options.revert}), n.refreshPositions(), n._trigger("activate", t, s))
    })
  }, stop:function(t, n) {
    var r = e(this).data("draggable"), i = e.extend({}, n, {item:r.element});
    e.each(r.sortables, function() {
      this.instance.isOver ? (this.instance.isOver = 0, r.cancelHelperRemoval = !0, this.instance.cancelHelperRemoval = !1, this.shouldRevert && (this.instance.options.revert = !0), this.instance._mouseStop(t), this.instance.options.helper = this.instance.options._helper, r.options.helper == "original" && this.instance.currentItem.css({top:"auto", left:"auto"})) : (this.instance.cancelHelperRemoval = !1, this.instance._trigger("deactivate", t, i))
    })
  }, drag:function(t, n) {
    var r = e(this).data("draggable"), i = this, s = function(t) {
      var n = this.offset.click.top, r = this.offset.click.left, i = this.positionAbs.top, s = this.positionAbs.left, o = t.height, u = t.width, a = t.top, f = t.left;
      return e.ui.isOver(i + n, s + r, a, f, o, u)
    };
    e.each(r.sortables, function(s) {
      var o = !1, u = this;
      this.instance.positionAbs = r.positionAbs, this.instance.helperProportions = r.helperProportions, this.instance.offset.click = r.offset.click, this.instance._intersectsWith(this.instance.containerCache) && (o = !0, e.each(r.sortables, function() {
        return this.instance.positionAbs = r.positionAbs, this.instance.helperProportions = r.helperProportions, this.instance.offset.click = r.offset.click, this != u && this.instance._intersectsWith(this.instance.containerCache) && e.ui.contains(u.instance.element[0], this.instance.element[0]) && (o = !1), o
      })), o ? (this.instance.isOver || (this.instance.isOver = 1, this.instance.currentItem = e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item", !0), this.instance.options._helper = this.instance.options.helper, this.instance.options.helper = function() {
        return n.helper[0]
      }, t.target = this.instance.currentItem[0], this.instance._mouseCapture(t, !0), this.instance._mouseStart(t, !0, !0), this.instance.offset.click.top = r.offset.click.top, this.instance.offset.click.left = r.offset.click.left, this.instance.offset.parent.left -= r.offset.parent.left - this.instance.offset.parent.left, this.instance.offset.parent.top -= r.offset.parent.top - this.instance.offset.parent.top, r._trigger("toSortable", t), r.dropped = this.instance.element, r.currentItem = r.element, 
      this.instance.fromOutside = r), this.instance.currentItem && this.instance._mouseDrag(t)) : this.instance.isOver && (this.instance.isOver = 0, this.instance.cancelHelperRemoval = !0, this.instance.options.revert = !1, this.instance._trigger("out", t, this.instance._uiHash(this.instance)), this.instance._mouseStop(t, !0), this.instance.options.helper = this.instance.options._helper, this.instance.currentItem.remove(), this.instance.placeholder && this.instance.placeholder.remove(), r._trigger("fromSortable", 
      t), r.dropped = !1)
    })
  }}), e.ui.plugin.add("draggable", "cursor", {start:function(t, n) {
    var r = e("body"), i = e(this).data("draggable").options;
    r.css("cursor") && (i._cursor = r.css("cursor")), r.css("cursor", i.cursor)
  }, stop:function(t, n) {
    var r = e(this).data("draggable").options;
    r._cursor && e("body").css("cursor", r._cursor)
  }}), e.ui.plugin.add("draggable", "opacity", {start:function(t, n) {
    var r = e(n.helper), i = e(this).data("draggable").options;
    r.css("opacity") && (i._opacity = r.css("opacity")), r.css("opacity", i.opacity)
  }, stop:function(t, n) {
    var r = e(this).data("draggable").options;
    r._opacity && e(n.helper).css("opacity", r._opacity)
  }}), e.ui.plugin.add("draggable", "scroll", {start:function(t, n) {
    var r = e(this).data("draggable");
    r.scrollParent[0] != document && r.scrollParent[0].tagName != "HTML" && (r.overflowOffset = r.scrollParent.offset())
  }, drag:function(t, n) {
    var r = e(this).data("draggable"), i = r.options, s = !1;
    if(r.scrollParent[0] != document && r.scrollParent[0].tagName != "HTML") {
      if(!i.axis || i.axis != "x") {
        r.overflowOffset.top + r.scrollParent[0].offsetHeight - t.pageY < i.scrollSensitivity ? r.scrollParent[0].scrollTop = s = r.scrollParent[0].scrollTop + i.scrollSpeed : t.pageY - r.overflowOffset.top < i.scrollSensitivity && (r.scrollParent[0].scrollTop = s = r.scrollParent[0].scrollTop - i.scrollSpeed)
      }
      if(!i.axis || i.axis != "y") {
        r.overflowOffset.left + r.scrollParent[0].offsetWidth - t.pageX < i.scrollSensitivity ? r.scrollParent[0].scrollLeft = s = r.scrollParent[0].scrollLeft + i.scrollSpeed : t.pageX - r.overflowOffset.left < i.scrollSensitivity && (r.scrollParent[0].scrollLeft = s = r.scrollParent[0].scrollLeft - i.scrollSpeed)
      }
    }else {
      if(!i.axis || i.axis != "x") {
        t.pageY - e(document).scrollTop() < i.scrollSensitivity ? s = e(document).scrollTop(e(document).scrollTop() - i.scrollSpeed) : e(window).height() - (t.pageY - e(document).scrollTop()) < i.scrollSensitivity && (s = e(document).scrollTop(e(document).scrollTop() + i.scrollSpeed))
      }
      if(!i.axis || i.axis != "y") {
        t.pageX - e(document).scrollLeft() < i.scrollSensitivity ? s = e(document).scrollLeft(e(document).scrollLeft() - i.scrollSpeed) : e(window).width() - (t.pageX - e(document).scrollLeft()) < i.scrollSensitivity && (s = e(document).scrollLeft(e(document).scrollLeft() + i.scrollSpeed))
      }
    }
    s !== !1 && e.ui.ddmanager && !i.dropBehaviour && e.ui.ddmanager.prepareOffsets(r, t)
  }}), e.ui.plugin.add("draggable", "snap", {start:function(t, n) {
    var r = e(this).data("draggable"), i = r.options;
    r.snapElements = [], e(i.snap.constructor != String ? i.snap.items || ":data(draggable)" : i.snap).each(function() {
      var t = e(this), n = t.offset();
      this != r.element[0] && r.snapElements.push({item:this, width:t.outerWidth(), height:t.outerHeight(), top:n.top, left:n.left})
    })
  }, drag:function(t, n) {
    var r = e(this).data("draggable"), i = r.options, s = i.snapTolerance, o = n.offset.left, u = o + r.helperProportions.width, a = n.offset.top, f = a + r.helperProportions.height;
    for(var l = r.snapElements.length - 1;l >= 0;l--) {
      var c = r.snapElements[l].left, h = c + r.snapElements[l].width, p = r.snapElements[l].top, d = p + r.snapElements[l].height;
      if(!(c - s < o && o < h + s && p - s < a && a < d + s || c - s < o && o < h + s && p - s < f && f < d + s || c - s < u && u < h + s && p - s < a && a < d + s || c - s < u && u < h + s && p - s < f && f < d + s)) {
        r.snapElements[l].snapping && r.options.snap.release && r.options.snap.release.call(r.element, t, e.extend(r._uiHash(), {snapItem:r.snapElements[l].item})), r.snapElements[l].snapping = !1;
        continue
      }
      if(i.snapMode != "inner") {
        var v = Math.abs(p - f) <= s, m = Math.abs(d - a) <= s, g = Math.abs(c - u) <= s, y = Math.abs(h - o) <= s;
        v && (n.position.top = r._convertPositionTo("relative", {top:p - r.helperProportions.height, left:0}).top - r.margins.top), m && (n.position.top = r._convertPositionTo("relative", {top:d, left:0}).top - r.margins.top), g && (n.position.left = r._convertPositionTo("relative", {top:0, left:c - r.helperProportions.width}).left - r.margins.left), y && (n.position.left = r._convertPositionTo("relative", {top:0, left:h}).left - r.margins.left)
      }
      var b = v || m || g || y;
      if(i.snapMode != "outer") {
        var v = Math.abs(p - a) <= s, m = Math.abs(d - f) <= s, g = Math.abs(c - o) <= s, y = Math.abs(h - u) <= s;
        v && (n.position.top = r._convertPositionTo("relative", {top:p, left:0}).top - r.margins.top), m && (n.position.top = r._convertPositionTo("relative", {top:d - r.helperProportions.height, left:0}).top - r.margins.top), g && (n.position.left = r._convertPositionTo("relative", {top:0, left:c}).left - r.margins.left), y && (n.position.left = r._convertPositionTo("relative", {top:0, left:h - r.helperProportions.width}).left - r.margins.left)
      }
      !r.snapElements[l].snapping && (v || m || g || y || b) && r.options.snap.snap && r.options.snap.snap.call(r.element, t, e.extend(r._uiHash(), {snapItem:r.snapElements[l].item})), r.snapElements[l].snapping = v || m || g || y || b
    }
  }}), e.ui.plugin.add("draggable", "stack", {start:function(t, n) {
    var r = e(this).data("draggable").options, i = e.makeArray(e(r.stack)).sort(function(t, n) {
      return(parseInt(e(t).css("zIndex"), 10) || 0) - (parseInt(e(n).css("zIndex"), 10) || 0)
    });
    if(!i.length) {
      return
    }
    var s = parseInt(i[0].style.zIndex) || 0;
    e(i).each(function(e) {
      this.style.zIndex = s + e
    }), this[0].style.zIndex = s + i.length
  }}), e.ui.plugin.add("draggable", "zIndex", {start:function(t, n) {
    var r = e(n.helper), i = e(this).data("draggable").options;
    r.css("zIndex") && (i._zIndex = r.css("zIndex")), r.css("zIndex", i.zIndex)
  }, stop:function(t, n) {
    var r = e(this).data("draggable").options;
    r._zIndex && e(n.helper).css("zIndex", r._zIndex)
  }})
})(jQuery);
(function(e, t) {
  e.widget("ui.droppable", {version:"1.9.2", widgetEventPrefix:"drop", options:{accept:"*", activeClass:!1, addClasses:!0, greedy:!1, hoverClass:!1, scope:"default", tolerance:"intersect"}, _create:function() {
    var t = this.options, n = t.accept;
    this.isover = 0, this.isout = 1, this.accept = e.isFunction(n) ? n : function(e) {
      return e.is(n)
    }, this.proportions = {width:this.element[0].offsetWidth, height:this.element[0].offsetHeight}, e.ui.ddmanager.droppables[t.scope] = e.ui.ddmanager.droppables[t.scope] || [], e.ui.ddmanager.droppables[t.scope].push(this), t.addClasses && this.element.addClass("ui-droppable")
  }, _destroy:function() {
    var t = e.ui.ddmanager.droppables[this.options.scope];
    for(var n = 0;n < t.length;n++) {
      t[n] == this && t.splice(n, 1)
    }
    this.element.removeClass("ui-droppable ui-droppable-disabled")
  }, _setOption:function(t, n) {
    t == "accept" && (this.accept = e.isFunction(n) ? n : function(e) {
      return e.is(n)
    }), e.Widget.prototype._setOption.apply(this, arguments)
  }, _activate:function(t) {
    var n = e.ui.ddmanager.current;
    this.options.activeClass && this.element.addClass(this.options.activeClass), n && this._trigger("activate", t, this.ui(n))
  }, _deactivate:function(t) {
    var n = e.ui.ddmanager.current;
    this.options.activeClass && this.element.removeClass(this.options.activeClass), n && this._trigger("deactivate", t, this.ui(n))
  }, _over:function(t) {
    var n = e.ui.ddmanager.current;
    if(!n || (n.currentItem || n.element)[0] == this.element[0]) {
      return
    }
    this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass), this._trigger("over", t, this.ui(n)))
  }, _out:function(t) {
    var n = e.ui.ddmanager.current;
    if(!n || (n.currentItem || n.element)[0] == this.element[0]) {
      return
    }
    this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger("out", t, this.ui(n)))
  }, _drop:function(t, n) {
    var r = n || e.ui.ddmanager.current;
    if(!r || (r.currentItem || r.element)[0] == this.element[0]) {
      return!1
    }
    var i = !1;
    return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function() {
      var t = e.data(this, "droppable");
      if(t.options.greedy && !t.options.disabled && t.options.scope == r.options.scope && t.accept.call(t.element[0], r.currentItem || r.element) && e.ui.intersect(r, e.extend(t, {offset:t.element.offset()}), t.options.tolerance)) {
        return i = !0, !1
      }
    }), i ? !1 : this.accept.call(this.element[0], r.currentItem || r.element) ? (this.options.activeClass && this.element.removeClass(this.options.activeClass), this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger("drop", t, this.ui(r)), this.element) : !1
  }, ui:function(e) {
    return{draggable:e.currentItem || e.element, helper:e.helper, position:e.position, offset:e.positionAbs}
  }}), e.ui.intersect = function(t, n, r) {
    if(!n.offset) {
      return!1
    }
    var i = (t.positionAbs || t.position.absolute).left, s = i + t.helperProportions.width, o = (t.positionAbs || t.position.absolute).top, u = o + t.helperProportions.height, a = n.offset.left, f = a + n.proportions.width, l = n.offset.top, c = l + n.proportions.height;
    switch(r) {
      case "fit":
        return a <= i && s <= f && l <= o && u <= c;
      case "intersect":
        return a < i + t.helperProportions.width / 2 && s - t.helperProportions.width / 2 < f && l < o + t.helperProportions.height / 2 && u - t.helperProportions.height / 2 < c;
      case "pointer":
        var h = (t.positionAbs || t.position.absolute).left + (t.clickOffset || t.offset.click).left, p = (t.positionAbs || t.position.absolute).top + (t.clickOffset || t.offset.click).top, d = e.ui.isOver(p, h, l, a, n.proportions.height, n.proportions.width);
        return d;
      case "touch":
        return(o >= l && o <= c || u >= l && u <= c || o < l && u > c) && (i >= a && i <= f || s >= a && s <= f || i < a && s > f);
      default:
        return!1
    }
  }, e.ui.ddmanager = {current:null, droppables:{"default":[]}, prepareOffsets:function(t, n) {
    var r = e.ui.ddmanager.droppables[t.options.scope] || [], i = n ? n.type : null, s = (t.currentItem || t.element).find(":data(droppable)").andSelf();
    e:for(var o = 0;o < r.length;o++) {
      if(r[o].options.disabled || t && !r[o].accept.call(r[o].element[0], t.currentItem || t.element)) {
        continue
      }
      for(var u = 0;u < s.length;u++) {
        if(s[u] == r[o].element[0]) {
          r[o].proportions.height = 0;
          continue e
        }
      }
      r[o].visible = r[o].element.css("display") != "none";
      if(!r[o].visible) {
        continue
      }
      i == "mousedown" && r[o]._activate.call(r[o], n), r[o].offset = r[o].element.offset(), r[o].proportions = {width:r[o].element[0].offsetWidth, height:r[o].element[0].offsetHeight}
    }
  }, drop:function(t, n) {
    var r = !1;
    return e.each(e.ui.ddmanager.droppables[t.options.scope] || [], function() {
      if(!this.options) {
        return
      }
      !this.options.disabled && this.visible && e.ui.intersect(t, this, this.options.tolerance) && (r = this._drop.call(this, n) || r), !this.options.disabled && this.visible && this.accept.call(this.element[0], t.currentItem || t.element) && (this.isout = 1, this.isover = 0, this._deactivate.call(this, n))
    }), r
  }, dragStart:function(t, n) {
    t.element.parentsUntil("body").bind("scroll.droppable", function() {
      t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, n)
    })
  }, drag:function(t, n) {
    t.options.refreshPositions && e.ui.ddmanager.prepareOffsets(t, n), e.each(e.ui.ddmanager.droppables[t.options.scope] || [], function() {
      if(this.options.disabled || this.greedyChild || !this.visible) {
        return
      }
      var r = e.ui.intersect(t, this, this.options.tolerance), i = !r && this.isover == 1 ? "isout" : r && this.isover == 0 ? "isover" : null;
      if(!i) {
        return
      }
      var s;
      if(this.options.greedy) {
        var o = this.options.scope, u = this.element.parents(":data(droppable)").filter(function() {
          return e.data(this, "droppable").options.scope === o
        });
        u.length && (s = e.data(u[0], "droppable"), s.greedyChild = i == "isover" ? 1 : 0)
      }
      s && i == "isover" && (s.isover = 0, s.isout = 1, s._out.call(s, n)), this[i] = 1, this[i == "isout" ? "isover" : "isout"] = 0, this[i == "isover" ? "_over" : "_out"].call(this, n), s && i == "isout" && (s.isout = 0, s.isover = 1, s._over.call(s, n))
    })
  }, dragStop:function(t, n) {
    t.element.parentsUntil("body").unbind("scroll.droppable"), t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, n)
  }}
})(jQuery);
(function(e, t) {
  e.widget("ui.sortable", e.ui.mouse, {version:"1.9.2", widgetEventPrefix:"sort", ready:!1, options:{appendTo:"parent", axis:!1, connectWith:!1, containment:!1, cursor:"auto", cursorAt:!1, dropOnEmpty:!0, forcePlaceholderSize:!1, forceHelperSize:!1, grid:!1, handle:!1, helper:"original", items:"> *", opacity:!1, placeholder:!1, revert:!1, scroll:!0, scrollSensitivity:20, scrollSpeed:20, scope:"default", tolerance:"intersect", zIndex:1E3}, _create:function() {
    var e = this.options;
    this.containerCache = {}, this.element.addClass("ui-sortable"), this.refresh(), this.floating = this.items.length ? e.axis === "x" || /left|right/.test(this.items[0].item.css("float")) || /inline|table-cell/.test(this.items[0].item.css("display")) : !1, this.offset = this.element.offset(), this._mouseInit(), this.ready = !0
  }, _destroy:function() {
    this.element.removeClass("ui-sortable ui-sortable-disabled"), this._mouseDestroy();
    for(var e = this.items.length - 1;e >= 0;e--) {
      this.items[e].item.removeData(this.widgetName + "-item")
    }
    return this
  }, _setOption:function(t, n) {
    t === "disabled" ? (this.options[t] = n, this.widget().toggleClass("ui-sortable-disabled", !!n)) : e.Widget.prototype._setOption.apply(this, arguments)
  }, _mouseCapture:function(t, n) {
    var r = this;
    if(this.reverting) {
      return!1
    }
    if(this.options.disabled || this.options.type == "static") {
      return!1
    }
    this._refreshItems(t);
    var i = null, s = e(t.target).parents().each(function() {
      if(e.data(this, r.widgetName + "-item") == r) {
        return i = e(this), !1
      }
    });
    e.data(t.target, r.widgetName + "-item") == r && (i = e(t.target));
    if(!i) {
      return!1
    }
    if(this.options.handle && !n) {
      var o = !1;
      e(this.options.handle, i).find("*").andSelf().each(function() {
        this == t.target && (o = !0)
      });
      if(!o) {
        return!1
      }
    }
    return this.currentItem = i, this._removeCurrentsFromItems(), !0
  }, _mouseStart:function(t, n, r) {
    var i = this.options;
    this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(t), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = {top:this.offset.top - this.margins.top, left:this.offset.left - this.margins.left}, e.extend(this.offset, {click:{left:t.pageX - this.offset.left, top:t.pageY - this.offset.top}, parent:this._getParentOffset(), relative:this._getRelativeOffset()}), 
    this.helper.css("position", "absolute"), this.cssPosition = this.helper.css("position"), this.originalPosition = this._generatePosition(t), this.originalPageX = t.pageX, this.originalPageY = t.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this.domPosition = {prev:this.currentItem.prev()[0], parent:this.currentItem.parent()[0]}, this.helper[0] != this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), i.containment && this._setContainment(), i.cursor && (e("body").css("cursor") && 
    (this._storedCursor = e("body").css("cursor")), e("body").css("cursor", i.cursor)), i.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")), this.helper.css("opacity", i.opacity)), i.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")), this.helper.css("zIndex", i.zIndex)), this.scrollParent[0] != document && this.scrollParent[0].tagName != "HTML" && (this.overflowOffset = this.scrollParent.offset()), this._trigger("start", 
    t, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions();
    if(!r) {
      for(var s = this.containers.length - 1;s >= 0;s--) {
        this.containers[s]._trigger("activate", t, this._uiHash(this))
      }
    }
    return e.ui.ddmanager && (e.ui.ddmanager.current = this), e.ui.ddmanager && !i.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this.dragging = !0, this.helper.addClass("ui-sortable-helper"), this._mouseDrag(t), !0
  }, _mouseDrag:function(t) {
    this.position = this._generatePosition(t), this.positionAbs = this._convertPositionTo("absolute"), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs);
    if(this.options.scroll) {
      var n = this.options, r = !1;
      this.scrollParent[0] != document && this.scrollParent[0].tagName != "HTML" ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - t.pageY < n.scrollSensitivity ? this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop + n.scrollSpeed : t.pageY - this.overflowOffset.top < n.scrollSensitivity && (this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop - n.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - t.pageX < n.scrollSensitivity ? 
      this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft + n.scrollSpeed : t.pageX - this.overflowOffset.left < n.scrollSensitivity && (this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft - n.scrollSpeed)) : (t.pageY - e(document).scrollTop() < n.scrollSensitivity ? r = e(document).scrollTop(e(document).scrollTop() - n.scrollSpeed) : e(window).height() - (t.pageY - e(document).scrollTop()) < n.scrollSensitivity && (r = e(document).scrollTop(e(document).scrollTop() + 
      n.scrollSpeed)), t.pageX - e(document).scrollLeft() < n.scrollSensitivity ? r = e(document).scrollLeft(e(document).scrollLeft() - n.scrollSpeed) : e(window).width() - (t.pageX - e(document).scrollLeft()) < n.scrollSensitivity && (r = e(document).scrollLeft(e(document).scrollLeft() + n.scrollSpeed))), r !== !1 && e.ui.ddmanager && !n.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t)
    }
    this.positionAbs = this._convertPositionTo("absolute");
    if(!this.options.axis || this.options.axis != "y") {
      this.helper[0].style.left = this.position.left + "px"
    }
    if(!this.options.axis || this.options.axis != "x") {
      this.helper[0].style.top = this.position.top + "px"
    }
    for(var i = this.items.length - 1;i >= 0;i--) {
      var s = this.items[i], o = s.item[0], u = this._intersectsWithPointer(s);
      if(!u) {
        continue
      }
      if(s.instance !== this.currentContainer) {
        continue
      }
      if(o != this.currentItem[0] && this.placeholder[u == 1 ? "next" : "prev"]()[0] != o && !e.contains(this.placeholder[0], o) && (this.options.type == "semi-dynamic" ? !e.contains(this.element[0], o) : !0)) {
        this.direction = u == 1 ? "down" : "up";
        if(this.options.tolerance != "pointer" && !this._intersectsWithSides(s)) {
          break
        }
        this._rearrange(t, s), this._trigger("change", t, this._uiHash());
        break
      }
    }
    return this._contactContainers(t), e.ui.ddmanager && e.ui.ddmanager.drag(this, t), this._trigger("sort", t, this._uiHash()), this.lastPositionAbs = this.positionAbs, !1
  }, _mouseStop:function(t, n) {
    if(!t) {
      return
    }
    e.ui.ddmanager && !this.options.dropBehaviour && e.ui.ddmanager.drop(this, t);
    if(this.options.revert) {
      var r = this, i = this.placeholder.offset();
      this.reverting = !0, e(this.helper).animate({left:i.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] == document.body ? 0 : this.offsetParent[0].scrollLeft), top:i.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] == document.body ? 0 : this.offsetParent[0].scrollTop)}, parseInt(this.options.revert, 10) || 500, function() {
        r._clear(t)
      })
    }else {
      this._clear(t, n)
    }
    return!1
  }, cancel:function() {
    if(this.dragging) {
      this._mouseUp({target:null}), this.options.helper == "original" ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
      for(var t = this.containers.length - 1;t >= 0;t--) {
        this.containers[t]._trigger("deactivate", null, this._uiHash(this)), this.containers[t].containerCache.over && (this.containers[t]._trigger("out", null, this._uiHash(this)), this.containers[t].containerCache.over = 0)
      }
    }
    return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.options.helper != "original" && this.helper && this.helper[0].parentNode && this.helper.remove(), e.extend(this, {helper:null, dragging:!1, reverting:!1, _noFinalSort:null}), this.domPosition.prev ? e(this.domPosition.prev).after(this.currentItem) : e(this.domPosition.parent).prepend(this.currentItem)), this
  }, serialize:function(t) {
    var n = this._getItemsAsjQuery(t && t.connected), r = [];
    return t = t || {}, e(n).each(function() {
      var n = (e(t.item || this).attr(t.attribute || "id") || "").match(t.expression || /(.+)[-=_](.+)/);
      n && r.push((t.key || n[1] + "[]") + "=" + (t.key && t.expression ? n[1] : n[2]))
    }), !r.length && t.key && r.push(t.key + "="), r.join("&")
  }, toArray:function(t) {
    var n = this._getItemsAsjQuery(t && t.connected), r = [];
    return t = t || {}, n.each(function() {
      r.push(e(t.item || this).attr(t.attribute || "id") || "")
    }), r
  }, _intersectsWith:function(e) {
    var t = this.positionAbs.left, n = t + this.helperProportions.width, r = this.positionAbs.top, i = r + this.helperProportions.height, s = e.left, o = s + e.width, u = e.top, a = u + e.height, f = this.offset.click.top, l = this.offset.click.left, c = r + f > u && r + f < a && t + l > s && t + l < o;
    return this.options.tolerance == "pointer" || this.options.forcePointerForContainers || this.options.tolerance != "pointer" && this.helperProportions[this.floating ? "width" : "height"] > e[this.floating ? "width" : "height"] ? c : s < t + this.helperProportions.width / 2 && n - this.helperProportions.width / 2 < o && u < r + this.helperProportions.height / 2 && i - this.helperProportions.height / 2 < a
  }, _intersectsWithPointer:function(t) {
    var n = this.options.axis === "x" || e.ui.isOverAxis(this.positionAbs.top + this.offset.click.top, t.top, t.height), r = this.options.axis === "y" || e.ui.isOverAxis(this.positionAbs.left + this.offset.click.left, t.left, t.width), i = n && r, s = this._getDragVerticalDirection(), o = this._getDragHorizontalDirection();
    return i ? this.floating ? o && o == "right" || s == "down" ? 2 : 1 : s && (s == "down" ? 2 : 1) : !1
  }, _intersectsWithSides:function(t) {
    var n = e.ui.isOverAxis(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height), r = e.ui.isOverAxis(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width), i = this._getDragVerticalDirection(), s = this._getDragHorizontalDirection();
    return this.floating && s ? s == "right" && r || s == "left" && !r : i && (i == "down" && n || i == "up" && !n)
  }, _getDragVerticalDirection:function() {
    var e = this.positionAbs.top - this.lastPositionAbs.top;
    return e != 0 && (e > 0 ? "down" : "up")
  }, _getDragHorizontalDirection:function() {
    var e = this.positionAbs.left - this.lastPositionAbs.left;
    return e != 0 && (e > 0 ? "right" : "left")
  }, refresh:function(e) {
    return this._refreshItems(e), this.refreshPositions(), this
  }, _connectWith:function() {
    var e = this.options;
    return e.connectWith.constructor == String ? [e.connectWith] : e.connectWith
  }, _getItemsAsjQuery:function(t) {
    var n = [], r = [], i = this._connectWith();
    if(i && t) {
      for(var s = i.length - 1;s >= 0;s--) {
        var o = e(i[s]);
        for(var u = o.length - 1;u >= 0;u--) {
          var a = e.data(o[u], this.widgetName);
          a && a != this && !a.options.disabled && r.push([e.isFunction(a.options.items) ? a.options.items.call(a.element) : e(a.options.items, a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), a])
        }
      }
    }
    r.push([e.isFunction(this.options.items) ? this.options.items.call(this.element, null, {options:this.options, item:this.currentItem}) : e(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]);
    for(var s = r.length - 1;s >= 0;s--) {
      r[s][0].each(function() {
        n.push(this)
      })
    }
    return e(n)
  }, _removeCurrentsFromItems:function() {
    var t = this.currentItem.find(":data(" + this.widgetName + "-item)");
    this.items = e.grep(this.items, function(e) {
      for(var n = 0;n < t.length;n++) {
        if(t[n] == e.item[0]) {
          return!1
        }
      }
      return!0
    })
  }, _refreshItems:function(t) {
    this.items = [], this.containers = [this];
    var n = this.items, r = [[e.isFunction(this.options.items) ? this.options.items.call(this.element[0], t, {item:this.currentItem}) : e(this.options.items, this.element), this]], i = this._connectWith();
    if(i && this.ready) {
      for(var s = i.length - 1;s >= 0;s--) {
        var o = e(i[s]);
        for(var u = o.length - 1;u >= 0;u--) {
          var a = e.data(o[u], this.widgetName);
          a && a != this && !a.options.disabled && (r.push([e.isFunction(a.options.items) ? a.options.items.call(a.element[0], t, {item:this.currentItem}) : e(a.options.items, a.element), a]), this.containers.push(a))
        }
      }
    }
    for(var s = r.length - 1;s >= 0;s--) {
      var f = r[s][1], l = r[s][0];
      for(var u = 0, c = l.length;u < c;u++) {
        var h = e(l[u]);
        h.data(this.widgetName + "-item", f), n.push({item:h, instance:f, width:0, height:0, left:0, top:0})
      }
    }
  }, refreshPositions:function(t) {
    this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
    for(var n = this.items.length - 1;n >= 0;n--) {
      var r = this.items[n];
      if(r.instance != this.currentContainer && this.currentContainer && r.item[0] != this.currentItem[0]) {
        continue
      }
      var i = this.options.toleranceElement ? e(this.options.toleranceElement, r.item) : r.item;
      t || (r.width = i.outerWidth(), r.height = i.outerHeight());
      var s = i.offset();
      r.left = s.left, r.top = s.top
    }
    if(this.options.custom && this.options.custom.refreshContainers) {
      this.options.custom.refreshContainers.call(this)
    }else {
      for(var n = this.containers.length - 1;n >= 0;n--) {
        var s = this.containers[n].element.offset();
        this.containers[n].containerCache.left = s.left, this.containers[n].containerCache.top = s.top, this.containers[n].containerCache.width = this.containers[n].element.outerWidth(), this.containers[n].containerCache.height = this.containers[n].element.outerHeight()
      }
    }
    return this
  }, _createPlaceholder:function(t) {
    t = t || this;
    var n = t.options;
    if(!n.placeholder || n.placeholder.constructor == String) {
      var r = n.placeholder;
      n.placeholder = {element:function() {
        var n = e(document.createElement(t.currentItem[0].nodeName)).addClass(r || t.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];
        return r || (n.style.visibility = "hidden"), n
      }, update:function(e, i) {
        if(r && !n.forcePlaceholderSize) {
          return
        }
        i.height() || i.height(t.currentItem.innerHeight() - parseInt(t.currentItem.css("paddingTop") || 0, 10) - parseInt(t.currentItem.css("paddingBottom") || 0, 10)), i.width() || i.width(t.currentItem.innerWidth() - parseInt(t.currentItem.css("paddingLeft") || 0, 10) - parseInt(t.currentItem.css("paddingRight") || 0, 10))
      }}
    }
    t.placeholder = e(n.placeholder.element.call(t.element, t.currentItem)), t.currentItem.after(t.placeholder), n.placeholder.update(t, t.placeholder)
  }, _contactContainers:function(t) {
    var n = null, r = null;
    for(var i = this.containers.length - 1;i >= 0;i--) {
      if(e.contains(this.currentItem[0], this.containers[i].element[0])) {
        continue
      }
      if(this._intersectsWith(this.containers[i].containerCache)) {
        if(n && e.contains(this.containers[i].element[0], n.element[0])) {
          continue
        }
        n = this.containers[i], r = i
      }else {
        this.containers[i].containerCache.over && (this.containers[i]._trigger("out", t, this._uiHash(this)), this.containers[i].containerCache.over = 0)
      }
    }
    if(!n) {
      return
    }
    if(this.containers.length === 1) {
      this.containers[r]._trigger("over", t, this._uiHash(this)), this.containers[r].containerCache.over = 1
    }else {
      var s = 1E4, o = null, u = this.containers[r].floating ? "left" : "top", a = this.containers[r].floating ? "width" : "height", f = this.positionAbs[u] + this.offset.click[u];
      for(var l = this.items.length - 1;l >= 0;l--) {
        if(!e.contains(this.containers[r].element[0], this.items[l].item[0])) {
          continue
        }
        if(this.items[l].item[0] == this.currentItem[0]) {
          continue
        }
        var c = this.items[l].item.offset()[u], h = !1;
        Math.abs(c - f) > Math.abs(c + this.items[l][a] - f) && (h = !0, c += this.items[l][a]), Math.abs(c - f) < s && (s = Math.abs(c - f), o = this.items[l], this.direction = h ? "up" : "down")
      }
      if(!o && !this.options.dropOnEmpty) {
        return
      }
      this.currentContainer = this.containers[r], o ? this._rearrange(t, o, null, !0) : this._rearrange(t, null, this.containers[r].element, !0), this._trigger("change", t, this._uiHash()), this.containers[r]._trigger("change", t, this._uiHash(this)), this.options.placeholder.update(this.currentContainer, this.placeholder), this.containers[r]._trigger("over", t, this._uiHash(this)), this.containers[r].containerCache.over = 1
    }
  }, _createHelper:function(t) {
    var n = this.options, r = e.isFunction(n.helper) ? e(n.helper.apply(this.element[0], [t, this.currentItem])) : n.helper == "clone" ? this.currentItem.clone() : this.currentItem;
    return r.parents("body").length || e(n.appendTo != "parent" ? n.appendTo : this.currentItem[0].parentNode)[0].appendChild(r[0]), r[0] == this.currentItem[0] && (this._storedCSS = {width:this.currentItem[0].style.width, height:this.currentItem[0].style.height, position:this.currentItem.css("position"), top:this.currentItem.css("top"), left:this.currentItem.css("left")}), (r[0].style.width == "" || n.forceHelperSize) && r.width(this.currentItem.width()), (r[0].style.height == "" || n.forceHelperSize) && 
    r.height(this.currentItem.height()), r
  }, _adjustOffsetFromHelper:function(t) {
    typeof t == "string" && (t = t.split(" ")), e.isArray(t) && (t = {left:+t[0], top:+t[1] || 0}), "left" in t && (this.offset.click.left = t.left + this.margins.left), "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left), "top" in t && (this.offset.click.top = t.top + this.margins.top), "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top)
  }, _getParentOffset:function() {
    this.offsetParent = this.helper.offsetParent();
    var t = this.offsetParent.offset();
    this.cssPosition == "absolute" && this.scrollParent[0] != document && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop());
    if(this.offsetParent[0] == document.body || this.offsetParent[0].tagName && this.offsetParent[0].tagName.toLowerCase() == "html" && e.ui.ie) {
      t = {top:0, left:0}
    }
    return{top:t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left:t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)}
  }, _getRelativeOffset:function() {
    if(this.cssPosition == "relative") {
      var e = this.currentItem.position();
      return{top:e.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(), left:e.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()}
    }
    return{top:0, left:0}
  }, _cacheMargins:function() {
    this.margins = {left:parseInt(this.currentItem.css("marginLeft"), 10) || 0, top:parseInt(this.currentItem.css("marginTop"), 10) || 0}
  }, _cacheHelperProportions:function() {
    this.helperProportions = {width:this.helper.outerWidth(), height:this.helper.outerHeight()}
  }, _setContainment:function() {
    var t = this.options;
    t.containment == "parent" && (t.containment = this.helper[0].parentNode);
    if(t.containment == "document" || t.containment == "window") {
      this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, e(t.containment == "document" ? document : window).width() - this.helperProportions.width - this.margins.left, (e(t.containment == "document" ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]
    }
    if(!/^(document|window|parent)$/.test(t.containment)) {
      var n = e(t.containment)[0], r = e(t.containment).offset(), i = e(n).css("overflow") != "hidden";
      this.containment = [r.left + (parseInt(e(n).css("borderLeftWidth"), 10) || 0) + (parseInt(e(n).css("paddingLeft"), 10) || 0) - this.margins.left, r.top + (parseInt(e(n).css("borderTopWidth"), 10) || 0) + (parseInt(e(n).css("paddingTop"), 10) || 0) - this.margins.top, r.left + (i ? Math.max(n.scrollWidth, n.offsetWidth) : n.offsetWidth) - (parseInt(e(n).css("borderLeftWidth"), 10) || 0) - (parseInt(e(n).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, r.top + 
      (i ? Math.max(n.scrollHeight, n.offsetHeight) : n.offsetHeight) - (parseInt(e(n).css("borderTopWidth"), 10) || 0) - (parseInt(e(n).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top]
    }
  }, _convertPositionTo:function(t, n) {
    n || (n = this.position);
    var r = t == "absolute" ? 1 : -1, i = this.options, s = this.cssPosition != "absolute" || this.scrollParent[0] != document && !!e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, o = /(html|body)/i.test(s[0].tagName);
    return{top:n.top + this.offset.relative.top * r + this.offset.parent.top * r - (this.cssPosition == "fixed" ? -this.scrollParent.scrollTop() : o ? 0 : s.scrollTop()) * r, left:n.left + this.offset.relative.left * r + this.offset.parent.left * r - (this.cssPosition == "fixed" ? -this.scrollParent.scrollLeft() : o ? 0 : s.scrollLeft()) * r}
  }, _generatePosition:function(t) {
    var n = this.options, r = this.cssPosition != "absolute" || this.scrollParent[0] != document && !!e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, i = /(html|body)/i.test(r[0].tagName);
    this.cssPosition == "relative" && (this.scrollParent[0] == document || this.scrollParent[0] == this.offsetParent[0]) && (this.offset.relative = this._getRelativeOffset());
    var s = t.pageX, o = t.pageY;
    if(this.originalPosition) {
      this.containment && (t.pageX - this.offset.click.left < this.containment[0] && (s = this.containment[0] + this.offset.click.left), t.pageY - this.offset.click.top < this.containment[1] && (o = this.containment[1] + this.offset.click.top), t.pageX - this.offset.click.left > this.containment[2] && (s = this.containment[2] + this.offset.click.left), t.pageY - this.offset.click.top > this.containment[3] && (o = this.containment[3] + this.offset.click.top));
      if(n.grid) {
        var u = this.originalPageY + Math.round((o - this.originalPageY) / n.grid[1]) * n.grid[1];
        o = this.containment ? u - this.offset.click.top < this.containment[1] || u - this.offset.click.top > this.containment[3] ? u - this.offset.click.top < this.containment[1] ? u + n.grid[1] : u - n.grid[1] : u : u;
        var a = this.originalPageX + Math.round((s - this.originalPageX) / n.grid[0]) * n.grid[0];
        s = this.containment ? a - this.offset.click.left < this.containment[0] || a - this.offset.click.left > this.containment[2] ? a - this.offset.click.left < this.containment[0] ? a + n.grid[0] : a - n.grid[0] : a : a
      }
    }
    return{top:o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition == "fixed" ? -this.scrollParent.scrollTop() : i ? 0 : r.scrollTop()), left:s - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition == "fixed" ? -this.scrollParent.scrollLeft() : i ? 0 : r.scrollLeft())}
  }, _rearrange:function(e, t, n, r) {
    n ? n[0].appendChild(this.placeholder[0]) : t.item[0].parentNode.insertBefore(this.placeholder[0], this.direction == "down" ? t.item[0] : t.item[0].nextSibling), this.counter = this.counter ? ++this.counter : 1;
    var i = this.counter;
    this._delay(function() {
      i == this.counter && this.refreshPositions(!r)
    })
  }, _clear:function(t, n) {
    this.reverting = !1;
    var r = [];
    !this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null;
    if(this.helper[0] == this.currentItem[0]) {
      for(var i in this._storedCSS) {
        if(this._storedCSS[i] == "auto" || this._storedCSS[i] == "static") {
          this._storedCSS[i] = ""
        }
      }
      this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
    }else {
      this.currentItem.show()
    }
    this.fromOutside && !n && r.push(function(e) {
      this._trigger("receive", e, this._uiHash(this.fromOutside))
    }), (this.fromOutside || this.domPosition.prev != this.currentItem.prev().not(".ui-sortable-helper")[0] || this.domPosition.parent != this.currentItem.parent()[0]) && !n && r.push(function(e) {
      this._trigger("update", e, this._uiHash())
    }), this !== this.currentContainer && (n || (r.push(function(e) {
      this._trigger("remove", e, this._uiHash())
    }), r.push(function(e) {
      return function(t) {
        e._trigger("receive", t, this._uiHash(this))
      }
    }.call(this, this.currentContainer)), r.push(function(e) {
      return function(t) {
        e._trigger("update", t, this._uiHash(this))
      }
    }.call(this, this.currentContainer))));
    for(var i = this.containers.length - 1;i >= 0;i--) {
      n || r.push(function(e) {
        return function(t) {
          e._trigger("deactivate", t, this._uiHash(this))
        }
      }.call(this, this.containers[i])), this.containers[i].containerCache.over && (r.push(function(e) {
        return function(t) {
          e._trigger("out", t, this._uiHash(this))
        }
      }.call(this, this.containers[i])), this.containers[i].containerCache.over = 0)
    }
    this._storedCursor && e("body").css("cursor", this._storedCursor), this._storedOpacity && this.helper.css("opacity", this._storedOpacity), this._storedZIndex && this.helper.css("zIndex", this._storedZIndex == "auto" ? "" : this._storedZIndex), this.dragging = !1;
    if(this.cancelHelperRemoval) {
      if(!n) {
        this._trigger("beforeStop", t, this._uiHash());
        for(var i = 0;i < r.length;i++) {
          r[i].call(this, t)
        }
        this._trigger("stop", t, this._uiHash())
      }
      return this.fromOutside = !1, !1
    }
    n || this._trigger("beforeStop", t, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.helper[0] != this.currentItem[0] && this.helper.remove(), this.helper = null;
    if(!n) {
      for(var i = 0;i < r.length;i++) {
        r[i].call(this, t)
      }
      this._trigger("stop", t, this._uiHash())
    }
    return this.fromOutside = !1, !0
  }, _trigger:function() {
    e.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
  }, _uiHash:function(t) {
    var n = t || this;
    return{helper:n.helper, placeholder:n.placeholder || e([]), position:n.position, originalPosition:n.originalPosition, offset:n.positionAbs, item:n.currentItem, sender:t ? t.element : null}
  }})
})(jQuery);
(function(e, t) {
  var n = 0;
  e.widget("ui.autocomplete", {version:"1.9.2", defaultElement:"<input>", options:{appendTo:"body", autoFocus:!1, delay:300, minLength:1, position:{my:"left top", at:"left bottom", collision:"none"}, source:null, change:null, close:null, focus:null, open:null, response:null, search:null, select:null}, pending:0, _create:function() {
    var t, n, r;
    this.isMultiLine = this._isMultiLine(), this.valueMethod = this.element[this.element.is("input,textarea") ? "val" : "text"], this.isNewMenu = !0, this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off"), this._on(this.element, {keydown:function(i) {
      if(this.element.prop("readOnly")) {
        t = !0, r = !0, n = !0;
        return
      }
      t = !1, r = !1, n = !1;
      var s = e.ui.keyCode;
      switch(i.keyCode) {
        case s.PAGE_UP:
          t = !0, this._move("previousPage", i);
          break;
        case s.PAGE_DOWN:
          t = !0, this._move("nextPage", i);
          break;
        case s.UP:
          t = !0, this._keyEvent("previous", i);
          break;
        case s.DOWN:
          t = !0, this._keyEvent("next", i);
          break;
        case s.ENTER:
        ;
        case s.NUMPAD_ENTER:
          this.menu.active && (t = !0, i.preventDefault(), this.menu.select(i));
          break;
        case s.TAB:
          this.menu.active && this.menu.select(i);
          break;
        case s.ESCAPE:
          this.menu.element.is(":visible") && (this._value(this.term), this.close(i), i.preventDefault());
          break;
        default:
          n = !0, this._searchTimeout(i)
      }
    }, keypress:function(r) {
      if(t) {
        t = !1, r.preventDefault();
        return
      }
      if(n) {
        return
      }
      var i = e.ui.keyCode;
      switch(r.keyCode) {
        case i.PAGE_UP:
          this._move("previousPage", r);
          break;
        case i.PAGE_DOWN:
          this._move("nextPage", r);
          break;
        case i.UP:
          this._keyEvent("previous", r);
          break;
        case i.DOWN:
          this._keyEvent("next", r)
      }
    }, input:function(e) {
      if(r) {
        r = !1, e.preventDefault();
        return
      }
      this._searchTimeout(e)
    }, focus:function() {
      this.selectedItem = null, this.previous = this._value()
    }, blur:function(e) {
      if(this.cancelBlur) {
        delete this.cancelBlur;
        return
      }
      clearTimeout(this.searching), this.close(e), this._change(e)
    }}), this._initSource(), this.menu = e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo || "body")[0]).menu({input:e(), role:null}).zIndex(this.element.zIndex() + 1).hide().data("menu"), this._on(this.menu.element, {mousedown:function(t) {
      t.preventDefault(), this.cancelBlur = !0, this._delay(function() {
        delete this.cancelBlur
      });
      var n = this.menu.element[0];
      e(t.target).closest(".ui-menu-item").length || this._delay(function() {
        var t = this;
        this.document.one("mousedown", function(r) {
          r.target !== t.element[0] && r.target !== n && !e.contains(n, r.target) && t.close()
        })
      })
    }, menufocus:function(t, n) {
      if(this.isNewMenu) {
        this.isNewMenu = !1;
        if(t.originalEvent && /^mouse/.test(t.originalEvent.type)) {
          this.menu.blur(), this.document.one("mousemove", function() {
            e(t.target).trigger(t.originalEvent)
          });
          return
        }
      }
      var r = n.item.data("ui-autocomplete-item") || n.item.data("item.autocomplete");
      !1 !== this._trigger("focus", t, {item:r}) ? t.originalEvent && /^key/.test(t.originalEvent.type) && this._value(r.value) : this.liveRegion.text(r.value)
    }, menuselect:function(e, t) {
      var n = t.item.data("ui-autocomplete-item") || t.item.data("item.autocomplete"), r = this.previous;
      this.element[0] !== this.document[0].activeElement && (this.element.focus(), this.previous = r, this._delay(function() {
        this.previous = r, this.selectedItem = n
      })), !1 !== this._trigger("select", e, {item:n}) && this._value(n.value), this.term = this._value(), this.close(e), this.selectedItem = n
    }}), this.liveRegion = e("<span>", {role:"status", "aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element), e.fn.bgiframe && this.menu.element.bgiframe(), this._on(this.window, {beforeunload:function() {
      this.element.removeAttr("autocomplete")
    }})
  }, _destroy:function() {
    clearTimeout(this.searching), this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"), this.menu.element.remove(), this.liveRegion.remove()
  }, _setOption:function(e, t) {
    this._super(e, t), e === "source" && this._initSource(), e === "appendTo" && this.menu.element.appendTo(this.document.find(t || "body")[0]), e === "disabled" && t && this.xhr && this.xhr.abort()
  }, _isMultiLine:function() {
    return this.element.is("textarea") ? !0 : this.element.is("input") ? !1 : this.element.prop("isContentEditable")
  }, _initSource:function() {
    var t, n, r = this;
    e.isArray(this.options.source) ? (t = this.options.source, this.source = function(n, r) {
      r(e.ui.autocomplete.filter(t, n.term))
    }) : typeof this.options.source == "string" ? (n = this.options.source, this.source = function(t, i) {
      r.xhr && r.xhr.abort(), r.xhr = e.ajax({url:n, data:t, dataType:"json", success:function(e) {
        i(e)
      }, error:function() {
        i([])
      }})
    }) : this.source = this.options.source
  }, _searchTimeout:function(e) {
    clearTimeout(this.searching), this.searching = this._delay(function() {
      this.term !== this._value() && (this.selectedItem = null, this.search(null, e))
    }, this.options.delay)
  }, search:function(e, t) {
    e = e != null ? e : this._value(), this.term = this._value();
    if(e.length < this.options.minLength) {
      return this.close(t)
    }
    if(this._trigger("search", t) === !1) {
      return
    }
    return this._search(e)
  }, _search:function(e) {
    this.pending++, this.element.addClass("ui-autocomplete-loading"), this.cancelSearch = !1, this.source({term:e}, this._response())
  }, _response:function() {
    var e = this, t = ++n;
    return function(r) {
      t === n && e.__response(r), e.pending--, e.pending || e.element.removeClass("ui-autocomplete-loading")
    }
  }, __response:function(e) {
    e && (e = this._normalize(e)), this._trigger("response", null, {content:e}), !this.options.disabled && e && e.length && !this.cancelSearch ? (this._suggest(e), this._trigger("open")) : this._close()
  }, close:function(e) {
    this.cancelSearch = !0, this._close(e)
  }, _close:function(e) {
    this.menu.element.is(":visible") && (this.menu.element.hide(), this.menu.blur(), this.isNewMenu = !0, this._trigger("close", e))
  }, _change:function(e) {
    this.previous !== this._value() && this._trigger("change", e, {item:this.selectedItem})
  }, _normalize:function(t) {
    return t.length && t[0].label && t[0].value ? t : e.map(t, function(t) {
      return typeof t == "string" ? {label:t, value:t} : e.extend({label:t.label || t.value, value:t.value || t.label}, t)
    })
  }, _suggest:function(t) {
    var n = this.menu.element.empty().zIndex(this.element.zIndex() + 1);
    this._renderMenu(n, t), this.menu.refresh(), n.show(), this._resizeMenu(), n.position(e.extend({of:this.element}, this.options.position)), this.options.autoFocus && this.menu.next()
  }, _resizeMenu:function() {
    var e = this.menu.element;
    e.outerWidth(Math.max(e.width("").outerWidth() + 1, this.element.outerWidth()))
  }, _renderMenu:function(t, n) {
    var r = this;
    e.each(n, function(e, n) {
      r._renderItemData(t, n)
    })
  }, _renderItemData:function(e, t) {
    return this._renderItem(e, t).data("ui-autocomplete-item", t)
  }, _renderItem:function(t, n) {
    return e("<li>").append(e("<a>").text(n.label)).appendTo(t)
  }, _move:function(e, t) {
    if(!this.menu.element.is(":visible")) {
      this.search(null, t);
      return
    }
    if(this.menu.isFirstItem() && /^previous/.test(e) || this.menu.isLastItem() && /^next/.test(e)) {
      this._value(this.term), this.menu.blur();
      return
    }
    this.menu[e](t)
  }, widget:function() {
    return this.menu.element
  }, _value:function() {
    return this.valueMethod.apply(this.element, arguments)
  }, _keyEvent:function(e, t) {
    if(!this.isMultiLine || this.menu.element.is(":visible")) {
      this._move(e, t), t.preventDefault()
    }
  }}), e.extend(e.ui.autocomplete, {escapeRegex:function(e) {
    return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
  }, filter:function(t, n) {
    var r = new RegExp(e.ui.autocomplete.escapeRegex(n), "i");
    return e.grep(t, function(e) {
      return r.test(e.label || e.value || e)
    })
  }}), e.widget("ui.autocomplete", e.ui.autocomplete, {options:{messages:{noResults:"No search results.", results:function(e) {
    return e + (e > 1 ? " results are" : " result is") + " available, use up and down arrow keys to navigate."
  }}}, __response:function(e) {
    var t;
    this._superApply(arguments);
    if(this.options.disabled || this.cancelSearch) {
      return
    }
    e && e.length ? t = this.options.messages.results(e.length) : t = this.options.messages.noResults, this.liveRegion.text(t)
  }})
})(jQuery);
(function(e, t) {
  var n = !1;
  e.widget("ui.menu", {version:"1.9.2", defaultElement:"<ul>", delay:300, options:{icons:{submenu:"ui-icon-carat-1-e"}, menus:"ul", position:{my:"left top", at:"right top"}, role:"menu", blur:null, focus:null, select:null}, _create:function() {
    this.activeMenu = this.element, this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length).attr({role:this.options.role, tabIndex:0}).bind("click" + this.eventNamespace, e.proxy(function(e) {
      this.options.disabled && e.preventDefault()
    }, this)), this.options.disabled && this.element.addClass("ui-state-disabled").attr("aria-disabled", "true"), this._on({"mousedown .ui-menu-item > a":function(e) {
      e.preventDefault()
    }, "click .ui-state-disabled > a":function(e) {
      e.preventDefault()
    }, "click .ui-menu-item:has(a)":function(t) {
      var r = e(t.target).closest(".ui-menu-item");
      !n && r.not(".ui-state-disabled").length && (n = !0, this.select(t), r.has(".ui-menu").length ? this.expand(t) : this.element.is(":focus") || (this.element.trigger("focus", [!0]), this.active && this.active.parents(".ui-menu").length === 1 && clearTimeout(this.timer)))
    }, "mouseenter .ui-menu-item":function(t) {
      var n = e(t.currentTarget);
      n.siblings().children(".ui-state-active").removeClass("ui-state-active"), this.focus(t, n)
    }, mouseleave:"collapseAll", "mouseleave .ui-menu":"collapseAll", focus:function(e, t) {
      var n = this.active || this.element.children(".ui-menu-item").eq(0);
      t || this.focus(e, n)
    }, blur:function(t) {
      this._delay(function() {
        e.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(t)
      })
    }, keydown:"_keydown"}), this.refresh(), this._on(this.document, {click:function(t) {
      e(t.target).closest(".ui-menu").length || this.collapseAll(t), n = !1
    }})
  }, _destroy:function() {
    this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(), this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function() {
      var t = e(this);
      t.data("ui-menu-submenu-carat") && t.remove()
    }), this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")
  }, _keydown:function(t) {
    function a(e) {
      return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
    }
    var n, r, i, s, o, u = !0;
    switch(t.keyCode) {
      case e.ui.keyCode.PAGE_UP:
        this.previousPage(t);
        break;
      case e.ui.keyCode.PAGE_DOWN:
        this.nextPage(t);
        break;
      case e.ui.keyCode.HOME:
        this._move("first", "first", t);
        break;
      case e.ui.keyCode.END:
        this._move("last", "last", t);
        break;
      case e.ui.keyCode.UP:
        this.previous(t);
        break;
      case e.ui.keyCode.DOWN:
        this.next(t);
        break;
      case e.ui.keyCode.LEFT:
        this.collapse(t);
        break;
      case e.ui.keyCode.RIGHT:
        this.active && !this.active.is(".ui-state-disabled") && this.expand(t);
        break;
      case e.ui.keyCode.ENTER:
      ;
      case e.ui.keyCode.SPACE:
        this._activate(t);
        break;
      case e.ui.keyCode.ESCAPE:
        this.collapse(t);
        break;
      default:
        u = !1, r = this.previousFilter || "", i = String.fromCharCode(t.keyCode), s = !1, clearTimeout(this.filterTimer), i === r ? s = !0 : i = r + i, o = new RegExp("^" + a(i), "i"), n = this.activeMenu.children(".ui-menu-item").filter(function() {
          return o.test(e(this).children("a").text())
        }), n = s && n.index(this.active.next()) !== -1 ? this.active.nextAll(".ui-menu-item") : n, n.length || (i = String.fromCharCode(t.keyCode), o = new RegExp("^" + a(i), "i"), n = this.activeMenu.children(".ui-menu-item").filter(function() {
          return o.test(e(this).children("a").text())
        })), n.length ? (this.focus(t, n), n.length > 1 ? (this.previousFilter = i, this.filterTimer = this._delay(function() {
          delete this.previousFilter
        }, 1E3)) : delete this.previousFilter) : delete this.previousFilter
    }
    u && t.preventDefault()
  }, _activate:function(e) {
    this.active.is(".ui-state-disabled") || (this.active.children("a[aria-haspopup='true']").length ? this.expand(e) : this.select(e))
  }, refresh:function() {
    var t, n = this.options.icons.submenu, r = this.element.find(this.options.menus);
    r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role, "aria-hidden":"true", "aria-expanded":"false"}).each(function() {
      var t = e(this), r = t.prev("a"), i = e("<span>").addClass("ui-menu-icon ui-icon " + n).data("ui-menu-submenu-carat", !0);
      r.attr("aria-haspopup", "true").prepend(i), t.attr("aria-labelledby", r.attr("id"))
    }), t = r.add(this.element), t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role", "presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1, role:this._itemRole()}), t.children(":not(.ui-menu-item)").each(function() {
      var t = e(this);
      /[^\-\u2014\u2013\s]/.test(t.text()) || t.addClass("ui-widget-content ui-menu-divider")
    }), t.children(".ui-state-disabled").attr("aria-disabled", "true"), this.active && !e.contains(this.element[0], this.active[0]) && this.blur()
  }, _itemRole:function() {
    return{menu:"menuitem", listbox:"option"}[this.options.role]
  }, focus:function(e, t) {
    var n, r;
    this.blur(e, e && e.type === "focus"), this._scrollIntoView(t), this.active = t.first(), r = this.active.children("a").addClass("ui-state-focus"), this.options.role && this.element.attr("aria-activedescendant", r.attr("id")), this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"), e && e.type === "keydown" ? this._close() : this.timer = this._delay(function() {
      this._close()
    }, this.delay), n = t.children(".ui-menu"), n.length && /^mouse/.test(e.type) && this._startOpening(n), this.activeMenu = t.parent(), this._trigger("focus", e, {item:t})
  }, _scrollIntoView:function(t) {
    var n, r, i, s, o, u;
    this._hasScroll() && (n = parseFloat(e.css(this.activeMenu[0], "borderTopWidth")) || 0, r = parseFloat(e.css(this.activeMenu[0], "paddingTop")) || 0, i = t.offset().top - this.activeMenu.offset().top - n - r, s = this.activeMenu.scrollTop(), o = this.activeMenu.height(), u = t.height(), i < 0 ? this.activeMenu.scrollTop(s + i) : i + u > o && this.activeMenu.scrollTop(s + i - o + u))
  }, blur:function(e, t) {
    t || clearTimeout(this.timer);
    if(!this.active) {
      return
    }
    this.active.children("a").removeClass("ui-state-focus"), this.active = null, this._trigger("blur", e, {item:this.active})
  }, _startOpening:function(e) {
    clearTimeout(this.timer);
    if(e.attr("aria-hidden") !== "true") {
      return
    }
    this.timer = this._delay(function() {
      this._close(), this._open(e)
    }, this.delay)
  }, _open:function(t) {
    var n = e.extend({of:this.active}, this.options.position);
    clearTimeout(this.timer), this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden", "true"), t.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(n)
  }, collapseAll:function(t, n) {
    clearTimeout(this.timer), this.timer = this._delay(function() {
      var r = n ? this.element : e(t && t.target).closest(this.element.find(".ui-menu"));
      r.length || (r = this.element), this._close(r), this.blur(t), this.activeMenu = r
    }, this.delay)
  }, _close:function(e) {
    e || (e = this.active ? this.active.parent() : this.element), e.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false").end().find("a.ui-state-active").removeClass("ui-state-active")
  }, collapse:function(e) {
    var t = this.active && this.active.parent().closest(".ui-menu-item", this.element);
    t && t.length && (this._close(), this.focus(e, t))
  }, expand:function(e) {
    var t = this.active && this.active.children(".ui-menu ").children(".ui-menu-item").first();
    t && t.length && (this._open(t.parent()), this._delay(function() {
      this.focus(e, t)
    }))
  }, next:function(e) {
    this._move("next", "first", e)
  }, previous:function(e) {
    this._move("prev", "last", e)
  }, isFirstItem:function() {
    return this.active && !this.active.prevAll(".ui-menu-item").length
  }, isLastItem:function() {
    return this.active && !this.active.nextAll(".ui-menu-item").length
  }, _move:function(e, t, n) {
    var r;
    this.active && (e === "first" || e === "last" ? r = this.active[e === "first" ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : r = this.active[e + "All"](".ui-menu-item").eq(0));
    if(!r || !r.length || !this.active) {
      r = this.activeMenu.children(".ui-menu-item")[t]()
    }
    this.focus(n, r)
  }, nextPage:function(t) {
    var n, r, i;
    if(!this.active) {
      this.next(t);
      return
    }
    if(this.isLastItem()) {
      return
    }
    this._hasScroll() ? (r = this.active.offset().top, i = this.element.height(), this.active.nextAll(".ui-menu-item").each(function() {
      return n = e(this), n.offset().top - r - i < 0
    }), this.focus(t, n)) : this.focus(t, this.activeMenu.children(".ui-menu-item")[this.active ? "last" : "first"]())
  }, previousPage:function(t) {
    var n, r, i;
    if(!this.active) {
      this.next(t);
      return
    }
    if(this.isFirstItem()) {
      return
    }
    this._hasScroll() ? (r = this.active.offset().top, i = this.element.height(), this.active.prevAll(".ui-menu-item").each(function() {
      return n = e(this), n.offset().top - r + i > 0
    }), this.focus(t, n)) : this.focus(t, this.activeMenu.children(".ui-menu-item").first())
  }, _hasScroll:function() {
    return this.element.outerHeight() < this.element.prop("scrollHeight")
  }, select:function(t) {
    this.active = this.active || e(t.target).closest(".ui-menu-item");
    var n = {item:this.active};
    this.active.has(".ui-menu").length || this.collapseAll(t, !0), this._trigger("select", t, n)
  }})
})(jQuery);
(function(e, t) {
  var n = 5;
  e.widget("ui.slider", e.ui.mouse, {version:"1.9.2", widgetEventPrefix:"slide", options:{animate:!1, distance:0, max:100, min:0, orientation:"horizontal", range:!1, step:1, value:0, values:null}, _create:function() {
    var t, r, i = this.options, s = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"), o = "<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>", u = [];
    this._keySliding = !1, this._mouseSliding = !1, this._animateOff = !0, this._handleIndex = null, this._detectOrientation(), this._mouseInit(), this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget" + " ui-widget-content" + " ui-corner-all" + (i.disabled ? " ui-slider-disabled ui-disabled" : "")), this.range = e([]), i.range && (i.range === !0 && (i.values || (i.values = [this._valueMin(), this._valueMin()]), i.values.length && i.values.length !== 2 && (i.values = [i.values[0], 
    i.values[0]])), this.range = e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header" + (i.range === "min" || i.range === "max" ? " ui-slider-range-" + i.range : ""))), r = i.values && i.values.length || 1;
    for(t = s.length;t < r;t++) {
      u.push(o)
    }
    this.handles = s.add(e(u.join("")).appendTo(this.element)), this.handle = this.handles.eq(0), this.handles.add(this.range).filter("a").click(function(e) {
      e.preventDefault()
    }).mouseenter(function() {
      i.disabled || e(this).addClass("ui-state-hover")
    }).mouseleave(function() {
      e(this).removeClass("ui-state-hover")
    }).focus(function() {
      i.disabled ? e(this).blur() : (e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"), e(this).addClass("ui-state-focus"))
    }).blur(function() {
      e(this).removeClass("ui-state-focus")
    }), this.handles.each(function(t) {
      e(this).data("ui-slider-handle-index", t)
    }), this._on(this.handles, {keydown:function(t) {
      var r, i, s, o, u = e(t.target).data("ui-slider-handle-index");
      switch(t.keyCode) {
        case e.ui.keyCode.HOME:
        ;
        case e.ui.keyCode.END:
        ;
        case e.ui.keyCode.PAGE_UP:
        ;
        case e.ui.keyCode.PAGE_DOWN:
        ;
        case e.ui.keyCode.UP:
        ;
        case e.ui.keyCode.RIGHT:
        ;
        case e.ui.keyCode.DOWN:
        ;
        case e.ui.keyCode.LEFT:
          t.preventDefault();
          if(!this._keySliding) {
            this._keySliding = !0, e(t.target).addClass("ui-state-active"), r = this._start(t, u);
            if(r === !1) {
              return
            }
          }
      }
      o = this.options.step, this.options.values && this.options.values.length ? i = s = this.values(u) : i = s = this.value();
      switch(t.keyCode) {
        case e.ui.keyCode.HOME:
          s = this._valueMin();
          break;
        case e.ui.keyCode.END:
          s = this._valueMax();
          break;
        case e.ui.keyCode.PAGE_UP:
          s = this._trimAlignValue(i + (this._valueMax() - this._valueMin()) / n);
          break;
        case e.ui.keyCode.PAGE_DOWN:
          s = this._trimAlignValue(i - (this._valueMax() - this._valueMin()) / n);
          break;
        case e.ui.keyCode.UP:
        ;
        case e.ui.keyCode.RIGHT:
          if(i === this._valueMax()) {
            return
          }
          s = this._trimAlignValue(i + o);
          break;
        case e.ui.keyCode.DOWN:
        ;
        case e.ui.keyCode.LEFT:
          if(i === this._valueMin()) {
            return
          }
          s = this._trimAlignValue(i - o)
      }
      this._slide(t, u, s)
    }, keyup:function(t) {
      var n = e(t.target).data("ui-slider-handle-index");
      this._keySliding && (this._keySliding = !1, this._stop(t, n), this._change(t, n), e(t.target).removeClass("ui-state-active"))
    }}), this._refreshValue(), this._animateOff = !1
  }, _destroy:function() {
    this.handles.remove(), this.range.remove(), this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"), this._mouseDestroy()
  }, _mouseCapture:function(t) {
    var n, r, i, s, o, u, a, f, l = this, c = this.options;
    return c.disabled ? !1 : (this.elementSize = {width:this.element.outerWidth(), height:this.element.outerHeight()}, this.elementOffset = this.element.offset(), n = {x:t.pageX, y:t.pageY}, r = this._normValueFromMouse(n), i = this._valueMax() - this._valueMin() + 1, this.handles.each(function(t) {
      var n = Math.abs(r - l.values(t));
      i > n && (i = n, s = e(this), o = t)
    }), c.range === !0 && this.values(1) === c.min && (o += 1, s = e(this.handles[o])), u = this._start(t, o), u === !1 ? !1 : (this._mouseSliding = !0, this._handleIndex = o, s.addClass("ui-state-active").focus(), a = s.offset(), f = !e(t.target).parents().andSelf().is(".ui-slider-handle"), this._clickOffset = f ? {left:0, top:0} : {left:t.pageX - a.left - s.width() / 2, top:t.pageY - a.top - s.height() / 2 - (parseInt(s.css("borderTopWidth"), 10) || 0) - (parseInt(s.css("borderBottomWidth"), 10) || 
    0) + (parseInt(s.css("marginTop"), 10) || 0)}, this.handles.hasClass("ui-state-hover") || this._slide(t, o, r), this._animateOff = !0, !0))
  }, _mouseStart:function() {
    return!0
  }, _mouseDrag:function(e) {
    var t = {x:e.pageX, y:e.pageY}, n = this._normValueFromMouse(t);
    return this._slide(e, this._handleIndex, n), !1
  }, _mouseStop:function(e) {
    return this.handles.removeClass("ui-state-active"), this._mouseSliding = !1, this._stop(e, this._handleIndex), this._change(e, this._handleIndex), this._handleIndex = null, this._clickOffset = null, this._animateOff = !1, !1
  }, _detectOrientation:function() {
    this.orientation = this.options.orientation === "vertical" ? "vertical" : "horizontal"
  }, _normValueFromMouse:function(e) {
    var t, n, r, i, s;
    return this.orientation === "horizontal" ? (t = this.elementSize.width, n = e.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (t = this.elementSize.height, n = e.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)), r = n / t, r > 1 && (r = 1), r < 0 && (r = 0), this.orientation === "vertical" && (r = 1 - r), i = this._valueMax() - this._valueMin(), s = this._valueMin() + r * i, this._trimAlignValue(s)
  }, _start:function(e, t) {
    var n = {handle:this.handles[t], value:this.value()};
    return this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._trigger("start", e, n)
  }, _slide:function(e, t, n) {
    var r, i, s;
    this.options.values && this.options.values.length ? (r = this.values(t ? 0 : 1), this.options.values.length === 2 && this.options.range === !0 && (t === 0 && n > r || t === 1 && n < r) && (n = r), n !== this.values(t) && (i = this.values(), i[t] = n, s = this._trigger("slide", e, {handle:this.handles[t], value:n, values:i}), r = this.values(t ? 0 : 1), s !== !1 && this.values(t, n, !0))) : n !== this.value() && (s = this._trigger("slide", e, {handle:this.handles[t], value:n}), s !== !1 && this.value(n))
  }, _stop:function(e, t) {
    var n = {handle:this.handles[t], value:this.value()};
    this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._trigger("stop", e, n)
  }, _change:function(e, t) {
    if(!this._keySliding && !this._mouseSliding) {
      var n = {handle:this.handles[t], value:this.value()};
      this.options.values && this.options.values.length && (n.value = this.values(t), n.values = this.values()), this._trigger("change", e, n)
    }
  }, value:function(e) {
    if(arguments.length) {
      this.options.value = this._trimAlignValue(e), this._refreshValue(), this._change(null, 0);
      return
    }
    return this._value()
  }, values:function(t, n) {
    var r, i, s;
    if(arguments.length > 1) {
      this.options.values[t] = this._trimAlignValue(n), this._refreshValue(), this._change(null, t);
      return
    }
    if(!arguments.length) {
      return this._values()
    }
    if(!e.isArray(arguments[0])) {
      return this.options.values && this.options.values.length ? this._values(t) : this.value()
    }
    r = this.options.values, i = arguments[0];
    for(s = 0;s < r.length;s += 1) {
      r[s] = this._trimAlignValue(i[s]), this._change(null, s)
    }
    this._refreshValue()
  }, _setOption:function(t, n) {
    var r, i = 0;
    e.isArray(this.options.values) && (i = this.options.values.length), e.Widget.prototype._setOption.apply(this, arguments);
    switch(t) {
      case "disabled":
        n ? (this.handles.filter(".ui-state-focus").blur(), this.handles.removeClass("ui-state-hover"), this.handles.prop("disabled", !0), this.element.addClass("ui-disabled")) : (this.handles.prop("disabled", !1), this.element.removeClass("ui-disabled"));
        break;
      case "orientation":
        this._detectOrientation(), this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation), this._refreshValue();
        break;
      case "value":
        this._animateOff = !0, this._refreshValue(), this._change(null, 0), this._animateOff = !1;
        break;
      case "values":
        this._animateOff = !0, this._refreshValue();
        for(r = 0;r < i;r += 1) {
          this._change(null, r)
        }
        this._animateOff = !1;
        break;
      case "min":
      ;
      case "max":
        this._animateOff = !0, this._refreshValue(), this._animateOff = !1
    }
  }, _value:function() {
    var e = this.options.value;
    return e = this._trimAlignValue(e), e
  }, _values:function(e) {
    var t, n, r;
    if(arguments.length) {
      return t = this.options.values[e], t = this._trimAlignValue(t), t
    }
    n = this.options.values.slice();
    for(r = 0;r < n.length;r += 1) {
      n[r] = this._trimAlignValue(n[r])
    }
    return n
  }, _trimAlignValue:function(e) {
    if(e <= this._valueMin()) {
      return this._valueMin()
    }
    if(e >= this._valueMax()) {
      return this._valueMax()
    }
    var t = this.options.step > 0 ? this.options.step : 1, n = (e - this._valueMin()) % t, r = e - n;
    return Math.abs(n) * 2 >= t && (r += n > 0 ? t : -t), parseFloat(r.toFixed(5))
  }, _valueMin:function() {
    return this.options.min
  }, _valueMax:function() {
    return this.options.max
  }, _refreshValue:function() {
    var t, n, r, i, s, o = this.options.range, u = this.options, a = this, f = this._animateOff ? !1 : u.animate, l = {};
    this.options.values && this.options.values.length ? this.handles.each(function(r) {
      n = (a.values(r) - a._valueMin()) / (a._valueMax() - a._valueMin()) * 100, l[a.orientation === "horizontal" ? "left" : "bottom"] = n + "%", e(this).stop(1, 1)[f ? "animate" : "css"](l, u.animate), a.options.range === !0 && (a.orientation === "horizontal" ? (r === 0 && a.range.stop(1, 1)[f ? "animate" : "css"]({left:n + "%"}, u.animate), r === 1 && a.range[f ? "animate" : "css"]({width:n - t + "%"}, {queue:!1, duration:u.animate})) : (r === 0 && a.range.stop(1, 1)[f ? "animate" : "css"]({bottom:n + 
      "%"}, u.animate), r === 1 && a.range[f ? "animate" : "css"]({height:n - t + "%"}, {queue:!1, duration:u.animate}))), t = n
    }) : (r = this.value(), i = this._valueMin(), s = this._valueMax(), n = s !== i ? (r - i) / (s - i) * 100 : 0, l[this.orientation === "horizontal" ? "left" : "bottom"] = n + "%", this.handle.stop(1, 1)[f ? "animate" : "css"](l, u.animate), o === "min" && this.orientation === "horizontal" && this.range.stop(1, 1)[f ? "animate" : "css"]({width:n + "%"}, u.animate), o === "max" && this.orientation === "horizontal" && this.range[f ? "animate" : "css"]({width:100 - n + "%"}, {queue:!1, duration:u.animate}), 
    o === "min" && this.orientation === "vertical" && this.range.stop(1, 1)[f ? "animate" : "css"]({height:n + "%"}, u.animate), o === "max" && this.orientation === "vertical" && this.range[f ? "animate" : "css"]({height:100 - n + "%"}, {queue:!1, duration:u.animate}))
  }})
})(jQuery);
eval(function(p, a, c, k, e, r) {
  e = function(c) {
    return(c < a ? "" : e(parseInt(c / a))) + ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c.toString(36))
  };
  if(!"".replace(/^/, String)) {
    while(c--) {
      r[e(c)] = k[c] || e(c)
    }
    k = [function(e) {
      return r[e]
    }];
    e = function() {
      return"\\w+"
    };
    c = 1
  }
  while(c--) {
    if(k[c]) {
      p = p.replace(new RegExp("\\b" + e(c) + "\\b", "g"), k[c])
    }
  }
  return p
}("(D($){8($.1s.1v){H}$.1s.6i=$.1s.1v=D(u,w){8(1l.S==0){18(J,'6j 55 6k 1j \"'+1l.4o+'\".');H 1l}8(1l.S>1){H 1l.1W(D(){$(1l).1v(u,w)})}F y=1l,$12=1l[0],56=L;8(y.1q('57')){56=y.1P('3o','4p');y.T('3o',['4q',J])}F z={};z.59=D(o,a,b){o=3S($12,o);o.E=6l($12,o.E);o.1K=6m($12,o.1K);o.N=6n($12,o.N);o.14=5a($12,o.14);o.16=5a($12,o.16);o.1b=6o($12,o.1b);o.1r=6p($12,o.1r);o.1Q=6q($12,o.1Q);8(a){31=$.1L(J,{},$.1s.1v.5b,o)}7=$.1L(J,{},$.1s.1v.5b,o);7.d=6r(7);A.2l=(7.2l=='5c'||7.2l=='1m')?'16':'14';F c=y.13(),2m=5d($1n,7,'P');8(3p(7.25)){7.25='7Q'+G.3T}7.3U=5e(7,2m);7.E=6s(7.E,7,c,b);7[7.d['P']]=6t(7[7.d['P']],7,c);7[7.d['1e']]=6u(7[7.d['1e']],7,c);8(7.2H){8(!3V(7[7.d['P']])){7[7.d['P']]='2I%'}}8(3V(7[7.d['P']])){A.6v=J;A.4r=7[7.d['P']];7[7.d['P']]=4s(2m,A.4r);8(!7.E.M){7.E.U.1d=J}}8(7.2H){7.1R=L;7.1i=[0,0,0,0];7.1B=L;7.E.U.1d=L}O{8(!7.E.M){7=6w(7,2m)}8(!7[7.d['P']]){8(!7.E.U.1d&&Y(7.E[7.d['P']])&&7.E.1t=='*'){7[7.d['P']]=7.E.M*7.E[7.d['P']];7.1B=L}O{7[7.d['P']]='1d'}}8(1z(7.1B)){7.1B=(Y(7[7.d['P']]))?'5f':L}8(7.E.U.1d){7.E.M=32(c,7,0)}}8(7.E.1t!='*'&&!7.E.U.1d){7.E.U.4t=7.E.M;7.E.M=3W(c,7,0)}7.E.M=2x(7.E.M,7,7.E.U.2c,$12);7.E.U.20=7.E.M;8(7.2H){8(!7.E.U.34){7.E.U.34=7.E.M}8(!7.E.U.1X){7.E.U.1X=7.E.M}7=5g(7,c,2m)}O{7.1i=6x(7.1i);8(7.1B=='3q'){7.1B='1m'}O 8(7.1B=='5h'){7.1B='35'}1F(7.1B){R'5f':R'1m':R'35':8(7[7.d['P']]!='1d'){7=5i(7,c);7.1R=J}17;2J:7.1B=L;7.1R=(7.1i[0]==0&&7.1i[1]==0&&7.1i[2]==0&&7.1i[3]==0)?L:J;17}}8(!Y(7.1K.1M)){7.1K.1M=6y}8(1z(7.1K.E)){7.1K.E=(7.2H||7.E.U.1d||7.E.1t!='*')?'M':7.E.M}7.N=$.1L(J,{},7.1K,7.N);7.14=$.1L(J,{},7.1K,7.14);7.16=$.1L(J,{},7.1K,7.16);7.1b=$.1L(J,{},7.1K,7.1b);7.N=6z($12,7.N);7.14=5j($12,7.14);7.16=5j($12,7.16);7.1b=6A($12,7.1b);7.1r=6B($12,7.1r);7.1Q=6C($12,7.1Q);8(7.2n){7.2n=5k(7.2n)}8(7.N.5l){7.N.4u=7.N.5l;3X('N.5l','N.4u')}8(7.N.5m){7.N.4v=7.N.5m;3X('N.5m','N.4v')}8(7.N.5n){7.N.4w=7.N.5n;3X('N.5n','N.4w')}8(7.N.5o){7.N.2K=7.N.5o;3X('N.5o','N.2K')}};z.6D=D(){y.1q('57',J);F a=y.13(),3Y=6E(y,['6F','6G','3r','3q','35','5h','1m','3Z','P','1e','6H','1S','5p','6I']),5q='7R';1F(3Y.3r){R'6J':R'7S':5q=3Y.3r;17}8(G.3s=='36'){41($1n)}O{$1n.Z(3Y)}$1n.Z({'7T':'3t','3r':5q});41(y);y.1q('6K',3Y.3Z);y.Z({'6F':'1m','6G':'42','3r':'6J','3q':0,'35':'N','5h':'N','1m':0,'6H':0,'1S':0,'5p':0,'6I':0});4x(a,7);41(a);8(7.2H){5r(7,a)}};z.6L=D(){z.5s();y.11(I('6M',G),D(e,a){e.1g();8(!A.2d){8(7.N.W){7.N.W.3a(2y('4y',G))}}A.2d=J;8(7.N.1G){7.N.1G=L;y.T(I('3b',G),a)}H J});y.11(I('5t',G),D(e){e.1g();8(A.26){43(V)}H J});y.11(I('3b',G),D(e,a,b){e.1g();1u=3u(1u);8(a&&A.26){V.2d=J;F c=2o()-V.2L;V.1M-=c;8(V.4z){V.4z.1M-=c}8(V.4A){V.4A.1M-=c}43(V,L)}8(!A.27&&!A.26){8(b){1u.3v+=2o()-1u.2L}}8(!A.27){8(7.N.W){7.N.W.3a(2y('6N',G))}}A.27=J;8(7.N.4v){F d=7.N.2K-1u.3v,3c=2I-1H.2z(d*2I/7.N.2K);7.N.4v.1h($12,3c,d)}H J});y.11(I('1G',G),D(e,b,c,d){e.1g();1u=3u(1u);F v=[b,c,d],t=['2M','28','3d'],a=3e(v,t);b=a[0];c=a[1];d=a[2];8(b!='14'&&b!='16'){b=A.2l}8(!Y(c)){c=0}8(!1k(d)){d=L}8(d){A.2d=L;7.N.1G=J}8(!7.N.1G){e.2e();H 18(G,'3w 4y: 2p 3f.')}8(A.27){8(7.N.W){7.N.W.2N(2y('4y',G));7.N.W.2N(2y('6N',G))}}A.27=L;1u.2L=2o();F f=7.N.2K+c;44=f-1u.3v;3c=2I-1H.2z(44*2I/f);8(7.N.1f){1u.1f=7U(D(){F a=2o()-1u.2L+1u.3v,3c=1H.2z(a*2I/f);7.N.1f.4B.1h(7.N.1f.2q[0],3c)},7.N.1f.5u)}1u.N=7V(D(){8(7.N.1f){7.N.1f.4B.1h(7.N.1f.2q[0],2I)}8(7.N.4w){7.N.4w.1h($12,3c,44)}8(A.26){y.T(I('1G',G),b)}O{y.T(I(b,G),7.N)}},44);8(7.N.4u){7.N.4u.1h($12,3c,44)}H J});y.11(I('3g',G),D(e){e.1g();8(V.2d){V.2d=L;A.27=L;A.26=J;V.2L=2o();3x(V,G)}O{y.T(I('1G',G))}H J});y.11(I('14',G)+' '+I('16',G),D(e,b,f,g,h){e.1g();8(A.2d||y.2f(':3t')){e.2e();H 18(G,'3w 4y 7W 3t: 2p 3f.')}F i=(Y(7.E.4C))?7.E.4C:7.E.M+1;8(i>K.Q){e.2e();H 18(G,'2p 6O E ('+K.Q+' Q, '+i+' 6P): 2p 3f.')}F v=[b,f,g,h],t=['2A','28/2M','D','3d'],a=3e(v,t);b=a[0];f=a[1];g=a[2];h=a[3];F k=e.5v.19(G.3y.45.S);8(!1T(b)){b={}}8(1o(g)){b.3h=g}8(1k(h)){b.2O=h}b=$.1L(J,{},7[k],b);8(b.5w&&!b.5w.1h($12,k)){e.2e();H 18(G,'7X \"5w\" 7Y L.')}8(!Y(f)){8(7.E.1t!='*'){f='M'}O{F m=[f,b.E,7[k].E];1j(F a=0,l=m.S;a<l;a++){8(Y(m[a])||m[a]=='6Q'||m[a]=='M'){f=m[a];17}}}1F(f){R'6Q':e.2e();H y.1P(I(k+'7Z',G),[b,g]);17;R'M':8(!7.E.U.1d&&7.E.1t=='*'){f=7.E.M}17}}8(V.2d){y.T(I('3g',G));y.T(I('2O',G),[k,[b,f,g]]);e.2e();H 18(G,'3w 80 3f.')}8(b.1M>0){8(A.26){8(b.2O){8(b.2O=='2P'){2g=[]}8(b.2O!='X'||2g.S==0){y.T(I('2O',G),[k,[b,f,g]])}}e.2e();H 18(G,'3w 81 3f.')}}1u.3v=0;y.T(I('6R'+k,G),[b,f]);8(7.2n){F s=7.2n,c=[b,f];1j(F j=0,l=s.S;j<l;j++){F d=k;8(!s[j][2]){d=(d=='14')?'16':'14'}8(!s[j][1]){c[0]=s[j][0].1P('3o',['6S',d])}c[1]=f+s[j][3];s[j][0].T('3o',['6R'+d,c])}}H J});y.11(I('82',G),D(e,b,c){e.1g();F d=y.13();8(!7.1U){8(K.X==0){8(7.3z){y.T(I('16',G),K.Q-1)}H e.2e()}}1Y(d,7);8(!Y(c)){8(7.E.U.1d){c=4D(d,7,K.Q-1)}O 8(7.E.1t!='*'){F f=(Y(b.E))?b.E:5x(y,7);c=6T(d,7,K.Q-1,f)}O{c=7.E.M}c=4E(c,7,b.E,$12)}8(!7.1U){8(K.Q-c<K.X){c=K.Q-K.X}}7.E.U.20=7.E.M;8(7.E.U.1d){F g=2x(32(d,7,K.Q-c),7,7.E.U.2c,$12);8(7.E.M+c<=g&&c<K.Q){c++;g=2x(32(d,7,K.Q-c),7,7.E.U.2c,$12)}7.E.M=g}O 8(7.E.1t!='*'){F g=3W(d,7,K.Q-c);7.E.M=2x(g,7,7.E.U.2c,$12)}1Y(d,7,J);8(c==0){e.2e();H 18(G,'0 E 46 1K: 2p 3f.')}18(G,'6U '+c+' E 5y.');K.X+=c;2h(K.X>=K.Q){K.X-=K.Q}8(!7.1U){8(K.X==0&&b.4F){b.4F.1h($12,'14')}8(!7.3z){3A(7,K.X,G)}}y.13().19(K.Q-c,K.Q).83(y);8(K.Q<7.E.M+c){y.13().19(0,(7.E.M+c)-K.Q).4G(J).47(y)}F d=y.13(),3i=6V(d,7,c),2i=6W(d,7),1Z=d.1N(c-1),21=3i.2P(),2r=2i.2P();1Y(d,7);F h=0,2B=0;8(7.1B){F p=4H(2i,7);h=p[0];2B=p[1]}F i=(h<0)?7.1i[7.d[3]]:0;F j=L,2Q=$();8(7.E.M<c){2Q=d.19(7.E.U.20,c);8(b.1V=='6X'){F k=7.E[7.d['P']];j=2Q;1Z=2r;5z(j);7.E[7.d['P']]='1d'}}F l=L,3B=2R(d.19(0,c),7,'P'),2j=4I(4J(2i,7,J),7,!7.1R),3C=0,29={},4K={},2s={},2S={},4L={},2T={},5A={},2U=5B(b,7,c,3B);1F(b.1V){R'1I':R'1I-1w':3C=2R(d.19(0,7.E.M),7,'P');17}8(j){7.E[7.d['P']]=k}1Y(d,7,J);8(2B>=0){1Y(21,7,7.1i[7.d[1]])}8(h>=0){1Y(1Z,7,7.1i[7.d[3]])}8(7.1B){7.1i[7.d[1]]=2B;7.1i[7.d[3]]=h}2T[7.d['1m']]=-(3B-i);5A[7.d['1m']]=-(3C-i);4K[7.d['1m']]=2j[7.d['P']];F m=D(){},1O=D(){},1C=D(){},3D=D(){},2C=D(){},5C=D(){},1D=D(){},3E=D(){},1x=D(){},1y=D(){},1J=D(){};1F(b.1V){R'3j':R'1I':R'1I-1w':R'22':R'22-1w':l=y.4G(J).47($1n);17}1F(b.1V){R'3j':R'22':R'22-1w':l.13().19(0,c).2t();l.13().19(7.E.U.20).2t();17;R'1I':R'1I-1w':l.13().19(7.E.M).2t();l.Z(5A);17}y.Z(2T);V=48(2U,b.2u,G);29[7.d['1m']]=(7.1R)?7.1i[7.d[3]]:0;8(7[7.d['P']]=='1d'||7[7.d['1e']]=='1d'){m=D(){$1n.Z(2j)};1O=D(){V.1a.1c([$1n,2j])}}8(7.1R){8(2r.4M(1Z).S){2s[7.d['1S']]=1Z.1q('2a');8(h<0){1Z.Z(2s)}O{1D=D(){1Z.Z(2s)};3E=D(){V.1a.1c([1Z,2s])}}}1F(b.1V){R'1I':R'1I-1w':l.13().1N(c-1).Z(2s);17}8(2r.4M(21).S){2S[7.d['1S']]=21.1q('2a');1C=D(){21.Z(2S)};3D=D(){V.1a.1c([21,2S])}}8(2B>=0){4L[7.d['1S']]=2r.1q('2a')+7.1i[7.d[1]];2C=D(){2r.Z(4L)};5C=D(){V.1a.1c([2r,4L])}}}1J=D(){y.Z(29)};F n=7.E.M+c-K.Q;1y=D(){8(n>0){y.13().19(K.Q).2t();3i=$(y.13().19(K.Q-(7.E.M-n)).3F().6Y(y.13().19(0,n).3F()))}5D(j);8(7.1R){F a=y.13().1N(7.E.M+c-1);a.Z(7.d['1S'],a.1q('2a'))}};F o=5E(3i,2Q,2i,c,'14',2U,2j);1x=D(){5F(y,l,b);A.26=L;2b.3h=4a($12,b,'3h',o,2b);2g=5G(y,2g,G);8(!A.27){y.T(I('1G',G))}};A.26=J;1u=3u(1u);2b.3G=4a($12,b,'3G',o,2b);1F(b.1V){R'42':y.Z(29);m();1C();2C();1D();1J();1y();1x();17;R'1w':V.1a.1c([y,{'1E':0},D(){m();1C();2C();1D();1J();1y();V=48(2U,b.2u,G);V.1a.1c([y,{'1E':1},1x]);3x(V,G)}]);17;R'3j':y.Z({'1E':0});V.1a.1c([l,{'1E':0}]);V.1a.1c([y,{'1E':1},1x]);1O();1C();2C();1D();1J();1y();17;R'1I':V.1a.1c([l,29,D(){1C();2C();1D();1J();1y();1x()}]);1O();17;R'1I-1w':V.1a.1c([y,{'1E':0}]);V.1a.1c([l,29,D(){y.Z({'1E':1});1C();2C();1D();1J();1y();1x()}]);1O();17;R'22':V.1a.1c([l,4K,1x]);1O();1C();2C();1D();1J();1y();17;R'22-1w':y.Z({'1E':0});V.1a.1c([y,{'1E':1}]);V.1a.1c([l,4K,1x]);1O();1C();2C();1D();1J();1y();17;2J:V.1a.1c([y,29,D(){1y();1x()}]);1O();3D();5C();3E();17}3x(V,G);5H(7.25,y,G);y.T(I('3H',G),[L,2j]);H J});y.11(I('84',G),D(e,c,d){e.1g();F f=y.13();8(!7.1U){8(K.X==7.E.M){8(7.3z){y.T(I('14',G),K.Q-1)}H e.2e()}}1Y(f,7);8(!Y(d)){8(7.E.1t!='*'){F g=(Y(c.E))?c.E:5x(y,7);d=6Z(f,7,0,g)}O{d=7.E.M}d=4E(d,7,c.E,$12)}F h=(K.X==0)?K.Q:K.X;8(!7.1U){8(7.E.U.1d){F i=32(f,7,d),g=4D(f,7,h-1)}O{F i=7.E.M,g=7.E.M}8(d+i>h){d=h-g}}7.E.U.20=7.E.M;8(7.E.U.1d){F i=2x(5I(f,7,d,h),7,7.E.U.2c,$12);2h(7.E.M-d>=i&&d<K.Q){d++;i=2x(5I(f,7,d,h),7,7.E.U.2c,$12)}7.E.M=i}O 8(7.E.1t!='*'){F i=3W(f,7,d);7.E.M=2x(i,7,7.E.U.2c,$12)}1Y(f,7,J);8(d==0){e.2e();H 18(G,'0 E 46 1K: 2p 3f.')}18(G,'6U '+d+' E 70.');K.X-=d;2h(K.X<0){K.X+=K.Q}8(!7.1U){8(K.X==7.E.M&&c.4F){c.4F.1h($12,'16')}8(!7.3z){3A(7,K.X,G)}}8(K.Q<7.E.M+d){y.13().19(0,(7.E.M+d)-K.Q).4G(J).47(y)}F f=y.13(),3i=71(f,7),2i=72(f,7,d),1Z=f.1N(d-1),21=3i.2P(),2r=2i.2P();1Y(f,7);F j=0,2B=0;8(7.1B){F p=4H(2i,7);j=p[0];2B=p[1]}F k=L,2Q=$();8(7.E.U.20<d){2Q=f.19(7.E.U.20,d);8(c.1V=='6X'){F l=7.E[7.d['P']];k=2Q;1Z=21;5z(k);7.E[7.d['P']]='1d'}}F m=L,3B=2R(f.19(0,d),7,'P'),2j=4I(4J(2i,7,J),7,!7.1R),3C=0,29={},4N={},2s={},2S={},2T={},2U=5B(c,7,d,3B);1F(c.1V){R'22':R'22-1w':3C=2R(f.19(0,7.E.U.20),7,'P');17}8(k){7.E[7.d['P']]=l}8(7.1B){8(7.1i[7.d[1]]<0){7.1i[7.d[1]]=0}}1Y(f,7,J);1Y(21,7,7.1i[7.d[1]]);8(7.1B){7.1i[7.d[1]]=2B;7.1i[7.d[3]]=j}2T[7.d['1m']]=(7.1R)?7.1i[7.d[3]]:0;F n=D(){},1O=D(){},1C=D(){},3D=D(){},1D=D(){},3E=D(){},1x=D(){},1y=D(){},1J=D(){};1F(c.1V){R'3j':R'1I':R'1I-1w':R'22':R'22-1w':m=y.4G(J).47($1n);m.13().19(7.E.U.20).2t();17}1F(c.1V){R'3j':R'1I':R'1I-1w':y.Z('3Z',1);m.Z('3Z',0);17}V=48(2U,c.2u,G);29[7.d['1m']]=-3B;4N[7.d['1m']]=-3C;8(j<0){29[7.d['1m']]+=j}8(7[7.d['P']]=='1d'||7[7.d['1e']]=='1d'){n=D(){$1n.Z(2j)};1O=D(){V.1a.1c([$1n,2j])}}8(7.1R){F o=2r.1q('2a');8(2B>=0){o+=7.1i[7.d[1]]}2r.Z(7.d['1S'],o);8(1Z.4M(21).S){2S[7.d['1S']]=21.1q('2a')}1C=D(){21.Z(2S)};3D=D(){V.1a.1c([21,2S])};F q=1Z.1q('2a');8(j>0){q+=7.1i[7.d[3]]}2s[7.d['1S']]=q;1D=D(){1Z.Z(2s)};3E=D(){V.1a.1c([1Z,2s])}}1J=D(){y.Z(2T)};F r=7.E.M+d-K.Q;1y=D(){8(r>0){y.13().19(K.Q).2t()}F a=y.13().19(0,d).47(y).2P();8(r>0){2i=3I(f,7)}5D(k);8(7.1R){8(K.Q<7.E.M+d){F b=y.13().1N(7.E.M-1);b.Z(7.d['1S'],b.1q('2a')+7.1i[7.d[1]])}a.Z(7.d['1S'],a.1q('2a'))}};F s=5E(3i,2Q,2i,d,'16',2U,2j);1x=D(){y.Z('3Z',y.1q('6K'));5F(y,m,c);A.26=L;2b.3h=4a($12,c,'3h',s,2b);2g=5G(y,2g,G);8(!A.27){y.T(I('1G',G))}};A.26=J;1u=3u(1u);2b.3G=4a($12,c,'3G',s,2b);1F(c.1V){R'42':y.Z(29);n();1C();1D();1J();1y();1x();17;R'1w':V.1a.1c([y,{'1E':0},D(){n();1C();1D();1J();1y();V=48(2U,c.2u,G);V.1a.1c([y,{'1E':1},1x]);3x(V,G)}]);17;R'3j':y.Z({'1E':0});V.1a.1c([m,{'1E':0}]);V.1a.1c([y,{'1E':1},1x]);1O();1C();1D();1J();1y();17;R'1I':y.Z(7.d['1m'],$1n[7.d['P']]());V.1a.1c([y,2T,1x]);1O();1C();1D();1y();17;R'1I-1w':y.Z(7.d['1m'],$1n[7.d['P']]());V.1a.1c([m,{'1E':0}]);V.1a.1c([y,2T,1x]);1O();1C();1D();1y();17;R'22':V.1a.1c([m,4N,1x]);1O();1C();1D();1J();1y();17;R'22-1w':y.Z({'1E':0});V.1a.1c([y,{'1E':1}]);V.1a.1c([m,4N,1x]);1O();1C();1D();1J();1y();17;2J:V.1a.1c([y,29,D(){1J();1y();1x()}]);1O();3D();3E();17}3x(V,G);5H(7.25,y,G);y.T(I('3H',G),[L,2j]);H J});y.11(I('3k',G),D(e,b,c,d,f,g,h){e.1g();F v=[b,c,d,f,g,h],t=['2M/28/2A','28','3d','2A','2M','D'],a=3e(v,t);f=a[3];g=a[4];h=a[5];b=3J(a[0],a[1],a[2],K,y);8(b==0){H L}8(!1T(f)){f=L}8(g!='14'&&g!='16'){8(7.1U){g=(b<=K.Q/2)?'16':'14'}O{g=(K.X==0||K.X>b)?'16':'14'}}8(g=='14'){b=K.Q-b}y.T(I(g,G),[f,b,h]);H J});y.11(I('85',G),D(e,a,b){e.1g();F c=y.1P(I('4b',G));H y.1P(I('5J',G),[c-1,a,'14',b])});y.11(I('86',G),D(e,a,b){e.1g();F c=y.1P(I('4b',G));H y.1P(I('5J',G),[c+1,a,'16',b])});y.11(I('5J',G),D(e,a,b,c,d){e.1g();8(!Y(a)){a=y.1P(I('4b',G))}F f=7.1b.E||7.E.M,1X=1H.2z(K.Q/f)-1;8(a<0){a=1X}8(a>1X){a=0}H y.1P(I('3k',G),[a*f,0,J,b,c,d])});y.11(I('73',G),D(e,s){e.1g();8(s){s=3J(s,0,J,K,y)}O{s=0}s+=K.X;8(s!=0){8(K.Q>0){2h(s>K.Q){s-=K.Q}}y.87(y.13().19(s,K.Q))}H J});y.11(I('2n',G),D(e,s){e.1g();8(s){s=5k(s)}O 8(7.2n){s=7.2n}O{H 18(G,'6j 88 46 2n.')}F n=y.1P(I('4p',G)),x=J;1j(F j=0,l=s.S;j<l;j++){8(!s[j][0].1P(I('3k',G),[n,s[j][3],J])){x=L}}H x});y.11(I('2O',G),D(e,a,b){e.1g();8(1o(a)){a.1h($12,2g)}O 8(2V(a)){2g=a}O 8(!1z(a)){2g.1c([a,b])}H 2g});y.11(I('89',G),D(e,b,c,d,f){e.1g();F v=[b,c,d,f],t=['2M/2A','2M/28/2A','3d','28'],a=3e(v,t);b=a[0];c=a[1];d=a[2];f=a[3];8(1T(b)&&!2v(b)){b=$(b)}O 8(1p(b)){b=$(b)}8(!2v(b)||b.S==0){H 18(G,'2p a 5K 2A.')}8(1z(c)){c='4c'}4x(b,7);41(b);F g=c,4d='4d';8(c=='4c'){8(d){8(K.X==0){c=K.Q-1;4d='74'}O{c=K.X;K.X+=b.S}8(c<0){c=0}}O{c=K.Q-1;4d='74'}}O{c=3J(c,f,d,K,y)}F h=y.13().1N(c);8(h.S){h[4d](b)}O{18(G,'8a 8b-3r 4M 6k! 8c 8d 46 75 4c.');y.76(b)}8(g!='4c'&&!d){8(c<K.X){K.X+=b.S}}K.Q=y.13().S;8(K.X>=K.Q){K.X-=K.Q}y.T(I('4O',G));y.T(I('5L',G));H J});y.11(I('77',G),D(e,c,d,f){e.1g();F v=[c,d,f],t=['2M/28/2A','3d','28'],a=3e(v,t);c=a[0];d=a[1];f=a[2];F g=L;8(c 2W $&&c.S>1){h=$();c.1W(D(i,a){F b=y.T(I('77',G),[$(1l),d,f]);8(b){h=h.8e(b)}});H h}8(1z(c)||c=='4c'){h=y.13().2P()}O{c=3J(c,f,d,K,y);F h=y.13().1N(c);8(h.S){8(c<K.X){K.X-=h.S}}}8(h&&h.S){h.8f();K.Q=y.13().S;y.T(I('4O',G))}H h});y.11(I('3G',G)+' '+I('3h',G),D(e,a){e.1g();F b=e.5v.19(G.3y.45.S);8(2V(a)){2b[b]=a}8(1o(a)){2b[b].1c(a)}H 2b[b]});y.11(I('4p',G),D(e,a){e.1g();8(K.X==0){F b=0}O{F b=K.Q-K.X}8(1o(a)){a.1h($12,b)}H b});y.11(I('4b',G),D(e,a){e.1g();F b=7.1b.E||7.E.M,1X=1H.2z(K.Q/b-1),2k;8(K.X==0){2k=0}O 8(K.X<K.Q%b){2k=0}O 8(K.X==b&&!7.1U){2k=1X}O{2k=1H.78((K.Q-K.X)/b)}8(2k<0){2k=0}8(2k>1X){2k=1X}8(1o(a)){a.1h($12,2k)}H 2k});y.11(I('8g',G),D(e,a){e.1g();F b=3I(y.13(),7);8(1o(a)){a.1h($12,b)}H b});y.11(I('19',G),D(e,f,l,b){e.1g();8(K.Q==0){H L}F v=[f,l,b],t=['28','28','D'],a=3e(v,t);f=(Y(a[0]))?a[0]:0;l=(Y(a[1]))?a[1]:K.Q;b=a[2];f+=K.X;l+=K.X;8(E.Q>0){2h(f>K.Q){f-=K.Q}2h(l>K.Q){l-=K.Q}2h(f<0){f+=K.Q}2h(l<0){l+=K.Q}}F c=y.13(),$i;8(l>f){$i=c.19(f,l)}O{$i=$(c.19(f,K.Q).3F().6Y(c.19(0,l).3F()))}8(1o(b)){b.1h($12,$i)}H $i});y.11(I('27',G)+' '+I('2d',G)+' '+I('26',G),D(e,a){e.1g();F b=e.5v.19(G.3y.45.S),5M=A[b];8(1o(a)){a.1h($12,5M)}H 5M});y.11(I('6S',G),D(e,a,b,c){e.1g();F d=L;8(1o(a)){a.1h($12,7)}O 8(1T(a)){31=$.1L(J,{},31,a);8(b!==L)d=J;O 7=$.1L(J,{},7,a)}O 8(!1z(a)){8(1o(b)){F f=4P('7.'+a);8(1z(f)){f=''}b.1h($12,f)}O 8(!1z(b)){8(2X c!=='3d')c=J;4P('31.'+a+' = b');8(c!==L)d=J;O 4P('7.'+a+' = b')}O{H 4P('7.'+a)}}8(d){1Y(y.13(),7);z.59(31);z.5N();F g=4Q(y,7);y.T(I('3H',G),[J,g])}H 7});y.11(I('5L',G),D(e,a,b){e.1g();8(1z(a)){a=$('8h')}O 8(1p(a)){a=$(a)}8(!2v(a)||a.S==0){H 18(G,'2p a 5K 2A.')}8(!1p(b)){b='a.6i'}a.8i(b).1W(D(){F h=1l.79||'';8(h.S>0&&y.13().7a($(h))!=-1){$(1l).23('5O').5O(D(e){e.2D();y.T(I('3k',G),h)})}});H J});y.11(I('3H',G),D(e,b,c){e.1g();8(!7.1b.1A){H}F d=7.1b.E||7.E.M,4R=1H.2z(K.Q/d);8(b){8(7.1b.3K){7.1b.1A.13().2t();7.1b.1A.1W(D(){1j(F a=0;a<4R;a++){F i=y.13().1N(3J(a*d,0,J,K,y));$(1l).76(7.1b.3K.1h(i[0],a+1))}})}7.1b.1A.1W(D(){$(1l).13().23(7.1b.3L).1W(D(a){$(1l).11(7.1b.3L,D(e){e.2D();y.T(I('3k',G),[a*d,-7.1b.4S,J,7.1b])})})})}F f=y.1P(I('4b',G))+7.1b.4S;8(f>=4R){f=0}8(f<0){f=4R-1}7.1b.1A.1W(D(){$(1l).13().2N(2y('7b',G)).1N(f).3a(2y('7b',G))});H J});y.11(I('4O',G),D(e){F a=7.E.M,2E=y.13(),2m=5d($1n,7,'P');K.Q=2E.S;8(A.4r){7.3U=2m;7[7.d['P']]=4s(2m,A.4r)}O{7.3U=5e(7,2m)}8(7.2H){7.E.P=7.E.3M.P;7.E.1e=7.E.3M.1e;7=5g(7,2E,2m);a=7.E.M;5r(7,2E)}O 8(7.E.U.1d){a=32(2E,7,0)}O 8(7.E.1t!='*'){a=3W(2E,7,0)}8(!7.1U&&K.X!=0&&a>K.X){8(7.E.U.1d){F b=4D(2E,7,K.X)-K.X}O 8(7.E.1t!='*'){F b=7c(2E,7,K.X)-K.X}O{F b=7.E.M-K.X}18(G,'8j 8k-1U: 8l '+b+' E 5y.');y.T(I('14',G),b)}7.E.M=2x(a,7,7.E.U.2c,$12);7.E.U.20=7.E.M;7=5i(7,2E);F c=4Q(y,7);y.T(I('3H',G),[J,c]);4T(7,K.Q,G);3A(7,K.X,G);H c});y.11(I('4q',G),D(e,a){e.1g();1u=3u(1u);y.1q('57',L);y.T(I('5t',G));8(a){y.T(I('73',G))}4U(y.13());4U(y);z.5s();z.5P();8(G.3s=='36'){4U($1n)}O{$1n.8m(y)}H J});y.11(I('18',G),D(e){18(G,'3w P: '+7.P);18(G,'3w 1e: '+7.1e);18(G,'7d 8n: '+7.E.P);18(G,'7d 8o: '+7.E.1e);18(G,'4e 4f E M: '+7.E.M);8(7.N.1G){18(G,'4e 4f E 5Q 8p: '+7.N.E)}8(7.14.W){18(G,'4e 4f E 5Q 5y: '+7.14.E)}8(7.16.W){18(G,'4e 4f E 5Q 70: '+7.16.E)}H G.18});y.11('3o',D(e,n,o){e.1g();H y.1P(I(n,G),o)})};z.5s=D(){y.23(I('',G));y.23(I('',G,L));y.23('3o')};z.5N=D(){z.5P();4T(7,K.Q,G);3A(7,K.X,G);8(7.N.2F){F b=3N(7.N.2F);$1n.11(I('4V',G,L),D(){y.T(I('3b',G),b)}).11(I('4W',G,L),D(){y.T(I('3g',G))})}8(7.N.W){7.N.W.11(I(7.N.3L,G,L),D(e){e.2D();F a=L,b=3O;8(A.27){a='1G'}O 8(7.N.4X){a='3b';b=3N(7.N.4X)}8(a){y.T(I(a,G),b)}})}8(7.14.W){7.14.W.11(I(7.14.3L,G,L),D(e){e.2D();y.T(I('14',G))});8(7.14.2F){F b=3N(7.14.2F);7.14.W.11(I('4V',G,L),D(){y.T(I('3b',G),b)}).11(I('4W',G,L),D(){y.T(I('3g',G))})}}8(7.16.W){7.16.W.11(I(7.16.3L,G,L),D(e){e.2D();y.T(I('16',G))});8(7.16.2F){F b=3N(7.16.2F);7.16.W.11(I('4V',G,L),D(){y.T(I('3b',G),b)}).11(I('4W',G,L),D(){y.T(I('3g',G))})}}8(7.1b.1A){8(7.1b.2F){F b=3N(7.1b.2F);7.1b.1A.11(I('4V',G,L),D(){y.T(I('3b',G),b)}).11(I('4W',G,L),D(){y.T(I('3g',G))})}}8(7.14.2Y||7.16.2Y){$(4g).11(I('7e',G,L,J,J),D(e){F k=e.7f;8(k==7.16.2Y){e.2D();y.T(I('16',G))}8(k==7.14.2Y){e.2D();y.T(I('14',G))}})}8(7.1b.4Y){$(4g).11(I('7e',G,L,J,J),D(e){F k=e.7f;8(k>=49&&k<58){k=(k-49)*7.E.M;8(k<=K.Q){e.2D();y.T(I('3k',G),[k,0,J,7.1b])}}})}8($.1s.1r){F c='8q'8r 3l;8((c&&7.1r.4h)||(!c&&7.1r.5R)){F d=$.1L(J,{},7.14,7.1r),7g=$.1L(J,{},7.16,7.1r),5S=D(){y.T(I('14',G),[d])},5T=D(){y.T(I('16',G),[7g])};1F(7.2l){R'5c':R'7h':7.1r.2G.8s=5T;7.1r.2G.8t=5S;17;2J:7.1r.2G.8u=5T;7.1r.2G.8v=5S}8(A.1r){y.1r('4q')}$1n.1r(7.1r.2G);$1n.Z('7i','8w');A.1r=J}}8($.1s.1Q){8(7.1Q){F f=$.1L(J,{},7.14,7.1Q),7j=$.1L(J,{},7.16,7.1Q);8(A.1Q){$1n.23(I('1Q',G,L))}$1n.11(I('1Q',G,L),D(e,a){e.2D();8(a>0){y.T(I('14',G),[f])}O{y.T(I('16',G),[7j])}});A.1Q=J}}8(7.N.1G){y.T(I('1G',G),7.N.5U)}8(A.6v){F g=D(e){y.T(I('5t',G));8(7.N.5V&&!A.27){y.T(I('1G',G))}1Y(y.13(),7);y.T(I('4O',G))};F h=$(3l),4i=3O;8($.5W&&G.5X=='5W'){4i=$.5W(8x,g)}O 8($.4Z&&G.5X=='4Z'){4i=$.4Z(8y,g)}O{F i=0,5Y=0;4i=D(){F a=h.P(),5Z=h.1e();8(a!=i||5Z!=5Y){g();i=a;5Y=5Z}}}h.11(I('8z',G,L,J,J),4i)}};z.5P=D(){F a=I('',G),3P=I('',G,L);61=I('',G,L,J,J);$(4g).23(61);$(3l).23(61);$1n.23(3P);8(7.N.W){7.N.W.23(3P)}8(7.14.W){7.14.W.23(3P)}8(7.16.W){7.16.W.23(3P)}8(7.1b.1A){7.1b.1A.23(3P);8(7.1b.3K){7.1b.1A.13().2t()}}8(A.1r){y.1r('4q');$1n.Z('7i','2J');A.1r=L}8(A.1Q){A.1Q=L}4T(7,'4j',G);3A(7,'2N',G)};8(1k(w)){w={'18':w}}F A={'2l':'16','27':J,'26':L,'2d':L,'1Q':L,'1r':L},K={'Q':y.13().S,'X':0},1u={'N':3O,'1f':3O,'2L':2o(),'3v':0},V={'2d':L,'1M':0,'2L':0,'2u':'','1a':[]},2b={'3G':[],'3h':[]},2g=[],G=$.1L(J,{},$.1s.1v.7k,w),7={},31=$.1L(J,{},u),$1n=(G.3s=='36')?y.36():y.8A('<'+G.3s.55+' 8B=\"'+G.3s.7l+'\" />').36();G.4o=y.4o;G.3T=$.1s.1v.3T++;G.2Z=(G.2Z&&$.1s.2Z)?'2Z':'8C';z.59(31,J,56);z.6D();z.6L();z.5N();8(2V(7.E.3m)){F B=7.E.3m}O{F B=[];8(7.E.3m!=0){B.1c(7.E.3m)}}8(7.25){B.8D(4k(7m(7.25),10))}8(B.S>0){1j(F a=0,l=B.S;a<l;a++){F s=B[a];8(s==0){62}8(s===J){s=3l.8E.79;8(s.S<1){62}}O 8(s==='7n'){s=1H.4l(1H.7n()*K.Q)}8(y.1P(I('3k',G),[s,0,J,{1V:'42'}])){17}}}F C=4Q(y,7),7o=3I(y.13(),7);8(7.7p){7.7p.1h($12,{'P':C.P,'1e':C.1e,'E':7o})}y.T(I('3H',G),[J,C]);y.T(I('5L',G));8(G.18){y.T(I('18',G))}H y};$.1s.1v.3T=1;$.1s.1v.5b={'2n':L,'3z':J,'1U':J,'2H':L,'2l':'1m','E':{'3m':0},'1K':{'2u':'7q','1M':6y,'2F':L,'3L':'5O','2O':L}};$.1s.1v.7k={'18':L,'2Z':L,'5X':'4Z','3y':{'45':'','7r':'8F'},'3s':{'55':'8G','7l':'8H'},'63':{}};$.1s.1v.7s=D(a){H'<a 8I=\"#\"><7t>'+a+'</7t></a>'};$.1s.1v.7u=D(a){$(1l).Z('P',a+'%')};$.1s.1v.25={3F:D(n){n+='=';F b=4g.25.3Q(';');1j(F a=0,l=b.S;a<l;a++){F c=b[a];2h(c.8J(0)==' '){c=c.19(1)}8(c.3R(n)==0){H c.19(n.S)}}H 0},64:D(n,v,d){F e=\"\";8(d){F a=7v 7w();a.8K(a.2o()+(d*24*60*60*8L));e=\"; 8M=\"+a.8N()}4g.25=n+'='+v+e+'; 8O=/'},2t:D(n){$.1s.1v.25.64(n,\"\",-1)}};D 48(d,e,c){8(c.2Z=='2Z'){8(e=='7q'){e='8P'}}H{1a:[],1M:d,8Q:d,2u:e,2L:2o()}}D 3x(s,c){1j(F a=0,l=s.1a.S;a<l;a++){F b=s.1a[a];8(!b){62}b[0][c.2Z](b[1],s.1M,s.2u,b[2])}}D 43(s,c){8(!1k(c)){c=J}8(1T(s.4z)){43(s.4z,c)}1j(F a=0,l=s.1a.S;a<l;a++){F b=s.1a[a];b[0].6M(J);8(c){b[0].Z(b[1]);8(1o(b[2])){b[2]()}}}8(1T(s.4A)){43(s.4A,c)}}D 5F(a,b,o){8(b){b.2t()}1F(o.1V){R'1w':R'3j':R'1I-1w':R'22-1w':a.Z('1t','');a.Z('1E',1);17}}D 4a(d,o,b,a,c){8(o[b]){o[b].1h(d,a)}8(c[b].S){1j(F i=0,l=c[b].S;i<l;i++){c[b][i].1h(d,a)}}H[]}D 5G(a,q,c){8(q.S){a.T(I(q[0][0],c),q[0][1]);q.8R()}H q}D 5z(b){b.1W(D(){F a=$(1l);a.1q('7x',a.2f(':3t')).4j()})}D 5D(b){8(b){b.1W(D(){F a=$(1l);8(!a.1q('7x')){a.4m()}})}}D 3u(t){8(t.N){8S(t.N)}8(t.1f){8T(t.1f)}H t}D 5E(a,b,c,d,e,f,g){H{'P':g.P,'1e':g.1e,'E':{'20':a,'8U':b,'M':c},'1K':{'E':d,'2l':e,'1M':f}}}D 5B(a,o,b,c){F d=a.1M;8(a.1V=='42'){H 0}8(d=='N'){d=o.1K.1M/o.1K.E*b}O 8(d<10){d=c/d}8(d<1){H 0}8(a.1V=='1w'){d=d/2}H 1H.78(d)}D 4T(o,t,c){F a=(Y(o.E.4C))?o.E.4C:o.E.M+1;8(t=='4m'||t=='4j'){F f=t}O 8(a>t){18(c,'2p 6O E ('+t+' Q, '+a+' 6P): 8V 8W.');F f='4j'}O{F f='4m'}F s=(f=='4m')?'2N':'3a',h=2y('3t',c);8(o.N.W){o.N.W[f]()[s](h)}8(o.14.W){o.14.W[f]()[s](h)}8(o.16.W){o.16.W[f]()[s](h)}8(o.1b.1A){o.1b.1A[f]()[s](h)}}D 3A(o,f,c){8(o.1U||o.3z)H;F a=(f=='2N'||f=='3a')?f:L,51=2y('8X',c);8(o.N.W&&a){o.N.W[a](51)}8(o.14.W){F b=a||(f==0)?'3a':'2N';o.14.W[b](51)}8(o.16.W){F b=a||(f==o.E.M)?'3a':'2N';o.16.W[b](51)}}D 3S(a,b){8(1o(b)){b=b.1h(a)}O 8(1z(b)){b={}}H b}D 6l(a,b){b=3S(a,b);8(Y(b)){b={'M':b}}O 8(b=='1d'){b={'M':b,'P':b,'1e':b}}O 8(!1T(b)){b={}}H b}D 6m(a,b){b=3S(a,b);8(Y(b)){8(b<=50){b={'E':b}}O{b={'1M':b}}}O 8(1p(b)){b={'2u':b}}O 8(!1T(b)){b={}}H b}D 52(a,b){b=3S(a,b);8(1p(b)){F c=65(b);8(c==-1){b=$(b)}O{b=c}}H b}D 6n(a,b){b=52(a,b);8(2v(b)){b={'W':b}}O 8(1k(b)){b={'1G':b}}O 8(Y(b)){b={'2K':b}}8(b.1f){8(1p(b.1f)||2v(b.1f)){b.1f={'2q':b.1f}}}H b}D 6z(a,b){8(1o(b.W)){b.W=b.W.1h(a)}8(1p(b.W)){b.W=$(b.W)}8(!1k(b.1G)){b.1G=J}8(!Y(b.5U)){b.5U=0}8(1z(b.4X)){b.4X=J}8(!1k(b.5V)){b.5V=J}8(!Y(b.2K)){b.2K=(b.1M<10)?8Y:b.1M*5}8(b.1f){8(1o(b.1f.2q)){b.1f.2q=b.1f.2q.1h(a)}8(1p(b.1f.2q)){b.1f.2q=$(b.1f.2q)}8(b.1f.2q){8(!1o(b.1f.4B)){b.1f.4B=$.1s.1v.7u}8(!Y(b.1f.5u)){b.1f.5u=50}}O{b.1f=L}}H b}D 5a(a,b){b=52(a,b);8(2v(b)){b={'W':b}}O 8(Y(b)){b={'2Y':b}}H b}D 5j(a,b){8(1o(b.W)){b.W=b.W.1h(a)}8(1p(b.W)){b.W=$(b.W)}8(1p(b.2Y)){b.2Y=65(b.2Y)}H b}D 6o(a,b){b=52(a,b);8(2v(b)){b={'1A':b}}O 8(1k(b)){b={'4Y':b}}H b}D 6A(a,b){8(1o(b.1A)){b.1A=b.1A.1h(a)}8(1p(b.1A)){b.1A=$(b.1A)}8(!Y(b.E)){b.E=L}8(!1k(b.4Y)){b.4Y=L}8(!1o(b.3K)&&!53(b.3K)){b.3K=$.1s.1v.7s}8(!Y(b.4S)){b.4S=0}H b}D 6p(a,b){8(1o(b)){b=b.1h(a)}8(1z(b)){b={'4h':L}}8(3p(b)){b={'4h':b}}O 8(Y(b)){b={'E':b}}H b}D 6B(a,b){8(!1k(b.4h)){b.4h=J}8(!1k(b.5R)){b.5R=L}8(!1T(b.2G)){b.2G={}}8(!1k(b.2G.7y)){b.2G.7y=L}H b}D 6q(a,b){8(1o(b)){b=b.1h(a)}8(3p(b)){b={}}O 8(Y(b)){b={'E':b}}O 8(1z(b)){b=L}H b}D 6C(a,b){H b}D 3J(a,b,c,d,e){8(1p(a)){a=$(a,e)}8(1T(a)){a=$(a,e)}8(2v(a)){a=e.13().7a(a);8(!1k(c)){c=L}}O{8(!1k(c)){c=J}}8(!Y(a)){a=0}8(!Y(b)){b=0}8(c){a+=d.X}a+=b;8(d.Q>0){2h(a>=d.Q){a-=d.Q}2h(a<0){a+=d.Q}}H a}D 4D(i,o,s){F t=0,x=0;1j(F a=s;a>=0;a--){F j=i.1N(a);t+=(j.2f(':M'))?j[o.d['2w']](J):0;8(t>o.3U){H x}8(a==0){a=i.S}x++}}D 7c(i,o,s){H 66(i,o.E.1t,o.E.U.4t,s)}D 6T(i,o,s,m){H 66(i,o.E.1t,m,s)}D 66(i,f,m,s){F t=0,x=0;1j(F a=s,l=i.S;a>=0;a--){x++;8(x==l){H x}F j=i.1N(a);8(j.2f(f)){t++;8(t==m){H x}}8(a==0){a=l}}}D 5x(a,o){H o.E.U.4t||a.13().19(0,o.E.M).1t(o.E.1t).S}D 32(i,o,s){F t=0,x=0;1j(F a=s,l=i.S-1;a<=l;a++){F j=i.1N(a);t+=(j.2f(':M'))?j[o.d['2w']](J):0;8(t>o.3U){H x}x++;8(x==l+1){H x}8(a==l){a=-1}}}D 5I(i,o,s,l){F v=32(i,o,s);8(!o.1U){8(s+v>l){v=l-s}}H v}D 3W(i,o,s){H 68(i,o.E.1t,o.E.U.4t,s,o.1U)}D 6Z(i,o,s,m){H 68(i,o.E.1t,m+1,s,o.1U)-1}D 68(i,f,m,s,c){F t=0,x=0;1j(F a=s,l=i.S-1;a<=l;a++){x++;8(x>=l){H x}F j=i.1N(a);8(j.2f(f)){t++;8(t==m){H x}}8(a==l){a=-1}}}D 3I(i,o){H i.19(0,o.E.M)}D 6V(i,o,n){H i.19(n,o.E.U.20+n)}D 6W(i,o){H i.19(0,o.E.M)}D 71(i,o){H i.19(0,o.E.U.20)}D 72(i,o,n){H i.19(n,o.E.M+n)}D 4x(i,o,d){8(o.1R){8(!1p(d)){d='2a'}i.1W(D(){F j=$(1l),m=4k(j.Z(o.d['1S']),10);8(!Y(m)){m=0}j.1q(d,m)})}}D 1Y(i,o,m){8(o.1R){F x=(1k(m))?m:L;8(!Y(m)){m=0}4x(i,o,'7z');i.1W(D(){F j=$(1l);j.Z(o.d['1S'],((x)?j.1q('7z'):m+j.1q('2a')))})}}D 41(i){i.1W(D(){F j=$(1l);j.1q('7A',j.7B('7C')||'')})}D 4U(i){i.1W(D(){F j=$(1l);j.7B('7C',j.1q('7A')||'')})}D 5r(o,b){F c=o.E.M,7D=o.E[o.d['P']],69=o[o.d['1e']],7E=3V(69);b.1W(D(){F a=$(1l),6a=7D-7F(a,o,'8Z');a[o.d['P']](6a);8(7E){a[o.d['1e']](4s(6a,69))}})}D 4Q(a,o){F b=a.36(),$i=a.13(),$v=3I($i,o),54=4I(4J($v,o,J),o,L);b.Z(54);8(o.1R){F p=o.1i,r=p[o.d[1]];8(o.1B&&r<0){r=0}F c=$v.2P();c.Z(o.d['1S'],c.1q('2a')+r);a.Z(o.d['3q'],p[o.d[0]]);a.Z(o.d['1m'],p[o.d[3]])}a.Z(o.d['P'],54[o.d['P']]+(2R($i,o,'P')*2));a.Z(o.d['1e'],6b($i,o,'1e'));H 54}D 4J(i,o,a){H[2R(i,o,'P',a),6b(i,o,'1e',a)]}D 6b(i,o,a,b){8(!1k(b)){b=L}8(Y(o[o.d[a]])&&b){H o[o.d[a]]}8(Y(o.E[o.d[a]])){H o.E[o.d[a]]}a=(a.6c().3R('P')>-1)?'2w':'3n';H 4n(i,o,a)}D 4n(i,o,b){F s=0;1j(F a=0,l=i.S;a<l;a++){F j=i.1N(a);F m=(j.2f(':M'))?j[o.d[b]](J):0;8(s<m){s=m}}H s}D 2R(i,o,b,c){8(!1k(c)){c=L}8(Y(o[o.d[b]])&&c){H o[o.d[b]]}8(Y(o.E[o.d[b]])){H o.E[o.d[b]]*i.S}F d=(b.6c().3R('P')>-1)?'2w':'3n',s=0;1j(F a=0,l=i.S;a<l;a++){F j=i.1N(a);s+=(j.2f(':M'))?j[o.d[d]](J):0}H s}D 5d(a,o,d){F b=a.2f(':M');8(b){a.4j()}F s=a.36()[o.d[d]]();8(b){a.4m()}H s}D 5e(o,a){H(Y(o[o.d['P']]))?o[o.d['P']]:a}D 6d(i,o,b){F s=L,v=L;1j(F a=0,l=i.S;a<l;a++){F j=i.1N(a);F c=(j.2f(':M'))?j[o.d[b]](J):0;8(s===L){s=c}O 8(s!=c){v=J}8(s==0){v=J}}H v}D 7F(i,o,d){H i[o.d['90'+d]](J)-i[o.d[d.6c()]]()}D 4s(s,o){8(3V(o)){o=4k(o.19(0,-1),10);8(!Y(o)){H s}s*=o/2I}H s}D I(n,c,a,b,d){8(!1k(a)){a=J}8(!1k(b)){b=J}8(!1k(d)){d=L}8(a){n=c.3y.45+n}8(b){n=n+'.'+c.3y.7r}8(b&&d){n+=c.3T}H n}D 2y(n,c){H(1p(c.63[n]))?c.63[n]:n}D 4I(a,o,p){8(!1k(p)){p=J}F b=(o.1R&&p)?o.1i:[0,0,0,0];F c={};c[o.d['P']]=a[0]+b[1]+b[3];c[o.d['1e']]=a[1]+b[0]+b[2];H c}D 3e(c,d){F e=[];1j(F a=0,7G=c.S;a<7G;a++){1j(F b=0,7H=d.S;b<7H;b++){8(d[b].3R(2X c[a])>-1&&1z(e[b])){e[b]=c[a];17}}}H e}D 6x(p){8(1z(p)){H[0,0,0,0]}8(Y(p)){H[p,p,p,p]}8(1p(p)){p=p.3Q('91').7I('').3Q('92').7I('').3Q(' ')}8(!2V(p)){H[0,0,0,0]}1j(F i=0;i<4;i++){p[i]=4k(p[i],10)}1F(p.S){R 0:H[0,0,0,0];R 1:H[p[0],p[0],p[0],p[0]];R 2:H[p[0],p[1],p[0],p[1]];R 3:H[p[0],p[1],p[2],p[1]];2J:H[p[0],p[1],p[2],p[3]]}}D 4H(a,o){F x=(Y(o[o.d['P']]))?1H.2z(o[o.d['P']]-2R(a,o,'P')):0;1F(o.1B){R'1m':H[0,x];R'35':H[x,0];R'5f':2J:H[1H.2z(x/2),1H.4l(x/2)]}}D 6r(o){F a=[['P','7J','2w','1e','7K','3n','1m','3q','1S',0,1,2,3],['1e','7K','3n','P','7J','2w','3q','1m','5p',3,2,1,0]];F b=a[0].S,7L=(o.2l=='35'||o.2l=='1m')?0:1;F c={};1j(F d=0;d<b;d++){c[a[0][d]]=a[7L][d]}H c}D 4E(x,o,a,b){F v=x;8(1o(a)){v=a.1h(b,v)}O 8(1p(a)){F p=a.3Q('+'),m=a.3Q('-');8(m.S>p.S){F c=J,6e=m[0],30=m[1]}O{F c=L,6e=p[0],30=p[1]}1F(6e){R'93':v=(x%2==1)?x-1:x;17;R'94':v=(x%2==0)?x-1:x;17;2J:v=x;17}30=4k(30,10);8(Y(30)){8(c){30=-30}v+=30}}8(!Y(v)||v<1){v=1}H v}D 2x(x,o,a,b){H 6f(4E(x,o,a,b),o.E.U)}D 6f(v,i){8(Y(i.34)&&v<i.34){v=i.34}8(Y(i.1X)&&v>i.1X){v=i.1X}8(v<1){v=1}H v}D 5k(s){8(!2V(s)){s=[[s]]}8(!2V(s[0])){s=[s]}1j(F j=0,l=s.S;j<l;j++){8(1p(s[j][0])){s[j][0]=$(s[j][0])}8(!1k(s[j][1])){s[j][1]=J}8(!1k(s[j][2])){s[j][2]=J}8(!Y(s[j][3])){s[j][3]=0}}H s}D 65(k){8(k=='35'){H 39}8(k=='1m'){H 37}8(k=='5c'){H 38}8(k=='7h'){H 40}H-1}D 5H(n,a,c){8(n){F v=a.1P(I('4p',c));$.1s.1v.25.64(n,v)}}D 7m(n){F c=$.1s.1v.25.3F(n);H(c=='')?0:c}D 6E(a,b){F c={};1j(F p=0,l=b.S;p<l;p++){c[b[p]]=a.Z(b[p])}H c}D 6s(a,b,c,d){8(!1T(a.U)){a.U={}}8(!1T(a.3M)){a.3M={}}8(a.3m==0&&Y(d)){a.3m=d}8(1T(a.M)){a.U.34=a.M.34;a.U.1X=a.M.1X;a.M=L}O 8(1p(a.M)){8(a.M=='1d'){a.U.1d=J}O{a.U.2c=a.M}a.M=L}O 8(1o(a.M)){a.U.2c=a.M;a.M=L}8(!1p(a.1t)){a.1t=(c.1t(':3t').S>0)?':M':'*'}8(!a[b.d['P']]){8(b.2H){18(J,'7M a '+b.d['P']+' 1j 75 E!');a[b.d['P']]=4n(c,b,'2w')}O{a[b.d['P']]=(6d(c,b,'2w'))?'1d':c[b.d['2w']](J)}}8(!a[b.d['1e']]){a[b.d['1e']]=(6d(c,b,'3n'))?'1d':c[b.d['3n']](J)}a.3M.P=a.P;a.3M.1e=a.1e;H a}D 6w(a,b){8(a.E[a.d['P']]=='1d'){a.E.U.1d=J}8(!a.E.U.1d){8(Y(a[a.d['P']])){a.E.M=1H.4l(a[a.d['P']]/a.E[a.d['P']])}O{a.E.M=1H.4l(b/a.E[a.d['P']]);a[a.d['P']]=a.E.M*a.E[a.d['P']];8(!a.E.U.2c){a.1B=L}}8(a.E.M=='95'||a.E.M<1){18(J,'2p a 5K 28 4f M E: 7M 46 \"1d\".');a.E.U.1d=J}}H a}D 6t(a,b,c){8(a=='N'){a=4n(c,b,'2w')}H a}D 6u(a,b,c){8(a=='N'){a=4n(c,b,'3n')}8(!a){a=b.E[b.d['1e']]}H a}D 5i(o,a){F p=4H(3I(a,o),o);o.1i[o.d[1]]=p[1];o.1i[o.d[3]]=p[0];H o}D 5g(o,a,b){F c=6f(1H.2z(o[o.d['P']]/o.E[o.d['P']]),o.E.U);8(c>a.S){c=a.S}F d=1H.4l(o[o.d['P']]/c);o.E.M=c;o.E[o.d['P']]=d;o[o.d['P']]=c*d;H o}D 3N(p){8(1p(p)){F i=(p.3R('96')>-1)?J:L,r=(p.3R('3g')>-1)?J:L}O{F i=r=L}H[i,r]}D 97(a){H(Y(a))?a:3O}D 6g(a){H(a===3O)}D 1z(a){H(6g(a)||2X a=='7N'||a===''||a==='7N')}D 2V(a){H(a 2W 98)}D 2v(a){H(a 2W 7O)}D 1T(a){H((a 2W 99||2X a=='2A')&&!6g(a)&&!2v(a)&&!2V(a))}D Y(a){H((a 2W 4e||2X a=='28')&&!9a(a))}D 1p(a){H((a 2W 9b||2X a=='2M')&&!1z(a)&&!3p(a)&&!53(a))}D 1o(a){H(a 2W 9c||2X a=='D')}D 1k(a){H(a 2W 9d||2X a=='3d'||3p(a)||53(a))}D 3p(a){H(a===J||a==='J')}D 53(a){H(a===L||a==='L')}D 3V(x){H(1p(x)&&x.19(-1)=='%')}D 2o(){H 7v 7w().2o()}D 3X(o,n){18(J,o+' 2f 9e, 9f 1j 9g 9h 9i 9j. 9k '+n+' 9l.')}D 18(d,m){8(!1z(3l.6h)&&!1z(3l.6h.7P)){8(1T(d)){F s=' ('+d.4o+')';d=d.18}O{F s=''}8(!d){H L}8(1p(m)){m='1v'+s+': '+m}O{m=['1v'+s+':',m]}3l.6h.7P(m)}H L}$.1L($.2u,{'9m':D(t){F a=t*t;H t*(-a*t+4*a-6*t+4)},'9n':D(t){H t*(4*t*t-9*t+6)},'9o':D(t){F a=t*t;H t*(33*a*a-9p*a*t+9q*a-67*t+15)}})})(7O);", 
62, 585, "|||||||opts|if|||||||||||||||||||||||||||||||function|items|var|conf|return|cf_e|true|itms|false|visible|auto|else|width|total|case|length|trigger|visibleConf|scrl|button|first|is_number|css||bind|tt0|children|prev||next|break|debug|slice|anims|pagination|push|variable|height|progress|stopPropagation|call|padding|for|is_boolean|this|left|wrp|is_function|is_string|data|swipe|fn|filter|tmrs|carouFredSel|fade|_onafter|_moveitems|is_undefined|container|align|_s_paddingold|_s_paddingcur|opacity|switch|play|Math|cover|_position|scroll|extend|duration|eq|_a_wrapper|triggerHandler|mousewheel|usePadding|marginRight|is_object|circular|fx|each|max|sz_resetMargin|i_cur_l|old|i_old_l|uncover|unbind||cookie|isScrolling|isPaused|number|a_cfs|_cfs_origCssMargin|clbk|adjust|isStopped|stopImmediatePropagation|is|queu|while|i_new|w_siz|nr|direction|avail_primary|synchronise|getTime|Not|bar|i_new_l|a_cur|remove|easing|is_jquery|outerWidth|cf_getItemsAdjust|cf_c|ceil|object|pR|_s_paddingnew|preventDefault|a_itm|pauseOnHover|options|responsive|100|default|timeoutDuration|startTime|string|removeClass|queue|last|i_skp|ms_getTotalSize|a_old|a_lef|a_dur|is_array|instanceof|typeof|key|transition|adj|opts_orig|gn_getVisibleItemsNext||min|right|parent||||addClass|pause|perc|boolean|cf_sortParams|scrolling|resume|onAfter|i_old|crossfade|slideTo|window|start|outerHeight|_cfs_triggerEvent|is_true|top|position|wrapper|hidden|sc_clearTimers|timePassed|Carousel|sc_startScroll|events|infinite|nv_enableNavi|i_siz|i_siz_vis|_a_paddingold|_a_paddingcur|get|onBefore|updatePageStatus|gi_getCurrentItems|gn_getItemIndex|anchorBuilder|event|sizesConf|bt_pauseOnHoverConfig|null|ns2|split|indexOf|go_getObject|serialNumber|maxDimension|is_percentage|gn_getVisibleItemsNextFilter|deprecated|orgCSS|zIndex||sz_storeOrigCss|none|sc_stopScroll|dur2|prefix|to|appendTo|sc_setScroll||sc_fireCallbacks|currentPage|end|before|Number|of|document|onTouch|onResize|hide|parseInt|floor|show|ms_getTrueLargestSize|selector|currentPosition|destroy|primarySizePercentage|ms_getPercentage|org|onTimeoutStart|onTimeoutPause|onTimeoutEnd|sz_storeMargin|stopped|pre|post|updater|minimum|gn_getVisibleItemsPrev|cf_getAdjust|onEnd|clone|cf_getAlignPadding|cf_mapWrapperSizes|ms_getSizes|a_wsz|a_new|not|a_cfs_vis|updateSizes|eval|sz_setSizes|pgs|deviation|nv_showNavi|sz_restoreOrigCss|mouseenter|mouseleave|pauseOnEvent|keys|throttle||di|go_getNaviObject|is_false|sz|element|starting_position|_cfs_isCarousel||_cfs_init|go_getPrevNextObject|defaults|up|ms_getParentSize|ms_getMaxDimension|center|in_getResponsiveValues|bottom|in_getAlignPadding|go_complementPrevNextObject|cf_getSynchArr|onPauseStart|onPausePause|onPauseEnd|pauseDuration|marginBottom|newPosition|sz_setResponsiveSizes|_cfs_unbind_events|finish|interval|type|conditions|gn_getVisibleOrg|backward|sc_hideHiddenItems|a_lef_vis|sc_getDuration|_a_paddingnew|sc_showHiddenItems|sc_mapCallbackArguments|sc_afterScroll|sc_fireQueue|cf_setCookie|gn_getVisibleItemsNextTestCircular|slideToPage|valid|linkAnchors|value|_cfs_bind_buttons|click|_cfs_unbind_buttons|scrolled|onMouse|swP|swN|delay|pauseOnResize|debounce|onWindowResize|_windowHeight|nh||ns3|continue|classnames|set|cf_getKeyCode|gn_getItemsPrevFilter||gn_getItemsNextFilter|seco|nw|ms_getLargestSize|toLowerCase|ms_hasVariableSizes|sta|cf_getItemAdjustMinMax|is_null|console|caroufredsel|No|found|go_getItemsObject|go_getScrollObject|go_getAutoObject|go_getPaginationObject|go_getSwipeObject|go_getMousewheelObject|cf_getDimensions|in_complementItems|in_complementPrimarySize|in_complementSecondarySize|upDateOnWindowResize|in_complementVisibleItems|cf_getPadding|500|go_complementAutoObject|go_complementPaginationObject|go_complementSwipeObject|go_complementMousewheelObject|_cfs_build|in_mapCss|textAlign|float|marginTop|marginLeft|absolute|_cfs_origCssZindex|_cfs_bind_events|stop|paused|enough|needed|page|slide_|configuration|gn_getScrollItemsPrevFilter|Scrolling|gi_getOldItemsPrev|gi_getNewItemsPrev|directscroll|concat|gn_getScrollItemsNextFilter|forward|gi_getOldItemsNext|gi_getNewItemsNext|jumpToStart|after|the|append|removeItem|round|hash|index|selected|gn_getVisibleItemsPrevFilter|Item|keyup|keyCode|scN|down|cursor|mcN|configs|classname|cf_getCookie|random|itm|onCreate|swing|namespace|pageAnchorBuilder|span|progressbarUpdater|new|Date|_cfs_isHidden|triggerOnTouchEnd|_cfs_tempCssMargin|_cfs_origCss|attr|style|newS|secp|ms_getPaddingBorderMargin|l1|l2|join|innerWidth|innerHeight|dx|Set|undefined|jQuery|log|caroufredsel_cookie_|relative|fixed|overflow|setInterval|setTimeout|or|Callback|returned|Page|resumed|currently|slide_prev|prependTo|slide_next|prevPage|nextPage|prepend|carousel|insertItem|Correct|insert|Appending|item|add|detach|currentVisible|body|find|Preventing|non|sliding|replaceWith|widths|heights|automatically|ontouchstart|in|swipeUp|swipeDown|swipeLeft|swipeRight|move|200|300|resize|wrap|class|animate|unshift|location|cfs|div|caroufredsel_wrapper|href|charAt|setTime|1000|expires|toGMTString|path|ease|orgDuration|shift|clearTimeout|clearInterval|skipped|Hiding|navigation|disabled|2500|Width|outer|px|em|even|odd|Infinity|immediate|bt_mousesheelNumber|Array|Object|isNaN|String|Function|Boolean|DEPRECATED|support|it|will|be|removed|Use|instead|quadratic|cubic|elastic|106|126".split("|"), 
0, {}));
jQuery.cookie = function(key, value, options) {
  if(arguments.length > 1 && String(value) !== "[object Object]") {
    options = jQuery.extend({}, options);
    if(value === null || value === undefined) {
      options.expires = -1
    }
    if(typeof options.expires === "number") {
      var days = options.expires, t = options.expires = new Date;
      t.setDate(t.getDate() + days)
    }
    value = String(value);
    return document.cookie = [encodeURIComponent(key), "=", options.raw ? value : encodeURIComponent(value), options.expires ? "; expires=" + options.expires.toUTCString() : "", options.path ? "; path=" + options.path : "", options.domain ? "; domain=" + options.domain : "", options.secure ? "; secure" : ""].join("")
  }
  options = value || {};
  var result, decode = options.raw ? function(s) {
    return s
  } : decodeURIComponent;
  return(result = (new RegExp("(?:^|; )" + encodeURIComponent(key) + "=([^;]*)")).exec(document.cookie)) ? decode(result[1]) : null
};
(function($) {
  var tmp, loading, overlay, wrap, outer, content, close, title, nav_left, nav_right, selectedIndex = 0, selectedOpts = {}, selectedArray = [], currentIndex = 0, currentOpts = {}, currentArray = [], ajaxLoader = null, imgPreloader = new Image, imgRegExp = /\.(jpg|gif|png|bmp|jpeg)(.*)?$/i, swfRegExp = /[^\.]\.(swf)\s*$/i, loadingTimer, loadingFrame = 1, titleHeight = 0, titleStr = "", start_pos, final_pos, busy = false, fx = $.extend($("<div/>")[0], {prop:0}), isIE6 = $.browser.msie && $.browser.version < 
  7 && !window.XMLHttpRequest, _abort = function() {
    loading.hide();
    imgPreloader.onerror = imgPreloader.onload = null;
    if(ajaxLoader) {
      ajaxLoader.abort()
    }
    tmp.empty()
  }, _error = function() {
    if(false === selectedOpts.onError(selectedArray, selectedIndex, selectedOpts)) {
      loading.hide();
      busy = false;
      return
    }
    selectedOpts.titleShow = false;
    selectedOpts.width = "auto";
    selectedOpts.height = "auto";
    tmp.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');
    _process_inline()
  }, _start = function() {
    var obj = selectedArray[selectedIndex], href, type, title, str, emb, ret;
    _abort();
    selectedOpts = $.extend({}, $.fn.fancybox.defaults, typeof $(obj).data("fancybox") == "undefined" ? selectedOpts : $(obj).data("fancybox"));
    ret = selectedOpts.onStart(selectedArray, selectedIndex, selectedOpts);
    if(ret === false) {
      busy = false;
      return
    }else {
      if(typeof ret == "object") {
        selectedOpts = $.extend(selectedOpts, ret)
      }
    }
    title = selectedOpts.title || (obj.nodeName ? $(obj).attr("title") : obj.title) || "";
    if(obj.nodeName && !selectedOpts.orig) {
      selectedOpts.orig = $(obj).children("img:first").length ? $(obj).children("img:first") : $(obj)
    }
    if(title === "" && selectedOpts.orig && selectedOpts.titleFromAlt) {
      title = selectedOpts.orig.attr("alt")
    }
    href = selectedOpts.href || (obj.nodeName ? $(obj).attr("href") : obj.href) || null;
    if(/^(?:javascript)/i.test(href) || href == "#") {
      href = null
    }
    if(selectedOpts.type) {
      type = selectedOpts.type;
      if(!href) {
        href = selectedOpts.content
      }
    }else {
      if(selectedOpts.content) {
        type = "html"
      }else {
        if(href) {
          if(href.match(imgRegExp)) {
            type = "image"
          }else {
            if(href.match(swfRegExp)) {
              type = "swf"
            }else {
              if($(obj).hasClass("iframe")) {
                type = "iframe"
              }else {
                if(href.indexOf("#") === 0) {
                  type = "inline"
                }else {
                  type = "ajax"
                }
              }
            }
          }
        }
      }
    }
    if(!type) {
      _error();
      return
    }
    if(type == "inline") {
      obj = href.substr(href.indexOf("#"));
      type = $(obj).length > 0 ? "inline" : "ajax"
    }
    selectedOpts.type = type;
    selectedOpts.href = href;
    selectedOpts.title = title;
    if(selectedOpts.autoDimensions) {
      if(selectedOpts.type == "html" || selectedOpts.type == "inline" || selectedOpts.type == "ajax") {
        selectedOpts.width = "auto";
        selectedOpts.height = "auto"
      }else {
        selectedOpts.autoDimensions = false
      }
    }
    if(selectedOpts.modal) {
      selectedOpts.overlayShow = true;
      selectedOpts.hideOnOverlayClick = false;
      selectedOpts.hideOnContentClick = false;
      selectedOpts.enableEscapeButton = false;
      selectedOpts.showCloseButton = false
    }
    selectedOpts.padding = parseInt(selectedOpts.padding, 10);
    selectedOpts.margin = parseInt(selectedOpts.margin, 10);
    tmp.css("padding", selectedOpts.padding + selectedOpts.margin);
    $(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change", function() {
      $(this).replaceWith(content.children())
    });
    switch(type) {
      case "html":
        tmp.html(selectedOpts.content);
        _process_inline();
        break;
      case "inline":
        if($(obj).parent().is("#fancybox-content") === true) {
          busy = false;
          return
        }
        $('<div class="fancybox-inline-tmp" />').hide().insertBefore($(obj)).bind("fancybox-cleanup", function() {
          $(this).replaceWith(content.children())
        }).bind("fancybox-cancel", function() {
          $(this).replaceWith(tmp.children())
        });
        $(obj).appendTo(tmp);
        _process_inline();
        break;
      case "image":
        busy = false;
        $.fancybox.showActivity();
        imgPreloader = new Image;
        imgPreloader.onerror = function() {
          _error()
        };
        imgPreloader.onload = function() {
          busy = true;
          imgPreloader.onerror = imgPreloader.onload = null;
          _process_image()
        };
        imgPreloader.src = href;
        break;
      case "swf":
        selectedOpts.scrolling = "no";
        str = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="' + selectedOpts.width + '" height="' + selectedOpts.height + '"><param name="movie" value="' + href + '"></param>';
        emb = "";
        $.each(selectedOpts.swf, function(name, val) {
          str += '<param name="' + name + '" value="' + val + '"></param>';
          emb += " " + name + '="' + val + '"'
        });
        str += '<embed src="' + href + '" type="application/x-shockwave-flash" width="' + selectedOpts.width + '" height="' + selectedOpts.height + '"' + emb + "></embed></object>";
        tmp.html(str);
        _process_inline();
        break;
      case "ajax":
        busy = false;
        $.fancybox.showActivity();
        selectedOpts.ajax.win = selectedOpts.ajax.success;
        ajaxLoader = $.ajax($.extend({}, selectedOpts.ajax, {url:href, data:selectedOpts.ajax.data || {}, error:function(XMLHttpRequest, textStatus, errorThrown) {
          if(XMLHttpRequest.status > 0) {
            _error()
          }
        }, success:function(data, textStatus, XMLHttpRequest) {
          var o = typeof XMLHttpRequest == "object" ? XMLHttpRequest : ajaxLoader;
          if(o.status == 200) {
            if(typeof selectedOpts.ajax.win == "function") {
              ret = selectedOpts.ajax.win(href, data, textStatus, XMLHttpRequest);
              if(ret === false) {
                loading.hide();
                return
              }else {
                if(typeof ret == "string" || typeof ret == "object") {
                  data = ret
                }
              }
            }
            tmp.html(data);
            _process_inline()
          }
        }}));
        break;
      case "iframe":
        _show();
        break
    }
  }, _process_inline = function() {
    var w = selectedOpts.width, h = selectedOpts.height;
    if(w.toString().indexOf("%") > -1) {
      w = parseInt(($(window).width() - selectedOpts.margin * 2) * parseFloat(w) / 100, 10) + "px"
    }else {
      w = w == "auto" ? "auto" : w + "px"
    }
    if(h.toString().indexOf("%") > -1) {
      h = parseInt(($(window).height() - selectedOpts.margin * 2) * parseFloat(h) / 100, 10) + "px"
    }else {
      h = h == "auto" ? "auto" : h + "px"
    }
    tmp.wrapInner('<div style="width:' + w + ";height:" + h + ";overflow: " + (selectedOpts.scrolling == "auto" ? "auto" : selectedOpts.scrolling == "yes" ? "scroll" : "hidden") + ';position:relative;"></div>');
    selectedOpts.width = tmp.width();
    selectedOpts.height = tmp.height();
    _show()
  }, _process_image = function() {
    selectedOpts.width = imgPreloader.width;
    selectedOpts.height = imgPreloader.height;
    $("<img />").attr({"id":"fancybox-img", "src":imgPreloader.src, "alt":selectedOpts.title}).appendTo(tmp);
    _show()
  }, _show = function() {
    $(".joyride-close-tip").click();
    var pos, equal;
    loading.hide();
    if(wrap.is(":visible") && false === currentOpts.onCleanup(currentArray, currentIndex, currentOpts)) {
      $.event.trigger("fancybox-cancel");
      busy = false;
      return
    }
    busy = true;
    $(content.add(overlay)).unbind();
    $(window).unbind("resize.fb scroll.fb");
    $(document).unbind("keydown.fb");
    if(wrap.is(":visible") && currentOpts.titlePosition !== "outside") {
      wrap.css("height", wrap.height())
    }
    currentArray = selectedArray;
    currentIndex = selectedIndex;
    currentOpts = selectedOpts;
    if(currentOpts.overlayShow) {
      overlay.css({"background-color":currentOpts.overlayColor, "opacity":currentOpts.overlayOpacity, "cursor":currentOpts.hideOnOverlayClick ? "pointer" : "auto", "height":$(document).height()});
      if(!overlay.is(":visible")) {
        if(isIE6) {
          $("select:not(#fancybox-tmp select)").filter(function() {
            return this.style.visibility !== "hidden"
          }).css({"visibility":"hidden"}).one("fancybox-cleanup", function() {
            this.style.visibility = "inherit"
          })
        }
        overlay.show()
      }
    }else {
      overlay.hide()
    }
    final_pos = _get_zoom_to();
    _process_title();
    if(wrap.is(":visible")) {
      $(close.add(nav_left).add(nav_right)).hide();
      pos = wrap.position(), start_pos = {top:pos.top, left:pos.left, width:wrap.width(), height:wrap.height()};
      equal = start_pos.width == final_pos.width && start_pos.height == final_pos.height;
      content.fadeTo(currentOpts.changeFade, 0.3, function() {
        var finish_resizing = function() {
          content.html(tmp.contents()).fadeTo(currentOpts.changeFade, 1, _finish)
        };
        $.event.trigger("fancybox-change");
        content.empty().removeAttr("filter").css({"border-width":currentOpts.padding, "width":final_pos.width - currentOpts.padding * 2, "height":selectedOpts.autoDimensions ? "auto" : final_pos.height - titleHeight - currentOpts.padding * 2});
        if(equal) {
          finish_resizing()
        }else {
          fx.prop = 0;
          $(fx).animate({prop:1}, {duration:currentOpts.changeSpeed, easing:currentOpts.easingChange, step:_draw, complete:finish_resizing})
        }
      });
      return
    }
    wrap.removeAttr("style");
    content.css("border-width", currentOpts.padding);
    if(currentOpts.transitionIn == "elastic") {
      start_pos = _get_zoom_from();
      content.html(tmp.contents());
      wrap.show();
      if(currentOpts.opacity) {
        final_pos.opacity = 0
      }
      fx.prop = 0;
      $(fx).animate({prop:1}, {duration:currentOpts.speedIn, easing:currentOpts.easingIn, step:_draw, complete:_finish});
      return
    }
    if(currentOpts.titlePosition == "inside" && titleHeight > 0) {
      title.show()
    }
    content.css({"width":final_pos.width - currentOpts.padding * 2, "height":selectedOpts.autoDimensions ? "auto" : final_pos.height - titleHeight - currentOpts.padding * 2}).html(tmp.contents());
    wrap.css(final_pos).fadeIn(currentOpts.transitionIn == "none" ? 0 : currentOpts.speedIn, _finish)
  }, _format_title = function(title) {
    if(title && title.length) {
      if(currentOpts.titlePosition == "float") {
        return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">' + title + '</td><td id="fancybox-title-float-right"></td></tr></table>'
      }
      return'<div id="fancybox-title-' + currentOpts.titlePosition + '">' + title + "</div>"
    }
    return false
  }, _process_title = function() {
    titleStr = currentOpts.title || "";
    titleHeight = 0;
    title.empty().removeAttr("style").removeClass();
    if(currentOpts.titleShow === false) {
      title.hide();
      return
    }
    titleStr = $.isFunction(currentOpts.titleFormat) ? currentOpts.titleFormat(titleStr, currentArray, currentIndex, currentOpts) : _format_title(titleStr);
    if(!titleStr || titleStr === "") {
      title.hide();
      return
    }
    title.addClass("fancybox-title-" + currentOpts.titlePosition).html(titleStr).appendTo("body").show();
    switch(currentOpts.titlePosition) {
      case "inside":
        title.css({"width":final_pos.width - currentOpts.padding * 2, "marginLeft":currentOpts.padding, "marginRight":currentOpts.padding});
        titleHeight = title.outerHeight(true);
        title.appendTo(outer);
        final_pos.height += titleHeight;
        break;
      case "over":
        title.css({"marginLeft":currentOpts.padding, "width":final_pos.width - currentOpts.padding * 2, "bottom":currentOpts.padding}).appendTo(outer);
        break;
      case "float":
        title.css("left", parseInt((title.width() - final_pos.width - 40) / 2, 10) * -1).appendTo(wrap);
        break;
      default:
        title.css({"width":final_pos.width - currentOpts.padding * 2, "paddingLeft":currentOpts.padding, "paddingRight":currentOpts.padding}).appendTo(wrap);
        break
    }
    title.hide()
  }, _set_navigation = function() {
    if(currentOpts.enableEscapeButton || currentOpts.enableKeyboardNav) {
      $(document).bind("keydown.fb", function(e) {
        if(e.keyCode == 27 && currentOpts.enableEscapeButton) {
          e.preventDefault();
          $.fancybox.close()
        }else {
          if((e.keyCode == 37 || e.keyCode == 39) && currentOpts.enableKeyboardNav && e.target.tagName !== "INPUT" && e.target.tagName !== "TEXTAREA" && e.target.tagName !== "SELECT") {
            e.preventDefault();
            $.fancybox[e.keyCode == 37 ? "prev" : "next"]()
          }
        }
      })
    }
    if(!currentOpts.showNavArrows) {
      nav_left.hide();
      nav_right.hide();
      return
    }
    if(currentOpts.cyclic && currentArray.length > 1 || currentIndex !== 0) {
      nav_left.show()
    }
    if(currentOpts.cyclic && currentArray.length > 1 || currentIndex != currentArray.length - 1) {
      nav_right.show()
    }
  }, _finish = function() {
    if(!$.support.opacity) {
      content.get(0).style.removeAttribute("filter");
      wrap.get(0).style.removeAttribute("filter")
    }
    if(selectedOpts.autoDimensions) {
      content.css("height", "auto")
    }
    wrap.css("height", "auto");
    if(titleStr && titleStr.length) {
      title.show()
    }
    if(currentOpts.showCloseButton) {
      close.show()
    }
    _set_navigation();
    if(currentOpts.hideOnContentClick) {
      content.bind("click", $.fancybox.close)
    }
    if(currentOpts.hideOnOverlayClick) {
      overlay.bind("click", $.fancybox.close)
    }
    $(window).bind("resize.fb", $.fancybox.resize);
    if(currentOpts.centerOnScroll) {
      $(window).bind("scroll.fb", $.fancybox.center)
    }
    if(currentOpts.type == "iframe") {
      $('<iframe id="fancybox-frame" name="fancybox-frame' + (new Date).getTime() + '" frameborder="0" hspace="0" ' + ($.browser.msie ? 'allowtransparency="true""' : "") + ' scrolling="' + selectedOpts.scrolling + '" src="' + currentOpts.href + '"></iframe>').appendTo(content)
    }
    wrap.show();
    busy = false;
    $.fancybox.center();
    currentOpts.onComplete(currentArray, currentIndex, currentOpts);
    _preload_images()
  }, _preload_images = function() {
    var href, objNext;
    if(currentArray.length - 1 > currentIndex) {
      href = currentArray[currentIndex + 1].href;
      if(typeof href !== "undefined" && href.match(imgRegExp)) {
        objNext = new Image;
        objNext.src = href
      }
    }
    if(currentIndex > 0) {
      href = currentArray[currentIndex - 1].href;
      if(typeof href !== "undefined" && href.match(imgRegExp)) {
        objNext = new Image;
        objNext.src = href
      }
    }
  }, _draw = function(pos) {
    var dim = {width:parseInt(start_pos.width + (final_pos.width - start_pos.width) * pos, 10), height:parseInt(start_pos.height + (final_pos.height - start_pos.height) * pos, 10), top:parseInt(start_pos.top + (final_pos.top - start_pos.top) * pos, 10), left:parseInt(start_pos.left + (final_pos.left - start_pos.left) * pos, 10)};
    if(typeof final_pos.opacity !== "undefined") {
      dim.opacity = pos < 0.5 ? 0.5 : pos
    }
    wrap.css(dim);
    content.css({"width":dim.width - currentOpts.padding * 2, "height":dim.height - titleHeight * pos - currentOpts.padding * 2})
  }, _get_viewport = function() {
    return[$(window).width() - currentOpts.margin * 2, $(window).height() - currentOpts.margin * 2, $(document).scrollLeft() + currentOpts.margin, $(document).scrollTop() + currentOpts.margin]
  }, _get_zoom_to = function() {
    var view = _get_viewport(), to = {}, resize = currentOpts.autoScale, double_padding = currentOpts.padding * 2, ratio;
    if(currentOpts.width.toString().indexOf("%") > -1) {
      to.width = parseInt(view[0] * parseFloat(currentOpts.width) / 100, 10)
    }else {
      to.width = currentOpts.width + double_padding
    }
    if(currentOpts.height.toString().indexOf("%") > -1) {
      to.height = parseInt(view[1] * parseFloat(currentOpts.height) / 100, 10)
    }else {
      to.height = currentOpts.height + double_padding
    }
    if(resize && (to.width > view[0] || to.height > view[1])) {
      if(selectedOpts.type == "image" || selectedOpts.type == "swf") {
        ratio = currentOpts.width / currentOpts.height;
        if(to.width > view[0]) {
          to.width = view[0];
          to.height = parseInt((to.width - double_padding) / ratio + double_padding, 10)
        }
        if(to.height > view[1]) {
          to.height = view[1];
          to.width = parseInt((to.height - double_padding) * ratio + double_padding, 10)
        }
      }else {
        to.width = Math.min(to.width, view[0]);
        to.height = Math.min(to.height, view[1])
      }
    }
    to.top = parseInt(Math.max(view[3] - 20, view[3] + (view[1] - to.height - 40) * 0.5), 10);
    to.left = parseInt(Math.max(view[2] - 20, view[2] + (view[0] - to.width - 40) * 0.5), 10);
    return to
  }, _get_obj_pos = function(obj) {
    var pos = obj.offset();
    pos.top += parseInt(obj.css("paddingTop"), 10) || 0;
    pos.left += parseInt(obj.css("paddingLeft"), 10) || 0;
    pos.top += parseInt(obj.css("border-top-width"), 10) || 0;
    pos.left += parseInt(obj.css("border-left-width"), 10) || 0;
    pos.width = obj.width();
    pos.height = obj.height();
    return pos
  }, _get_zoom_from = function() {
    var orig = selectedOpts.orig ? $(selectedOpts.orig) : false, from = {}, pos, view;
    if(orig && orig.length) {
      pos = _get_obj_pos(orig);
      from = {width:pos.width + currentOpts.padding * 2, height:pos.height + currentOpts.padding * 2, top:pos.top - currentOpts.padding - 20, left:pos.left - currentOpts.padding - 20}
    }else {
      view = _get_viewport();
      from = {width:currentOpts.padding * 2, height:currentOpts.padding * 2, top:parseInt(view[3] + view[1] * 0.5, 10), left:parseInt(view[2] + view[0] * 0.5, 10)}
    }
    return from
  }, _animate_loading = function() {
    if(!loading.is(":visible")) {
      clearInterval(loadingTimer);
      return
    }
    $("div", loading).css("top", loadingFrame * -40 + "px");
    loadingFrame = (loadingFrame + 1) % 12
  };
  $.fn.fancybox = function(options) {
    if(!$(this).length) {
      return this
    }
    $(this).data("fancybox", $.extend({}, options, $.metadata ? $(this).metadata() : {})).unbind("click.fb").bind("click.fb", function(e) {
      e.preventDefault();
      if(busy) {
        return
      }
      busy = true;
      $(this).blur();
      selectedArray = [];
      selectedIndex = 0;
      var rel = $(this).attr("rel") || "";
      if(!rel || rel == "" || rel === "nofollow") {
        selectedArray.push(this)
      }else {
        selectedArray = $("a[rel=" + rel + "], area[rel=" + rel + "]");
        selectedIndex = selectedArray.index(this)
      }
      _start();
      return
    });
    return this
  };
  $.fancybox = function(obj) {
    var opts;
    if(busy) {
      return
    }
    busy = true;
    opts = typeof arguments[1] !== "undefined" ? arguments[1] : {};
    selectedArray = [];
    selectedIndex = parseInt(opts.index, 10) || 0;
    if($.isArray(obj)) {
      for(var i = 0, j = obj.length;i < j;i++) {
        if(typeof obj[i] == "object") {
          $(obj[i]).data("fancybox", $.extend({}, opts, obj[i]))
        }else {
          obj[i] = $({}).data("fancybox", $.extend({content:obj[i]}, opts))
        }
      }
      selectedArray = jQuery.merge(selectedArray, obj)
    }else {
      if(typeof obj == "object") {
        $(obj).data("fancybox", $.extend({}, opts, obj))
      }else {
        obj = $({}).data("fancybox", $.extend({content:obj}, opts))
      }
      selectedArray.push(obj)
    }
    if(selectedIndex > selectedArray.length || selectedIndex < 0) {
      selectedIndex = 0
    }
    _start()
  };
  $.fancybox.showActivity = function() {
    clearInterval(loadingTimer);
    loading.show();
    loadingTimer = setInterval(_animate_loading, 66)
  };
  $.fancybox.hideActivity = function() {
    loading.hide()
  };
  $.fancybox.next = function() {
    return $.fancybox.pos(currentIndex + 1)
  };
  $.fancybox.prev = function() {
    return $.fancybox.pos(currentIndex - 1)
  };
  $.fancybox.pos = function(pos) {
    if(busy) {
      return
    }
    pos = parseInt(pos);
    selectedArray = currentArray;
    if(pos > -1 && pos < currentArray.length) {
      selectedIndex = pos;
      _start()
    }else {
      if(currentOpts.cyclic && currentArray.length > 1) {
        selectedIndex = pos >= currentArray.length ? 0 : currentArray.length - 1;
        _start()
      }
    }
    return
  };
  $.fancybox.cancel = function() {
    if(busy) {
      return
    }
    busy = true;
    $.event.trigger("fancybox-cancel");
    _abort();
    selectedOpts.onCancel(selectedArray, selectedIndex, selectedOpts);
    busy = false
  };
  $.fancybox.close = function() {
    $(".joyride-close-tip").click();
    if(busy || wrap.is(":hidden")) {
      return
    }
    busy = true;
    if(currentOpts && false === currentOpts.onCleanup(currentArray, currentIndex, currentOpts)) {
      busy = false;
      return
    }
    _abort();
    $(close.add(nav_left).add(nav_right)).hide();
    $(content.add(overlay)).unbind();
    $(window).unbind("resize.fb scroll.fb");
    $(document).unbind("keydown.fb");
    content.find("iframe").attr("src", isIE6 && /^https/i.test(window.location.href || "") ? "javascript:void(false)" : "about:blank");
    if(currentOpts.titlePosition !== "inside") {
      title.empty()
    }
    wrap.stop();
    function _cleanup() {
      overlay.fadeOut("fast");
      title.empty().hide();
      wrap.hide();
      $.event.trigger("fancybox-cleanup");
      content.empty();
      currentOpts.onClosed(currentArray, currentIndex, currentOpts);
      currentArray = selectedOpts = [];
      currentIndex = selectedIndex = 0;
      currentOpts = selectedOpts = {};
      busy = false
    }
    if(currentOpts.transitionOut == "elastic") {
      start_pos = _get_zoom_from();
      var pos = wrap.position();
      final_pos = {top:pos.top, left:pos.left, width:wrap.width(), height:wrap.height()};
      if(currentOpts.opacity) {
        final_pos.opacity = 1
      }
      title.empty().hide();
      fx.prop = 1;
      $(fx).animate({prop:0}, {duration:currentOpts.speedOut, easing:currentOpts.easingOut, step:_draw, complete:_cleanup})
    }else {
      wrap.fadeOut(currentOpts.transitionOut == "none" ? 0 : currentOpts.speedOut, _cleanup)
    }
  };
  $.fancybox.resize = function() {
    if(overlay.is(":visible")) {
      overlay.css("height", $(document).height())
    }
    $.fancybox.center(true)
  };
  $.fancybox.center = function() {
    var view, align;
    if(busy) {
      return
    }
    align = arguments[0] === true ? 1 : 0;
    view = _get_viewport();
    if(!align && (wrap.width() > view[0] || wrap.height() > view[1])) {
      return
    }
    wrap.stop().animate({"top":parseInt(Math.max(view[3] - 20, view[3] + (view[1] - content.height() - 40) * 0.5 - currentOpts.padding)), "left":parseInt(Math.max(view[2] - 20, view[2] + (view[0] - content.width() - 40) * 0.5 - currentOpts.padding))}, typeof arguments[0] == "number" ? arguments[0] : 200)
  };
  $.fancybox.init = function() {
    if($("#fancybox-wrap").length) {
      return
    }
    $("body").append(tmp = $('<div id="fancybox-tmp"></div>'), loading = $('<div id="fancybox-loading"><div></div></div>'), overlay = $('<div id="fancybox-overlay"></div>'), wrap = $('<div id="fancybox-wrap"></div>'));
    outer = $('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(wrap);
    outer.append(content = $('<div id="fancybox-content"></div>'), close = $('<a id="fancybox-close"></a>'), title = $('<div id="fancybox-title"></div>'), nav_left = $('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'), nav_right = $('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));
    close.click($.fancybox.close);
    loading.click($.fancybox.cancel);
    nav_left.click(function(e) {
      e.preventDefault();
      $.fancybox.prev()
    });
    nav_right.click(function(e) {
      e.preventDefault();
      $.fancybox.next()
    });
    if($.fn.mousewheel) {
      wrap.bind("mousewheel.fb", function(e, delta) {
        if(busy) {
          e.preventDefault()
        }else {
          if($(e.target).get(0).clientHeight == 0 || $(e.target).get(0).scrollHeight === $(e.target).get(0).clientHeight) {
            e.preventDefault();
            $.fancybox[delta > 0 ? "prev" : "next"]()
          }
        }
      })
    }
    if(!$.support.opacity) {
      wrap.addClass("fancybox-ie")
    }
    if(isIE6) {
      loading.addClass("fancybox-ie6");
      wrap.addClass("fancybox-ie6");
      $('<iframe id="fancybox-hide-sel-frame" src="' + (/^https/i.test(window.location.href || "") ? "javascript:void(false)" : "about:blank") + '" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer)
    }
  };
  $.fn.fancybox.defaults = {padding:10, margin:40, opacity:false, modal:false, cyclic:false, scrolling:"auto", width:560, height:340, autoScale:true, autoDimensions:true, centerOnScroll:false, ajax:{}, swf:{wmode:"transparent"}, hideOnOverlayClick:true, hideOnContentClick:false, overlayShow:true, overlayOpacity:0.7, overlayColor:"#777", titleShow:true, titlePosition:"float", titleFormat:null, titleFromAlt:false, transitionIn:"fade", transitionOut:"fade", speedIn:300, speedOut:300, changeSpeed:300, 
  changeFade:"fast", easingIn:"swing", easingOut:"swing", showCloseButton:true, showNavArrows:true, enableEscapeButton:true, enableKeyboardNav:true, onStart:function() {
  }, onCancel:function() {
  }, onComplete:function() {
  }, onCleanup:function() {
  }, onClosed:function() {
  }, onError:function() {
  }};
  $(document).ready(function() {
    $.fancybox.init()
  })
})(jQuery);
(function($) {
  var feature = {};
  feature.fileapi = $("<input type='file'/>").get(0).files !== undefined;
  feature.formdata = window.FormData !== undefined;
  $.fn.ajaxSubmit = function(options) {
    if(!this.length) {
      log("ajaxSubmit: skipping submit process - no element selected");
      return this
    }
    var method, action, url, $form = this;
    if(typeof options == "function") {
      options = {success:options}
    }
    method = this.attr("method");
    action = this.attr("action");
    url = typeof action === "string" ? $.trim(action) : "";
    url = url || window.location.href || "";
    if(url) {
      url = (url.match(/^([^#]+)/) || [])[1]
    }
    options = $.extend(true, {url:url, success:$.ajaxSettings.success, type:method || "GET", iframeSrc:/^https/i.test(window.location.href || "") ? "javascript:false" : "about:blank"}, options);
    var veto = {};
    this.trigger("form-pre-serialize", [this, options, veto]);
    if(veto.veto) {
      log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");
      return this
    }
    if(options.beforeSerialize && options.beforeSerialize(this, options) === false) {
      log("ajaxSubmit: submit aborted via beforeSerialize callback");
      return this
    }
    var traditional = options.traditional;
    if(traditional === undefined) {
      traditional = $.ajaxSettings.traditional
    }
    var elements = [];
    var qx, a = this.formToArray(options.semantic, elements);
    if(options.data) {
      options.extraData = options.data;
      qx = $.param(options.data, traditional)
    }
    if(options.beforeSubmit && options.beforeSubmit(a, this, options) === false) {
      log("ajaxSubmit: submit aborted via beforeSubmit callback");
      return this
    }
    this.trigger("form-submit-validate", [a, this, options, veto]);
    if(veto.veto) {
      log("ajaxSubmit: submit vetoed via form-submit-validate trigger");
      return this
    }
    var q = $.param(a, traditional);
    if(qx) {
      q = q ? q + "&" + qx : qx
    }
    if(options.type.toUpperCase() == "GET") {
      options.url += (options.url.indexOf("?") >= 0 ? "&" : "?") + q;
      options.data = null
    }else {
      options.data = q
    }
    var callbacks = [];
    if(options.resetForm) {
      callbacks.push(function() {
        $form.resetForm()
      })
    }
    if(options.clearForm) {
      callbacks.push(function() {
        $form.clearForm(options.includeHidden)
      })
    }
    if(!options.dataType && options.target) {
      var oldSuccess = options.success || function() {
      };
      callbacks.push(function(data) {
        var fn = options.replaceTarget ? "replaceWith" : "html";
        $(options.target)[fn](data).each(oldSuccess, arguments)
      })
    }else {
      if(options.success) {
        callbacks.push(options.success)
      }
    }
    options.success = function(data, status, xhr) {
      var context = options.context || options;
      for(var i = 0, max = callbacks.length;i < max;i++) {
        callbacks[i].apply(context, [data, status, xhr || $form, $form])
      }
    };
    var fileInputs = $("input:file:enabled[value]", this);
    var hasFileInputs = fileInputs.length > 0;
    var mp = "multipart/form-data";
    var multipart = $form.attr("enctype") == mp || $form.attr("encoding") == mp;
    var fileAPI = feature.fileapi && feature.formdata;
    log("fileAPI :" + fileAPI);
    var shouldUseFrame = (hasFileInputs || multipart) && !fileAPI;
    if(options.iframe !== false && (options.iframe || shouldUseFrame)) {
      if(options.closeKeepAlive) {
        $.get(options.closeKeepAlive, function() {
          fileUploadIframe(a)
        })
      }else {
        fileUploadIframe(a)
      }
    }else {
      if((hasFileInputs || multipart) && fileAPI) {
        fileUploadXhr(a)
      }else {
        $.ajax(options)
      }
    }
    for(var k = 0;k < elements.length;k++) {
      elements[k] = null
    }
    this.trigger("form-submit-notify", [this, options]);
    return this;
    function fileUploadXhr(a) {
      var formdata = new FormData;
      for(var i = 0;i < a.length;i++) {
        formdata.append(a[i].name, a[i].value)
      }
      if(options.extraData) {
        for(var p in options.extraData) {
          if(options.extraData.hasOwnProperty(p)) {
            formdata.append(p, options.extraData[p])
          }
        }
      }
      options.data = null;
      var s = $.extend(true, {}, $.ajaxSettings, options, {contentType:false, processData:false, cache:false, type:"POST"});
      if(options.uploadProgress) {
        s.xhr = function() {
          var xhr = jQuery.ajaxSettings.xhr();
          if(xhr.upload) {
            xhr.upload.onprogress = function(event) {
              var percent = 0;
              var position = event.loaded || event.position;
              var total = event.total;
              if(event.lengthComputable) {
                percent = Math.ceil(position / total * 100)
              }
              options.uploadProgress(event, position, total, percent)
            }
          }
          return xhr
        }
      }
      s.data = null;
      var beforeSend = s.beforeSend;
      s.beforeSend = function(xhr, o) {
        o.data = formdata;
        if(beforeSend) {
          beforeSend.call(o, xhr, options)
        }
      };
      $.ajax(s)
    }
    function fileUploadIframe(a) {
      var form = $form[0], el, i, s, g, id, $io, io, xhr, sub, n, timedOut, timeoutHandle;
      var useProp = !!$.fn.prop;
      if($(":input[name=submit],:input[id=submit]", form).length) {
        return
      }
      if(a) {
        for(i = 0;i < elements.length;i++) {
          el = $(elements[i]);
          if(useProp) {
            el.prop("disabled", false)
          }else {
            el.removeAttr("disabled")
          }
        }
      }
      s = $.extend(true, {}, $.ajaxSettings, options);
      s.context = s.context || s;
      id = "jqFormIO" + (new Date).getTime();
      if(s.iframeTarget) {
        $io = $(s.iframeTarget);
        n = $io.attr("name");
        if(!n) {
          $io.attr("name", id)
        }else {
          id = n
        }
      }else {
        $io = $('<iframe name="' + id + '" src="' + s.iframeSrc + '" />');
        $io.css({position:"absolute", top:"-1000px", left:"-1000px"})
      }
      io = $io[0];
      xhr = {aborted:0, responseText:null, responseXML:null, status:0, statusText:"n/a", getAllResponseHeaders:function() {
      }, getResponseHeader:function() {
      }, setRequestHeader:function() {
      }, abort:function(status) {
        var e = status === "timeout" ? "timeout" : "aborted";
        log("aborting upload... " + e);
        this.aborted = 1;
        $io.attr("src", s.iframeSrc);
        xhr.error = e;
        if(s.error) {
          s.error.call(s.context, xhr, e, status)
        }
        if(g) {
          $.event.trigger("ajaxError", [xhr, s, e])
        }
        if(s.complete) {
          s.complete.call(s.context, xhr, e)
        }
      }};
      g = s.global;
      if(g && 0 === $.active++) {
        $.event.trigger("ajaxStart")
      }
      if(g) {
        $.event.trigger("ajaxSend", [xhr, s])
      }
      if(s.beforeSend && s.beforeSend.call(s.context, xhr, s) === false) {
        if(s.global) {
          $.active--
        }
        return
      }
      if(xhr.aborted) {
        return
      }
      sub = form.clk;
      if(sub) {
        n = sub.name;
        if(n && !sub.disabled) {
          s.extraData = s.extraData || {};
          s.extraData[n] = sub.value;
          if(sub.type == "image") {
            s.extraData[n + ".x"] = form.clk_x;
            s.extraData[n + ".y"] = form.clk_y
          }
        }
      }
      var CLIENT_TIMEOUT_ABORT = 1;
      var SERVER_ABORT = 2;
      function getDoc(frame) {
        var doc = frame.contentWindow ? frame.contentWindow.document : frame.contentDocument ? frame.contentDocument : frame.document;
        return doc
      }
      var csrf_token = $("meta[name=csrf-token]").attr("content");
      var csrf_param = $("meta[name=csrf-param]").attr("content");
      if(csrf_param && csrf_token) {
        s.extraData = s.extraData || {};
        s.extraData[csrf_param] = csrf_token
      }
      function doSubmit() {
        var t = $form.attr("target"), a = $form.attr("action");
        form.setAttribute("target", id);
        if(!method) {
          form.setAttribute("method", "POST")
        }
        if(a != s.url) {
          form.setAttribute("action", s.url)
        }
        if(!s.skipEncodingOverride && (!method || /post/i.test(method))) {
          $form.attr({encoding:"multipart/form-data", enctype:"multipart/form-data"})
        }
        if(s.timeout) {
          timeoutHandle = setTimeout(function() {
            timedOut = true;
            cb(CLIENT_TIMEOUT_ABORT)
          }, s.timeout)
        }
        function checkState() {
          try {
            var state = getDoc(io).readyState;
            log("state = " + state);
            if(state && state.toLowerCase() == "uninitialized") {
              setTimeout(checkState, 50)
            }
          }catch(e) {
            log("Server abort: ", e, " (", e.name, ")");
            cb(SERVER_ABORT);
            if(timeoutHandle) {
              clearTimeout(timeoutHandle)
            }
            timeoutHandle = undefined
          }
        }
        var extraInputs = [];
        try {
          if(s.extraData) {
            for(var n in s.extraData) {
              if(s.extraData.hasOwnProperty(n)) {
                extraInputs.push($('<input type="hidden" name="' + n + '">').attr("value", s.extraData[n]).appendTo(form)[0])
              }
            }
          }
          if(!s.iframeTarget) {
            $io.appendTo("body");
            if(io.attachEvent) {
              io.attachEvent("onload", cb)
            }else {
              io.addEventListener("load", cb, false)
            }
          }
          setTimeout(checkState, 15);
          form.submit()
        }finally {
          form.setAttribute("action", a);
          if(t) {
            form.setAttribute("target", t)
          }else {
            $form.removeAttr("target")
          }
          $(extraInputs).remove()
        }
      }
      if(s.forceSync) {
        doSubmit()
      }else {
        setTimeout(doSubmit, 10)
      }
      var data, doc, domCheckCount = 50, callbackProcessed;
      function cb(e) {
        if(xhr.aborted || callbackProcessed) {
          return
        }
        try {
          doc = getDoc(io)
        }catch(ex) {
          log("cannot access response document: ", ex);
          e = SERVER_ABORT
        }
        if(e === CLIENT_TIMEOUT_ABORT && xhr) {
          xhr.abort("timeout");
          return
        }else {
          if(e == SERVER_ABORT && xhr) {
            xhr.abort("server abort");
            return
          }
        }
        if(!doc || doc.location.href == s.iframeSrc) {
          if(!timedOut) {
            return
          }
        }
        if(io.detachEvent) {
          io.detachEvent("onload", cb)
        }else {
          io.removeEventListener("load", cb, false)
        }
        var status = "success", errMsg;
        try {
          if(timedOut) {
            throw"timeout";
          }
          var isXml = s.dataType == "xml" || doc.XMLDocument || $.isXMLDoc(doc);
          log("isXml=" + isXml);
          if(!isXml && window.opera && (doc.body === null || !doc.body.innerHTML)) {
            if(--domCheckCount) {
              log("requeing onLoad callback, DOM not available");
              setTimeout(cb, 250);
              return
            }
          }
          var docRoot = doc.body ? doc.body : doc.documentElement;
          xhr.responseText = docRoot ? docRoot.innerHTML : null;
          xhr.responseXML = doc.XMLDocument ? doc.XMLDocument : doc;
          if(isXml) {
            s.dataType = "xml"
          }
          xhr.getResponseHeader = function(header) {
            var headers = {"content-type":s.dataType};
            return headers[header]
          };
          if(docRoot) {
            xhr.status = Number(docRoot.getAttribute("status")) || xhr.status;
            xhr.statusText = docRoot.getAttribute("statusText") || xhr.statusText
          }
          var dt = (s.dataType || "").toLowerCase();
          var scr = /(json|script|text)/.test(dt);
          if(scr || s.textarea) {
            var ta = doc.getElementsByTagName("textarea")[0];
            if(ta) {
              xhr.responseText = ta.value;
              xhr.status = Number(ta.getAttribute("status")) || xhr.status;
              xhr.statusText = ta.getAttribute("statusText") || xhr.statusText
            }else {
              if(scr) {
                var pre = doc.getElementsByTagName("pre")[0];
                var b = doc.getElementsByTagName("body")[0];
                if(pre) {
                  xhr.responseText = pre.textContent ? pre.textContent : pre.innerText
                }else {
                  if(b) {
                    xhr.responseText = b.textContent ? b.textContent : b.innerText
                  }
                }
              }
            }
          }else {
            if(dt == "xml" && !xhr.responseXML && xhr.responseText) {
              xhr.responseXML = toXml(xhr.responseText)
            }
          }
          try {
            data = httpData(xhr, dt, s)
          }catch(e) {
            status = "parsererror";
            xhr.error = errMsg = e || status
          }
        }catch(e) {
          log("error caught: ", e);
          status = "error";
          xhr.error = errMsg = e || status
        }
        if(xhr.aborted) {
          log("upload aborted");
          status = null
        }
        if(xhr.status) {
          status = xhr.status >= 200 && xhr.status < 300 || xhr.status === 304 ? "success" : "error"
        }
        if(status === "success") {
          if(s.success) {
            s.success.call(s.context, data, "success", xhr)
          }
          if(g) {
            $.event.trigger("ajaxSuccess", [xhr, s])
          }
        }else {
          if(status) {
            if(errMsg === undefined) {
              errMsg = xhr.statusText
            }
            if(s.error) {
              s.error.call(s.context, xhr, status, errMsg)
            }
            if(g) {
              $.event.trigger("ajaxError", [xhr, s, errMsg])
            }
          }
        }
        if(g) {
          $.event.trigger("ajaxComplete", [xhr, s])
        }
        if(g && !--$.active) {
          $.event.trigger("ajaxStop")
        }
        if(s.complete) {
          s.complete.call(s.context, xhr, status)
        }
        callbackProcessed = true;
        if(s.timeout) {
          clearTimeout(timeoutHandle)
        }
        setTimeout(function() {
          if(!s.iframeTarget) {
            $io.remove()
          }
          xhr.responseXML = null
        }, 100)
      }
      var toXml = $.parseXML || function(s, doc) {
        if(window.ActiveXObject) {
          doc = new ActiveXObject("Microsoft.XMLDOM");
          doc.async = "false";
          doc.loadXML(s)
        }else {
          doc = (new DOMParser).parseFromString(s, "text/xml")
        }
        return doc && doc.documentElement && doc.documentElement.nodeName != "parsererror" ? doc : null
      };
      var parseJSON = $.parseJSON || function(s) {
        return window["eval"]("(" + s + ")")
      };
      var httpData = function(xhr, type, s) {
        var ct = xhr.getResponseHeader("content-type") || "", xml = type === "xml" || !type && ct.indexOf("xml") >= 0, data = xml ? xhr.responseXML : xhr.responseText;
        if(xml && data.documentElement.nodeName === "parsererror") {
          if($.error) {
            $.error("parsererror")
          }
        }
        if(s && s.dataFilter) {
          data = s.dataFilter(data, type)
        }
        if(typeof data === "string") {
          if(type === "json" || !type && ct.indexOf("json") >= 0) {
            data = parseJSON(data)
          }else {
            if(type === "script" || !type && ct.indexOf("javascript") >= 0) {
              $.globalEval(data)
            }
          }
        }
        return data
      }
    }
  };
  $.fn.ajaxForm = function(options) {
    options = options || {};
    options.delegation = options.delegation && $.isFunction($.fn.on);
    if(!options.delegation && this.length === 0) {
      var o = {s:this.selector, c:this.context};
      if(!$.isReady && o.s) {
        log("DOM not ready, queuing ajaxForm");
        $(function() {
          $(o.s, o.c).ajaxForm(options)
        });
        return this
      }
      log("terminating; zero elements found by selector" + ($.isReady ? "" : " (DOM not ready)"));
      return this
    }
    if(options.delegation) {
      $(document).off("submit.form-plugin", this.selector, doAjaxSubmit).off("click.form-plugin", this.selector, captureSubmittingElement).on("submit.form-plugin", this.selector, options, doAjaxSubmit).on("click.form-plugin", this.selector, options, captureSubmittingElement);
      return this
    }
    return this.ajaxFormUnbind().bind("submit.form-plugin", options, doAjaxSubmit).bind("click.form-plugin", options, captureSubmittingElement)
  };
  function doAjaxSubmit(e) {
    var options = e.data;
    if(!e.isDefaultPrevented()) {
      e.preventDefault();
      $(this).ajaxSubmit(options)
    }
  }
  function captureSubmittingElement(e) {
    var target = e.target;
    var $el = $(target);
    if(!$el.is(":submit,input:image")) {
      var t = $el.closest(":submit");
      if(t.length === 0) {
        return
      }
      target = t[0]
    }
    var form = this;
    form.clk = target;
    if(target.type == "image") {
      if(e.offsetX !== undefined) {
        form.clk_x = e.offsetX;
        form.clk_y = e.offsetY
      }else {
        if(typeof $.fn.offset == "function") {
          var offset = $el.offset();
          form.clk_x = e.pageX - offset.left;
          form.clk_y = e.pageY - offset.top
        }else {
          form.clk_x = e.pageX - target.offsetLeft;
          form.clk_y = e.pageY - target.offsetTop
        }
      }
    }
    setTimeout(function() {
      form.clk = form.clk_x = form.clk_y = null
    }, 100)
  }
  $.fn.ajaxFormUnbind = function() {
    return this.unbind("submit.form-plugin click.form-plugin")
  };
  $.fn.formToArray = function(semantic, elements) {
    var a = [];
    if(this.length === 0) {
      return a
    }
    var form = this[0];
    var els = semantic ? form.getElementsByTagName("*") : form.elements;
    if(!els) {
      return a
    }
    var i, j, n, v, el, max, jmax;
    for(i = 0, max = els.length;i < max;i++) {
      el = els[i];
      n = el.name;
      if(!n) {
        continue
      }
      if(semantic && form.clk && el.type == "image") {
        if(!el.disabled && form.clk == el) {
          a.push({name:n, value:$(el).val(), type:el.type});
          a.push({name:n + ".x", value:form.clk_x}, {name:n + ".y", value:form.clk_y})
        }
        continue
      }
      v = $.fieldValue(el, true);
      if(v && v.constructor == Array) {
        if(elements) {
          elements.push(el)
        }
        for(j = 0, jmax = v.length;j < jmax;j++) {
          a.push({name:n, value:v[j]})
        }
      }else {
        if(feature.fileapi && el.type == "file" && !el.disabled) {
          if(elements) {
            elements.push(el)
          }
          var files = el.files;
          if(files.length) {
            for(j = 0;j < files.length;j++) {
              a.push({name:n, value:files[j], type:el.type})
            }
          }else {
            a.push({name:n, value:"", type:el.type})
          }
        }else {
          if(v !== null && typeof v != "undefined") {
            if(elements) {
              elements.push(el)
            }
            a.push({name:n, value:v, type:el.type, required:el.required})
          }
        }
      }
    }
    if(!semantic && form.clk) {
      var $input = $(form.clk), input = $input[0];
      n = input.name;
      if(n && !input.disabled && input.type == "image") {
        a.push({name:n, value:$input.val()});
        a.push({name:n + ".x", value:form.clk_x}, {name:n + ".y", value:form.clk_y})
      }
    }
    return a
  };
  $.fn.formSerialize = function(semantic) {
    return $.param(this.formToArray(semantic))
  };
  $.fn.fieldSerialize = function(successful) {
    var a = [];
    this.each(function() {
      var n = this.name;
      if(!n) {
        return
      }
      var v = $.fieldValue(this, successful);
      if(v && v.constructor == Array) {
        for(var i = 0, max = v.length;i < max;i++) {
          a.push({name:n, value:v[i]})
        }
      }else {
        if(v !== null && typeof v != "undefined") {
          a.push({name:this.name, value:v})
        }
      }
    });
    return $.param(a)
  };
  $.fn.fieldValue = function(successful) {
    for(var val = [], i = 0, max = this.length;i < max;i++) {
      var el = this[i];
      var v = $.fieldValue(el, successful);
      if(v === null || typeof v == "undefined" || v.constructor == Array && !v.length) {
        continue
      }
      if(v.constructor == Array) {
        $.merge(val, v)
      }else {
        val.push(v)
      }
    }
    return val
  };
  $.fieldValue = function(el, successful) {
    var n = el.name, t = el.type, tag = el.tagName.toLowerCase();
    if(successful === undefined) {
      successful = true
    }
    if(successful && (!n || el.disabled || t == "reset" || t == "button" || (t == "checkbox" || t == "radio") && !el.checked || (t == "submit" || t == "image") && el.form && el.form.clk != el || tag == "select" && el.selectedIndex == -1)) {
      return null
    }
    if(tag == "select") {
      var index = el.selectedIndex;
      if(index < 0) {
        return null
      }
      var a = [], ops = el.options;
      var one = t == "select-one";
      var max = one ? index + 1 : ops.length;
      for(var i = one ? index : 0;i < max;i++) {
        var op = ops[i];
        if(op.selected) {
          var v = op.value;
          if(!v) {
            v = op.attributes && op.attributes["value"] && !op.attributes["value"].specified ? op.text : op.value
          }
          if(one) {
            return v
          }
          a.push(v)
        }
      }
      return a
    }
    return $(el).val()
  };
  $.fn.clearForm = function(includeHidden) {
    return this.each(function() {
      $("input,select,textarea", this).clearFields(includeHidden)
    })
  };
  $.fn.clearFields = $.fn.clearInputs = function(includeHidden) {
    var re = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;
    return this.each(function() {
      var t = this.type, tag = this.tagName.toLowerCase();
      if(re.test(t) || tag == "textarea") {
        this.value = ""
      }else {
        if(t == "checkbox" || t == "radio") {
          this.checked = false
        }else {
          if(tag == "select") {
            this.selectedIndex = -1
          }else {
            if(includeHidden) {
              if(includeHidden === true && /hidden/.test(t) || typeof includeHidden == "string" && $(this).is(includeHidden)) {
                this.value = ""
              }
            }
          }
        }
      }
    })
  };
  $.fn.resetForm = function() {
    return this.each(function() {
      if(typeof this.reset == "function" || typeof this.reset == "object" && !this.reset.nodeType) {
        this.reset()
      }
    })
  };
  $.fn.enable = function(b) {
    if(b === undefined) {
      b = true
    }
    return this.each(function() {
      this.disabled = !b
    })
  };
  $.fn.selected = function(select) {
    if(select === undefined) {
      select = true
    }
    return this.each(function() {
      var t = this.type;
      if(t == "checkbox" || t == "radio") {
        this.checked = select
      }else {
        if(this.tagName.toLowerCase() == "option") {
          var $sel = $(this).parent("select");
          if(select && $sel[0] && $sel[0].type == "select-one") {
            $sel.find("option").selected(false)
          }
          this.selected = select
        }
      }
    })
  };
  $.fn.ajaxSubmit.debug = false;
  function log() {
    if(!$.fn.ajaxSubmit.debug) {
      return
    }
    var msg = "[jquery.form] " + Array.prototype.join.call(arguments, "");
    if(window.console && window.console.log) {
      window.console.log(msg)
    }else {
      if(window.opera && window.opera.postError) {
        window.opera.postError(msg)
      }
    }
  }
})(jQuery);
(function($) {
  $.fn.joyride = function(options) {
    var settings = {"tipLocation":"bottom", "scrollSpeed":300, "timer":0, "startTimerOnClick":false, "nextButton":true, "tipAnimation":"fade", "tipAnimationFadeSpeed":300, "cookieMonster":false, "cookieName":"JoyRide", "cookieDomain":false, "tipContainer":"body", "inline":false, "tipContent":"#joyRideTipContent", "postRideCallback":$.noop, "postStepCallback":$.noop};
    var options = $.extend(settings, options);
    return this.each(function() {
      if($(options.tipContent).length === 0) {
        return
      }
      $(options.tipContent).hide();
      var bodyOffset = $(options.tipContainer).children("*").first().position(), tipContent = $(options.tipContent + " > li"), count = skipCount = 0, prevCount = -1, timerIndicatorInstance, timerIndicatorTemplate = '<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>';
      var tipTemplate = function(tipClass, index, buttonText, self) {
        return'<div class="joyride-tip-guide ' + tipClass + '" id="joyRidePopup' + index + '"><span class="joyride-nub"></span><div class="joyride-content-wrapper">' + $(self).html() + buttonText + '<a href="#close" class="joyride-close-tip"></a>' + timerIndicatorInstance + "</div></div>"
      };
      var tipLayout = function(tipClass, index, buttonText, self) {
        if(index == 0 && settings.startTimerOnClick && settings.timer > 0 || settings.timer == 0) {
          timerIndicatorInstance = ""
        }else {
          timerIndicatorInstance = timerIndicatorTemplate
        }
        if(!tipClass) {
          tipClass = ""
        }
        if(buttonText) {
          buttonText = '<a href="#" class="joyride-next-tip small nice radius yellow button">' + buttonText + "</a>"
        }else {
          buttonText = ""
        }
        if(settings.inline) {
          $(tipTemplate(tipClass, index, buttonText, self)).insertAfter("#" + $(self).data("id"))
        }else {
          $(options.tipContainer).append(tipTemplate(tipClass, index, buttonText, self))
        }
      };
      if(!settings.cookieMonster || !$.cookie(settings.cookieName)) {
        tipContent.each(function(index) {
          var buttonText = $(this).data("text"), tipClass = $(this).attr("class"), self = this;
          if(settings.nextButton && !buttonText) {
            buttonText = "Next"
          }
          if(settings.nextButton || !settings.nextButton && settings.startTimerOnClick) {
            if($(this).attr("class")) {
              tipLayout(tipClass, index, buttonText, self)
            }else {
              tipLayout(false, index, buttonText, self)
            }
          }else {
            if(!settings.nextButton) {
              if($(this).attr("class")) {
                tipLayout(tipClass, index, "", self)
              }else {
                tipLayout(false, index, "", self)
              }
            }
          }
          $("#joyRidePopup" + index).hide()
        })
      }
      showNextTip = function() {
        var parentElementID = $(tipContent[count]).data("id"), parentElement = $("#" + parentElementID), opt = {};
        $.each(($(tipContent[count]).data("options") || ":").split(";"), function(i, s) {
          var p = s.split(":");
          if(p.length == 2) {
            opt[$.trim(p[0])] = $.trim(p[1])
          }
        });
        var tipSettings = $.extend({}, settings, opt);
        while(parentElement.offset() === null) {
          count++;
          skipCount++;
          if(tipContent.length - 1 > prevCount) {
            prevCount++
          }
          parentElementID = $(tipContent[count]).data("id"), parentElement = $("#" + parentElementID);
          if($(tipContent).length < count) {
            break
          }
        }
        var windowHalf = Math.ceil($(window).height() / 2), currentTip = $("#joyRidePopup" + count), currentTipPosition = parentElement.offset(), currentParentHeight = parentElement.outerHeight(), currentTipHeight = currentTip.outerHeight(), nubHeight = Math.ceil($(".joyride-nub").outerHeight() / 2), tipOffset = 0;
        if(currentTip.length === 0) {
          return
        }
        if(count < tipContent.length) {
          if(settings.tipAnimation == "pop") {
            $(".joyride-timer-indicator").width(0);
            if(settings.timer > 0) {
              currentTip.show().children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:$(".joyride-timer-indicator-wrap").width()}, settings.timer)
            }else {
              currentTip.show()
            }
          }else {
            if(settings.tipAnimation == "fade") {
              $(".joyride-timer-indicator").width(0);
              if(settings.timer > 0) {
                currentTip.fadeIn(settings.tipAnimationFadeSpeed).children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:$(".joyride-timer-indicator-wrap").width()}, settings.timer)
              }else {
                currentTip.fadeIn(settings.tipAnimationFadeSpeed)
              }
            }
          }
          var nub = currentTip.children(".joyride-nub");
          var left = currentTipPosition.left - bodyOffset.left;
          nub.removeClass("bottom").removeClass("top").removeClass("right");
          if($(window).scrollLeft() + $(window).width() < left + currentTip.width()) {
            left -= currentTip.width() - nub.offset().left * 2;
            nub.addClass("right")
          }
          if(Modernizr.mq("only screen and (max-width: 769px)")) {
            if(tipSettings.tipLocation.indexOf("top") != -1) {
              if(currentTipHeight >= currentTipPosition.top) {
                currentTip.offset({top:currentTipPosition.top + currentParentHeight + nubHeight - bodyOffset.top});
                nub.addClass("top").css({left:left})
              }else {
                currentTip.offset({top:currentTipPosition.top - (currentTipHeight + bodyOffset.top + nubHeight)});
                nub.addClass("bottom").css({left:left})
              }
            }else {
              currentTip.offset({top:currentTipPosition.top + currentParentHeight + nubHeight});
              nub.addClass("top").css({left:left})
            }
          }else {
            if(tipSettings.tipLocation == "top") {
              if(currentTipHeight >= currentTipPosition.top) {
                currentTip.offset({top:currentTipPosition.top + currentParentHeight + nubHeight - bodyOffset.top, left:left});
                nub.addClass("top")
              }else {
                currentTip.offset({top:currentTipPosition.top - (currentTipHeight + bodyOffset.top + nubHeight), left:left});
                nub.addClass("bottom")
              }
            }else {
              if(tipSettings.tipLocation == "bottom") {
                currentTip.offset({top:currentTipPosition.top + currentParentHeight + nubHeight, left:left});
                nub.addClass("top")
              }
            }
          }
          if(tipSettings.tipLocation.indexOf("right") != -1) {
            currentTip.offset({left:currentTipPosition.left - bodyOffset.left - currentTip.width() + parentElement.width()});
            currentTip.children(".joyride-nub").addClass("right")
          }
          tipOffset = Math.ceil(currentTip.offset().top - windowHalf);
          $("html, body").animate({scrollTop:tipOffset}, settings.scrollSpeed);
          if(count > 0) {
            if(skipCount > 0) {
              var hideCount = prevCount - skipCount;
              skipCount = 0
            }else {
              var hideCount = prevCount
            }
            if(settings.tipAnimation == "pop") {
              $("#joyRidePopup" + hideCount).hide()
            }else {
              if(settings.tipAnimation == "fade") {
                $("#joyRidePopup" + hideCount).fadeOut(settings.tipAnimationFadeSpeed)
              }
            }
          }
        }else {
          if(tipContent.length - 1 < count) {
            var hideCnt;
            if(skipCount > 0) {
              hideCount = prevCount - skipCount;
              skipCount = 0
            }else {
              hideCount = prevCount
            }
            if(settings.cookieMonster == true) {
              $.cookie(settings.cookieName, "ridden", {expires:365, domain:settings.cookieDomain})
            }
            if(settings.tipAnimation == "pop") {
              $("#joyRidePopup" + hideCount).fadeTo(0, 0)
            }else {
              if(settings.tipAnimation == "fade") {
                $("#joyRidePopup" + hideCount).fadeTo(settings.tipAnimationFadeSpeed, 0)
              }
            }
          }
        }
        count++;
        if(prevCount < 0) {
          prevCount = 0
        }else {
          if(tipContent.length - 1 > prevCount) {
            prevCount++
          }
        }
        if(settings.postStepCallback != $.noop) {
          settings.postStepCallback(prevCount)
        }
      };
      if(!settings.inline || !settings.cookieMonster || !$.cookie(settings.cookieName)) {
        $(window).resize(function() {
          var parentElementID = $(tipContent[prevCount]).data("id"), currentTipPosition = $("#" + parentElementID).offset(), currentParentHeight = $("#" + parentElementID).outerHeight(), currentTipHeight = $("#joyRidePopup" + prevCount).outerHeight(), nubHeight = Math.ceil($(".joyride-nub").outerHeight() / 2);
          if(Modernizr.mq("only screen and (max-width: 769px)")) {
            if(settings.tipLocation == "bottom") {
              $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top + currentParentHeight + nubHeight, left:0});
              $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:currentTipPosition.left - bodyOffset.left})
            }else {
              if(settings.tipLocation == "top") {
                if(currentTipPosition.top <= currentTipHeight) {
                  $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top + nubHeight + currentParentHeight, left:0});
                  $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:currentTipPosition.left - bodyOffset.left})
                }else {
                  $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top - (currentTipHeight + nubHeight), left:0});
                  $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("bottom").removeClass("top").css({left:currentTipPosition.left - bodyOffset.left})
                }
              }
            }
          }else {
            if(settings.tipLocation == "bottom") {
              $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top + currentParentHeight + nubHeight, left:currentTipPosition.left});
              $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:""})
            }else {
              if(settings.tipLocation == "top") {
                if(currentTipPosition.top <= currentTipHeight) {
                  $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top + nubHeight + currentParentHeight, left:currentTipPosition.left});
                  $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("top").removeClass("bottom").css({left:""})
                }else {
                  $("#joyRidePopup" + prevCount).offset({top:currentTipPosition.top - (currentTipHeight + nubHeight), left:currentTipPosition.left});
                  $("#joyRidePopup" + prevCount).children(".joyride-nub").addClass("bottom").removeClass("top").css({left:""})
                }
              }
            }
          }
        })
      }
      var interval_id = null, showTimerState = false;
      if(!settings.startTimerOnClick && settings.timer > 0) {
        showNextTip();
        interval_id = setInterval(function() {
          showNextTip()
        }, settings.timer)
      }else {
        showNextTip()
      }
      var endTip = function(e, interval_id, cookie, self) {
        e.preventDefault();
        clearInterval(interval_id);
        if(cookie) {
          $.cookie(settings.cookieName, "ridden", {expires:365, domain:settings.cookieDomain})
        }
        $(self).parent().parent().hide();
        if(settings.postRideCallback != $.noop) {
          settings.postRideCallback()
        }
      };
      $(".joyride-close-tip").click(function(e) {
        endTip(e, interval_id, settings.cookieMonster, this)
      });
      $(".joyride-next-tip").click(function(e) {
        e.preventDefault();
        if(count >= tipContent.length) {
          endTip(e, interval_id, settings.cookieMonster, this)
        }
        if(settings.timer > 0 && settings.startTimerOnClick) {
          showNextTip();
          clearInterval(interval_id);
          interval_id = setInterval(function() {
            showNextTip()
          }, settings.timer)
        }else {
          if(settings.timer > 0 && !settings.startTimerOnClick) {
            clearInterval(interval_id);
            interval_id = setInterval(function() {
              showNextTip()
            }, settings.timer)
          }else {
            showNextTip()
          }
        }
      })
    })
  }
})(jQuery);
(function(d) {
  function g(a) {
    var b = a || window.event, i = [].slice.call(arguments, 1), c = 0, h = 0, e = 0;
    a = d.event.fix(b);
    a.type = "mousewheel";
    if(a.wheelDelta) {
      c = a.wheelDelta / 120
    }
    if(a.detail) {
      c = -a.detail / 3
    }
    e = c;
    if(b.axis !== undefined && b.axis === b.HORIZONTAL_AXIS) {
      e = 0;
      h = -1 * c
    }
    if(b.wheelDeltaY !== undefined) {
      e = b.wheelDeltaY / 120
    }
    if(b.wheelDeltaX !== undefined) {
      h = -1 * b.wheelDeltaX / 120
    }
    i.unshift(a, c, h, e);
    return d.event.handle.apply(this, i)
  }
  var f = ["DOMMouseScroll", "mousewheel"];
  d.event.special.mousewheel = {setup:function() {
    if(this.addEventListener) {
      for(var a = f.length;a;) {
        this.addEventListener(f[--a], g, false)
      }
    }else {
      this.onmousewheel = g
    }
  }, teardown:function() {
    if(this.removeEventListener) {
      for(var a = f.length;a;) {
        this.removeEventListener(f[--a], g, false)
      }
    }else {
      this.onmousewheel = null
    }
  }};
  d.fn.extend({mousewheel:function(a) {
    return a ? this.bind("mousewheel", a) : this.trigger("mousewheel")
  }, unmousewheel:function(a) {
    return this.unbind("mousewheel", a)
  }})
})(jQuery);
(function(r) {
  r.fn.qrcode = function(h) {
    var s;
    function u(a) {
      this.mode = s;
      this.data = a
    }
    function o(a, c) {
      this.typeNumber = a;
      this.errorCorrectLevel = c;
      this.modules = null;
      this.moduleCount = 0;
      this.dataCache = null;
      this.dataList = []
    }
    function q(a, c) {
      if(void 0 == a.length) {
        throw Error(a.length + "/" + c);
      }
      for(var d = 0;d < a.length && 0 == a[d];) {
        d++
      }
      this.num = Array(a.length - d + c);
      for(var b = 0;b < a.length - d;b++) {
        this.num[b] = a[b + d]
      }
    }
    function p(a, c) {
      this.totalCount = a;
      this.dataCount = c
    }
    function t() {
      this.buffer = [];
      this.length = 0
    }
    u.prototype = {getLength:function() {
      return this.data.length
    }, write:function(a) {
      for(var c = 0;c < this.data.length;c++) {
        a.put(this.data.charCodeAt(c), 8)
      }
    }};
    o.prototype = {addData:function(a) {
      this.dataList.push(new u(a));
      this.dataCache = null
    }, isDark:function(a, c) {
      if(0 > a || this.moduleCount <= a || 0 > c || this.moduleCount <= c) {
        throw Error(a + "," + c);
      }
      return this.modules[a][c]
    }, getModuleCount:function() {
      return this.moduleCount
    }, make:function() {
      if(1 > this.typeNumber) {
        for(var a = 1, a = 1;40 > a;a++) {
          for(var c = p.getRSBlocks(a, this.errorCorrectLevel), d = new t, b = 0, e = 0;e < c.length;e++) {
            b += c[e].dataCount
          }
          for(e = 0;e < this.dataList.length;e++) {
            c = this.dataList[e], d.put(c.mode, 4), d.put(c.getLength(), j.getLengthInBits(c.mode, a)), c.write(d)
          }
          if(d.getLengthInBits() <= 8 * b) {
            break
          }
        }
        this.typeNumber = a
      }
      this.makeImpl(!1, this.getBestMaskPattern())
    }, makeImpl:function(a, c) {
      this.moduleCount = 4 * this.typeNumber + 17;
      this.modules = Array(this.moduleCount);
      for(var d = 0;d < this.moduleCount;d++) {
        this.modules[d] = Array(this.moduleCount);
        for(var b = 0;b < this.moduleCount;b++) {
          this.modules[d][b] = null
        }
      }
      this.setupPositionProbePattern(0, 0);
      this.setupPositionProbePattern(this.moduleCount - 7, 0);
      this.setupPositionProbePattern(0, this.moduleCount - 7);
      this.setupPositionAdjustPattern();
      this.setupTimingPattern();
      this.setupTypeInfo(a, c);
      7 <= this.typeNumber && this.setupTypeNumber(a);
      null == this.dataCache && (this.dataCache = o.createData(this.typeNumber, this.errorCorrectLevel, this.dataList));
      this.mapData(this.dataCache, c)
    }, setupPositionProbePattern:function(a, c) {
      for(var d = -1;7 >= d;d++) {
        if(!(-1 >= a + d || this.moduleCount <= a + d)) {
          for(var b = -1;7 >= b;b++) {
            -1 >= c + b || this.moduleCount <= c + b || (this.modules[a + d][c + b] = 0 <= d && 6 >= d && (0 == b || 6 == b) || 0 <= b && 6 >= b && (0 == d || 6 == d) || 2 <= d && 4 >= d && 2 <= b && 4 >= b ? !0 : !1)
          }
        }
      }
    }, getBestMaskPattern:function() {
      for(var a = 0, c = 0, d = 0;8 > d;d++) {
        this.makeImpl(!0, d);
        var b = j.getLostPoint(this);
        if(0 == d || a > b) {
          a = b, c = d
        }
      }
      return c
    }, createMovieClip:function(a, c, d) {
      a = a.createEmptyMovieClip(c, d);
      this.make();
      for(c = 0;c < this.modules.length;c++) {
        for(var d = 1 * c, b = 0;b < this.modules[c].length;b++) {
          var e = 1 * b;
          this.modules[c][b] && (a.beginFill(0, 100), a.moveTo(e, d), a.lineTo(e + 1, d), a.lineTo(e + 1, d + 1), a.lineTo(e, d + 1), a.endFill())
        }
      }
      return a
    }, setupTimingPattern:function() {
      for(var a = 8;a < this.moduleCount - 8;a++) {
        null == this.modules[a][6] && (this.modules[a][6] = 0 == a % 2)
      }
      for(a = 8;a < this.moduleCount - 8;a++) {
        null == this.modules[6][a] && (this.modules[6][a] = 0 == a % 2)
      }
    }, setupPositionAdjustPattern:function() {
      for(var a = j.getPatternPosition(this.typeNumber), c = 0;c < a.length;c++) {
        for(var d = 0;d < a.length;d++) {
          var b = a[c], e = a[d];
          if(null == this.modules[b][e]) {
            for(var f = -2;2 >= f;f++) {
              for(var i = -2;2 >= i;i++) {
                this.modules[b + f][e + i] = -2 == f || 2 == f || -2 == i || 2 == i || 0 == f && 0 == i ? !0 : !1
              }
            }
          }
        }
      }
    }, setupTypeNumber:function(a) {
      for(var c = j.getBCHTypeNumber(this.typeNumber), d = 0;18 > d;d++) {
        var b = !a && 1 == (c >> d & 1);
        this.modules[Math.floor(d / 3)][d % 3 + this.moduleCount - 8 - 3] = b
      }
      for(d = 0;18 > d;d++) {
        b = !a && 1 == (c >> d & 1), this.modules[d % 3 + this.moduleCount - 8 - 3][Math.floor(d / 3)] = b
      }
    }, setupTypeInfo:function(a, c) {
      for(var d = j.getBCHTypeInfo(this.errorCorrectLevel << 3 | c), b = 0;15 > b;b++) {
        var e = !a && 1 == (d >> b & 1);
        6 > b ? this.modules[b][8] = e : 8 > b ? this.modules[b + 1][8] = e : this.modules[this.moduleCount - 15 + b][8] = e
      }
      for(b = 0;15 > b;b++) {
        e = !a && 1 == (d >> b & 1), 8 > b ? this.modules[8][this.moduleCount - b - 1] = e : 9 > b ? this.modules[8][15 - b - 1 + 1] = e : this.modules[8][15 - b - 1] = e
      }
      this.modules[this.moduleCount - 8][8] = !a
    }, mapData:function(a, c) {
      for(var d = -1, b = this.moduleCount - 1, e = 7, f = 0, i = this.moduleCount - 1;0 < i;i -= 2) {
        for(6 == i && i--;;) {
          for(var g = 0;2 > g;g++) {
            if(null == this.modules[b][i - g]) {
              var n = !1;
              f < a.length && (n = 1 == (a[f] >>> e & 1));
              j.getMask(c, b, i - g) && (n = !n);
              this.modules[b][i - g] = n;
              e--;
               -1 == e && (f++, e = 7)
            }
          }
          b += d;
          if(0 > b || this.moduleCount <= b) {
            b -= d;
            d = -d;
            break
          }
        }
      }
    }};
    o.PAD0 = 236;
    o.PAD1 = 17;
    o.createData = function(a, c, d) {
      for(var c = p.getRSBlocks(a, c), b = new t, e = 0;e < d.length;e++) {
        var f = d[e];
        b.put(f.mode, 4);
        b.put(f.getLength(), j.getLengthInBits(f.mode, a));
        f.write(b)
      }
      for(e = a = 0;e < c.length;e++) {
        a += c[e].dataCount
      }
      if(b.getLengthInBits() > 8 * a) {
        throw Error("code length overflow. (" + b.getLengthInBits() + ">" + 8 * a + ")");
      }
      for(b.getLengthInBits() + 4 <= 8 * a && b.put(0, 4);0 != b.getLengthInBits() % 8;) {
        b.putBit(!1)
      }
      for(;!(b.getLengthInBits() >= 8 * a);) {
        b.put(o.PAD0, 8);
        if(b.getLengthInBits() >= 8 * a) {
          break
        }
        b.put(o.PAD1, 8)
      }
      return o.createBytes(b, c)
    };
    o.createBytes = function(a, c) {
      for(var d = 0, b = 0, e = 0, f = Array(c.length), i = Array(c.length), g = 0;g < c.length;g++) {
        var n = c[g].dataCount, h = c[g].totalCount - n, b = Math.max(b, n), e = Math.max(e, h);
        f[g] = Array(n);
        for(var k = 0;k < f[g].length;k++) {
          f[g][k] = 255 & a.buffer[k + d]
        }
        d += n;
        k = j.getErrorCorrectPolynomial(h);
        n = (new q(f[g], k.getLength() - 1)).mod(k);
        i[g] = Array(k.getLength() - 1);
        for(k = 0;k < i[g].length;k++) {
          h = k + n.getLength() - i[g].length, i[g][k] = 0 <= h ? n.get(h) : 0
        }
      }
      for(k = g = 0;k < c.length;k++) {
        g += c[k].totalCount
      }
      d = Array(g);
      for(k = n = 0;k < b;k++) {
        for(g = 0;g < c.length;g++) {
          k < f[g].length && (d[n++] = f[g][k])
        }
      }
      for(k = 0;k < e;k++) {
        for(g = 0;g < c.length;g++) {
          k < i[g].length && (d[n++] = i[g][k])
        }
      }
      return d
    };
    s = 4;
    for(var j = {PATTERN_POSITION_TABLE:[[], [6, 18], [6, 22], [6, 26], [6, 30], [6, 34], [6, 22, 38], [6, 24, 42], [6, 26, 46], [6, 28, 50], [6, 30, 54], [6, 32, 58], [6, 34, 62], [6, 26, 46, 66], [6, 26, 48, 70], [6, 26, 50, 74], [6, 30, 54, 78], [6, 30, 56, 82], [6, 30, 58, 86], [6, 34, 62, 90], [6, 28, 50, 72, 94], [6, 26, 50, 74, 98], [6, 30, 54, 78, 102], [6, 28, 54, 80, 106], [6, 32, 58, 84, 110], [6, 30, 58, 86, 114], [6, 34, 62, 90, 118], [6, 26, 50, 74, 98, 122], [6, 30, 54, 78, 102, 126], 
    [6, 26, 52, 78, 104, 130], [6, 30, 56, 82, 108, 134], [6, 34, 60, 86, 112, 138], [6, 30, 58, 86, 114, 142], [6, 34, 62, 90, 118, 146], [6, 30, 54, 78, 102, 126, 150], [6, 24, 50, 76, 102, 128, 154], [6, 28, 54, 80, 106, 132, 158], [6, 32, 58, 84, 110, 136, 162], [6, 26, 54, 82, 110, 138, 166], [6, 30, 58, 86, 114, 142, 170]], G15:1335, G18:7973, G15_MASK:21522, getBCHTypeInfo:function(a) {
      for(var c = a << 10;0 <= j.getBCHDigit(c) - j.getBCHDigit(j.G15);) {
        c ^= j.G15 << j.getBCHDigit(c) - j.getBCHDigit(j.G15)
      }
      return(a << 10 | c) ^ j.G15_MASK
    }, getBCHTypeNumber:function(a) {
      for(var c = a << 12;0 <= j.getBCHDigit(c) - j.getBCHDigit(j.G18);) {
        c ^= j.G18 << j.getBCHDigit(c) - j.getBCHDigit(j.G18)
      }
      return a << 12 | c
    }, getBCHDigit:function(a) {
      for(var c = 0;0 != a;) {
        c++, a >>>= 1
      }
      return c
    }, getPatternPosition:function(a) {
      return j.PATTERN_POSITION_TABLE[a - 1]
    }, getMask:function(a, c, d) {
      switch(a) {
        case 0:
          return 0 == (c + d) % 2;
        case 1:
          return 0 == c % 2;
        case 2:
          return 0 == d % 3;
        case 3:
          return 0 == (c + d) % 3;
        case 4:
          return 0 == (Math.floor(c / 2) + Math.floor(d / 3)) % 2;
        case 5:
          return 0 == c * d % 2 + c * d % 3;
        case 6:
          return 0 == (c * d % 2 + c * d % 3) % 2;
        case 7:
          return 0 == (c * d % 3 + (c + d) % 2) % 2;
        default:
          throw Error("bad maskPattern:" + a);
      }
    }, getErrorCorrectPolynomial:function(a) {
      for(var c = new q([1], 0), d = 0;d < a;d++) {
        c = c.multiply(new q([1, l.gexp(d)], 0))
      }
      return c
    }, getLengthInBits:function(a, c) {
      if(1 <= c && 10 > c) {
        switch(a) {
          case 1:
            return 10;
          case 2:
            return 9;
          case s:
            return 8;
          case 8:
            return 8;
          default:
            throw Error("mode:" + a);
        }
      }else {
        if(27 > c) {
          switch(a) {
            case 1:
              return 12;
            case 2:
              return 11;
            case s:
              return 16;
            case 8:
              return 10;
            default:
              throw Error("mode:" + a);
          }
        }else {
          if(41 > c) {
            switch(a) {
              case 1:
                return 14;
              case 2:
                return 13;
              case s:
                return 16;
              case 8:
                return 12;
              default:
                throw Error("mode:" + a);
            }
          }else {
            throw Error("type:" + c);
          }
        }
      }
    }, getLostPoint:function(a) {
      for(var c = a.getModuleCount(), d = 0, b = 0;b < c;b++) {
        for(var e = 0;e < c;e++) {
          for(var f = 0, i = a.isDark(b, e), g = -1;1 >= g;g++) {
            if(!(0 > b + g || c <= b + g)) {
              for(var h = -1;1 >= h;h++) {
                0 > e + h || c <= e + h || 0 == g && 0 == h || i == a.isDark(b + g, e + h) && f++
              }
            }
          }
          5 < f && (d += 3 + f - 5)
        }
      }
      for(b = 0;b < c - 1;b++) {
        for(e = 0;e < c - 1;e++) {
          if(f = 0, a.isDark(b, e) && f++, a.isDark(b + 1, e) && f++, a.isDark(b, e + 1) && f++, a.isDark(b + 1, e + 1) && f++, 0 == f || 4 == f) {
            d += 3
          }
        }
      }
      for(b = 0;b < c;b++) {
        for(e = 0;e < c - 6;e++) {
          a.isDark(b, e) && !a.isDark(b, e + 1) && a.isDark(b, e + 2) && a.isDark(b, e + 3) && a.isDark(b, e + 4) && !a.isDark(b, e + 5) && a.isDark(b, e + 6) && (d += 40)
        }
      }
      for(e = 0;e < c;e++) {
        for(b = 0;b < c - 6;b++) {
          a.isDark(b, e) && !a.isDark(b + 1, e) && a.isDark(b + 2, e) && a.isDark(b + 3, e) && a.isDark(b + 4, e) && !a.isDark(b + 5, e) && a.isDark(b + 6, e) && (d += 40)
        }
      }
      for(e = f = 0;e < c;e++) {
        for(b = 0;b < c;b++) {
          a.isDark(b, e) && f++
        }
      }
      a = Math.abs(100 * f / c / c - 50) / 5;
      return d + 10 * a
    }}, l = {glog:function(a) {
      if(1 > a) {
        throw Error("glog(" + a + ")");
      }
      return l.LOG_TABLE[a]
    }, gexp:function(a) {
      for(;0 > a;) {
        a += 255
      }
      for(;256 <= a;) {
        a -= 255
      }
      return l.EXP_TABLE[a]
    }, EXP_TABLE:Array(256), LOG_TABLE:Array(256)}, m = 0;8 > m;m++) {
      l.EXP_TABLE[m] = 1 << m
    }
    for(m = 8;256 > m;m++) {
      l.EXP_TABLE[m] = l.EXP_TABLE[m - 4] ^ l.EXP_TABLE[m - 5] ^ l.EXP_TABLE[m - 6] ^ l.EXP_TABLE[m - 8]
    }
    for(m = 0;255 > m;m++) {
      l.LOG_TABLE[l.EXP_TABLE[m]] = m
    }
    q.prototype = {get:function(a) {
      return this.num[a]
    }, getLength:function() {
      return this.num.length
    }, multiply:function(a) {
      for(var c = Array(this.getLength() + a.getLength() - 1), d = 0;d < this.getLength();d++) {
        for(var b = 0;b < a.getLength();b++) {
          c[d + b] ^= l.gexp(l.glog(this.get(d)) + l.glog(a.get(b)))
        }
      }
      return new q(c, 0)
    }, mod:function(a) {
      if(0 > this.getLength() - a.getLength()) {
        return this
      }
      for(var c = l.glog(this.get(0)) - l.glog(a.get(0)), d = Array(this.getLength()), b = 0;b < this.getLength();b++) {
        d[b] = this.get(b)
      }
      for(b = 0;b < a.getLength();b++) {
        d[b] ^= l.gexp(l.glog(a.get(b)) + c)
      }
      return(new q(d, 0)).mod(a)
    }};
    p.RS_BLOCK_TABLE = [[1, 26, 19], [1, 26, 16], [1, 26, 13], [1, 26, 9], [1, 44, 34], [1, 44, 28], [1, 44, 22], [1, 44, 16], [1, 70, 55], [1, 70, 44], [2, 35, 17], [2, 35, 13], [1, 100, 80], [2, 50, 32], [2, 50, 24], [4, 25, 9], [1, 134, 108], [2, 67, 43], [2, 33, 15, 2, 34, 16], [2, 33, 11, 2, 34, 12], [2, 86, 68], [4, 43, 27], [4, 43, 19], [4, 43, 15], [2, 98, 78], [4, 49, 31], [2, 32, 14, 4, 33, 15], [4, 39, 13, 1, 40, 14], [2, 121, 97], [2, 60, 38, 2, 61, 39], [4, 40, 18, 2, 41, 19], [4, 40, 
    14, 2, 41, 15], [2, 146, 116], [3, 58, 36, 2, 59, 37], [4, 36, 16, 4, 37, 17], [4, 36, 12, 4, 37, 13], [2, 86, 68, 2, 87, 69], [4, 69, 43, 1, 70, 44], [6, 43, 19, 2, 44, 20], [6, 43, 15, 2, 44, 16], [4, 101, 81], [1, 80, 50, 4, 81, 51], [4, 50, 22, 4, 51, 23], [3, 36, 12, 8, 37, 13], [2, 116, 92, 2, 117, 93], [6, 58, 36, 2, 59, 37], [4, 46, 20, 6, 47, 21], [7, 42, 14, 4, 43, 15], [4, 133, 107], [8, 59, 37, 1, 60, 38], [8, 44, 20, 4, 45, 21], [12, 33, 11, 4, 34, 12], [3, 145, 115, 1, 146, 116], 
    [4, 64, 40, 5, 65, 41], [11, 36, 16, 5, 37, 17], [11, 36, 12, 5, 37, 13], [5, 109, 87, 1, 110, 88], [5, 65, 41, 5, 66, 42], [5, 54, 24, 7, 55, 25], [11, 36, 12], [5, 122, 98, 1, 123, 99], [7, 73, 45, 3, 74, 46], [15, 43, 19, 2, 44, 20], [3, 45, 15, 13, 46, 16], [1, 135, 107, 5, 136, 108], [10, 74, 46, 1, 75, 47], [1, 50, 22, 15, 51, 23], [2, 42, 14, 17, 43, 15], [5, 150, 120, 1, 151, 121], [9, 69, 43, 4, 70, 44], [17, 50, 22, 1, 51, 23], [2, 42, 14, 19, 43, 15], [3, 141, 113, 4, 142, 114], [3, 
    70, 44, 11, 71, 45], [17, 47, 21, 4, 48, 22], [9, 39, 13, 16, 40, 14], [3, 135, 107, 5, 136, 108], [3, 67, 41, 13, 68, 42], [15, 54, 24, 5, 55, 25], [15, 43, 15, 10, 44, 16], [4, 144, 116, 4, 145, 117], [17, 68, 42], [17, 50, 22, 6, 51, 23], [19, 46, 16, 6, 47, 17], [2, 139, 111, 7, 140, 112], [17, 74, 46], [7, 54, 24, 16, 55, 25], [34, 37, 13], [4, 151, 121, 5, 152, 122], [4, 75, 47, 14, 76, 48], [11, 54, 24, 14, 55, 25], [16, 45, 15, 14, 46, 16], [6, 147, 117, 4, 148, 118], [6, 73, 45, 14, 
    74, 46], [11, 54, 24, 16, 55, 25], [30, 46, 16, 2, 47, 17], [8, 132, 106, 4, 133, 107], [8, 75, 47, 13, 76, 48], [7, 54, 24, 22, 55, 25], [22, 45, 15, 13, 46, 16], [10, 142, 114, 2, 143, 115], [19, 74, 46, 4, 75, 47], [28, 50, 22, 6, 51, 23], [33, 46, 16, 4, 47, 17], [8, 152, 122, 4, 153, 123], [22, 73, 45, 3, 74, 46], [8, 53, 23, 26, 54, 24], [12, 45, 15, 28, 46, 16], [3, 147, 117, 10, 148, 118], [3, 73, 45, 23, 74, 46], [4, 54, 24, 31, 55, 25], [11, 45, 15, 31, 46, 16], [7, 146, 116, 7, 147, 
    117], [21, 73, 45, 7, 74, 46], [1, 53, 23, 37, 54, 24], [19, 45, 15, 26, 46, 16], [5, 145, 115, 10, 146, 116], [19, 75, 47, 10, 76, 48], [15, 54, 24, 25, 55, 25], [23, 45, 15, 25, 46, 16], [13, 145, 115, 3, 146, 116], [2, 74, 46, 29, 75, 47], [42, 54, 24, 1, 55, 25], [23, 45, 15, 28, 46, 16], [17, 145, 115], [10, 74, 46, 23, 75, 47], [10, 54, 24, 35, 55, 25], [19, 45, 15, 35, 46, 16], [17, 145, 115, 1, 146, 116], [14, 74, 46, 21, 75, 47], [29, 54, 24, 19, 55, 25], [11, 45, 15, 46, 46, 16], [13, 
    145, 115, 6, 146, 116], [14, 74, 46, 23, 75, 47], [44, 54, 24, 7, 55, 25], [59, 46, 16, 1, 47, 17], [12, 151, 121, 7, 152, 122], [12, 75, 47, 26, 76, 48], [39, 54, 24, 14, 55, 25], [22, 45, 15, 41, 46, 16], [6, 151, 121, 14, 152, 122], [6, 75, 47, 34, 76, 48], [46, 54, 24, 10, 55, 25], [2, 45, 15, 64, 46, 16], [17, 152, 122, 4, 153, 123], [29, 74, 46, 14, 75, 47], [49, 54, 24, 10, 55, 25], [24, 45, 15, 46, 46, 16], [4, 152, 122, 18, 153, 123], [13, 74, 46, 32, 75, 47], [48, 54, 24, 14, 55, 25], 
    [42, 45, 15, 32, 46, 16], [20, 147, 117, 4, 148, 118], [40, 75, 47, 7, 76, 48], [43, 54, 24, 22, 55, 25], [10, 45, 15, 67, 46, 16], [19, 148, 118, 6, 149, 119], [18, 75, 47, 31, 76, 48], [34, 54, 24, 34, 55, 25], [20, 45, 15, 61, 46, 16]];
    p.getRSBlocks = function(a, c) {
      var d = p.getRsBlockTable(a, c);
      if(void 0 == d) {
        throw Error("bad rs block @ typeNumber:" + a + "/errorCorrectLevel:" + c);
      }
      for(var b = d.length / 3, e = [], f = 0;f < b;f++) {
        for(var h = d[3 * f + 0], g = d[3 * f + 1], j = d[3 * f + 2], l = 0;l < h;l++) {
          e.push(new p(g, j))
        }
      }
      return e
    };
    p.getRsBlockTable = function(a, c) {
      switch(c) {
        case 1:
          return p.RS_BLOCK_TABLE[4 * (a - 1) + 0];
        case 0:
          return p.RS_BLOCK_TABLE[4 * (a - 1) + 1];
        case 3:
          return p.RS_BLOCK_TABLE[4 * (a - 1) + 2];
        case 2:
          return p.RS_BLOCK_TABLE[4 * (a - 1) + 3]
      }
    };
    t.prototype = {get:function(a) {
      return 1 == (this.buffer[Math.floor(a / 8)] >>> 7 - a % 8 & 1)
    }, put:function(a, c) {
      for(var d = 0;d < c;d++) {
        this.putBit(1 == (a >>> c - d - 1 & 1))
      }
    }, getLengthInBits:function() {
      return this.length
    }, putBit:function(a) {
      var c = Math.floor(this.length / 8);
      this.buffer.length <= c && this.buffer.push(0);
      a && (this.buffer[c] |= 128 >>> this.length % 8);
      this.length++
    }};
    "string" === typeof h && (h = {text:h});
    h = r.extend({}, {render:"canvas", width:256, height:256, typeNumber:-1, correctLevel:2, background:"#ffffff", foreground:"#000000"}, h);
    return this.each(function() {
      var a;
      if("canvas" == h.render) {
        a = new o(h.typeNumber, h.correctLevel);
        a.addData(h.text);
        a.make();
        var c = document.createElement("canvas");
        c.width = h.width;
        c.height = h.height;
        for(var d = c.getContext("2d"), b = h.width / a.getModuleCount(), e = h.height / a.getModuleCount(), f = 0;f < a.getModuleCount();f++) {
          for(var i = 0;i < a.getModuleCount();i++) {
            d.fillStyle = a.isDark(f, i) ? h.foreground : h.background;
            var g = Math.ceil((i + 1) * b) - Math.floor(i * b), j = Math.ceil((f + 1) * b) - Math.floor(f * b);
            d.fillRect(Math.round(i * b), Math.round(f * e), g, j)
          }
        }
      }else {
        a = new o(h.typeNumber, h.correctLevel);
        a.addData(h.text);
        a.make();
        c = r("<table></table>").css("width", h.width + "px").css("height", h.height + "px").css("border", "0px").css("border-collapse", "collapse").css("background-color", h.background);
        d = h.width / a.getModuleCount();
        b = h.height / a.getModuleCount();
        for(e = 0;e < a.getModuleCount();e++) {
          f = r("<tr></tr>").css("height", b + "px").appendTo(c);
          for(i = 0;i < a.getModuleCount();i++) {
            r("<td></td>").css("width", d + "px").css("background-color", a.isDark(e, i) ? h.foreground : h.background).appendTo(f)
          }
        }
      }
      a = c;
      jQuery(a).appendTo(this)
    })
  }
})(jQuery);
(function(b) {
  b.support.touch = "ontouchend" in document;
  if(!b.support.touch) {
    return
  }
  var c = b.ui.mouse.prototype, e = c._mouseInit, a;
  function d(g, h) {
    if(g.originalEvent.touches.length > 1) {
      return
    }
    g.preventDefault();
    var i = g.originalEvent.changedTouches[0], f = document.createEvent("MouseEvents");
    f.initMouseEvent(h, true, true, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, false, false, false, false, 0, null);
    g.target.dispatchEvent(f)
  }
  c._touchStart = function(g) {
    var f = this;
    if(a || !f._mouseCapture(g.originalEvent.changedTouches[0])) {
      return
    }
    a = true;
    f._touchMoved = false;
    d(g, "mouseover");
    d(g, "mousemove");
    d(g, "mousedown")
  };
  c._touchMove = function(f) {
    if(!a) {
      return
    }
    this._touchMoved = true;
    d(f, "mousemove")
  };
  c._touchEnd = function(f) {
    if(!a) {
      return
    }
    d(f, "mouseup");
    d(f, "mouseout");
    if(!this._touchMoved) {
      d(f, "click")
    }
    a = false
  };
  c._mouseInit = function() {
    var f = this;
    f.element.bind("touchstart", b.proxy(f, "_touchStart")).bind("touchmove", b.proxy(f, "_touchMove")).bind("touchend", b.proxy(f, "_touchEnd"));
    e.call(f)
  }
})(jQuery);
(function(a, h, y) {
  var w = "function", v = "password", j = "maxLength", n = "type", b = "", c = true, u = "placeholder", i = false, t = "watermark", g = t, f = "watermarkClass", q = "watermarkFocus", l = "watermarkSubmit", o = "watermarkMaxLength", e = "watermarkPassword", d = "watermarkText", k = /\r/g, s = "input:data(" + g + "),textarea:data(" + g + ")", m = "input:text,input:password,input[type=search],input:not([type]),textarea", p = ["Page_ClientValidate"], r = i, x = u in document.createElement("input");
  a.watermark = a.watermark || {version:"3.1.3", runOnce:c, options:{className:t, useNative:c, hideBeforeUnload:c}, hide:function(b) {
    a(b).filter(s).each(function() {
      a.watermark._hide(a(this))
    })
  }, _hide:function(a, r) {
    var p = a[0], q = (p.value || b).replace(k, b), l = a.data(d) || b, m = a.data(o) || 0, i = a.data(f);
    if(l.length && q == l) {
      p.value = b;
      if(a.data(e)) {
        if((a.attr(n) || b) === "text") {
          var g = a.data(e) || [], c = a.parent() || [];
          if(g.length && c.length) {
            c[0].removeChild(a[0]);
            c[0].appendChild(g[0]);
            a = g
          }
        }
      }
      if(m) {
        a.attr(j, m);
        a.removeData(o)
      }
      if(r) {
        a.attr("autocomplete", "off");
        h.setTimeout(function() {
          a.select()
        }, 1)
      }
    }
    i && a.removeClass(i)
  }, show:function(b) {
    a(b).filter(s).each(function() {
      a.watermark._show(a(this))
    })
  }, _show:function(g) {
    var p = g[0], u = (p.value || b).replace(k, b), h = g.data(d) || b, s = g.attr(n) || b, t = g.data(f);
    if((u.length == 0 || u == h) && !g.data(q)) {
      r = c;
      if(g.data(e)) {
        if(s === v) {
          var m = g.data(e) || [], l = g.parent() || [];
          if(m.length && l.length) {
            l[0].removeChild(g[0]);
            l[0].appendChild(m[0]);
            g = m;
            g.attr(j, h.length);
            p = g[0]
          }
        }
      }
      if(s === "text" || s === "search") {
        var i = g.attr(j) || 0;
        if(i > 0 && h.length > i) {
          g.data(o, i);
          g.attr(j, h.length)
        }
      }
      t && g.addClass(t);
      p.value = h
    }else {
      a.watermark._hide(g)
    }
  }, hideAll:function() {
    if(r) {
      a.watermark.hide(m);
      r = i
    }
  }, showAll:function() {
    a.watermark.show(m)
  }};
  a.fn.watermark = a.fn.watermark || function(p, o) {
    var t = "string";
    if(!this.length) {
      return this
    }
    var s = i, r = typeof p === t;
    if(r) {
      p = p.replace(k, b)
    }
    if(typeof o === "object") {
      s = typeof o.className === t;
      o = a.extend({}, a.watermark.options, o)
    }else {
      if(typeof o === t) {
        s = c;
        o = a.extend({}, a.watermark.options, {className:o})
      }else {
        o = a.watermark.options
      }
    }
    if(typeof o.useNative !== w) {
      o.useNative = o.useNative ? function() {
        return c
      } : function() {
        return i
      }
    }
    return this.each(function() {
      var B = "dragleave", A = "dragenter", z = this, i = a(z);
      if(!i.is(m)) {
        return
      }
      if(i.data(g)) {
        if(r || s) {
          a.watermark._hide(i);
          r && i.data(d, p);
          s && i.data(f, o.className)
        }
      }else {
        if(x && o.useNative.call(z, i) && (i.attr("tagName") || b) !== "TEXTAREA") {
          r && i.attr(u, p);
          return
        }
        i.data(d, r ? p : b);
        i.data(f, o.className);
        i.data(g, 1);
        if((i.attr(n) || b) === v) {
          var C = i.wrap("<span>").parent(), t = a(C.html().replace(/type=["']?password["']?/i, 'type="text"'));
          t.data(d, i.data(d));
          t.data(f, i.data(f));
          t.data(g, 1);
          t.attr(j, p.length);
          t.focus(function() {
            a.watermark._hide(t, c)
          }).bind(A, function() {
            a.watermark._hide(t)
          }).bind("dragend", function() {
            h.setTimeout(function() {
              t.blur()
            }, 1)
          });
          i.blur(function() {
            a.watermark._show(i)
          }).bind(B, function() {
            a.watermark._show(i)
          });
          t.data(e, i);
          i.data(e, t)
        }else {
          i.focus(function() {
            i.data(q, 1);
            a.watermark._hide(i, c)
          }).blur(function() {
            i.data(q, 0);
            a.watermark._show(i)
          }).bind(A, function() {
            a.watermark._hide(i)
          }).bind(B, function() {
            a.watermark._show(i)
          }).bind("dragend", function() {
            h.setTimeout(function() {
              a.watermark._show(i)
            }, 1)
          }).bind("drop", function(e) {
            var c = i[0], a = e.originalEvent.dataTransfer.getData("Text");
            if((c.value || b).replace(k, b).replace(a, b) === i.data(d)) {
              c.value = a
            }
            i.focus()
          })
        }
        if(z.form) {
          var w = z.form, y = a(w);
          if(!y.data(l)) {
            y.submit(a.watermark.hideAll);
            if(w.submit) {
              y.data(l, w.submit);
              w.submit = function(c, b) {
                return function() {
                  var d = b.data(l);
                  a.watermark.hideAll();
                  if(d.apply) {
                    d.apply(c, Array.prototype.slice.call(arguments))
                  }else {
                    d()
                  }
                }
              }(w, y)
            }else {
              y.data(l, 1);
              w.submit = function(b) {
                return function() {
                  a.watermark.hideAll();
                  delete b.submit;
                  b.submit()
                }
              }(w)
            }
          }
        }
      }
      a.watermark._show(i)
    })
  };
  if(a.watermark.runOnce) {
    a.watermark.runOnce = i;
    a.extend(a.expr[":"], {data:function(c, d, b) {
      return!!a.data(c, b[3])
    }});
    (function(c) {
      a.fn.val = function() {
        var e = this;
        if(!e.length) {
          return arguments.length ? e : y
        }
        if(!arguments.length) {
          if(e.data(g)) {
            var f = (e[0].value || b).replace(k, b);
            return f === (e.data(d) || b) ? b : f
          }else {
            return c.apply(e, arguments)
          }
        }else {
          c.apply(e, arguments);
          a.watermark.show(e);
          return e
        }
      }
    })(a.fn.val);
    p.length && a(function() {
      for(var b, c, d = p.length - 1;d >= 0;d--) {
        b = p[d];
        c = h[b];
        if(typeof c === w) {
          h[b] = function(b) {
            return function() {
              a.watermark.hideAll();
              return b.apply(null, Array.prototype.slice.call(arguments))
            }
          }(c)
        }
      }
    });
    a(h).bind("beforeunload", function() {
      a.watermark.options.hideBeforeUnload && a.watermark.hideAll()
    })
  }
})(jQuery, window);
window.Modernizr = function(a, b, c) {
  function x(a) {
    j.cssText = a
  }
  function y(a, b) {
    return x(m.join(a + ";") + (b || ""))
  }
  function z(a, b) {
    return typeof a === b
  }
  function A(a, b) {
    return!!~("" + a).indexOf(b)
  }
  function B(a, b, d) {
    for(var e in a) {
      var f = b[a[e]];
      if(f !== c) {
        return d === !1 ? a[e] : z(f, "function") ? f.bind(d || b) : f
      }
    }
    return!1
  }
  var d = "2.5.2", e = {}, f = !0, g = b.documentElement, h = "modernizr", i = b.createElement(h), j = i.style, k, l = {}.toString, m = " -webkit- -moz- -o- -ms- ".split(" "), n = {}, o = {}, p = {}, q = [], r = q.slice, s, t = function(a, c, d, e) {
    var f, i, j, k = b.createElement("div"), l = b.body, m = l ? l : b.createElement("body");
    if(parseInt(d, 10)) {
      while(d--) {
        j = b.createElement("div"), j.id = e ? e[d] : h + (d + 1), k.appendChild(j)
      }
    }
    return f = ["&#173;", "<style>", a, "</style>"].join(""), k.id = h, m.innerHTML += f, m.appendChild(k), l || g.appendChild(m), i = c(k, a), l ? k.parentNode.removeChild(k) : m.parentNode.removeChild(m), !!i
  }, u = function(b) {
    var c = a.matchMedia || a.msMatchMedia;
    if(c) {
      return c(b).matches
    }
    var d;
    return t("@media " + b + " { #" + h + " { position: absolute; } }", function(b) {
      d = (a.getComputedStyle ? getComputedStyle(b, null) : b.currentStyle)["position"] == "absolute"
    }), d
  }, v = {}.hasOwnProperty, w;
  !z(v, "undefined") && !z(v.call, "undefined") ? w = function(a, b) {
    return v.call(a, b)
  } : w = function(a, b) {
    return b in a && z(a.constructor.prototype[b], "undefined")
  }, Function.prototype.bind || (Function.prototype.bind = function(b) {
    var c = this;
    if(typeof c != "function") {
      throw new TypeError;
    }
    var d = r.call(arguments, 1), e = function() {
      if(this instanceof e) {
        var a = function() {
        };
        a.prototype = c.prototype;
        var f = new a, g = c.apply(f, d.concat(r.call(arguments)));
        return Object(g) === g ? g : f
      }
      return c.apply(b, d.concat(r.call(arguments)))
    };
    return e
  });
  var C = function(c, d) {
    var f = c.join(""), g = d.length;
    t(f, function(c, d) {
      var f = b.styleSheets[b.styleSheets.length - 1], h = f ? f.cssRules && f.cssRules[0] ? f.cssRules[0].cssText : f.cssText || "" : "", i = c.childNodes, j = {};
      while(g--) {
        j[i[g].id] = i[g]
      }
      e.touch = "ontouchstart" in a || a.DocumentTouch && b instanceof DocumentTouch || (j.touch && j.touch.offsetTop) === 9
    }, g, d)
  }([, ["@media (", m.join("touch-enabled),("), h, ")", "{#touch{top:9px;position:absolute}}"].join("")], [, "touch"]);
  n.touch = function() {
    return e.touch
  };
  for(var D in n) {
    w(n, D) && (s = D.toLowerCase(), e[s] = n[D](), q.push((e[s] ? "" : "no-") + s))
  }
  return e.addTest = function(a, b) {
    if(typeof a == "object") {
      for(var d in a) {
        w(a, d) && e.addTest(d, a[d])
      }
    }else {
      a = a.toLowerCase();
      if(e[a] !== c) {
        return e
      }
      b = typeof b == "function" ? b() : b, g.className += " " + (b ? "" : "no-") + a, e[a] = b
    }
    return e
  }, x(""), i = k = null, e._version = d, e._prefixes = m, e.mq = u, e.testStyles = t, g.className = g.className.replace(/(^|\s)no-js(\s|$)/, "$1$2") + (f ? " js " + q.join(" ") : ""), e
}(this, this.document), function(a, b, c) {
  function d(a) {
    return o.call(a) == "[object Function]"
  }
  function e(a) {
    return typeof a == "string"
  }
  function f() {
  }
  function g(a) {
    return!a || a == "loaded" || a == "complete" || a == "uninitialized"
  }
  function h() {
    var a = p.shift();
    q = 1, a ? a.t ? m(function() {
      (a.t == "c" ? B.injectCss : B.injectJs)(a.s, 0, a.a, a.x, a.e, 1)
    }, 0) : (a(), h()) : q = 0
  }
  function i(a, c, d, e, f, i, j) {
    function k(b) {
      if(!o && g(l.readyState) && (u.r = o = 1, !q && h(), l.onload = l.onreadystatechange = null, b)) {
        a != "img" && m(function() {
          t.removeChild(l)
        }, 50);
        for(var d in y[c]) {
          y[c].hasOwnProperty(d) && y[c][d].onload()
        }
      }
    }
    var j = j || B.errorTimeout, l = {}, o = 0, r = 0, u = {t:d, s:c, e:f, a:i, x:j};
    y[c] === 1 && (r = 1, y[c] = [], l = b.createElement(a)), a == "object" ? l.data = c : (l.src = c, l.type = a), l.width = l.height = "0", l.onerror = l.onload = l.onreadystatechange = function() {
      k.call(this, r)
    }, p.splice(e, 0, u), a != "img" && (r || y[c] === 2 ? (t.insertBefore(l, s ? null : n), m(k, j)) : y[c].push(l))
  }
  function j(a, b, c, d, f) {
    return q = 0, b = b || "j", e(a) ? i(b == "c" ? v : u, a, b, this.i++, c, d, f) : (p.splice(this.i++, 0, a), p.length == 1 && h()), this
  }
  function k() {
    var a = B;
    return a.loader = {load:j, i:0}, a
  }
  var l = b.documentElement, m = a.setTimeout, n = b.getElementsByTagName("script")[0], o = {}.toString, p = [], q = 0, r = "MozAppearance" in l.style, s = r && !!b.createRange().compareNode, t = s ? l : n.parentNode, l = !!b.attachEvent, u = r ? "object" : l ? "script" : "img", v = l ? "script" : u, w = Array.isArray || function(a) {
    return o.call(a) == "[object Array]"
  }, x = [], y = {}, z = {timeout:function(a, b) {
    return b.length && (a.timeout = b[0]), a
  }}, A, B;
  B = function(a) {
    function b(a) {
      var a = a.split("!"), b = x.length, c = a.pop(), d = a.length, c = {url:c, origUrl:c, prefixes:a}, e, f, g;
      for(f = 0;f < d;f++) {
        g = a[f].split("="), (e = z[g.shift()]) && (c = e(c, g))
      }
      for(f = 0;f < b;f++) {
        c = x[f](c)
      }
      return c
    }
    function g(a, e, f, g, i) {
      var j = b(a), l = j.autoCallback;
      j.url.split(".").pop().split("?").shift(), j.bypass || (e && (e = d(e) ? e : e[a] || e[g] || e[a.split("/").pop().split("?")[0]] || h), j.instead ? j.instead(a, e, f, g, i) : (y[j.url] ? j.noexec = !0 : y[j.url] = 1, f.load(j.url, j.forceCSS || !j.forceJS && "css" == j.url.split(".").pop().split("?").shift() ? "c" : c, j.noexec, j.attrs, j.timeout), (d(e) || d(l)) && f.load(function() {
        k(), e && e(j.origUrl, i, g), l && l(j.origUrl, i, g), y[j.url] = 2
      })))
    }
    function i(a, b) {
      function c(a, c) {
        if(a) {
          if(e(a)) {
            c || (j = function() {
              var a = [].slice.call(arguments);
              k.apply(this, a), l()
            }), g(a, j, b, 0, h)
          }else {
            if(Object(a) === a) {
              for(n in m = function() {
                var b = 0, c;
                for(c in a) {
                  a.hasOwnProperty(c) && b++
                }
                return b
              }(), a) {
                a.hasOwnProperty(n) && (!c && !--m && (d(j) ? j = function() {
                  var a = [].slice.call(arguments);
                  k.apply(this, a), l()
                } : j[n] = function(a) {
                  return function() {
                    var b = [].slice.call(arguments);
                    a && a.apply(this, b), l()
                  }
                }(k[n])), g(a[n], j, b, n, h))
              }
            }
          }
        }else {
          !c && l()
        }
      }
      var h = !!a.test, i = a.load || a.both, j = a.callback || f, k = j, l = a.complete || f, m, n;
      c(h ? a.yep : a.nope, !!i), i && c(i)
    }
    var j, l, m = this.yepnope.loader;
    if(e(a)) {
      g(a, 0, m, 0)
    }else {
      if(w(a)) {
        for(j = 0;j < a.length;j++) {
          l = a[j], e(l) ? g(l, 0, m, 0) : w(l) ? B(l) : Object(l) === l && i(l, m)
        }
      }else {
        Object(a) === a && i(a, m)
      }
    }
  }, B.addPrefix = function(a, b) {
    z[a] = b
  }, B.addFilter = function(a) {
    x.push(a)
  }, B.errorTimeout = 1E4, b.readyState == null && b.addEventListener && (b.readyState = "loading", b.addEventListener("DOMContentLoaded", A = function() {
    b.removeEventListener("DOMContentLoaded", A, 0), b.readyState = "complete"
  }, 0)), a.yepnope = k(), a.yepnope.executeStack = h, a.yepnope.injectJs = function(a, c, d, e, i, j) {
    var k = b.createElement("script"), l, o, e = e || B.errorTimeout;
    k.src = a;
    for(o in d) {
      k.setAttribute(o, d[o])
    }
    c = j ? h : c || f, k.onreadystatechange = k.onload = function() {
      !l && g(k.readyState) && (l = 1, c(), k.onload = k.onreadystatechange = null)
    }, m(function() {
      l || (l = 1, c(1))
    }, e), i ? k.onload() : n.parentNode.insertBefore(k, n)
  }, a.yepnope.injectCss = function(a, c, d, e, g, i) {
    var e = b.createElement("link"), j, c = i ? h : c || f;
    e.href = a, e.rel = "stylesheet", e.type = "text/css";
    for(j in d) {
      e.setAttribute(j, d[j])
    }
    g || (n.parentNode.insertBefore(e, n), m(c, 0))
  }
}(this, document), Modernizr.load = function() {
  yepnope.apply(window, [].slice.call(arguments, 0))
}, Modernizr.addTest("ie8compat", function() {
  return!window.addEventListener && document.documentMode && document.documentMode === 7
});
window.Modernizr = function(a, b, c) {
  function v(a) {
    i.cssText = a
  }
  function w(a, b) {
    return v(prefixes.join(a + ";") + (b || ""))
  }
  function x(a, b) {
    return typeof a === b
  }
  function y(a, b) {
    return!!~("" + a).indexOf(b)
  }
  function z(a, b, d) {
    for(var e in a) {
      var f = b[a[e]];
      if(f !== c) {
        return d === !1 ? a[e] : x(f, "function") ? f.bind(d || b) : f
      }
    }
    return!1
  }
  var d = "2.5.3", e = {}, f = b.documentElement, g = "modernizr", h = b.createElement(g), i = h.style, j, k = {}.toString, l = {}, m = {}, n = {}, o = [], p = o.slice, q, r = function(a, c, d, e) {
    var h, i, j, k = b.createElement("div"), l = b.body, m = l ? l : b.createElement("body");
    if(parseInt(d, 10)) {
      while(d--) {
        j = b.createElement("div"), j.id = e ? e[d] : g + (d + 1), k.appendChild(j)
      }
    }
    return h = ["&#173;", "<style>", a, "</style>"].join(""), k.id = g, (l ? k : m).innerHTML += h, m.appendChild(k), l || (m.style.background = "", f.appendChild(m)), i = c(k, a), l ? k.parentNode.removeChild(k) : m.parentNode.removeChild(m), !!i
  }, s = function(b) {
    var c = a.matchMedia || a.msMatchMedia;
    if(c) {
      return c(b).matches
    }
    var d;
    return r("@media " + b + " { #" + g + " { position: absolute; } }", function(b) {
      d = (a.getComputedStyle ? getComputedStyle(b, null) : b.currentStyle)["position"] == "absolute"
    }), d
  }, t = {}.hasOwnProperty, u;
  !x(t, "undefined") && !x(t.call, "undefined") ? u = function(a, b) {
    return t.call(a, b)
  } : u = function(a, b) {
    return b in a && x(a.constructor.prototype[b], "undefined")
  }, Function.prototype.bind || (Function.prototype.bind = function(b) {
    var c = this;
    if(typeof c != "function") {
      throw new TypeError;
    }
    var d = p.call(arguments, 1), e = function() {
      if(this instanceof e) {
        var a = function() {
        };
        a.prototype = c.prototype;
        var f = new a, g = c.apply(f, d.concat(p.call(arguments)));
        return Object(g) === g ? g : f
      }
      return c.apply(b, d.concat(p.call(arguments)))
    };
    return e
  });
  for(var A in l) {
    u(l, A) && (q = A.toLowerCase(), e[q] = l[A](), o.push((e[q] ? "" : "no-") + q))
  }
  return v(""), h = j = null, e._version = d, e.mq = s, e.testStyles = r, e
}(this, this.document);
(function($) {
  $.widget("ui.tagit", {options:{tagSource:[], triggerKeys:["enter", "space", "comma", "tab"], initialTags:[], minLength:1, select:false, allowNewTags:true, caseSensitive:false, sortable:false, highlightOnExistColor:"#0F0", emptySearch:true, watermarkAllowMessage:"Add tags", watermarkDenyMessage:"Tags limit reached", tagsChanged:function(tagValue, action, element) {
  }}, _splitAt:/\ |,/g, _existingAtIndex:0, _pasteMetaKeyPressed:false, _keys:{backspace:[8], enter:[13], space:[32], comma:[44, 188], tab:[9]}, _sortable:{sorting:-1}, _create:function() {
    var self = this;
    this.tagsArray = [];
    this.timer = null;
    this.element.addClass("tagit");
    this.element.children("li").each(function() {
      var tag = $(this);
      var tagValue = tag.attr("tagValue");
      self.options.initialTags.push({label:tag.text(), value:tagValue ? tagValue : tag.text()})
    });
    self._splitAt = null;
    if($.inArray("space", self.options.triggerKeys) > 0 && $.inArray("comma", self.options.triggerKeys) > 0) {
      self._splitAt = /\ |,/g
    }else {
      if($.inArray("space", self.options.triggerKeys) > 0) {
        self._splitAt = /\ /g
      }else {
        if($.inArray("comma", self.options.triggerKeys) > 0) {
          self._splitAt = /,/g
        }
      }
    }
    this.element.html('<li class="tagit-new"><input class="tagit-input" type="text" /></li>');
    this.input = this.element.find(".tagit-input");
    if(typeof $().watermark == "function") {
      this.input.watermark(this.options.watermarkAllowMessage)
    }
    $(this.element).click(function(e) {
      if($(e.target).hasClass("tagit-close")) {
        var parent = $(e.target).parent();
        var tag = self.tagsArray[parent.index()];
        tag.element.remove();
        self._popTag(tag)
      }else {
        self.input.focus();
        if(self.options.emptySearch && $(e.target).hasClass("tagit-input") && self.input.val() == "" && self.input.autocomplete != undefined) {
          self.input.autocomplete("search")
        }
      }
    });
    var os = this.options.select;
    this.options.appendTo = this.element;
    this.options.source = this.options.tagSource;
    this.options.select = function(event, ui) {
      self.input.data("autoCompleteTag", true);
      clearTimeout(self.timer);
      if(ui.item.label === undefined) {
        self._addTag(ui.item.value)
      }else {
        self._addTag(ui.item.label, ui.item.value)
      }
      event.stopPropagation();
      return false
    };
    this.options.focus = function(event, ui) {
      if(ui.item.label !== undefined && /^key/.test(event.originalEvent.originalEvent.type)) {
        self.input.val(ui.item.label);
        self.input.attr("tagValue", ui.item.value);
        return false
      }
    };
    this.options.autoFocus = !this.options.allowNewTags;
    this.input.autocomplete(this.options);
    this.options.select = os;
    this.input.keydown(function(e) {
      var lastLi = self.element.children(".tagit-choice:last");
      if(e.which == self._keys.backspace) {
        return self._backspace(lastLi)
      }
      if(self._isInitKey(e.which) && !(self._isTabKey(e.which) && this.value == "" && !self.input.data("autoCompleteTag"))) {
        e.preventDefault();
        self.input.data("autoCompleteTag", false);
        if(self.options.allowNewTags && $(this).val().length >= self.options.minLength) {
          self._addTag($(this).val())
        }
      }
      if(self.options.maxLength !== undefined && self.input.val().length == self.options.maxLength) {
        e.preventDefault()
      }
      if(lastLi.hasClass("selected")) {
        lastLi.removeClass("selected")
      }
      _pasteMetaKeyPressed = e.metaKey;
      self.lastKey = e.which
    });
    this.input.keyup(function(e) {
      if(_pasteMetaKeyPressed && (e.which == 91 || e.which == 86)) {
        $(this).blur()
      }
      window.setTimeout(function() {
        _pasteMetaKeyPressed = e.metaKey
      }, 250)
    });
    this.input.blur(function(e) {
      self.currentLabel = $(this).val();
      self.currentValue = $(this).attr("tagValue");
      if(self.options.allowNewTags && self.currentLabel) {
        self.timer = setTimeout(function() {
          self._addTag(self.currentLabel, self.currentValue);
          self.currentValue = "";
          self.currentLabel = ""
        }, 400)
      }
      $(this).val("").removeAttr("tagValue");
      return true
    });
    if(!String.prototype.trim) {
      String.prototype.trim = function() {
        return this.replace(/^\s+|\s+$/g, "")
      }
    }
    if(this.options.select) {
      this.select = $('<select class="tagit-hiddenSelect" name="' + this.element.attr("name") + '" multiple="multiple"></select>');
      this.element.after(this.select)
    }
    this._initialTags();
    if(self.options.sortable !== false) {
      var soptions = {items:".tagit-choice", containment:"parent", opacity:0.6, tolerance:"pointer", start:function(event, ui) {
        self._sortable.tag = $(ui.item);
        self._sortable.origIndex = self._sortable.tag.index()
      }, update:function(event, ui) {
        self._sortable.newIndex = self._sortable.tag.index();
        self._moveTag(self._sortable.origIndex, self._sortable.newIndex);
        if(self.options.tagsChanged) {
          var tag = self.tagsArray[self._sortable.newIndex];
          self.options.tagsChanged(tag.value, "moved", tag.element)
        }
      }};
      if(self.options.sortable == "handle") {
        soptions.handle = "a.ui-icon";
        soptions.cursor = "move"
      }
      self.element.sortable(soptions)
    }
  }, _popSelect:function(tag) {
    $("option:eq(" + tag.index + ")", this.select).remove();
    this.select.change()
  }, _addSelect:function(tag) {
    this.select.append('<option selected="selected" value="' + tag.value + '">' + tag.label + "</option>");
    this.select.change()
  }, _popTag:function(tag) {
    if(tag === undefined) {
      tag = this.tagsArray.pop()
    }else {
      this.tagsArray.splice(tag.index, 1)
    }
    if(typeof $().watermark == "function") {
      this.input.watermark(this.options.watermarkAllowMessage)
    }
    for(var ind in this.tagsArray) {
      this.tagsArray[ind].index = ind
    }
    if(this.options.select) {
      this._popSelect(tag)
    }
    if(this.options.tagsChanged) {
      this.options.tagsChanged(tag.value || tag.label, "popped", null)
    }
    return
  }, _addTag:function(label, value) {
    if(this.tagsArray.length > this.options.maxTags - 1) {
      $(this.input).blur();
      return false
    }
    this.input.autocomplete("close").val("");
    if(this._splitAt && label.search(this._splitAt) > 0) {
      var result = label.split(this._splitAt);
      for(var i = 0;i < result.length;i++) {
        this._addTag(result[i], value)
      }
      return
    }
    label = label.replace(/,+$/, "").trim();
    if(label == "") {
      return false
    }
    var tagExists = this._exists(label, value);
    if(tagExists !== false) {
      this._highlightExisting(tagExists);
      return false
    }
    if(this.tagsArray.length == this.options.maxTags - 1) {
      if(typeof $().watermark == "function") {
        this.input.watermark(this.options.watermarkDenyMessage)
      }
      $(this.input).blur()
    }
    var tag = this.tag(label, value);
    tag.element = $('<li class="tagit-choice"' + (value !== undefined ? ' tagValue="' + value + '"' : "") + ">" + (this.options.sortable == "handle" ? '<a class="ui-icon ui-icon-grip-dotted-vertical" style="float:left"></a>' : "") + label + '<a class="tagit-close">x</a></li>');
    tag.element.insertBefore(this.input.parent());
    this.tagsArray.push(tag);
    this.input.val("");
    if(this.options.select) {
      this._addSelect(tag)
    }
    if(this.options.tagsChanged) {
      this.options.tagsChanged(tag.label, "added", tag.element)
    }
    return true
  }, _removeTagWithValue:function(label, value) {
    var index = this._exists(label, value);
    if(index != false) {
      var tag = this.tagsArray[index];
      tag.element.remove();
      this._popTag(tag)
    }
  }, _exists:function(label, value) {
    if(this.tagsArray.length == 0) {
      return false
    }
    label = this._lowerIfCaseInsensitive(label);
    value = this._lowerIfCaseInsensitive(value);
    for(var ind in this.tagsArray) {
      if(this._lowerIfCaseInsensitive(this.tagsArray[ind].label) == label) {
        if(value !== undefined) {
          if(this._lowerIfCaseInsensitive(this.tagsArray[ind].value) == value) {
            return ind
          }
        }else {
          return ind
        }
      }
    }
    return false
  }, _highlightExisting:function(index) {
    if(this.options.highlightOnExistColor === undefined) {
      return
    }
    var tag = this.tagsArray[index];
    tag.element.stop();
    var initialColor = tag.element.css("color");
    tag.element.animate({color:this.options.highlightOnExistColor}, 100).animate({"color":initialColor}, 800)
  }, _isInitKey:function(keyCode) {
    var keyName = "";
    for(var key in this._keys) {
      if($.inArray(keyCode, this._keys[key]) != -1) {
        keyName = key
      }
    }
    if($.inArray(keyName, this.options.triggerKeys) != -1) {
      return true
    }
    return false
  }, _isTabKey:function(keyCode) {
    var tabKeys = this._keys["tab"];
    return $.inArray(keyCode, tabKeys) > -1
  }, _removeTag:function() {
    this._popTag();
    this.element.children(".tagit-choice:last").remove()
  }, _backspace:function(li) {
    if(this.input.val() == "") {
      if(this.lastKey == this._keys.backspace) {
        this._popTag();
        li.remove();
        this.lastKey = null
      }else {
        li.addClass("selected");
        this.lastKey = this._keys.backspace
      }
    }
    return true
  }, _initialTags:function() {
    var input = this;
    var _temp;
    if(this.options.tagsChanged) {
      _temp = this.options.tagsChanged
    }
    this.options.tagsChanged = null;
    if(this.options.initialTags.length != 0) {
      $(this.options.initialTags).each(function(i, element) {
        if(typeof element == "object") {
          input._addTag(element.label, element.value)
        }else {
          input._addTag(element)
        }
      })
    }
    this.options.tagsChanged = _temp
  }, _lowerIfCaseInsensitive:function(inp) {
    if(inp === undefined || typeof inp != typeof"a") {
      return inp
    }
    if(this.options.caseSensitive) {
      return inp
    }
    return inp.toLowerCase()
  }, _moveTag:function(old_index, new_index) {
    this.tagsArray.splice(new_index, 0, this.tagsArray.splice(old_index, 1)[0]);
    for(var ind in this.tagsArray) {
      this.tagsArray[ind].index = ind
    }
    if(this.options.select) {
      $("option:eq(" + old_index + ")", this.select).insertBefore($("option:eq(" + new_index + ")", this.select))
    }
  }, tags:function() {
    return this.tagsArray
  }, destroy:function() {
    $.Widget.prototype.destroy.apply(this, arguments);
    this.tagsArray = []
  }, reset:function() {
    this.element.find(".tagit-choice").remove();
    this.tagsArray = [];
    if(this.options.select) {
      this.select.children().remove();
      this.select.change()
    }
    this._initialTags();
    if(this.options.tagsChanged) {
      this.options.tagsChanged(null, "reset", null)
    }
    if(typeof $().watermark == "function") {
      this.input.watermark(this.options.watermarkAllowMessage)
    }
  }, fill:function(tags) {
    if(tags !== undefined) {
      this.options.initialTags = tags
    }
    this.reset()
  }, add:function(label, value) {
    if(typeof label == "object") {
      return this._addTag({label:label, value:value})
    }else {
      return this._addTag(label, value)
    }
  }, remove:function(value) {
    this._removeTagWithValue(value, value)
  }, tag:function(label, value, element) {
    var self = this;
    return{label:label, value:value === undefined ? label : value, element:element, index:self.tagsArray.length}
  }})
})(jQuery);
if(!window["YT"]) {
  var YT = {}
}
if(!YT.Player) {
  (function() {
    var s = "http:" + "//s.ytimg.com/yts/jsbin/www-widgetapi-vfl3iLqI8.js";
    var a = document.createElement("script");
    a.src = s;
    a.async = true;
    var b = document.getElementsByTagName("script")[0];
    b.parentNode.insertBefore(a, b);
    YT.embed_template = '<iframe width="425" height="344" src="" frameborder="0" allowfullscreen></iframe>'
  })()
}
;VISH.Renderer = function(V, $, undefined) {
  var SLIDE_CONTAINER = null;
  var init = function() {
    SLIDE_CONTAINER = $(".slides");
    V.Renderer.Filter.init()
  };
  var renderSlide = function(slide, extra_classes, extra_buttons) {
    var article;
    if(!extra_classes) {
      var extra_classes = ""
    }
    if(!extra_buttons) {
      var extra_buttons = ""
    }
    switch(slide.type) {
      case undefined:
      ;
      case V.Constant.STANDARD:
      ;
      case V.Constant.QUIZ_SIMPLE:
        article = _renderStandardSlide(slide, extra_classes, extra_buttons);
        break;
      case V.Constant.FLASHCARD:
        article = _renderFlashcardSlide(slide, extra_classes, extra_buttons);
        break;
      case V.Constant.VTOUR:
        article = _renderVirtualTourSlide(slide, extra_classes, extra_buttons);
        break;
      default:
        article = null;
        break
    }
    if(article) {
      SLIDE_CONTAINER.append($(article));
      _afterDrawSlide(slide)
    }
  };
  var _renderStandardSlide = function(slide, extra_classes, extra_buttons) {
    var content = "";
    var classes = "";
    for(el in slide.elements) {
      if(!V.Renderer.Filter.allowElement(slide.elements[el])) {
        content += V.Renderer.Filter.renderContentFiltered(slide.elements[el], slide.template)
      }else {
        if(slide.elements[el].type === V.Constant.TEXT) {
          content += _renderText(slide.elements[el], slide.template)
        }else {
          if(slide.elements[el].type === V.Constant.IMAGE) {
            content += _renderImage(slide.elements[el], slide.template)
          }else {
            if(slide.elements[el].type === V.Constant.VIDEO) {
              content += renderVideo(slide.elements[el], slide.template)
            }else {
              if(slide.elements[el].type === V.Constant.OBJECT) {
                content += _renderObject(slide.elements[el], slide.template);
                classes += "object "
              }else {
                if(slide.elements[el].type === V.Constant.SNAPSHOT) {
                  content += _renderSnapshot(slide.elements[el], slide.template);
                  classes += "snapshot "
                }else {
                  if(slide.elements[el].type === V.Constant.APPLET) {
                    content += _renderApplet(slide.elements[el], slide.template);
                    classes += "applet "
                  }else {
                    if(slide.elements[el].type === V.Constant.QUIZ) {
                      content += V.Quiz.render(slide.elements[el], slide.template);
                      classes += V.Constant.QUIZ
                    }else {
                      content += _renderEmpty(slide.elements[el], slide.template)
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    return"<article class='" + extra_classes + " " + classes + "' id='" + slide.id + "'>" + extra_buttons + content + "</article>"
  };
  var _renderFlashcardSlide = function(slide, extra_classes, extra_buttons) {
    var all_slides = "";
    for(index in slide.slides) {
      var subslide = slide.slides[index];
      all_slides += _renderStandardSlide(subslide, "subslide", "<div class='close_subslide' id='close" + subslide.id + "'></div>")
    }
    var div_for_slides_hidden = "<div class='subslides' >" + all_slides + "</div>";
    return $("<article class='" + extra_classes + " flashcard_slide' type='flashcard' avatar='" + slide.background + "' id='" + slide.id + "'>" + extra_buttons + div_for_slides_hidden + "</article>")
  };
  var _renderVirtualTourSlide = function(slide, extra_classes, extra_buttons) {
    var all_slides = "";
    for(index in slide.slides) {
      var subslide = slide.slides[index];
      all_slides += _renderStandardSlide(subslide, "subslide", "<div class='close_subslide' id='close" + subslide.id + "'></div>")
    }
    var div_for_slides_hidden = "<div class='subslides' >" + all_slides + "</div>";
    return $("<article class='" + extra_classes + " virtualTour_slide' type='" + V.Constant.VTOUR + "' id='" + slide.id + "'>" + extra_buttons + div_for_slides_hidden + "</article>")
  };
  var _afterDrawSlide = function(slide) {
    switch(slide.type) {
      case undefined:
      ;
      case V.Constant.STANDARD:
        break;
      case V.Constant.FLASHCARD:
        $("#" + slide.id).css("background-image", slide.background);
        for(index in slide.pois) {
          var poi = slide.pois[index];
          V.Flashcard.addArrow(slide.id, poi, true)
        }
        break;
      case V.Constant.VTOUR:
        V.VirtualTour.drawMap(slide);
        break;
      default:
        break
    }
  };
  var _renderText = function(element, template) {
    return"<div id='" + element["id"] + "' class='VEtextArea " + template + "_" + element["areaid"] + " " + template + "_text" + "'>" + element["body"] + "</div>"
  };
  var _renderEmpty = function(element, template) {
    return"<div id='" + element["id"] + "' class='" + template + "_" + element["areaid"] + " " + template + "_text" + "'></div>"
  };
  var _renderImage = function(element, template) {
    var div = $("<div id='" + element["id"] + "' class='" + template + "_" + element["areaid"] + "'></div>");
    var img = $("<img class='" + template + "_image' src='" + element["body"] + "' style='" + element["style"] + "' />");
    if(element["hyperlink"]) {
      var a = $("<a href='" + element["hyperlink"] + "' target='blank_'></a>");
      $(a).append(img);
      $(div).append(a)
    }else {
      $(div).append(img)
    }
    return V.Utils.getOuterHTML(div)
  };
  var renderVideo = function(element, template) {
    var rendered = "<div id='" + element["id"] + "' class='" + template + "_" + element["areaid"] + "'>";
    var style = element["style"] ? "style='" + element["style"] + "'" : "";
    var controls = element["controls"] ? "controls='" + element["controls"] + "' " : "controls='controls' ";
    var autoplay = element["autoplay"] ? "autoplayonslideenter='" + element["autoplay"] + "' " : "";
    var poster = element["poster"] ? "poster='" + element["poster"] + "' " : "";
    var loop = element["loop"] ? "loop='loop' " : "";
    var sources = element["sources"];
    var videoId = V.Utils.getId();
    if(typeof sources == "string") {
      sources = JSON.parse(sources)
    }
    rendered = rendered + "<video id='" + videoId + "' class='" + template + "_video' preload='metadata' " + style + controls + autoplay + poster + loop + ">";
    $.each(sources, function(index, source) {
      var type = source.type ? "type='" + source.type + "' " : "";
      rendered = rendered + "<source src='" + source.src + "' " + type + ">"
    });
    if(sources.length > 0) {
      rendered = rendered + "<p>Your browser does not support HTML5 video.</p>"
    }
    rendered = rendered + "</video>";
    return rendered
  };
  var _renderObject = function(element, template) {
    var objectInfo = V.Object.getObjectInfo(element.body);
    switch(objectInfo.type) {
      case "youtube":
        return _renderYoutubeVideo(element, template, objectInfo.source);
        break;
      default:
        var style = element["style"] ? element["style"] : "";
        var body = element["body"];
        var zoomInStyle = element["zoomInStyle"] ? element["zoomInStyle"] : "";
        return"<div id='" + element["id"] + "' class='objectelement " + template + "_" + element["areaid"] + "' objectStyle='" + style + "' zoomInStyle='" + zoomInStyle + "' objectWrapper='" + body + "'>" + "" + "</div>";
        break
    }
  };
  var _renderYoutubeVideo = function(element, template, source) {
    var ytContainerId = V.Utils.getId();
    var style = element["style"] ? element["style"] : "";
    var body = element["body"];
    var zoomInStyle = element["zoomInStyle"] ? element["zoomInStyle"] : "";
    return"<div id='" + element["id"] + "' class='objectelement youtubeelement " + template + "_" + element["areaid"] + "' objectStyle='" + style + "' zoomInStyle='" + zoomInStyle + "' source='" + source + "' ytContainerId='" + ytContainerId + "'>" + "</div>"
  };
  var _renderSnapshot = function(element, template) {
    var style = element["style"] ? element["style"] : "";
    var body = element["body"];
    var scrollTop = element["scrollTop"] ? element["scrollTop"] : 0;
    var scrollLeft = element["scrollLeft"] ? element["scrollLeft"] : 0;
    return"<div id='" + element["id"] + "' class='snapshotelement " + template + "_" + element["areaid"] + "' template='" + template + "' objectStyle='" + style + "' scrollTop='" + scrollTop + "' scrollTopOrigin='" + scrollTop + "' scrollLeft='" + scrollLeft + "' scrollLeftOrigin='" + scrollLeft + "' objectWrapper='" + body + "'>" + "" + "</div>"
  };
  var _renderApplet = function(element, template) {
    return"<div id='" + element["id"] + "' class='appletelement " + template + "_" + element["areaid"] + "' code='" + element["code"] + "' width='" + element["width"] + "' height='" + element["height"] + "' archive='" + element["archive"] + "' params='" + element["params"] + "' ></div>"
  };
  var _renderFlashcard = function(element, template) {
    return"<div id='" + element["id"] + "' class='template_flashcard'><canvas id='" + element["canvasid"] + "'>Your browser does not support canvas</canvas></div>"
  };
  return{init:init, renderVideo:renderVideo, renderSlide:renderSlide}
}(VISH, jQuery);
VISH.Status = function(V, $, undefined) {
  var _device;
  var _isInIframe;
  var _isAnotherDomain;
  var _isOnline;
  var _isSlave;
  var _isPreventDefault;
  var init = function(callback) {
    _checkIframe();
    _checkDomain();
    V.Status.Device.init(function(returnedDevice) {
      _device = returnedDevice;
      _checkOnline();
      if(typeof callback === "function") {
        callback()
      }
    })
  };
  var _checkIframe = function() {
    _isInIframe = window.location != window.parent.location ? true : false;
    return _isInIframe
  };
  var _checkDomain = function() {
    _isAnotherDomain = false;
    if(_checkIframe()) {
      var parent = window.parent;
      while(parent != window.top) {
        if(typeof parent.location.href === "undefined") {
          _isAnotherDomain = true;
          break
        }else {
          parent = parent.parent
        }
      }
      if(typeof window.top.location.href === "undefined") {
        _isAnotherDomain = true
      }
    }
    return _isAnotherDomain
  };
  var _checkOnline = function() {
    $.ajax({async:true, cache:false, error:function(req, status, ex) {
      V.Debugging.log("Error: " + ex);
      _isOnline = false
    }, success:function(data, status, req) {
      _isOnline = true
    }, timeout:5E3, type:"GET", url:V.ImagesPath + "blank.gif"})
  };
  var getDevice = function() {
    return _device
  };
  var getIsEmbed = function() {
    return _isAnotherDomain
  };
  var getIsInIframe = function() {
    return _isInIframe
  };
  var getIframe = function() {
    if(_isInIframe) {
      return window.frameElement
    }else {
      return null
    }
  };
  var isOnline = function() {
    return _isOnline
  };
  var isSlaveMode = function() {
    if(typeof _isSlave !== "undefined") {
      return _isSlave
    }else {
      return false
    }
  };
  var setSlaveMode = function(slaveMode) {
    if(slaveMode !== _isSlave) {
      if(slaveMode === true) {
        V.Events.unbindViewerEventListeners();
        V.VideoPlayer.HTML5.showControls(false);
        _isSlave = true
      }else {
        V.Events.bindViewerEventListeners();
        V.VideoPlayer.HTML5.showControls(true);
        _isSlave = false
      }
    }
  };
  var isPreventDefaultMode = function() {
    if(typeof _isPreventDefault !== "undefined") {
      return _isPreventDefault
    }else {
      return false
    }
  };
  var setPreventDefaultMode = function(preventDefault) {
    if(preventDefault !== _isPreventDefault) {
      if(preventDefault === true) {
        _isPreventDefault = true
      }else {
        _isPreventDefault = false
      }
    }
  };
  return{init:init, getDevice:getDevice, getIsEmbed:getIsEmbed, getIsInIframe:getIsInIframe, getIframe:getIframe, isOnline:isOnline, isSlaveMode:isSlaveMode, setSlaveMode:setSlaveMode, isPreventDefaultMode:isPreventDefaultMode, setPreventDefaultMode:setPreventDefaultMode}
}(VISH, jQuery);
VISH.Status.Device = function(V, $, undefined) {
  var init = function(callback) {
    V.Status.Device.Browser.init();
    V.Status.Device.Features.init();
    _fillDevice(callback)
  };
  var _fillDevice = function(callback) {
    var storedDevice = V.Storage.get(V.Constant.Storage.Device);
    if(typeof storedDevice !== "undefined") {
      device = storedDevice;
      _loadViewportForDevice(device, function() {
        _fillScreen(device);
        if(typeof callback === "function") {
          callback(device)
        }
      });
      return
    }
    var device = {};
    device.browser = {};
    device.features = {};
    device.browser = V.Status.Device.Browser.fillBrowser();
    _fillUserAgentBeforeViewport(device);
    _loadViewportForDevice(device, function() {
      _fillUserAgentAfterViewport(device);
      _fillScreen(device);
      device.features = V.Status.Device.Features.fillFeatures();
      V.Storage.add(V.Constant.Storage.Device, device, false);
      if(device.android && device.browser.name === V.Constant.ANDROID_BROWSER) {
        if(device.hasTestingViewport === true) {
          _reloadOnAndroidTestingViewport(callback, device);
          return
        }
      }
      if(typeof callback === "function") {
        callback(device)
      }
    })
  };
  var _reloadOnAndroidTestingViewport = function(callback, device) {
    var attempts = 0;
    var maxAttempts = 3;
    var initialDevice = V.Storage.get(V.Constant.Storage.Device);
    if(typeof storedDevice !== "undefined") {
      location.reload(true);
      return
    }
    var waitTimer = setInterval(function() {
      var storedDevice = V.Storage.get(V.Constant.Storage.Device);
      if(typeof storedDevice !== "undefined") {
        clearInterval(waitTimer);
        location.reload(true)
      }else {
        attempts++;
        if(attempts >= maxAttempts) {
          clearInterval(waitTimer);
          callback(device)
        }
      }
    }, 1E3)
  };
  var _fillUserAgentBeforeViewport = function(device) {
    device.pixelRatio = window.devicePixelRatio || 1;
    device.iPhone = /iPhone/i.test(navigator.userAgent);
    device.iPhone4 = device.iPhone && device.pixelRatio == 2;
    device.iPad = /iPad/i.test(navigator.userAgent);
    device.iOS = device.iPhone || device.iPad;
    device.applePhone = device.iPhone || device.iPhone4;
    device.appleTablet = device.iPad;
    device.android = /android/i.test(navigator.userAgent)
  };
  var _loadViewportForDevice = function(device, callback) {
    if(device.iOS && device.browser.name === V.Constant.SAFARI) {
      _setViewportForIphone(callback)
    }else {
      if(device.android) {
        if(device.browser.name === V.Constant.CHROME) {
          _setViewportForChromeForAndroid(callback)
        }else {
          if(device.browser.name === V.Constant.ANDROID_BROWSER) {
            if(typeof device.desktop === "undefined") {
              device.hasTestingViewport = true;
              _setTestingViewportForAndroidBrowser(callback)
            }else {
              _setViewportForAndroidBrowser(callback)
            }
          }
        }
      }else {
        if(typeof callback === "function") {
          callback()
        }
      }
    }
  };
  var WAITING_TIME_FOR_VIEWPORT_LOAD = 1250;
  var _setViewport = function(viewportContent, callback) {
    var viewport = $("head>meta[name='viewport']");
    if(viewport.length === 0) {
      $("head").prepend('<meta name="viewport" content="' + viewportContent + '"/>')
    }else {
      $(viewport).attr("content", viewportContent)
    }
    setTimeout(function() {
      if(typeof callback === "function") {
        callback()
      }
    }, WAITING_TIME_FOR_VIEWPORT_LOAD)
  };
  var _setViewportForAndroidBrowser = function(callback) {
    _setViewport("user-scalable=yes", callback)
  };
  var _setTestingViewportForAndroidBrowser = function(callback) {
    _setViewport("width=device-width,height=device-height,user-scalable=yes", callback)
  };
  var _setViewportForChromeForAndroid = function(callback) {
    _setViewport("width=device-width,height=device-height,user-scalable=yes", callback)
  };
  var _setViewportForIphone = function(callback) {
    _setViewport("user-scalable=yes", callback)
  };
  var _fillUserAgentAfterViewport = function(device) {
    device.androidPhone = false;
    device.androidTablet = false;
    if(device.android) {
      if(/tablet/i.test(navigator.userAgent)) {
        device.androidTablet = true
      }else {
        var maxWidth = 960 * device.pixelRatio;
        var maxHeight = 720 * device.pixelRatio;
        var landscape = window.screen.availWidth > window.screen.availHeight;
        if(landscape) {
          if(window.screen.availWidth >= maxWidth && window.screen.availHeight >= maxHeight) {
            device.androidTablet = true
          }else {
            device.androidPhone = true
          }
        }else {
          if(window.screen.availWidth >= maxHeight && window.screen.availHeight >= maxWidth) {
            device.androidTablet = true
          }else {
            device.androidPhone = true
          }
        }
      }
    }
    device.mobile = device.applePhone || device.androidPhone;
    device.tablet = device.appleTablet || device.androidTablet;
    if(!device.mobile && !device.tablet) {
      device.desktop = true
    }else {
      device.desktop = false
    }
  };
  var _fillScreen = function(device) {
    device.viewport = {width:window.innerWidth, height:window.innerHeight};
    device.screen = {rWidth:window.screen.availWidth * device.pixelRatio, rHeight:window.screen.availHeight * device.pixelRatio, width:window.screen.availWidth, height:window.screen.availHeight}
  };
  return{init:init}
}(VISH, jQuery);
VISH.Utils = function(V, undefined) {
  var ids;
  var domIds;
  var init = function() {
    if(!domIds) {
      domIds = new Array;
      ids = []
    }
  };
  var getOptions = function() {
    if(V.Editing) {
      return V.Editor.getOptions()
    }else {
      return V.SlideManager.getOptions()
    }
  };
  var getId = function(full_id_prefix, justCheck, separator) {
    if(!justCheck) {
      if(typeof full_id_prefix !== "string") {
        full_id_prefix = "unicID"
      }
      if(typeof separator !== "string") {
        separator = ""
      }
      if(typeof domIds[full_id_prefix] === "undefined") {
        domIds[full_id_prefix] = 0
      }
      domIds[full_id_prefix] = domIds[full_id_prefix] + 1;
      var full_id = full_id_prefix + separator + domIds[full_id_prefix]
    }else {
      var full_id = full_id_prefix;
      full_id_prefix = full_id_prefix.replace(full_id_prefix[full_id_prefix.length - 1], "")
    }
    if($("#" + full_id).length === 0 && ids.indexOf(full_id) === -1) {
      ids.push(full_id);
      return full_id
    }else {
      return getId(full_id_prefix, false, separator)
    }
  };
  var fixPresentation = function(presentation) {
    if(typeof presentation.type == "undefined") {
      presentation.type = V.Constant.STANDARD
    }
    if(typeof presentation.VEVersion == "undefined") {
      presentation.VEVersion = "0.1"
    }
    presentation = _fixIds(presentation);
    return presentation
  };
  var _fixIds = function(presentation) {
    var slides = presentation.slides;
    var sL = slides.length;
    for(var i = 0;i < sL;i++) {
      var slide = slides[i];
      if(!slide.id.match(/^article[0-9]+/g)) {
        slide.id = getId("article")
      }else {
        slide.id = getId(slide.id, true)
      }
      if(typeof slide.type == "undefined") {
        slide.type = V.Constant.STANDARD
      }
      switch(slide.type) {
        case V.Constant.STANDARD:
          slide = _fixIdsStandardSlide(slide);
          break;
        case V.Constant.FLASHCARD:
          slide = _fixIdsFlashcardSlide(slide);
          break;
        case V.Constant.VTOUR:
          slide = _fixIdsVTourSlide(slide);
          break;
        default:
          return
      }
    }
    return presentation
  };
  var _fixIdsStandardSlide = function(slide) {
    var elements = slide.elements;
    var eL = elements.length;
    for(var j = 0;j < eL;j++) {
      if(elements[j].id.match(new RegExp("^" + slide.id, "g")) === null) {
        elements[j].id = getId(slide.id + "_zone")
      }else {
        elements[j].id = getId(elements[j].id, true)
      }
    }
    return slide
  };
  var _fixIdsFlashcardSlide = function(slide) {
    return slide
  };
  var _fixIdsVTourSlide = function(slide) {
    var slides = slide.slides;
    if(slides) {
      var sL = slides.length;
      for(var i = 0;i < sL;i++) {
        if(typeof slides[i].type == "undefined") {
          slides[i].type = V.Constant.STANDARD
        }
      }
    }
    return slide
  };
  var getOuterHTML = function(tag) {
    if(typeof $(tag)[0].outerHTML == "undefined") {
      return $(tag).clone().wrap("<div></div>").parent().html()
    }else {
      return $(tag)[0].outerHTML
    }
  };
  var loadDeviceCSS = function() {
    if(V.Status.getDevice().desktop) {
      loadCSS("device/desktop.css")
    }else {
      if(V.Status.getDevice().mobile) {
        loadCSS("device/mobile.css")
      }else {
        if(V.Status.getDevice().tablet) {
          loadCSS("device/tablet.css")
        }
      }
    }
    switch(V.Status.getDevice().browser.name) {
      case V.Constant.FIREFOX:
        loadCSS("browser/firefox.css");
        break;
      case V.Constant.IE:
        loadCSS("browser/ie.css");
        break;
      case V.Constant.CHROME:
        loadCSS("browser/chrome.css");
        break
    }
  };
  var sendParentToURL = function(the_url) {
    window.top.location = the_url
  };
  var addParamToUrl = function(url, paramName, paramValue) {
    if(typeof url !== "string" || typeof paramName !== "string" || typeof paramValue !== "string") {
      return url
    }
    var splitHash = url.split("#");
    url = splitHash[0];
    var param = paramName + "=" + paramValue;
    if(url.indexOf("?") > -1) {
      url += "&" + param
    }else {
      url += "?" + param
    }
    if(splitHash.length > 1) {
      url = url + "#" + splitHash[1]
    }
    return url
  };
  var getParamsFromUrl = function(url) {
    var params = {};
    if(typeof url !== "string") {
      return params
    }
    var split = url.split("?");
    if(split.length <= 1) {
      return params
    }else {
      var urlParams = split[1].split("#")[0].split("&");
      for(var i = 0;i < urlParams.length;i++) {
        var resultSplit = urlParams[i].split("=");
        if(resultSplit.length === 2) {
          params[resultSplit[0]] = resultSplit[1]
        }
      }
      return params
    }
  };
  var loadCSS = function(path) {
    $("head").append('<link rel="stylesheet" href="' + V.StylesheetsPath + path + '" type="text/css" />')
  };
  var checkMiniumRequirements = function() {
    var browserRequirements = true;
    var device = V.Status.getDevice();
    switch(device.browser.name) {
      case V.Constant.IE:
        if(V.Editing) {
          if(device.browser.version < 9) {
            browserRequirements = false
          }
        }else {
          if(device.browser.version < 8) {
            browserRequirements = false
          }
        }
        break;
      case V.Constant.FIREFOX:
        break;
      case V.Constant.CHROME:
        break;
      default:
        break
    }
    if(!browserRequirements) {
      $.fancybox($("#requirements_form_wrapper").html(), {"autoDimensions":false, "width":650, "height":400, "showCloseButton":false, "padding":0, "onClosed":function() {
      }});
      return false
    }
    return true
  };
  var getSrcFromCSS = function(css) {
    if(css.indexOf("url") === 0) {
      return css.substring(4, css.length - 1)
    }else {
      return css
    }
  };
  var getZoomInStyle = function(zoom) {
    var style = "";
    style = style + "-ms-transform: scale(" + zoom + "); ";
    style = style + "-ms-transform-origin: 0 0; ";
    style = style + "-moz-transform: scale(" + zoom + "); ";
    style = style + "-moz-transform-origin: 0 0; ";
    style = style + "-o-transform: scale(" + zoom + "); ";
    style = style + "-o-transform-origin: 0 0; ";
    style = style + "-webkit-transform: scale(" + zoom + "); ";
    style = style + "-webkit-transform-origin: 0 0; ";
    return style
  };
  var getZoomFromStyle = function(style) {
    var zoom = 1;
    if(!style) {
      return zoom
    }
    var moz_zoom_pattern = /-moz-transform: ?scale\(([0-9]+.[0-9]+)\)/g;
    var webkit_zoom_pattern = /-webkit-transform: ?scale\(([0-9]+.[0-9]+)\)/g;
    var opera_zoom_pattern = /-o-transform: ?scale\(([0-9]+.[0-9]+)\)/g;
    var ie_zoom_pattern = /-ms-transform: ?scale\(([0-9]+.[0-9]+)\)/g;
    $.each(style.split(";"), function(index, property) {
      if(property.match(moz_zoom_pattern) != null) {
        var result = moz_zoom_pattern.exec(property);
        if(result !== null && result[1]) {
          zoom = parseFloat(result[1]);
          return false
        }
      }else {
        if(property.match(webkit_zoom_pattern) != null) {
          var result = webkit_zoom_pattern.exec(property);
          if(result !== null && result[1]) {
            zoom = parseFloat(result[1]);
            return false
          }
        }else {
          if(property.match(opera_zoom_pattern) != null) {
            var result = opera_zoom_pattern.exec(property);
            if(result !== null && result[1]) {
              zoom = parseFloat(result[1]);
              return false
            }
          }else {
            if(property.match(ie_zoom_pattern) != null) {
              var result = ie_zoom_pattern.exec(property);
              if(result !== null && result[1]) {
                zoom = parseFloat(result[1]);
                return false
              }
            }
          }
        }
      }
    });
    return zoom
  };
  var getWidthFromStyle = function(style, area) {
    return getPixelDimensionsFromStyle(style, area)[0]
  };
  var getHeightFromStyle = function(style, area) {
    return getPixelDimensionsFromStyle(style, area)[1]
  };
  var getPixelDimensionsFromStyle = function(style, area) {
    var dimensions = [];
    var width = null;
    var height = null;
    $.each(style.split(";"), function(index, property) {
      var width_percent_pattern = /width:\s?([0-9]+(\.[0-9]+)?)%/g;
      var width_px_pattern = /width:\s?([0-9]+(\.?[0-9]+)?)px/g;
      var height_percent_pattern = /height:\s?([0-9]+(\.[0-9]+)?)%/g;
      var height_px_pattern = /height:\s?([0-9]+(\.?[0-9]+)?)px/g;
      if(property.indexOf("width") !== -1) {
        if(property.match(width_px_pattern)) {
          var result = width_px_pattern.exec(property);
          if(result[1]) {
            width = result[1]
          }
        }else {
          if(property.match(width_percent_pattern)) {
            var result = width_percent_pattern.exec(property);
            if(result[1]) {
              var percent = result[1];
              if(area) {
                width = $(area).width() * percent / 100
              }
            }
          }
        }
      }else {
        if(property.indexOf("height") !== -1) {
          if(property.match(height_px_pattern)) {
            var result = height_px_pattern.exec(property);
            if(result[1]) {
              height = result[1]
            }
          }else {
            if(property.match(height_percent_pattern)) {
              var result = height_percent_pattern.exec(property);
              if(result[1]) {
                var percent = result[1];
                if(area) {
                  height = $(area).height() * percent / 100
                }
              }
            }
          }
        }
      }
    });
    dimensions.push(width);
    dimensions.push(height);
    return dimensions
  };
  var getFontSizeFromStyle = function(style) {
    if(!style) {
      return
    }
    var ft = null;
    $.each(style.split(";"), function(index, property) {
      var font_style_pattern = /font-size:\s?([0-9]+)px/g;
      if(property.match(font_style_pattern) != null) {
        var result = font_style_pattern.exec(property);
        if(result !== null && result[1] !== null) {
          ft = parseFloat(result[1]);
          return false
        }
      }
    });
    return ft
  };
  var addFontSizeToStyle = function(style, fontSize) {
    if(typeof style !== "string") {
      return null
    }
    var filterStyle = "";
    $.each(style.split(";"), function(index, property) {
      if(property.indexOf("font-size") === -1 && property !== "") {
        filterStyle = filterStyle + property + "; "
      }
    });
    if(fontSize) {
      filterStyle = filterStyle + "font-size:" + fontSize + ";"
    }
    return filterStyle
  };
  var removeFontSizeInStyle = function(style) {
    if(typeof style !== "string") {
      return null
    }
    var filterStyle = "";
    $.each(style.split(";"), function(index, property) {
      if(property.indexOf("font-size") === -1 && property !== "") {
        filterStyle = filterStyle + property + "; "
      }
    });
    return filterStyle
  };
  return{init:init, getOptions:getOptions, getId:getId, getOuterHTML:getOuterHTML, getSrcFromCSS:getSrcFromCSS, loadDeviceCSS:loadDeviceCSS, loadCSS:loadCSS, checkMiniumRequirements:checkMiniumRequirements, addFontSizeToStyle:addFontSizeToStyle, removeFontSizeInStyle:removeFontSizeInStyle, getFontSizeFromStyle:getFontSizeFromStyle, getZoomFromStyle:getZoomFromStyle, getZoomInStyle:getZoomInStyle, getWidthFromStyle:getWidthFromStyle, getHeightFromStyle:getHeightFromStyle, getPixelDimensionsFromStyle:getPixelDimensionsFromStyle, 
  sendParentToURL:sendParentToURL, addParamToUrl:addParamToUrl, getParamsFromUrl:getParamsFromUrl, fixPresentation:fixPresentation}
}(VISH);
VISH.Editor = function(V, $, undefined) {
  var initialPresentation = false;
  var initOptions;
  var currentZone;
  var eventsLoaded = false;
  var confirmOnExit;
  var draftPresentation = null;
  var savedPresentation = null;
  var editorMode;
  var init = function(options, presentation) {
    V.Editing = true;
    V.Debugging.init(options);
    if(options) {
      initOptions = options;
      if(options.configuration && V.Configuration) {
        V.Configuration.init(options.configuration);
        V.Configuration.applyConfiguration()
      }
    }else {
      initOptions = {}
    }
    V.Utils.init();
    V.Status.init(function() {
      _initAferStatusLoaded(options, presentation)
    })
  };
  var _initAferStatusLoaded = function(options, presentation) {
    if(!V.Utils.checkMiniumRequirements()) {
      return
    }
    V.Utils.loadDeviceCSS();
    V.Editor.Dummies.init();
    V.EventsNotifier.init();
    V.Editor.Themes.init();
    V.Flashcard.init();
    V.VirtualTour.init();
    V.Editor.Slideset.init();
    V.Editor.Presentation.init();
    V.Editor.Flashcard.init();
    V.Editor.VirtualTour.init();
    V.Renderer.init();
    V.Slides.init();
    V.User.init(options);
    if(V.Debugging.isDevelopping()) {
      if(options.configuration.mode == V.Constant.NOSERVER && V.Debugging.getActionInit() == "loadSamples" && !presentation) {
        presentation = V.Debugging.getPresentationSamples()
      }
    }
    $("#slider-range").slider({range:true, min:0, max:30, values:[4, 20], slide:function(event, ui) {
      $("#age_range").val(ui.values[0] + " - " + ui.values[1])
    }});
    $("#age_range").val(V.Constant.AGE_RANGE);
    if(presentation) {
      presentation = V.Utils.fixPresentation(presentation);
      initialPresentation = true;
      setPresentation(presentation);
      V.Editor.Renderer.init(presentation);
      _removeSelectableProperties()
    }
    $("a#addSlideFancybox").fancybox({"autoDimensions":false, "scrolling":"no", "width":800, "height":600, "padding":0, "onStart":function(data) {
      var clickedZoneId = $(data).attr("zone");
      setCurrentArea($("#" + clickedZoneId));
      V.Editor.Utils.loadTab("tab_templates")
    }});
    $("a#addQuizFancybox").fancybox({"autoDimensions":false, "scrolling":"no", "width":385, "height":340, "padding":0, "onStart":function(data) {
      V.Editor.Utils.loadTab("tab_quizes")
    }});
    if(!eventsLoaded) {
      eventsLoaded = true;
      $(document).on("click", "#edit_presentation_details", V.Editor.Tools.Menu.onSettings);
      $(document).on("click", "#save", V.Editor.Tools.Menu.onSaveButtonClicked);
      $(document).on("click", "#pedagogical_clasification_button", V.Editor.Tools.Menu.onPedagogicalButtonClicked);
      $(document).on("click", "#save_presentation_details", V.Editor.Tools.Menu.onSavePresentationDetailsButtonClicked);
      $(document).on("click", "#done_in_pedagogical", V.Editor.Tools.Menu.onDonePedagogicalButtonClicked);
      $(document).on("click", ".templatethumb", _onTemplateThumbClicked);
      $(document).on("click", ".editable", _onEditableClicked);
      $(document).on("click", ".selectable", _onSelectableClicked);
      $(document).on("click", ':not(".selectable")', _onNoSelectableClicked);
      $(document).on("click", ".delete_content", _onDeleteItemClicked);
      $(document).on("click", ".delete_slide", _onDeleteSlideClicked);
      $(document).on("click", "#arrow_left_div", _onArrowLeftClicked);
      $(document).on("click", "#arrow_right_div", _onArrowRightClicked);
      $(document).on("click", "#fc_change_bg_big", V.Editor.Tools.changeFlashcardBackground);
      _addEditorEnterLeaveEvents();
      V.Editor.Slides.redrawSlides();
      V.Editor.Thumbnails.redrawThumbnails();
      _addTutorialEvents();
      window.onbeforeunload = exitConfirmation;
      confirmOnExit = true
    }
    if(presentation) {
      $(".object_wrapper").hide()
    }
    V.Editor.I18n.init(options.lang);
    V.Editor.Text.init();
    V.Editor.Image.init();
    V.Editor.Video.init();
    V.Editor.Object.init();
    V.Editor.Presentation.Repository.init();
    V.Editor.Slideset.Repository.init();
    V.Editor.Thumbnails.init();
    V.Editor.AvatarPicker.init();
    V.Editor.Quiz.init();
    V.Editor.Preview.init();
    V.Editor.Tools.init();
    V.Editor.Filter.init();
    V.Storage.init();
    V.Editor.Clipboard.init();
    V.Editor.Events.init();
    if(options.addons) {
      V.Addons.init(options.addons)
    }
    V.Editor.Utils.Loader.unloadAllObjects();
    V.Editor.Utils.Loader.loadObjectsInEditorSlide(V.Slides.getCurrentSlide());
    window.focus()
  };
  var getOptions = function() {
    return initOptions
  };
  var addDeleteButton = function(element) {
    element.append("<div class='delete_content'></div>")
  };
  var _addTutorialEvents = function() {
    $(document).on("click", "#start_tutorial", function() {
      V.Editor.Tour.startTourWithId("initial_screen_help", "top")
    });
    $(document).on("click", "#help_right", function() {
      V.Editor.Tour.startTourWithId("menubar_help", "top")
    });
    $(document).on("click", "#help_flashcard", function() {
      V.Editor.Tour.startTourWithId("fc_help", "top")
    });
    $(document).on("click", "#help_vtour", function() {
      V.Editor.Tour.startTourWithId("vt_help", "top")
    });
    $(document).on("click", ".help_in_template", function() {
      V.Editor.Tour.startTourWithId("template_help", "bottom")
    });
    $(document).on("click", "#tab_quizes_help", function() {
      V.Editor.Tour.startTourWithId("quiz_help", "bottom")
    });
    $(document).on("click", "#help_themes_selection", function() {
      V.Editor.Tour.startTourWithId("themes_help", "bottom")
    });
    $(document).on("click", "#help_template_selection", function() {
      V.Editor.Tour.startTourWithId("help_template_selection_help", "bottom")
    });
    $(document).on("click", "#tab_pic_from_url_help", function() {
      V.Editor.Tour.startTourWithId("images_fancy_tabs_id_help", "top")
    });
    $(document).on("click", "#tab_pic_upload_help", function() {
      V.Editor.Tour.startTourWithId("upload_picture_form_help", "top")
    });
    $(document).on("click", "#tab_pic_repo_help", function() {
      V.Editor.Tour.startTourWithId("search_picture_help", "bottom")
    });
    $(document).on("click", "#tab_pic_flikr_help", function() {
      V.Editor.Tour.startTourWithId("search_flickr_fancy_help", "bottom")
    });
    $(document).on("click", "#tab_object_from_url_help", function() {
      V.Editor.Tour.startTourWithId("object_fancy_tabs_id_help", "top")
    });
    $(document).on("click", "#tab_object_from_web_help", function() {
      V.Editor.Tour.startTourWithId("object_fancy_tabs_web_help", "top")
    });
    $(document).on("click", "#tab_object_upload_help", function() {
      V.Editor.Tour.startTourWithId("upload_object_form_help", "top")
    });
    $(document).on("click", "#tab_object_repo_help", function() {
      V.Editor.Tour.startTourWithId("search_object_help", "bottom")
    });
    $(document).on("click", "#tab_object_snapshot_help", function() {
      V.Editor.Tour.startTourWithId("object_fancy_tabs_websnapshot_help", "bottom")
    });
    $(document).on("click", "#tab_video_from_url_help", function() {
      V.Editor.Tour.startTourWithId("video_fancy_tabs_id_help", "top")
    });
    $(document).on("click", "#tab_video_repo_help", function() {
      V.Editor.Tour.startTourWithId("search_video_help", "top")
    });
    $(document).on("click", "#tab_video_youtube_help", function() {
      V.Editor.Tour.startTourWithId("search_youtube_fancy_help", "bottom")
    });
    $(document).on("click", "#tab_video_vimeo_help", function() {
      V.Editor.Tour.startTourWithId("search_vimeo_fancy_help", "bottom")
    });
    $(document).on("click", "#tab_live_webcam_help", function() {
      V.Editor.Tour.startTourWithId("tab_live_webcam_id", "bottom")
    })
  };
  var _addEditorEnterLeaveEvents = function() {
    $("article").live("slideenter", _onSlideEnterEditor);
    $("article").live("slideleave", _onSlideLeaveEditor)
  };
  var _onSlideEnterEditor = function(e) {
    setTimeout(function() {
      $(e.target).find(".object_wrapper").show()
    }, 500);
    if($(e.target).hasClass("flashcard_slide")) {
      V.Flashcard.startAnimation(e.target.id)
    }else {
      if($(e.target).hasClass("virtualTour_slide")) {
        V.VirtualTour.loadMap(e.target.id)
      }
    }
    if($(e.target).hasClass("subslide")) {
      setTimeout(function() {
        if($(e.target).hasClass("object")) {
          V.ObjectPlayer.loadObject($(e.target))
        }else {
          if($(e.target).hasClass("applet")) {
            V.AppletPlayer.loadApplet($(e.target))
          }else {
            if($(e.target).hasClass("snapshot")) {
              V.SnapshotPlayer.loadSnapshot($(e.target))
            }
          }
        }
      }, 500);
      V.VideoPlayer.HTML5.playVideos(e.target)
    }else {
      V.Editor.Utils.Loader.loadObjectsInEditorSlide(e.target)
    }
  };
  var _onSlideLeaveEditor = function(e) {
    $(".object_wrapper").hide();
    if($(e.target).hasClass("flashcard_slide")) {
      V.Flashcard.stopAnimation(e.target.id)
    }
    if($(e.target).hasClass("subslide")) {
      V.VideoPlayer.HTML5.stopVideos(e.target);
      V.ObjectPlayer.unloadObject(e.target);
      V.AppletPlayer.unloadApplet()
    }else {
      V.Editor.Utils.Loader.unloadObjectsInEditorSlide(e.target)
    }
  };
  var _onTemplateThumbClicked = function(event) {
    var theid = draftPresentation ? draftPresentation.id : "";
    var slide = V.Editor.Dummies.getDummy($(this).attr("template"), V.Slides.getSlidesQuantity() + 1);
    V.Editor.Slides.addSlide(slide);
    $.fancybox.close();
    V.Slides.setCurrentSlideNumber(V.Slides.getCurrentSlideNumber() + 1);
    V.Editor.Slides.redrawSlides();
    V.Editor.Thumbnails.redrawThumbnails();
    setTimeout(function() {
      V.Slides.lastSlide()
    }, 300)
  };
  var _onEditableClicked = function(event) {
    $(this).removeClass("editable");
    setCurrentArea($(this));
    var content = $("#menuselect").clone().attr("id", "current_menu");
    $(content).find("a").css("display", "none");
    $(content).find("a.all").css("display", "inline");
    switch($(this).attr("size")) {
      case V.Constant.EXTRA_SMALL:
        $(content).find("a.small").css("display", "inline");
        $(content).find("a > div").addClass("thumb_extra_small");
        break;
      case V.Constant.SMALL:
        $(content).find("a.small").css("display", "inline");
        $(content).find("a > div").addClass("thumb_small");
        break;
      case V.Constant.MEDIUM:
        $(content).find("a.medium").css("display", "inline");
        $(content).find("a > div").addClass("thumb_medium");
        break;
      case V.Constant.LARGE:
        $(content).find("a.large").css("display", "inline");
        $(content).find("a > div").addClass("thumb_large");
        break
    }
    $(this).html(content);
    $("a.addpicture").fancybox({"autoDimensions":false, "width":800, "scrolling":"no", "height":600, "padding":0, "onStart":function(data) {
      var clickedZoneId = $(data).attr("zone");
      setCurrentArea($("#" + clickedZoneId));
      V.Editor.Image.setAddContentMode(V.Constant.NONE);
      V.Editor.Utils.loadTab("tab_pic_from_url")
    }});
    $("a.addobject").fancybox({"autoDimensions":false, "width":800, "height":600, "scrolling":"no", "padding":0, "onStart":function(data) {
      var clickedZoneId = $(data).attr("zone");
      setCurrentArea($("#" + clickedZoneId));
      V.Editor.Utils.loadTab("tab_object_from_url")
    }});
    $("a.addvideo").fancybox({"autoDimensions":false, "width":800, "scrolling":"no", "height":600, "padding":0, "onStart":function(data) {
      var clickedZoneId = $(data).attr("zone");
      setCurrentArea($("#" + clickedZoneId));
      V.Editor.Utils.loadTab("tab_video_from_url")
    }});
    $("a.addLive").fancybox({"autoDimensions":false, "width":800, "scrolling":"no", "height":600, "padding":0, "onStart":function(data) {
      var clickedZoneId = $(data).attr("zone");
      setCurrentArea($("#" + clickedZoneId));
      V.Editor.Utils.loadTab("tab_live_webcam")
    }});
    $("a.addQuiz").click(function(event) {
      $("a#addQuizFancybox").trigger("click")
    })
  };
  var _onDeleteItemClicked = function() {
    setCurrentArea($(this).parent());
    $("#image_template_prompt").attr("src", V.ImagesPath + "zonethumbs/" + getCurrentArea().attr("type") + ".png");
    $.fancybox($("#prompt_form").html(), {"autoDimensions":false, "scrolling":"no", "width":350, "height":150, "showCloseButton":false, "padding":0, "onClosed":function() {
      if($("#prompt_answer").val() === "true") {
        $("#prompt_answer").val("false");
        getCurrentArea().html("");
        getCurrentArea().removeAttr("type");
        getCurrentArea().addClass("editable")
      }
    }})
  };
  var _onDeleteSlideClicked = function() {
    var article_to_delete = $(this).parent()[0];
    if(getMode() === V.Constant.FLASHCARD) {
      $(article_to_delete).hide();
      return
    }
    var thumb;
    switch(V.Slides.getSlideType(article_to_delete)) {
      case V.Constant.STANDARD:
        thumb = V.ImagesPath + "templatesthumbs/" + $(article_to_delete).attr("template") + ".png";
        break;
      case V.Constant.FLASHCARD:
        thumb = V.Utils.getSrcFromCSS($(article_to_delete).attr("avatar"));
        break;
      case V.Constant.VTOUR:
        break;
      default:
        thumb = V.ImagesPath + "templatesthumbs/" + "default.png";
        break
    }
    $("#image_template_prompt").attr("src", thumb);
    $.fancybox($("#prompt_form").html(), {"autoDimensions":false, "width":350, "scrolling":"no", "height":150, "showCloseButton":false, "padding":0, "onClosed":function() {
      if($("#prompt_answer").val() === "true") {
        $("#prompt_answer").val("false");
        V.Editor.Slides.removeSlide(V.Slides.getCurrentSlideNumber())
      }
    }})
  };
  var _onSelectableClicked = function(event) {
    selectArea($(this));
    event.stopPropagation();
    event.preventDefault()
  };
  var selectArea = function(area) {
    setCurrentArea(area);
    _removeSelectableProperties(area);
    _addSelectableProperties(area);
    V.Editor.Tools.loadToolsForZone(area)
  };
  var _onNoSelectableClicked = function(event) {
    if(!$(event.target).hasClass("noSelectableElement")) {
      if($("#fancybox-content").is(":visible")) {
        return
      }
      if($(event.target).parent().hasClass("selectable")) {
        return
      }
      if(jQuery.contains($("#toolbar_wrapper")[0], event.target)) {
        return
      }
      if(event.target.id === "toolbar_wrapper") {
        return
      }
      var isWysiwygFancyboxEnabled = false;
      $(".cke_dialog").each(function(index, cke_dialog) {
        if(cke_dialog && jQuery.contains(cke_dialog, event.target)) {
          isWysiwygFancyboxEnabled = true;
          return false
        }
      });
      if(isWysiwygFancyboxEnabled) {
        return
      }
    }
    setCurrentArea(null);
    V.Editor.Tools.cleanZoneTools()
  };
  var _addSelectableProperties = function(zone) {
    $(zone).css("cursor", "auto");
    $(zone).css("border-color", "rgb(255, 2, 94)");
    $(zone).css("-webkit-box-shadow", "inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(255, 100, 100, 0.6)");
    $(zone).css("-moz-box-shadow", "inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(255, 100, 100, 0.6)");
    $(zone).css("box-shadow", "inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(255, 100, 100, 0.6)");
    $(zone).css("outline", "0")
  };
  var _removeSelectableProperties = function(zone) {
    $(".selectable").css("border-color", "none");
    $(".selectable").css("-webkit-box-shadow", "none");
    $(".selectable").css("-moz-box-shadow", "none");
    $(".selectable").css("box-shadow", "none");
    $(".selectable").css("outline", "0");
    $(".selectable").css("cursor", "pointer")
  };
  var savePresentation = function(options) {
    V.Editor.Utils.Loader.loadAllObjects();
    $(".object_wrapper, .snapshot_wrapper").show();
    var presentation = {};
    presentation.VEVersion = V.VERSION;
    if(draftPresentation) {
      presentation.id = draftPresentation.id
    }else {
      presentation.id = ""
    }
    var saveForPreview = false;
    if(options && options.preview === true) {
      saveForPreview = true
    }
    if(saveForPreview && options && options.forcePresentation) {
      presentation.type = V.Constant.PRESENTATION
    }else {
      presentation.type = getPresentationType()
    }
    if(draftPresentation) {
      presentation.title = draftPresentation.title;
      presentation.description = draftPresentation.description;
      presentation.avatar = draftPresentation.avatar;
      presentation.tags = draftPresentation.tags;
      presentation.theme = draftPresentation.theme;
      presentation.age_range = draftPresentation.age_range;
      presentation.subject = draftPresentation.subject;
      presentation.language = draftPresentation.language;
      presentation.educational_objectives = draftPresentation.educational_objectives;
      presentation.adquired_competencies = draftPresentation.adquired_competencies
    }
    presentation.author = "";
    presentation.slides = [];
    var slide = {};
    var slidesetModule = V.Editor.Slideset.getCreatorModule(presentation.type);
    var isSlideset = slidesetModule !== null;
    if(isSlideset) {
      slide = slidesetModule.getSlideHeader();
      presentation.slides.push(slide)
    }
    slide = {};
    $(".slides > article").each(function(index, s) {
      slide.id = $(s).attr("id");
      slide.type = $(s).attr("type");
      if(slide.type === V.Constant.FLASHCARD) {
        var fc = V.Editor.Flashcard.getFlashcard(slide.id);
        presentation.slides.push(fc);
        slide = {};
        return true
      }else {
        if(slide.type === V.Constant.VTOUR) {
          var vt = V.Editor.VirtualTour.getVirtualTour(slide.id);
          presentation.slides.push(vt);
          return true
        }
      }
      slide.template = $(s).attr("template");
      slide.elements = [];
      var element = {};
      $(s).addClass("temp_shown");
      $(s).find("div").each(function(i, div) {
        if($(div).attr("areaid") !== undefined) {
          element.id = $(div).attr("id");
          element.type = $(div).attr("type");
          element.areaid = $(div).attr("areaid");
          if(element.type == V.Constant.TEXT) {
            var CKEditor = V.Editor.Text.getCKEditorFromZone(div);
            if(CKEditor !== null) {
              element.body = CKEditor.getData()
            }else {
              element.body = ""
            }
          }else {
            if(element.type == V.Constant.IMAGE) {
              element.body = $(div).find("img").attr("src");
              element.style = V.Editor.Utils.getStylesInPercentages($(div), $(div).find("img"));
              if($(div).attr("hyperlink")) {
                element.hyperlink = $(div).attr("hyperlink")
              }
            }else {
              if(element.type == V.Constant.VIDEO) {
                var video = $(div).find("video");
                element.poster = $(video).attr("poster");
                element.style = V.Editor.Utils.getStylesInPercentages($(div), $(video));
                var sources = "";
                $(video).find("source").each(function(index, source) {
                  if(index !== 0) {
                    sources = sources + ","
                  }
                  var type = typeof $(source).attr("type") != "undefined" ? ' "type": "' + $(source).attr("type") + '", ' : "";
                  sources = sources + "{" + type + '"src": "' + $(source).attr("src") + '"}'
                });
                sources = "[" + sources + "]";
                element.sources = sources
              }else {
                if(element.type === V.Constant.OBJECT) {
                  var wrapper = $(div).find(".object_wrapper")[0];
                  var object = $(wrapper).children()[0];
                  var myObject = $(object).clone();
                  $(myObject).removeAttr("style");
                  element.body = V.Utils.getOuterHTML(myObject);
                  element.style = V.Editor.Utils.getStylesInPercentages($(div), $(object).parent());
                  var zoom = V.Utils.getZoomFromStyle($(object).attr("style"));
                  if(zoom != 1) {
                    element.zoomInStyle = V.Utils.getZoomInStyle(zoom)
                  }
                }else {
                  if(element.type === V.Constant.QUIZ) {
                    var quizJSON = VISH.Editor.Quiz.save(div);
                    element.quiztype = quizJSON.quizType;
                    element.selfA = quizJSON.selfA;
                    element.question = quizJSON.question;
                    element.choices = quizJSON.choices;
                    if(quizJSON.extras) {
                      element.extras = quizJSON.extras
                    }
                    slide.containsQuiz = true
                  }else {
                    if(element.type === V.Constant.SNAPSHOT) {
                      var snapshotWrapper = $(div).find(".snapshot_wrapper");
                      var snapshotIframe = $(snapshotWrapper).children()[0];
                      $(snapshotIframe).removeAttr("style");
                      element.body = V.Utils.getOuterHTML(snapshotIframe);
                      element.style = V.Editor.Utils.getStylesInPercentages($(div), snapshotWrapper);
                      var scrollTopAttr = $(snapshotWrapper).attr("scrollTop");
                      if(typeof scrollTopAttr !== "undefined") {
                        element.scrollTop = scrollTopAttr;
                        element.scrollLeft = $(snapshotWrapper).attr("scrollLeft")
                      }else {
                        element.scrollTop = $(snapshotWrapper).scrollTop();
                        element.scrollLeft = $(snapshotWrapper).scrollLeft()
                      }
                    }else {
                      if(typeof element.type == "undefined") {
                      }
                    }
                  }
                }
              }
            }
          }
          slide.elements.push(element);
          element = {}
        }
      });
      if(slide.containsQuiz) {
        var quizSlide = $.extend(true, {}, slide);
        quizSlide.type = V.Constant.QUIZ_SIMPLE;
        var quizPresentation = {};
        quizPresentation.title = presentation.title;
        quizPresentation.description = presentation.description;
        quizPresentation.author = presentation.author;
        quizPresentation.type = V.Constant.QUIZ_SIMPLE;
        quizPresentation.slides = [quizSlide];
        for(var k = 0;k < slide.elements.length;k++) {
          if(slide.elements[k].type === V.Constant.QUIZ) {
            slide.elements[k].quiz_simple_json = quizPresentation
          }
        }
      }
      if(isSlideset) {
        slide = V.Editor.Slideset.prepareToNest(slide);
        presentation.slides[0].slides.push(slide)
      }else {
        presentation.slides.push(slide)
      }
      slide = {};
      $(s).removeClass("temp_shown")
    });
    savedPresentation = presentation;
    V.Editor.Utils.Loader.unloadAllObjects();
    V.Editor.Utils.Loader.loadObjectsInEditorSlide(V.Slides.getCurrentSlide());
    V.Debugging.log("\n\nVish Editor save the following presentation:\n");
    return savedPresentation
  };
  var afterSavePresentation = function(presentation, order) {
    switch(V.Configuration.getConfiguration().mode) {
      case V.Constant.NOSERVER:
        if(V.Debugging && V.Debugging.isDevelopping()) {
          if(V.Debugging.getActionSave() == "view") {
            V.Debugging.initVishViewer()
          }else {
            if(V.Debugging.getActionSave() == "edit") {
              V.Debugging.initVishEditor()
            }
          }
        }
        break;
      case V.Constant.VISH:
        var send_type;
        if(initialPresentation) {
          send_type = "PUT"
        }else {
          send_type = "POST"
        }
        var draft = order === "draft";
        var jsonPresentation = JSON.stringify(presentation);
        var params = {"excursion[json]":jsonPresentation, "authenticity_token":initOptions.token, "draft":draft};
        $.ajax({type:send_type, url:V.UploadPresentationPath, data:params, success:function(data) {
          allowExitWithoutConfirmation();
          window.top.location.href = data.url
        }});
        break;
      case V.Constant.STANDALONE:
        uploadPresentationWithNode(presentation);
        break
    }
  };
  var uploadPresentationWithNode = function(presentation) {
    var send_type;
    var url = V.UploadPresentationPath;
    if(draftPresentation) {
      send_type = "PUT";
      url = url + draftPresentation.id
    }else {
      send_type = "POST"
    }
    var jsonPresentation = JSON.stringify(presentation);
    var params = {"presentation[json]":jsonPresentation};
    $.ajax({type:send_type, url:url, data:params, success:function(data) {
      allowExitWithoutConfirmation();
      window.top.location.href = data.url
    }})
  };
  var _onArrowLeftClicked = function() {
    V.Slides.backwardOneSlide()
  };
  var _onArrowRightClicked = function() {
    V.Slides.forwardOneSlide()
  };
  var getTemplate = function(area) {
    if(area) {
      return area.parent().attr("template")
    }else {
      if(getCurrentArea()) {
        return getCurrentArea().parent().attr("template")
      }
    }
    return null
  };
  var getCurrentArea = function() {
    if(currentZone) {
      return currentZone
    }
    return null
  };
  var setCurrentArea = function(area) {
    currentZone = area
  };
  var getPresentation = function() {
    return draftPresentation
  };
  var setPresentation = function(presentation) {
    draftPresentation = presentation
  };
  var setMode = function(mode) {
    editorMode = mode
  };
  var getMode = function() {
    return editorMode
  };
  var getSavedPresentation = function() {
    if(savedPresentation) {
      return savedPresentation
    }else {
      return null
    }
  };
  var hasInitialPresentation = function() {
    return initialPresentation
  };
  var loadFancyBox = function(fancy) {
    var fancyBoxes = {1:"templates", 2:"flashcards"};
    for(var tab in fancyBoxes) {
      $("#tab_" + fancyBoxes[tab] + "_content").hide();
      $("#tab_" + fancyBoxes[tab]).attr("class", "");
      $("#tab_" + fancyBoxes[tab]).attr("class", "fancy_tab")
    }
    $("#tab_" + fancy + "_content").show();
    $("#tab_" + fancy).attr("class", "fancy_tab fancy_selected")
  };
  var getPresentationType = function() {
    if(!draftPresentation || !draftPresentation.type) {
      return"presentation"
    }
    return draftPresentation.type
  };
  var setPresentationType = function(type) {
    if(!draftPresentation) {
      draftPresentation = {}
    }
    if(type) {
      draftPresentation.type = type
    }else {
      draftPresentation.type = V.Constant.PRESENTATION
    }
  };
  var isPresentationStandard = function(presentation) {
    if(presentation) {
      return _isThisPresentationStandard(presentation)
    }else {
      if($("article[template]").length === 0) {
        return true
      }
      if(V.Editor.Flashcard.hasFlascards()) {
        return false
      }
      return true
    }
    return true
  };
  var _isThisPresentationStandard = function(presentation) {
    if(presentation.type !== "presentation") {
      return false
    }
    var isStandard = true;
    $.each(presentation.slides, function(index, slide) {
      if(slide.type && slide.type !== "standard") {
        isStandard = false;
        return false
      }
    });
    return isStandard
  };
  var isPresentationDraft = function() {
    if(initialPresentation) {
      if(initOptions.draft && typeof initOptions.draft === "boolean") {
        return initOptions.draft
      }else {
        return false
      }
    }else {
      return true
    }
  };
  var exitConfirmation = function() {
    if(V.Configuration.getConfiguration().mode === V.Constant.VISH && confirmOnExit) {
      return V.Editor.I18n.getTrans("i.exitConfirmation")
    }else {
      return
    }
  };
  var allowExitWithoutConfirmation = function() {
    confirmOnExit = false
  };
  return{init:init, addDeleteButton:addDeleteButton, getTemplate:getTemplate, getCurrentArea:getCurrentArea, getPresentationType:getPresentationType, getOptions:getOptions, loadFancyBox:loadFancyBox, getPresentation:getPresentation, setPresentation:setPresentation, isPresentationStandard:isPresentationStandard, isPresentationDraft:isPresentationDraft, getSavedPresentation:getSavedPresentation, hasInitialPresentation:hasInitialPresentation, savePresentation:savePresentation, afterSavePresentation:afterSavePresentation, 
  setPresentationType:setPresentationType, allowExitWithoutConfirmation:allowExitWithoutConfirmation, setCurrentArea:setCurrentArea, selectArea:selectArea, setMode:setMode, getMode:getMode}
}(VISH, jQuery);
VISH.Editor.Utils = function(V, $, undefined) {
  var dimentionToDraw = function(w_zone, h_zone, w_content, h_content) {
    var dimentions_for_drawing = {width:w_content, height:h_content};
    var aspect_ratio_zone = w_zone / h_zone;
    var aspect_ratio_content = w_content / h_content;
    if(aspect_ratio_zone > aspect_ratio_content) {
      dimentions_for_drawing.width = aspect_ratio_content * h_zone;
      dimentions_for_drawing.height = h_zone;
      return dimentions_for_drawing
    }else {
      dimentions_for_drawing.width = w_zone;
      dimentions_for_drawing.height = w_zone / aspect_ratio_content;
      return dimentions_for_drawing
    }
  };
  var setStyleInPixels = function(style, area) {
    var filterStyle = "";
    $.each(style.split(";"), function(index, property) {
      if(property.indexOf("width") === -1 && property.indexOf("height") === -1) {
        filterStyle = filterStyle + property + "; "
      }
    });
    var dimensions = V.Utils.getPixelDimensionsFromStyle(style, area);
    if(dimensions && dimensions[0]) {
      filterStyle = filterStyle + "width: " + dimensions[0] + "px; ";
      if(dimensions[1]) {
        filterStyle = filterStyle + "height: " + dimensions[1] + "px; "
      }
    }
    return filterStyle
  };
  var addZoomToStyle = function(style, zoom) {
    if(!style) {
      return null
    }
    var filterStyle = "";
    $.each(style.split(";"), function(index, property) {
      if(property.indexOf("-ms-transform") === -1 && property.indexOf("-moz-transform") === -1 && property.indexOf("-o-transform") === -1 && property.indexOf("-webkit-transform") === -1 && property.indexOf("-moz-transform-origin") === -1 && property.indexOf("-webkit-transform-origin") === -1 && property.indexOf("-o-transform-origin") === -1 && property.indexOf("-ms-transform-origin") === -1) {
        filterStyle = filterStyle + property + "; "
      }
    });
    if(zoom) {
      filterStyle = filterStyle + "-ms-transform: scale(" + zoom + "); ";
      filterStyle = filterStyle + "-ms-transform-origin: 0 0; ";
      filterStyle = filterStyle + "-moz-transform: scale(" + zoom + "); ";
      filterStyle = filterStyle + "-moz-transform-origin: 0 0; ";
      filterStyle = filterStyle + "-o-transform: scale(" + zoom + "); ";
      filterStyle = filterStyle + "-o-transform-origin: 0 0; ";
      filterStyle = filterStyle + "-webkit-transform: scale(" + zoom + "); ";
      filterStyle = filterStyle + "-webkit-transform-origin: 0 0; "
    }
    return filterStyle
  };
  var getStylesInPercentages = function(parent, element) {
    var WidthPercent = element.width() * 100 / parent.width();
    var HeightPercent = element.height() * 100 / parent.height();
    var TopPercent = element.position().top * 100 / parent.height();
    var LeftPercent = element.position().left * 100 / parent.width();
    return"position: relative; width:" + WidthPercent + "%; height:" + HeightPercent + "%; top:" + TopPercent + "%; left:" + LeftPercent + "%;"
  };
  var refreshDraggables = function(slide) {
    $(slide).find("[draggable='true']").draggable({cursor:"move", stop:function() {
      $(this).parent().click()
    }})
  };
  var generateTable = function(author, title, description, tableClass) {
    if(!author) {
      author = ""
    }
    if(!title) {
      title = ""
    }
    if(!description) {
      description = ""
    }
    if(!tableClass) {
      tableClass = "metadata"
    }
    return'<table class="' + tableClass + '">' + '<tr class="even">' + '<td class="title header_left">' + V.Editor.I18n.getTrans("i.Title") + "</td>" + '<td class="title header_right"><div class="height_wrapper">' + title + "</div></td>" + "</tr>" + '<tr class="odd">' + '<td class="title">' + V.Editor.I18n.getTrans("i.Author") + "</td>" + '<td class="info"><div class="height_wrapper">' + author + "</div></td>" + "</tr>" + '<tr class="even">' + '<td colspan="2" class="title_description">' + V.Editor.I18n.getTrans("i.Description") + 
    "</td>" + "</tr>" + '<tr class="odd">' + '<td colspan="2" class="info_description"><div class="height_wrapper_description">' + description + "</div></td>" + "</tr>" + "</table>"
  };
  var convertToTagsArray = function(tags) {
    var tagsArray = [];
    if(!tags || tags.length == 0) {
      return tagsArray
    }
    $.each(tags, function(index, tag) {
      tagsArray.push(tag.value)
    });
    return tagsArray
  };
  var autocompleteUrls = function(input) {
    var http_urls_pattern = /(^http(s)?:\/\/)/g;
    var objectInfo = V.Object.getObjectInfo();
    if(objectInfo.wrapper == null && input.match(http_urls_pattern) == null) {
      return"http://" + input
    }else {
      return input
    }
  };
  var filterFilePath = function(path) {
    return path.replace("C:\\fakepath\\", "")
  };
  var prepareSlideToNest = function(parentId, slide) {
    if(typeof parentId !== "string") {
      return slide
    }
    if(slide.type === V.Constant.FLASHCARD || slide.type === V.Constant.VTOUR) {
      return
    }
    slide.id = parentId + "_" + slide.id;
    if(slide.elements) {
      $.each(slide.elements, function(index, element) {
        slide.elements[index].id = parentId + "_" + slide.elements[index].id
      })
    }
    return slide
  };
  var undoNestedSlide = function(parentId, slide) {
    if(typeof parentId !== "string") {
      return slide
    }
    if(slide.type === V.Constant.FLASHCARD || slide.type === V.Constant.VTOUR) {
      return
    }
    slide.id = slide.id.replace(parentId + "_", "");
    if(slide.elements) {
      $.each(slide.elements, function(index, element) {
        slide.elements[index].id = slide.elements[index].id.replace(parentId + "_", "")
      })
    }
    return slide
  };
  var replaceIdsForSlide = function(slide) {
    var slideId = V.Utils.getId("article");
    $(slide).attr("id", slideId);
    var slideType = V.Slides.getSlideType(slide);
    switch(slideType) {
      case V.Constant.STANDARD:
        slide = _replaceIdsForStandardSlide(slide, slideId);
        break;
      case V.Constant.FLASHCARD:
        slide = _replaceIdsForFlashcardSlide(slide, slideId);
        break;
      case V.Constant.VTOUR:
        slide = _replaceIdsForVirtualTourSlide(slide, slideId);
        break;
      default:
        return
    }
    return slide
  };
  var _replaceIdsForStandardSlide = function(slide, slideId) {
    $(slide).children("div[id][areaid]").each(function(index, zone) {
      zone = _replaceIdsForZone(zone, slideId)
    });
    return slide
  };
  var _replaceIdsForFlashcardSlide = function(flashcard, flashcardId) {
    var pois = $(flashcard).find("div.fc_poi");
    $(pois).each(function(index, poi) {
      var poiId = V.Utils.getId(flashcardId + "_poi");
      $(poi).attr("id", poiId)
    });
    var subslides = $(flashcard).find(".subslides > article.subslide");
    $(subslides).each(function(index, subSlide) {
      subSlide = _replaceIdsForSubSlide(subSlide, flashcardId)
    });
    return flashcard
  };
  var _replaceIdsForVirtualTourSlide = function(vt, vtId) {
    var canvas = $(vt).find(".map_canvas");
    var canvasId = V.Utils.getId(vtId + "_canvas");
    $(canvas).attr("id", canvasId);
    var subslides = $(vt).find(".subslides > article.subslide");
    $(subslides).each(function(index, subSlide) {
      subSlide = _replaceIdsForSubSlide(subSlide, vtId)
    });
    return vt
  };
  var _replaceIdsForSubSlide = function(subSlide, parentId) {
    var slideId = V.Utils.getId(parentId + "_article");
    $(subSlide).attr("id", slideId);
    $(subSlide).children(".close_subslide").attr("id", "close" + slideId);
    var zones = $(subSlide).children("div[id]").not(".close_subslide");
    $(zones).each(function(index, zone) {
      zone = _replaceIdsForZone(zone, slideId)
    })
  };
  var _replaceIdsForZone = function(zone, slideId) {
    var zoneId = V.Utils.getId(slideId + "_zone");
    $(zone).attr("id", zoneId);
    $(zone).find("[id]").each(function(index, el) {
      el = _replaceIdsForEl(el, zoneId)
    });
    return zone
  };
  var _replaceIdsForEl = function(el, zoneId) {
    var elName = _getNameOfEl(el);
    var elId = V.Utils.getId(zoneId + "_" + elName);
    $(el).attr("id", elId);
    return el
  };
  var _getNameOfEl = function(el) {
    var elName = $($(el).attr("id").split("_")).last()[0];
    if(elName.length > 1) {
      return elName.substring(0, elName.length - 1)
    }else {
      return elName
    }
  };
  var replaceIdsForSlideJSON = function(slide, forceId) {
    var slideType = slide.type;
    var slideId;
    if(forceId) {
      slideId = forceId
    }else {
      slideId = V.Utils.getId("article")
    }
    switch(slideType) {
      case V.Constant.STANDARD:
        slide = _replaceIdsForStandardSlideJSON(slide, slideId);
        break;
      case V.Constant.FLASHCARD:
        slide = _replaceIdsForFlashcardJSON(slide, slideId);
        break;
      case V.Constant.VTOUR:
        slide = _replaceIdsForVTourJSON(slide, slideId);
        break;
      default:
        return
    }
    return slide
  };
  var _replaceIdsForStandardSlideJSON = function(slide, slideId) {
    var s = jQuery.extend(true, {}, slide);
    var oldId = s.id;
    s.id = slideId;
    var eL = s.elements.length;
    for(var i = 0;i < eL;i++) {
      var el = s.elements[i];
      if(el.id.match(new RegExp("^" + oldId, "g")) != null) {
        el.id = el.id.replace(oldId, s.id)
      }else {
        return null
      }
    }
    return s
  };
  var _replaceIdsForFlashcardJSON = function(flashcard, fcId) {
    var hash_subslide_new_ids = {};
    var old_id;
    var fc = jQuery.extend(true, {}, flashcard);
    fc.id = fcId;
    for(var ind in fc.slides) {
      old_id = fc.slides[ind].id;
      fc.slides[ind] = _replaceIdsForStandardSlideJSON(fc.slides[ind], fc.id + "_article" + (parseInt(ind) + 1));
      if(fc.slides[ind] === null) {
        return null
      }
      hash_subslide_new_ids[old_id] = fc.slides[ind].id
    }
    for(var num in fc.pois) {
      fc.pois[num].id = fc.id + "_poi" + (parseInt(num) + 1);
      fc.pois[num].slide_id = hash_subslide_new_ids[fc.pois[num].slide_id]
    }
    return fc
  };
  var _replaceIdsForVTourJSON = function(vTour, vTourId) {
    var hash_subslide_new_ids = {};
    var old_id;
    var vt = jQuery.extend(true, {}, vTour);
    vt.id = vTourId;
    for(var ind in vt.slides) {
      old_id = vt.slides[ind].id;
      vt.slides[ind] = _replaceIdsForStandardSlideJSON(vt.slides[ind], vt.id + "_article" + (parseInt(ind) + 1));
      hash_subslide_new_ids[old_id] = vt.slides[ind].id
    }
    for(var num in vt.pois) {
      vt.pois[num].id = vt.id + "_poi" + (parseInt(num) + 1);
      vt.pois[num].slide_id = hash_subslide_new_ids[vt.pois[num].slide_id]
    }
    return vt
  };
  var loadTab = function(tab_id) {
    $(".joyride-close-tip").click();
    $(".fancy_tab_content").hide();
    $("#" + tab_id + "_content").show();
    $(".fancy_tab").removeClass("fancy_selected");
    $("#" + tab_id).addClass("fancy_selected");
    $(".help_in_fancybox").hide();
    $("#" + tab_id + "_help").show();
    switch(tab_id) {
      case "tab_templates":
        break;
      case "tab_presentations_repo":
        V.Editor.Presentation.Repository.onLoadTab();
        break;
      case "tab_smartcards_repo":
        V.Editor.Slideset.Repository.onLoadTab();
        break;
      case "tab_pic_from_url":
        V.Editor.Image.onLoadTab("url");
        break;
      case "tab_pic_upload":
        V.Editor.Image.onLoadTab("upload");
        break;
      case "tab_pic_repo":
        V.Editor.Image.Repository.onLoadTab();
        break;
      case "tab_pic_flikr":
        V.Editor.Image.Flikr.onLoadTab();
        break;
      case "tab_video_from_url":
        V.Editor.Video.onLoadTab();
        break;
      case "tab_video_repo":
        V.Editor.Video.Repository.onLoadTab();
        break;
      case "tab_video_youtube":
        V.Editor.Video.Youtube.onLoadTab();
        break;
      case "tab_video_vimeo":
        V.Editor.Video.Vimeo.onLoadTab();
        break;
      case "tab_object_from_url":
        V.Editor.Object.onLoadTab("url");
        break;
      case "tab_object_from_web":
        V.Editor.Object.Web.onLoadTab();
        break;
      case "tab_object_snapshot":
        V.Editor.Object.Snapshot.onLoadTab();
        break;
      case "tab_object_upload":
        V.Editor.Object.onLoadTab("upload");
        break;
      case "tab_object_repo":
        V.Editor.Object.Repository.onLoadTab();
        break;
      case "tab_live_webcam":
        V.Editor.Object.Live.onLoadTab("webcam");
        break;
      case "tab_live_micro":
        V.Editor.Object.Live.onLoadTab("micro");
        break;
      default:
        break
    }
  };
  return{setStyleInPixels:setStyleInPixels, addZoomToStyle:addZoomToStyle, getStylesInPercentages:getStylesInPercentages, dimentionToDraw:dimentionToDraw, refreshDraggables:refreshDraggables, replaceIdsForSlide:replaceIdsForSlide, replaceIdsForSlideJSON:replaceIdsForSlideJSON, prepareSlideToNest:prepareSlideToNest, undoNestedSlide:undoNestedSlide, generateTable:generateTable, convertToTagsArray:convertToTagsArray, autocompleteUrls:autocompleteUrls, filterFilePath:filterFilePath, loadTab:loadTab}
}(VISH, jQuery);
VISH.Editor.Text = function(V, $, undefined) {
  var initialized = false;
  var init = function() {
    if(!initialized) {
      $(document).on("click", ".textthumb", launchTextEditor);
      CKEDITOR.on("dialogDefinition", function(ev) {
        var dialogName = ev.data.name;
        var dialogDefinition = ev.data.definition;
        if(dialogName == "link") {
          dialogDefinition.getContents("info").remove("linkType");
          var protocols = dialogDefinition.getContents("info").get("protocol").items;
          protocols.splice(3, 1);
          protocols.splice(2, 1);
          dialogDefinition.removeContents("advanced");
          var targetTab = dialogDefinition.getContents("target");
          var targetField = targetTab.get("linkTargetType");
          targetField["default"] = "_blank";
          targetField.items.splice(6, 1);
          targetField.items.splice(4, 1);
          targetField.items.splice(1, 1);
          targetField.items.splice(0, 1)
        }
        if(dialogName == "table") {
          dialogDefinition.removeContents("advanced");
          var info = dialogDefinition.getContents("info");
          var alignment = info.get("cmbAlign");
          alignment.items.splice(0, 1);
          alignment["default"] = "center";
          info.remove("selHeaders")
        }
      });
      initialized = true
    }
  };
  var launchTextEditor = function(event, area, initial_text, options) {
    init();
    var current_area;
    if(area) {
      current_area = area
    }else {
      current_area = $(this).parents(".selectable")
    }
    var isQuiz = $("div[type='quiz']").has(current_area).length > 0;
    var isTemplateArea = $(current_area).attr("areaid") !== undefined;
    if(isTemplateArea) {
      current_area.attr("type", "text")
    }
    var wysiwygContainerId = V.Utils.getId();
    var wysiwygContainer = $("<div id='" + wysiwygContainerId + "' class='wysiwygTextArea'></div>");
    $(wysiwygContainer).attr("style", "width: 100%; height: 100%");
    $(current_area).append(wysiwygContainer);
    var config = {};
    config.toolbar = "Basic";
    config.toolbar_Basic = [["Bold", "Italic", "Underline", "-", "Subscript", "Superscript"], ["NumberedList", "BulletedList", "Table"], ["JustifyLeft", "JustifyCenter", "JustifyRight", "JustifyBlock"], ["Link"], ["Font", "FontSize"], ["TextColor", "BGColor"]];
    config.sharedSpaces = {top:"toolbar_text"};
    config.toolbarCanCollapse = false;
    config.resize_enabled = false;
    config.removePlugins = "elementspath";
    config.extraPlugins = "tableresize,autogrow";
    if(options && options.autogrow) {
      config.autoGrow_minHeight = 34;
      config.autoGrow_maxHeight = 800
    }
    config.width = "100%";
    config.height = $(current_area).height();
    config.fontSize_defaultLabel = "12px";
    var ckeditorBasePath = CKEDITOR.basePath.substr(0, CKEDITOR.basePath.indexOf("editor/"));
    config.skin = "vEditor," + ckeditorBasePath + "editor/skins/vEditor/";
    var ckeditor = CKEDITOR.appendTo(wysiwygContainerId, config);
    var myWidth = $(current_area).width();
    var myHeight = $(current_area).height();
    var newInstance = !(typeof initial_text === "string") || options && options.forceNew;
    if(newInstance) {
      var defaultFontSize = 12;
      var defaultAlignment = "left";
      switch($(current_area).attr("size")) {
        case V.Constant.EXTRA_SMALL:
          defaultFontSize = 18;
          break;
        case V.Constant.SMALL:
          defaultFontSize = 18;
          break;
        case V.Constant.MEDIUM:
          defaultFontSize = 26;
          break;
        case V.Constant.LARGE:
          defaultFontSize = 36;
          break;
        default:
          break
      }
      var areaId = $(current_area).attr("areaid");
      if(areaId) {
        var isCircleArea = $(current_area).attr("areaid").indexOf("circle") !== -1;
        if(isCircleArea) {
          defaultAlignment = "center"
        }
      }
      var initialTextColor = "color:#" + V.Editor.Themes.getCurrentTheme().color;
      var blankTextColor = initialTextColor;
      if(options) {
        if(typeof options.fontSize == "number") {
          defaultFontSize = options.fontSize
        }
        if(options.placeholder === true) {
          initialTextColor = "color:#ccc"
        }
      }
      if(isTemplateArea || typeof initial_text != "string" || initial_text === "") {
        initial_text = "&shy"
      }
      initial_text = "<p style='text-align:" + defaultAlignment + ";'><span autoColor='true' style='" + initialTextColor + "'><span style='font-size:" + defaultFontSize + "px;'>" + initial_text + "</span></span></p>";
      initial_text_blank = "<p style='text-align:" + defaultAlignment + ";'><span autoColor='true' style='" + blankTextColor + "'><span style='font-size:" + defaultFontSize + "px;'>" + "&shy" + "</span></span></p>"
    }
    ckeditor.on("instanceReady", function() {
      if(initial_text) {
        ckeditor.setData(initial_text, function() {
          ckeditor.resize(myWidth, myHeight);
          _fixCKEDITORBug(ckeditor)
        });
        if(newInstance) {
          if(isTemplateArea || options && options.focus) {
            ckeditor.focus()
          }
        }
      }
    });
    ckeditor.on("focus", function(event) {
      if(options && options.placeholder === true) {
        var a = $(initial_text).text().replace(/\s+/g, "");
        var b = $(event.editor.getData()).text().replace(/\s+/g, "");
        if(a == b) {
          setTimeout(function() {
            event.editor.setData(initial_text_blank);
            event.editor.focus()
          }, 20)
        }
      }
      var area = getZoneForCKContainer(event.editor.container.$);
      V.Editor.selectArea(area)
    });
    ckeditor.on("blur", function(event) {
    });
    ckeditor.getPlainText = _getPlainText;
    if(isTemplateArea) {
      V.Editor.addDeleteButton(current_area)
    }
  };
  var getCKEditorFromZone = function(zone) {
    if(!zone || typeof CKEDITOR === "undefined" || typeof CKEDITOR.instances === "undefined") {
      return null
    }
    var CKEditorInstance = null;
    jQuery.each(CKEDITOR.instances, function(name, CKinstance) {
      var CKzone = getZoneForCKContainer(CKinstance.container.$);
      if($(CKzone).attr("id") === $(zone).attr("id")) {
        CKEditorInstance = CKinstance;
        return
      }
    });
    return CKEditorInstance
  };
  var getZoneForCKContainer = function(container) {
    var area;
    area = $("div[type='text']").has(container);
    if(area.length === 0) {
      area = $("div[type='quiz']").has(container)
    }
    return area
  };
  var getCKEditorIframeContentFromZone = function(zone) {
    var editor = getCKEditorFromZone(zone);
    if(!editor) {
      return null
    }
    var iframe = $(document.getElementById("cke_contents_" + editor.name)).find("iframe")[0];
    return $(iframe).contents()[0]
  };
  var getCKEditorFromTextArea = function(textArea) {
    if(!textArea || typeof CKEDITOR === "undefined" || typeof CKEDITOR.instances === "undefined") {
      return null
    }
    if(!$(textArea).hasClass(".cke_skin_vEditor")) {
      textArea = $(textArea).find(".cke_skin_vEditor");
      if(textArea.length > 0) {
        textArea = textArea[0]
      }
    }
    var CKEditorInstance = null;
    jQuery.each(CKEDITOR.instances, function(name, CKinstance) {
      if(textArea === CKinstance.container.$) {
        CKEditorInstance = CKinstance;
        return
      }
    });
    return CKEditorInstance
  };
  var _getPlainText = function() {
    return $(this.getSnapshot()).text()
  };
  var _fixCKEDITORBug = function(editor) {
    if(CKEDITOR.env.webkit) {
      var iframe = $(document.getElementById("cke_contents_" + editor.name)).find("iframe")[0];
      iframe.style.display = "none";
      iframe.style.display = "block"
    }
  };
  var refreshAutoColors = function() {
    var currentColor = "color:#" + V.Editor.Themes.getCurrentTheme().color;
    jQuery.each(CKEDITOR.instances, function(name, CKinstance) {
      var iframe = $($(document.getElementById("cke_contents_" + CKinstance.name)).find("iframe")[0]).contents()[0];
      var spans = $(iframe).find("span[autocolor][style]");
      jQuery.each(spans, function(name, span) {
        $(span).attr("style", currentColor + ";")
      })
    })
  };
  return{init:init, launchTextEditor:launchTextEditor, getCKEditorFromZone:getCKEditorFromZone, getCKEditorIframeContentFromZone:getCKEditorIframeContentFromZone, getCKEditorFromTextArea:getCKEditorFromTextArea, refreshAutoColors:refreshAutoColors}
}(VISH, jQuery);
VISH.Editor.Video = function(V, $, undefined) {
  var urlDivId = "tab_video_from_url_content";
  var urlInputId = "video_url";
  var init = function() {
    V.Editor.Video.HTML5.init();
    V.Editor.Video.Repository.init();
    V.Editor.Video.Youtube.init();
    V.Editor.Video.Vimeo.init();
    var urlInput = $("#" + urlInputId);
    $(urlInput).watermark("Paste video URL");
    $("#tab_video_from_url_content .previewButton").click(function(event) {
      if(V.Police.validateObject($(urlInput).val())[0]) {
        contentToAdd = V.Editor.Utils.autocompleteUrls($("#" + urlInputId).val());
        V.Editor.Object.drawPreview("tab_video_from_url_content", contentToAdd)
      }else {
        contentToAdd = null
      }
    })
  };
  var onLoadTab = function(tab) {
    $("#tab_video_from_url_content").find("input").val("");
    V.Editor.Object.resetPreview("tab_video_from_url_content")
  };
  var drawPreviewElement = function() {
    V.Editor.Object.drawPreviewObject(contentToAdd)
  };
  return{init:init, onLoadTab:onLoadTab, drawPreviewElement:drawPreviewElement}
}(VISH, jQuery);
VISH.Editor.Image = function(V, $, undefined) {
  var contentToAdd = null;
  var contentAddMode = V.Constant.NONE;
  var uploadDivId = "tab_pic_upload_content";
  var urlDivId = "tab_pic_from_url_content";
  var urlInputId = "picture_url";
  var init = function() {
    V.Editor.Image.Flikr.init();
    V.Editor.Image.Repository.init();
    $("#" + urlDivId + " .previewButton").click(function(event) {
      if(V.Police.validateObject($("#" + urlInputId).val())[0]) {
        contentToAdd = V.Editor.Utils.autocompleteUrls($("#" + urlInputId).val());
        V.Editor.Object.drawPreview(urlDivId, contentToAdd)
      }
    });
    var options = V.Editor.getOptions();
    var tagList = $("#" + uploadDivId + " .tagList");
    var bar = $("#" + uploadDivId + " .upload_progress_bar");
    var percent = $("#" + uploadDivId + " .upload_progress_bar_percent");
    $("#" + uploadDivId + " input[name='document[file]']").change(function() {
      var filterFilePath = V.Editor.Utils.filterFilePath($("#" + uploadDivId + " input:file").val());
      $("#" + uploadDivId + " input[name='document[title]']").val(filterFilePath);
      _resetUploadFields();
      $(tagList).parent().show();
      $("#" + uploadDivId + " form" + " .button").show();
      $("#" + uploadDivId + " .upload_progress_bar_wrapper").hide()
    });
    $("#" + uploadDivId + " #upload_document_submit").click(function(event) {
      if(!V.Police.validateFileUpload($("#" + uploadDivId + " input[name='document[file]']").val())[0]) {
        event.preventDefault()
      }else {
        if(options) {
          var description = "Uploaded by " + V.User.getName() + " via Vish Editor";
          $("#" + uploadDivId + " input[name='document[description]']").val(description);
          $("#" + uploadDivId + " input[name='document[owner_id]']").val(V.User.getId());
          $("#" + uploadDivId + " input[name='authenticity_token']").val(V.User.getToken());
          $("#" + uploadDivId + " .documentsForm").attr("action", V.UploadImagePath);
          $("#" + uploadDivId + " input[name='tags']").val(V.Editor.Utils.convertToTagsArray($(tagList).tagit("tags")));
          var tagList = $("#" + uploadDivId + " .tagList");
          $(tagList).parent().hide();
          $("#" + uploadDivId + " .upload_progress_bar_wrapper").show()
        }
      }
    });
    $("#" + uploadDivId + " form").ajaxForm({beforeSend:function() {
      var percentVal = "0%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, uploadProgress:function(event, position, total, percentComplete) {
      var percentVal = percentComplete + "%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, complete:function(xhr) {
      switch(V.Configuration.getConfiguration()["mode"]) {
        case V.Constant.NOSERVER:
          processResponse('{"src":"/vishEditor/images/excursion_thumbnails/excursion-01.png"}');
          break;
        case V.Constant.VISH:
          processResponse(xhr.responseText);
          break;
        case V.Constant.STANDALONE:
          processResponse(xhr.responseText);
          break
      }
      var percentVal = "100%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, error:function(error) {
      V.Debugging.log("Upload error");
      V.Debugging.log(error)
    }})
  };
  var onLoadTab = function(tab) {
    if(tab == "upload") {
      _onLoadUploadTab()
    }
    if(tab == "url") {
      _onLoadURLTab()
    }
  };
  var _onLoadURLTab = function() {
    contentToAdd = null;
    V.Editor.Object.resetPreview(urlDivId);
    $("#" + urlInputId).val("")
  };
  var _onLoadUploadTab = function() {
    contentToAdd = null;
    var tagList = $("#" + uploadDivId + " .tagList");
    $(tagList).parent().hide();
    $("#" + uploadDivId + " form" + " .button").hide();
    $("#" + uploadDivId + " .upload_progress_bar_wrapper").hide();
    $("#" + uploadDivId + " input[name='document[file]']").val("");
    _resetUploadFields();
    V.Editor.API.requestTags(_onTagsReceived)
  };
  var _resetUploadFields = function() {
    var bar = $("#" + uploadDivId + " .upload_progress_bar");
    var percent = $("#" + uploadDivId + " .upload_progress_bar_percent");
    bar.width("0%");
    percent.html("0%");
    V.Editor.Object.resetPreview(uploadDivId);
    var tagList = $("#" + uploadDivId + " .tagList");
    if($(tagList)[0].children.length !== 0) {
      $(tagList).tagit("reset")
    }
  };
  var _onTagsReceived = function(data) {
    var tagList = $("#" + uploadDivId + " .tagList");
    if($(tagList).children().length == 0) {
      $(tagList).tagit({tagSource:data, sortable:true, maxLength:15, maxTags:8, watermarkAllowMessage:V.Editor.I18n.getTrans("i.AddTags"), watermarkDenyMessage:V.Editor.I18n.getTrans("i.limitReached")})
    }
  };
  var processResponse = function(response) {
    try {
      var jsonResponse = JSON.parse(response);
      if(jsonResponse.src) {
        if(V.Police.validateObject(jsonResponse.src)[0]) {
          V.Editor.Object.drawPreview(uploadDivId, jsonResponse.src);
          contentToAdd = jsonResponse.src
        }
      }
    }catch(e) {
    }
  };
  var addContent = function(content) {
    if(content) {
      contentToAdd = content
    }
    switch(contentAddMode) {
      case V.Constant.FLASHCARD:
        V.Editor.Flashcard.Creator.onBackgroundSelected(contentToAdd);
        break;
      case V.Constant.THUMBNAIL:
        V.Editor.AvatarPicker.onCustomThumbnailSelected(contentToAdd);
        break;
      default:
        V.Editor.Object.drawPreviewObject(contentToAdd)
    }
    contentAddMode = V.Constant.NONE
  };
  var drawImage = function(image_url, area, style, hyperlink) {
    _drawImageInArea(image_url, area, style, hyperlink)
  };
  var _drawImageInArea = function(image_url, area, style, hyperlink) {
    var current_area;
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    var newStyle;
    if(style) {
      newStyle = V.Editor.Utils.setStyleInPixels(style, current_area)
    }else {
      var image_width = $(current_area).width();
      newStyle = "width:" + image_width + "px;"
    }
    var template = V.Editor.getTemplate();
    var nextImageId = V.Utils.getId();
    var idToDragAndResize = "draggable" + nextImageId;
    current_area.attr("type", "image");
    if(hyperlink) {
      current_area.attr("hyperlink", hyperlink)
    }
    current_area.html("<img class='" + template + "_image' id='" + idToDragAndResize + "' draggable='true' title='Click to drag' src='" + image_url + "' style='" + newStyle + "'/>");
    if(!style) {
      var theImg = $("#" + idToDragAndResize);
      $(theImg).load(function() {
        var dimentionsToDraw = V.Editor.Utils.dimentionToDraw($(current_area).width(), $(current_area).height(), $(theImg).width(), $(theImg).height());
        $(theImg).width(dimentionsToDraw.width);
        if(dimentionsToDraw.height > 0) {
          $(theImg).height(dimentionsToDraw.height)
        }
      })
    }
    V.Editor.addDeleteButton(current_area);
    $("#" + idToDragAndResize).draggable({cursor:"move", stop:function() {
      $(this).parent().click()
    }})
  };
  var setAddContentMode = function(mode) {
    contentAddMode = mode
  };
  return{init:init, onLoadTab:onLoadTab, drawImage:drawImage, addContent:addContent, setAddContentMode:setAddContentMode}
}(VISH, jQuery);
VISH.Editor.Object = function(V, $, undefined) {
  var contentToAdd = null;
  var uploadDivId = "tab_object_upload_content";
  var urlDivId = "tab_object_from_url_content";
  var urlInputId = "object_embed_code";
  var init = function() {
    V.Editor.Object.Repository.init();
    V.Editor.Object.Live.init();
    V.Editor.Object.Web.init();
    V.Editor.Object.PDF.init();
    V.Editor.Object.Snapshot.init();
    var urlInput = $(urlDivId).find("input");
    $(urlInput).watermark("Paste SWF file URL");
    $("#" + urlDivId + " .previewButton").click(function(event) {
      if(V.Police.validateObject($("#" + urlInputId).val())[0]) {
        contentToAdd = V.Editor.Utils.autocompleteUrls($("#" + urlInputId).val());
        drawPreview(urlDivId, contentToAdd)
      }
    });
    var options = V.Editor.getOptions();
    var tagList = $("#" + uploadDivId + " .tagList");
    var bar = $("#" + uploadDivId + " .upload_progress_bar");
    var percent = $("#" + uploadDivId + " .upload_progress_bar_percent");
    $("#" + uploadDivId + " input[name='document[file]']").change(function() {
      var filterFilePath = V.Editor.Utils.filterFilePath($("#" + uploadDivId + " input:file").val());
      $("#" + uploadDivId + " input[name='document[title]']").val(filterFilePath);
      _resetUploadFields();
      $(tagList).parent().show();
      $("#" + uploadDivId + " form" + " .button").show();
      $("#" + uploadDivId + " .upload_progress_bar_wrapper").hide()
    });
    $("#" + uploadDivId + " #upload_document_submit").click(function(event) {
      if(!V.Police.validateFileUpload($("#" + uploadDivId + " input[name='document[file]']").val())[0]) {
        event.preventDefault()
      }else {
        if(options) {
          var description = "Uploaded by " + V.User.getName() + " via Vish Editor";
          $("#" + uploadDivId + " input[name='document[description]']").val(description);
          $("#" + uploadDivId + " input[name='document[owner_id]']").val(V.User.getId());
          $("#" + uploadDivId + " input[name='authenticity_token']").val(V.User.getToken());
          $("#" + uploadDivId + " .documentsForm").attr("action", V.UploadObjectPath);
          $("#" + uploadDivId + " input[name='tags']").val(V.Editor.Utils.convertToTagsArray($(tagList).tagit("tags")));
          var tagList = $("#" + uploadDivId + " .tagList");
          $(tagList).parent().hide();
          $("#" + uploadDivId + " .upload_progress_bar_wrapper").show()
        }
      }
    });
    $("#" + uploadDivId + " form").ajaxForm({beforeSend:function() {
      var percentVal = "0%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, uploadProgress:function(event, position, total, percentComplete) {
      var percentVal = percentComplete + "%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, complete:function(xhr) {
      switch(V.Configuration.getConfiguration()["mode"]) {
        case V.Constant.NOSERVER:
          processResponse('{"src":"/vishEditor/images/excursion_thumbnails/excursion-01.png"}');
          break;
        case V.Constant.VISH:
          processResponse(xhr.responseText);
          break;
        case V.Constant.STANDALONE:
          processResponse(xhr.responseText);
          break
      }
      var percentVal = "100%";
      bar.width(percentVal);
      percent.html(percentVal)
    }, error:function(error) {
      V.Debugging.log("Upload error");
      V.Debugging.log(error)
    }})
  };
  var onLoadTab = function(tab) {
    if(tab == "upload") {
      _onLoadUploadTab()
    }
    if(tab == "url") {
      _onLoadURLTab()
    }
  };
  var _onLoadURLTab = function() {
    contentToAdd = null;
    resetPreview(urlDivId);
    $("#" + urlInputId).val("")
  };
  var _onLoadUploadTab = function() {
    contentToAdd = null;
    var tagList = $("#" + uploadDivId + " .tagList");
    $(tagList).parent().hide();
    $("#" + uploadDivId + " form" + " .button").hide();
    $("#" + uploadDivId + " .upload_progress_bar_wrapper").hide();
    $("#" + uploadDivId + " input[name='document[file]']").val("");
    _resetUploadFields();
    V.Editor.API.requestTags(_onTagsReceived)
  };
  var _resetUploadFields = function() {
    var bar = $("#" + uploadDivId + " .upload_progress_bar");
    var percent = $("#" + uploadDivId + " .upload_progress_bar_percent");
    bar.width("0%");
    percent.html("0%");
    resetPreview(uploadDivId);
    var tagList = $("#" + uploadDivId + " .tagList");
    if($(tagList)[0].children.length !== 0) {
      $(tagList).tagit("reset")
    }
  };
  var _onTagsReceived = function(data) {
    var tagList = $("#" + uploadDivId + " .tagList");
    if($(tagList).children().length == 0) {
      $(tagList).tagit({tagSource:data, sortable:true, maxLength:15, maxTags:8, watermarkAllowMessage:V.Editor.I18n.getTrans("i.AddTags"), watermarkDenyMessage:V.Editor.I18n.getTrans("i.limitReached")})
    }
  };
  var processResponse = function(response) {
    try {
      var jsonResponse = JSON.parse(response);
      if(jsonResponse.src) {
        if(V.Police.validateObject(jsonResponse.src)[0]) {
          drawPreview(uploadDivId, jsonResponse.src);
          contentToAdd = jsonResponse.src
        }
      }
    }catch(e) {
    }
  };
  var previewBackground;
  var drawPreview = function(divId, src) {
    previewBackground = $("#" + divId + " .previewimgbox").css("background-image");
    $("#" + divId + " .previewimgbox").css("background-image", "none");
    $("#" + divId + " .previewimgbox img.imagePreview").remove();
    var wrapper = renderObjectPreview(src);
    if($("#" + divId + " .previewimgbox .objectPreview").length > 0) {
      $("#" + divId + " .previewimgbox .objectPreview").remove()
    }
    $("#" + divId + " .previewimgbox").append(wrapper);
    $("#" + divId + " .previewimgbox button").show();
    $("#" + divId + " .documentblank").addClass("documentblank_extraMargin")
  };
  var resetPreview = function(divId) {
    $("#" + divId + " .previewimgbox button").hide();
    $("#" + divId + " .previewimgbox img.imagePreview").remove();
    $("#" + divId + " .previewimgbox .objectPreview").remove();
    if(previewBackground) {
      $("#" + divId + " .previewimgbox").css("background-image", previewBackground)
    }
    $("#" + divId + " .documentblank").removeClass("documentblank_extraMargin")
  };
  var drawPreviewElement = function() {
    drawPreviewObject(contentToAdd)
  };
  var drawPreviewObject = function(content) {
    if(content) {
      drawObject(content);
      $.fancybox.close()
    }
  };
  var resizeObject = function(id, newWidth) {
    var parent = $("#" + id).parent();
    var aspectRatio = $("#" + id).width() / $("#" + id).height();
    var newWrapperHeight = Math.round(newWidth / aspectRatio);
    var newWrapperWidth = Math.round(newWidth);
    $(parent).width(newWrapperWidth);
    $(parent).height(newWrapperHeight);
    var zoom = V.Utils.getZoomFromStyle($("#" + id).attr("style"));
    if(zoom != 1) {
      newWidth = newWidth / zoom;
      var newHeight = Math.round(newWidth / aspectRatio);
      newWidth = Math.round(newWidth)
    }else {
      var newHeight = newWrapperHeight;
      var newWidth = newWrapperWidth
    }
    $("#" + id).width(newWidth);
    $("#" + id).height(newHeight)
  };
  var _adjustWrapperOfObject = function(objectID, current_area) {
    var proportion = $("#" + objectID).height() / $("#" + objectID).width();
    var maxWidth = current_area.width();
    var maxHeight = current_area.height();
    var width = $("#" + objectID).width();
    var height = $("#" + objectID).height();
    if(width > maxWidth) {
      $("#" + objectID).width(maxWidth);
      $("#" + objectID).height(width * proportion);
      width = maxWidth;
      height = $("#" + objectID).height()
    }
    if(height > maxHeight) {
      $("#" + objectID).height(maxHeight);
      $("#" + objectID).width(height / proportion);
      width = $("#" + objectID).width();
      height = maxHeight
    }
    var wrapper = $("#" + objectID).parent();
    if($(wrapper).hasClass("object_wrapper")) {
      $(wrapper).height($("#" + objectID).height());
      $(wrapper).width($("#" + objectID).width())
    }
  };
  var autofixWrapperedObjectAfterZoom = function(object, zoom) {
    var wrapper = $(object).parent();
    $(object).height($(wrapper).height() / zoom);
    $(object).width($(wrapper).width() / zoom)
  };
  var renderObjectPreview = function(object) {
    var objectInfo = V.Object.getObjectInfo(object);
    switch(objectInfo.wrapper) {
      case null:
        switch(objectInfo.type) {
          case "image":
            return"<img class='imagePreview' src='" + object + "'></img>";
            break;
          case "swf":
            return"<embed class='objectPreview' src='" + object + "' wmode='opaque' ></embed>";
            break;
          case "pdf":
            return V.Editor.Object.PDF.generatePreviewWrapperForPdf(object);
            break;
          case "youtube":
            return V.Editor.Video.Youtube.generatePreviewWrapperForYoutubeVideoUrl(object);
            break;
          case "HTML5":
            return V.Editor.Video.HTML5.renderVideoFromSources([object]);
            break;
          case "web":
            return V.Editor.Object.Web.generatePreviewWrapperForWeb(object);
            break;
          default:
            V.Debugging.log("Unrecognized object source type");
            break
        }
        break;
      case "EMBED":
        return _genericWrapperPreview(object);
        break;
      case "OBJECT":
        return _genericWrapperPreview(object);
        break;
      case "IFRAME":
        return _genericWrapperPreview(object);
        break;
      default:
        V.Debugging.log("Unrecognized object wrapper: " + objectInfo.wrapper);
        break
    }
  };
  var _genericWrapperPreview = function(object) {
    var wrapperPreview = $(object);
    $(wrapperPreview).addClass("objectPreview");
    $(wrapperPreview).attr("wmode", "opaque");
    $(wrapperPreview).removeAttr("width");
    $(wrapperPreview).removeAttr("height");
    return wrapperPreview
  };
  var drawObject = function(object, area, style, zoomInStyle) {
    if(!V.Police.validateObject(object)[0]) {
      return
    }
    var current_area;
    var object_style = "";
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    if(style) {
      object_style = style
    }
    var objectInfo = V.Object.getObjectInfo(object);
    switch(objectInfo.wrapper) {
      case null:
        switch(objectInfo.type) {
          case "image":
            V.Editor.Image.drawImage(object);
            break;
          case "swf":
            V.Editor.Object.Flash.drawFlashObjectWithSource(object, object_style);
            break;
          case "pdf":
            V.Editor.Object.drawObject(V.Editor.Object.PDF.generateWrapperForPdf(object));
            break;
          case "youtube":
            V.Editor.Object.drawObject(V.Editor.Video.Youtube.generateWrapperForYoutubeVideoUrl(object));
            break;
          case "HTML5":
            V.Editor.Video.HTML5.drawVideoWithUrl(object);
            break;
          case "web":
            V.Editor.Object.drawObject(V.Editor.Object.Web.generateWrapperForWeb(object));
            break;
          default:
            V.Debugging.log("Unrecognized object source type: " + objectInfo.type);
            break
        }
        break;
      case "EMBED":
        drawObjectWithWrapper(object, current_area, object_style);
        break;
      case "OBJECT":
        drawObjectWithWrapper(object, current_area, object_style);
        break;
      case "IFRAME":
        drawObjectWithWrapper(object, current_area, object_style, zoomInStyle);
        break;
      default:
        V.Debugging.log("Unrecognized object wrapper: " + objectInfo.wrapper);
        break
    }
    V.Editor.Tools.loadToolsForZone(current_area)
  };
  var drawObjectWithWrapper = function(wrapper, current_area, style, zoomInStyle) {
    var template = V.Editor.getTemplate(current_area);
    var nextWrapperId = V.Utils.getId();
    var idToDrag = "draggable" + nextWrapperId;
    var idToResize = "resizable" + nextWrapperId;
    current_area.attr("type", "object");
    var wrapperDiv = document.createElement("div");
    wrapperDiv.setAttribute("id", idToDrag);
    wrapperDiv.setAttribute("draggable", true);
    if(style) {
      wrapperDiv.setAttribute("style", style)
    }
    $(wrapperDiv).addClass("object_wrapper");
    var wrapperTag = $(wrapper);
    $(wrapperTag).attr("id", idToResize);
    $(wrapperTag).css("pointer-events", "none");
    $(wrapperTag).attr("class", template + "_object");
    $(wrapperTag).attr("wmode", "opaque");
    $(current_area).html("");
    $(current_area).append(wrapperDiv);
    V.Editor.addDeleteButton($(current_area));
    $(wrapperDiv).append(wrapperTag);
    $("#" + idToDrag).draggable({cursor:"move"});
    _adjustWrapperOfObject(idToResize, current_area);
    V.Editor.Tools.loadToolbarForObject(wrapper);
    if(zoomInStyle) {
      $(wrapperTag).attr("style", zoomInStyle);
      V.ObjectPlayer.adjustDimensionsAfterZoom($(wrapperTag))
    }
  };
  return{init:init, onLoadTab:onLoadTab, drawObject:drawObject, renderObjectPreview:renderObjectPreview, resizeObject:resizeObject, autofixWrapperedObjectAfterZoom:autofixWrapperedObjectAfterZoom, drawPreview:drawPreview, resetPreview:resetPreview, drawPreviewElement:drawPreviewElement, drawPreviewObject:drawPreviewObject}
}(VISH, jQuery);
VISH.Editor.Presentation = function(V, $, undefined) {
  var init = function() {
    V.EventsNotifier.registerCallback(V.Constant.Event.onSelectedSlides, function(params) {
      insertPresentation(params.JSON, params.acceptedSlides);
      $.fancybox.close()
    })
  };
  var _onConnect = function(origin) {
  };
  var previewPresentation = function(presentation) {
    V.Editor.Preview.preview({insertMode:true, slideNumberToPreview:1, presentationJSON:presentation});
    V.IframeAPI.init({callback:_onConnect})
  };
  var insertPresentation = function(presentationJSON, selectedSlideNumbers) {
    var snL = selectedSlideNumbers.length;
    if(snL < 1) {
      $.fancybox.close();
      return
    }
    var selectedSlides = [];
    var flashcards = [];
    var vts = [];
    for(var i = 0;i < snL;i++) {
      var slide = presentationJSON.slides[selectedSlideNumbers[i] - 1];
      var mySlide = V.Editor.Utils.replaceIdsForSlideJSON(slide);
      if(mySlide === null) {
        $.fancybox.close();
        V.Debugging.log("Not valid presentation");
        return null
      }
      switch(mySlide.type) {
        case V.Constant.FLASHCARD:
          flashcards.push(mySlide);
          break;
        case V.Constant.VTOUR:
          vts.push(mySlide);
          break;
        default:
          break
      }
      selectedSlides.push(mySlide)
    }
    presentationJSON.slides = selectedSlides;
    V.Editor.Renderer.renderPresentation(presentationJSON);
    V.Editor.Slides.redrawSlides();
    V.Editor.Thumbnails.redrawThumbnails();
    V.Slides.lastSlide();
    V.Editor.Utils.Loader.unloadAllObjects();
    V.Editor.Utils.Loader.loadObjectsInEditorSlide(V.Slides.getCurrentSlide());
    for(var j = 0;j < flashcards.length;j++) {
      V.Editor.Events.bindEventsForFlashcard(flashcards[j]);
      V.Editor.Tools.Menu.updateMenuAfterAddSlide(V.Constant.FLASHCARD)
    }
    for(var k = 0;k < vts.length;k++) {
      V.Editor.Tools.Menu.updateMenuAfterAddSlide(V.Constant.VTOUR)
    }
    $.fancybox.close()
  };
  return{init:init, insertPresentation:insertPresentation, previewPresentation:previewPresentation}
}(VISH, jQuery);
VISH.Editor.Presentation.Repository = function(V, $, undefined) {
  var carrouselDivId = "tab_presentations_repo_content_carrousel";
  var previewDivId = "tab_presentations_repo_content_preview";
  var currentPresentations = new Array;
  var selectedPres = null;
  var myInput;
  var previewButton;
  var initialized = false;
  var init = function() {
    myInput = $("#tab_presentations_repo_content").find("input[type='search']");
    previewButton = $("#" + previewDivId).find("button.okButton");
    if(!initialized) {
      $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
      $(myInput).keydown(function(event) {
        if(event.keyCode == 13) {
          _requestData($(myInput).val());
          $(myInput).blur()
        }
      });
      $(previewButton).click(function() {
        if(selectedPres) {
          V.Editor.Presentation.previewPresentation(selectedPres)
        }
      });
      initialized = true
    }
  };
  var onLoadTab = function() {
    var previousSearch = $(myInput).val() !== "";
    if(!previousSearch) {
      _cleanObjectMetadata();
      _requestInitialData()
    }
  };
  var _requestInitialData = function() {
    V.Editor.API.requestRecomendedExcursions(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestExcursions(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    currentExcursions = new Array;
    var carrouselImages = [];
    var content = "";
    if(!data.excursions || data.excursions.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data.excursions, function(index, pres) {
      var myImg = $("<img excursionid ='" + pres.id + "'' src=" + pres.avatar + " />");
      carrouselImages.push(myImg);
      currentExcursions[pres.id] = pres
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 5;
    options["scrollItems"] = 5;
    options["width"] = 800;
    options["styleClass"] = "presentation_repository";
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
    V.Debugging.log("API error")
  };
  var _onClickCarrouselElement = function(event) {
    var excursionid = $(event.target).attr("excursionid");
    if(excursionid) {
      selectedPres = currentExcursions[excursionid];
      _renderObjectMetadata(selectedPres)
    }
  };
  var _renderObjectMetadata = function(object) {
    var metadataArea = $("#" + previewDivId).find("div.content_preview_metadata");
    $(metadataArea).html("");
    if(object) {
      var table = V.Editor.Utils.generateTable(object.author, object.title, object.description, "metadata metadata_presentation");
      $(metadataArea).html(table);
      $(previewButton).show()
    }
  };
  var _cleanObjectMetadata = function() {
    var metadataArea = $("#" + previewDivId).find("div.content_preview_metadata");
    $(metadataArea).html("");
    $(previewButton).hide()
  };
  return{init:init, onLoadTab:onLoadTab}
}(VISH, jQuery);
VISH.Editor.Slideset = function(V, $, undefined) {
  var initialized = false;
  var init = function() {
    if(initialized) {
      return
    }
  };
  var isSlideset = function(type) {
    return V.Slides.isSlideset(type)
  };
  var getCreatorModule = function(type) {
    switch(type) {
      case V.Constant.FLASHCARD:
        return V.Editor.Flashcard.Creator;
        break;
      case V.Constant.VTOUR:
        return V.Editor.VirtualTour.Creator;
        break;
      default:
        return null
    }
  };
  var getModule = function(type) {
    switch(type) {
      case V.Constant.FLASHCARD:
        return V.Editor.Flashcard;
        break;
      case V.Constant.VTOUR:
        return V.Editor.VirtualTour;
        break;
      default:
        return null
    }
  };
  var prepareToNest = function(slide) {
    return V.Editor.Utils.prepareSlideToNest(_getIdForSlideSet(V.Editor.getMode()), slide)
  };
  var undoNestedSlides = function(slideset) {
    slideset.slides = _undoNestedSlides(slideset.id, slideset.slides);
    slideset.pois = _undoNestedPois(slideset.id, slideset.pois);
    return slideset
  };
  var _undoNestedSlides = function(slidesetId, slides) {
    if(slides) {
      var sl = slides.length;
      for(var j = 0;j < sl;j++) {
        slides[j] = V.Editor.Utils.undoNestedSlide(slidesetId, slides[j])
      }
    }
    return slides
  };
  var _undoNestedPois = function(slidesetId, pois) {
    if(pois) {
      var lp = pois.length;
      for(var k = 0;k < lp;k++) {
        pois[k].id = pois[k].id.replace(slidesetId + "_", "");
        pois[k].slide_id = pois[k].slide_id.replace(slidesetId + "_", "")
      }
    }
    return pois
  };
  var _getIdForSlideSet = function(type) {
    switch(type) {
      case V.Constant.FLASHCARD:
        return V.Editor.Flashcard.Creator.getId();
        break;
      case V.Constant.VTOUR:
        return V.Editor.VirtualTour.Creator.getId();
        break;
      default:
        return null
    }
  };
  return{init:init, isSlideset:isSlideset, getCreatorModule:getCreatorModule, getModule:getModule, prepareToNest:prepareToNest, undoNestedSlides:undoNestedSlides}
}(VISH, jQuery);
VISH.Editor.VirtualTour = function(V, $, undefined) {
  var myVirtualTours;
  var init = function() {
    V.Editor.VirtualTour.Creator.init();
    myVirtualTours = new Array
  };
  var addVirtualTour = function(vt) {
    if(typeof myVirtualTours !== "undefined") {
      myVirtualTours[vt.id] = vt
    }
  };
  var getVirtualTour = function(id) {
    if(typeof myVirtualTours !== "undefined") {
      return myVirtualTours[id]
    }
  };
  var hasVirtualTours = function() {
    return $("section.slides > .VirtualTour_slide[type='VirtualTour']").length > 0
  };
  var getSlideset = function(id) {
    return getVirtualTour(id)
  };
  var preCopyActions = function(vtJSON, vtDOM) {
    var canvas = $(vtDOM).find(".map_canvas");
    $(canvas).remove()
  };
  var postCopyActions = function(vtJSON, vtDOM) {
    V.VirtualTour.drawMap(vtJSON);
    V.VirtualTour.loadMap(vtJSON.id);
    V.Editor.VirtualTour.addVirtualTour(vtJSON)
  };
  return{init:init, addVirtualTour:addVirtualTour, getVirtualTour:getVirtualTour, hasVirtualTours:hasVirtualTours, getSlideset:getSlideset, preCopyActions:preCopyActions, postCopyActions:postCopyActions}
}(VISH, jQuery);
VISH.Editor.Flashcard = function(V, $, undefined) {
  var myFlashcards;
  var init = function() {
    V.Editor.Flashcard.Creator.init();
    myFlashcards = new Array
  };
  var addFlashcard = function(fc) {
    if(typeof myFlashcards !== "undefined") {
      myFlashcards[fc.id] = fc
    }
  };
  var getFlashcard = function(id) {
    if(typeof myFlashcards !== "undefined") {
      return myFlashcards[id]
    }
  };
  var getFlashcards = function() {
    return myFlashcards
  };
  var hasFlascards = function() {
    return $("section.slides > .flashcard_slide[type='flashcard']").length > 0
  };
  var getSlideset = function(id) {
    return getFlashcard(id)
  };
  var preCopyActions = function(fcJSON, fcDOM) {
    addFlashcard(fcJSON);
    for(index in fcJSON.pois) {
      var poi = fcJSON.pois[index];
      V.Flashcard.addArrow(fcJSON.id, poi, true)
    }
    V.Editor.Events.bindEventsForFlashcard(fcJSON)
  };
  var postCopyActions = function(fcJSON, fcDOM) {
  };
  return{init:init, addFlashcard:addFlashcard, getFlashcard:getFlashcard, getFlashcards:getFlashcards, hasFlascards:hasFlascards, getSlideset:getSlideset, preCopyActions:preCopyActions, postCopyActions:postCopyActions}
}(VISH, jQuery);
VISH.Editor.Slideset.Repository = function(V, $, undefined) {
  var carrouselDivId = "tab_smartcards_repo_content_carrousel";
  var previewDivId = "tab_smartcards_repo_content_preview";
  var currentSmartcards = new Array;
  var selectedSmartcard = null;
  var myInput;
  var previewButton;
  var initialized = false;
  var init = function() {
    myInput = $("#tab_smartcards_repo_content").find("input[type='search']");
    previewButton = $("#" + previewDivId).find("button.okButton");
    if(!initialized) {
      $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
      $(myInput).keydown(function(event) {
        if(event.keyCode == 13) {
          _requestData($(myInput).val());
          $(myInput).blur()
        }
      });
      $(previewButton).click(function() {
        if(selectedSmartcard) {
          V.Editor.Presentation.previewPresentation(selectedSmartcard)
        }
      });
      initialized = true
    }
  };
  var onLoadTab = function() {
    var previousSearch = $(myInput).val() !== "";
    if(!previousSearch) {
      _cleanObjectMetadata();
      _requestInitialData()
    }
  };
  var _requestInitialData = function() {
    V.Editor.API.requestRecomendedSmartcards(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestSmartcards(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    currentSmartcards = new Array;
    var carrouselImages = [];
    var content = "";
    if(!data.excursions || data.excursions.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data.excursions, function(index, sc) {
      switch(sc.type) {
        case V.Constant.FLASHCARD:
          var myImg = $("<img smartcardid ='" + sc.id + "'' src='" + V.Utils.getSrcFromCSS(sc.slides[0].background) + "' />");
          break;
        case V.Constant.VTOUR:
          var myImg = $("<img smartcardid ='" + sc.id + "'' src='" + V.ImagesPath + "templatesthumbs/tVTour.png' />");
          break;
        default:
          return
      }
      carrouselImages.push(myImg);
      currentSmartcards[sc.id] = sc
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 5;
    options["scrollItems"] = 5;
    options["width"] = 800;
    options["styleClass"] = "presentation_repository";
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
    V.Debugging.log("API error")
  };
  var _onClickCarrouselElement = function(event) {
    var smartCardId = $(event.target).attr("smartcardid");
    if(smartCardId) {
      selectedSmartcard = currentSmartcards[smartCardId];
      _renderObjectMetadata(selectedSmartcard)
    }
  };
  var _renderObjectMetadata = function(object) {
    var metadataArea = $("#" + previewDivId).find("div.content_preview_metadata");
    $(metadataArea).html("");
    if(object) {
      var table = V.Editor.Utils.generateTable(object.author, object.title, object.description, "metadata metadata_presentation");
      $(metadataArea).html(table);
      $(previewButton).show()
    }
  };
  var _cleanObjectMetadata = function() {
    var metadataArea = $("#" + previewDivId).find("div.content_preview_metadata");
    $(metadataArea).html("");
    $(previewButton).hide()
  };
  return{init:init, onLoadTab:onLoadTab}
}(VISH, jQuery);
VISH.Samples = function(V, undefined) {
  var basic_samples = {"id":"1", "title":"The Iberian Lynx", "description":"The Iberian Lynx.\nAmazing presentation with images, videos and objects, generated by Vish Editor.", "author":"Vish Editor Team", "language":"en", "avatar":"http://vishub.org/assets/logos/original/excursion-10.png", "tags":["Do\u00f1ana", "Lynx", "Biology"], "age_range":"4 - 20", "subject":["Biology"], "educational_objectives":"Know about Iberian Lynx", "adquired_competencies":"Pupils will be smarter", "VEVersion":"0.2", 
  "type":"presentation", "theme":"theme1", "slides":[{"id":"article1", "type":"standard", "template":"t1", "elements":[{"id":"article1_zone1", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/312.jpg", "style":"position: relative; width:117.0886075949367%; height:109.47368421052632%; top:-4.7368421052631575%; left:-2.5316455696202533%;"}, {"id":"article1_zone2", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><b><i><br></i></b></span></div><div class="initTextDiv vish-parent-font4" style="text-align: right;"><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><b><i><br></i></b></span></div><div class="initTextDiv vish-parent-font4 vish-parent-fontundefined" style="text-align: right;"><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><i>by <b><span class="vish-fontundefined vish-fontHelvetica" style="color:#cb6120;undefined;">Vish</span> Editor</b> Team<b>&nbsp;</b></i></span></div>'}, 
  {"id":"article1_zone3", "areaid":"subheader"}]}, {"id":"article2", "type":"standard", "template":"t8", "elements":[{"id":"article2_zone1", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font6 vish-parent-fontundefined" style="font-weight: normal; "><span class="vish-font6 vish-fontHelvetica" style="color:#db9600;font-weight: bold;  ;">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;"> Lynx &nbsp; &nbsp; &nbsp;</span><span class="vish-fontundefined vish-fontHelvetica" style="color:#5ea099;undefined;">Description and habitat</span></div>'}, 
  {"id":"article2_zone2", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/73.jpeg", "style":"position: relative; width:130.4%; height:106.6%; top:0.5%; left:-25.2%;"}, {"id":"article2_zone3", "type":"text", "areaid":"center", "body":'In most respects, the Iberian Lynx resembles other species of lynx, with a short tail,tufted ears and a ruff of fur beneath the chin. ...<div class="vish-parent-font7" style="font-weight: normal; "><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, 
  {"id":"article2_zone4", "type":"image", "areaid":"right", "body":"http://vishub.org/pictures/313.png", "style":"position: relative; width:119.5%; height:88.6%; top:3.4%; left:-2.6%;"}]}, {"id":"article3", "type":"standard", "template":"t3", "elements":[{"id":"article3_zone1", "type":"text", "areaid":"header", "body":'<span class="vish-font6 vish-fontHelvetica" style="color: rgb(219, 150, 0); font-weight: normal; ">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">&nbsp;</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">Lynx</span><div class="vish-parent-font4"><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, 
  {"id":"article3_zone2", "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/8t29CZcGAbs?wmode=opaque" frameborder="0" id="resizableunicID9" class="t3_object" wmode="opaque"></iframe>', "style":"position: relative; width:85.81661891117479%; height:100%; top:0.22321428571428573%; left:6.446991404011461%;"}]}, {"id":"article4", "type":"standard", "template":"t6", "elements":[{"id":"article4_zone1", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font6" style="font-weight: normal; "><span class="vish-font6 vish-fontHelvetica" style="color:#db9600;font-weight: bold;  ;">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">&nbsp;Lynx</span><br></div>'}, 
  {"id":"article4_zone2", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/314.jpeg", "style":"position: relative; width:373.6111111111111%; height:217.9%; top:-34.97%; left:-42.13%;"}, {"id":"article4_zone3", "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/314.jpeg", "style":"position: relative; width:373.1%; height:217.7%; top:-46.9%; left:-199.1%;"}, {"id":"article4_zone4", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font4 vish-parent-fontundefined" style="text-align: center; font-weight: normal; "><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;">During the mating season the female leaves her territory...</span><span class="vish-fontundefined vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}]}, 
  {"id":"article5", "type":"standard", "template":"t10", "elements":[{"id":"article5_zone1", "type":"object", "areaid":"center", "body":'<iframe src="http://en.wikipedia.org/wiki/Do%C3%B1ana_National_Park?wmode=transparent" id="resizableunicID15" class="t10_object" wmode="opaque"></iframe>', "style":"position: relative; width:100%; height:100%; top:0%; left:0%;"}]}, {"id":"article6", "type":"standard", "template":"t12", "elements":[{"id":"article6_zone1", "areaid":"left1"}, {"id":"article6_zone2", 
  "areaid":"right1"}, {"id":"article6_zone3", "areaid":"left2"}, {"id":"article6_zone4", "type":"image", "areaid":"right2", "body":"http://vishub.org/pictures/312.jpg", "style":"position: relative; width:114.6%; height:113.8%; top:0%; left:0%;"}]}]};
  var samplesv01 = {"id":"2", "type":"presentation", "title":"Chess: The Art of Learning", "description":"Samples of VE v01. The Art of Learning, a journey in the pursuit of excellence.\nAmazing presentation with images, videos and 3d objects, generated by Vish Editor.", "avatar":"http://static.betazeta.com/www.veoverde.com/wp-content/uploads/2011/07/fotos-gatos.jpg", "tags":["Samples", "Test", "Development"], "author":"Vish Editor Team", "theme":"theme1", "age_range":"4 - 14", "subject":["Art", 
  "Astronomy"], "language":"en", "educational_objectives":"bla bla bla 3", "adquired_competencies":"pupils will be smarter", "slides":[{"id":"article1", "template":"t1", "elements":[{"id":"zone1", "type":"image", "areaid":"left", "body":"http://blogs.20minutos.es/cronicaverde/files/parque_nacional_donana_lince_iberico.jpg", "style":"position: relative; width:97.82608695652173%; height:80.10752688172043%; top:0%; left:0%;"}, {"id":"zone2", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6" style="text-align: center; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="font-family: helvetica;"><span style="font-weight: bold;">Chess</span>: The Art of Learning</span></span><br></span></div>'}, 
  {"id":"zone3", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font3 vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="font-style: italic; font-family: helvetica;">by Aldo Gordillo&nbsp; </span></span><br></span></div>'}]}, {"id":"article2", "template":"t3", "elements":[{"id":"325", "type":"text", "areaid":"header", "body":"Experimento virtual1"}, 
  {"id":"7335", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash"></embed>'}]}, {"id":"articlearticle4", "template":"t6", "elements":[{"id":"zone6", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6 vish-parent-font4" style="font-weight: normal; "><span class="vish-font3 vish-fontHelvetica" style=""><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(219, 150, 0);">Iberian</span></span><span class="vish-font6 vish-fontHelvetica" style="undefined;"> </span><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(32, 24, 21);">Lynx</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="color: rgb(113, 113, 117);">Reproduction</span></span><br></span></div>'}, 
  {"id":"zone7", "type":"image", "areaid":"left", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "hyperlink":"http://www.google.es", "style":"position: relative; width:380.95238095238096%; height:218.69565217391303%; top:-36.231884541718856%; left:-58.201090494791664%;"}, {"id":"zone8", "type":"image", "areaid":"center", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:357.14285714285717%; height:205.2173913043478%; top:-45.41062894074813%; left:-193.12174479166666%;"}, 
  {"id":"zone9", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font2" style="text-align: center; font-weight: normal; "><span class="vish-font2 vish-fontHelvetica" style="">During the mating season the female leaves her territory in search of a male. The typical gestation period is about two months; the cubs are born between March and September, with a peak of births in March and April. A litter consists of two or three (rarely one, four or five) kittens weighing between 200 and 250 grams (7.1 and 8.8 oz).The kittens become independent at seven to 10 months old, but remain with the mother until around 20 months old. Survival of the young depends heavily on the availability of prey species. In the wild, both males and females reach sexual maturity at one year old, though in practice they rarely breed until a territory becomes vacant; one female was known not to breed until five years old when its mother died.</span></div>'}]}, 
  {"id":"article_5", "type":"standard", "template":"t2", "elements":[{"id":"zone11", "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/VAEp2gT-2a8?wmode=opaque" frameborder="0" id="resizableunicID_7" class="t2_object" wmode="opaque"></iframe>', "style":"position: relative; width:99.9390243902439%; height:99.6774193548387%; top:2.225806451612903%; left:2.3536585365853657%;"}]}]};
  var fc_sample = {"id":"3", "VEVersion":"0.2", "type":"flashcard", "title":"Curiosity Flashcard", "description":'A Flashcard about "Curiosity", the car-sized robotic rover exploring Gale Crater on Mars.', "avatar":"http://vishub.org/pictures/311.jpg", "tags":["Science", "Space", "Mars"], "age_range":"12 - 30", "subject":["Astronomy"], "language":"independent", "educational_objectives":'Know about "Curiosity", the car-sized robotic rover exploring Gale Crater on Mars.', "adquired_competencies":"Pupils will be smarter", 
  "author":"Vish Editor Team", "slides":[{"id":"article4", "type":"flashcard", "background":"url(http://vishub.org/pictures/311.jpg)", "pois":[{"id":"article4_poi1", "x":"88.88", "y":"50.83", "slide_id":"article4_article1"}, {"id":"article4_poi2", "x":"45.5", "y":"2.5", "slide_id":"article4_article3"}, {"id":"article4_poi3", "x":"13.5", "y":"63.17", "slide_id":"article4_article4"}], "slides":[{"id":"article4_article1", "type":"standard", "template":"t2", "elements":[{"id":"article4_article1_zone1", 
  "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/P4boyXQuUIw?wmode=opaque" frameborder="0" id="resizableunicID3" class="t2_object" wmode="opaque"></iframe>', "style":"position: relative; width:100%; height:98.7%; top:0%; left:0%;"}]}, {"id":"article4_article3", "type":"standard", "template":"t7", "elements":[{"id":"article4_article3_zone1", "type":"image", "areaid":"header", "body":"http://vishub.org/pictures/315.jpeg", "style":"position: relative; width:101.9%; height:190.4%; top:-69.2%; left:-0.1%;"}, 
  {"id":"article4_article3_zone2", "type":"text", "areaid":"left", "body":'The image shows the Alpha Particle X-Ray Spectrometer (APXS) on NASA\'s Curiosity rover, with the Martian landscape in the background.<div class="vish-parent-font5" style="font-weight: normal; "><span class="vish-font5 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, {"id":"article4_article3_zone3", "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/316.jpeg", "style":"position: relative; width:129.1%; height:110.6%; top:-5.2%; left:-10.9%;"}, 
  {"id":"article4_article3_zone4", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font4" style="font-weight: normal; "><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;">Image credit: NASA/JPL-Caltech/MSSS</span><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}]}, {"id":"article4_article4", "type":"standard", "template":"t10", "elements":[{"id":"article4_article4_zone1", "type":"object", "areaid":"center", 
  "body":'<iframe src="http://en.wikipedia.org/wiki/Curiosity_rover?wmode=transparent" id="resizableunicID6" class="t10_object" wmode="opaque"></iframe>', "style":"position: relative; width:100%; height:100%; top:0%; left:0%;"}]}]}]};
  var samples_vtour = {"id":"1987", "title":"Toledo Virtual Tour", "description":"Virtual Tour example with Vish Editor", "author":"Aldo", "avatar":"http://vishub.org/assets/logos/original/excursion-05.png", "tags":["Samples", "Test", "Development", "Virtual Tour"], "age_range":"4 - 14", "subject":"Media Education", "educational_objectives":"Amazing educational Virtual Tour", "adquired_competencies":"Pupils will be smarter", "type":"VirtualTour", "theme":"theme1", "language":"en", "VEVersion":"0.4", 
  "slides":[{"id":"article5", "type":"VirtualTour", "map_service":"Google Maps", "center":{"lat":"41.23", "lng":"-366.3"}, "zoom":5, "mapType":"roadmap", "width":"100%", "height":"100%", "pois":[{"id":"article5_poi1", "lat":"40.24", "lng":"-3.6", "slide_id":"article5_article1"}, {"id":"article5_poi2", "lat":"41.2", "lng":"2.1", "slide_id":"article5_article2"}, {"id":"article5_poi3", "lat":"37.26", "lng":"-5.97", "slide_id":"article5_article3"}, {"id":"article5_poi4", "lat":"43.26", "lng":"-5.97", 
  "slide_id":"article5_article4"}], "tours":[{"id":"article5_tour1", "path":["article5_poi1", "article5_poi2", "article5_poi3"]}], "slides":[{"id":"article5_article1", "template":"t1", "elements":[{"id":"article5_article1_zone1", "type":"image", "areaid":"left", "body":"http://blogs.20minutos.es/cronicaverde/files/parque_nacional_donana_lince_iberico.jpg", "style":"position: relative; width:97.82608695652173%; height:80.10752688172043%; top:0%; left:0%;"}, {"id":"article5_article1_zone2", "type":"text", 
  "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6" style="text-align: center; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="font-family: helvetica;"><span style="font-weight: bold;">Chess</span>: The Art of Learning</span></span><br></span></div>'}, {"id":"article5_article1_zone3", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font3 vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="font-style: italic; font-family: helvetica;">by Aldo Gordillo&nbsp; </span></span><br></span></div>'}]}, 
  {"id":"article5_article2", "template":"t2", "elements":[{"id":"article5_article2_zone1", "type":"text", "areaid":"header", "body":"Experimento virtual1"}, {"id":"article5_article2_zone2", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash"></embed>'}]}, {"id":"article5_article3", "template":"t6", "elements":[{"id":"article5_article3_zone1", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6 vish-parent-font4" style="font-weight: normal; "><span class="vish-font3 vish-fontHelvetica" style=""><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(219, 150, 0);">Iberian</span></span><span class="vish-font6 vish-fontHelvetica" style="undefined;"> </span><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(32, 24, 21);">Lynx</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="color: rgb(113, 113, 117);">Reproduction</span></span><br></span></div>'}, 
  {"id":"article5_article3_zone2", "type":"image", "areaid":"left", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "hyperlink":"http://www.google.es", "style":"position: relative; width:380.95238095238096%; height:218.69565217391303%; top:-36.231884541718856%; left:-58.201090494791664%;"}, {"id":"article5_article3_zone4", "type":"image", "areaid":"center", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:357.14285714285717%; height:205.2173913043478%; top:-45.41062894074813%; left:-193.12174479166666%;"}, 
  {"id":"article5_article3_zone5", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font2" style="text-align: center; font-weight: normal; "><span class="vish-font2 vish-fontHelvetica" style="">During the mating season the female leaves her territory in search of a male. The typical gestation period is about two months; the cubs are born between March and September, with a peak of births in March and April. A litter consists of two or three (rarely one, four or five) kittens weighing between 200 and 250 grams (7.1 and 8.8 oz).The kittens become independent at seven to 10 months old, but remain with the mother until around 20 months old. Survival of the young depends heavily on the availability of prey species. In the wild, both males and females reach sexual maturity at one year old, though in practice they rarely breed until a territory becomes vacant; one female was known not to breed until five years old when its mother died.</span></div>'}]}, 
  {"id":"article5_article4", "type":"standard", "template":"t2", "elements":[{"id":"article5_article4_zone1", "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/VAEp2gT-2a8?wmode=opaque" frameborder="0" id="resizableunicID_7" class="t2_object" wmode="opaque"></iframe>', "style":"position: relative; width:99.9390243902439%; height:99.6774193548387%; top:2.225806451612903%; left:2.3536585365853657%;"}]}]}]};
  var full_samples = {"id":"4", "VEVersion":"0.2", "type":"presentation", "title":"The Iberian Lynx", "description":"The Iberian Lynx.\nAmazing presentation with images, videos and objects, generated by Vish Editor.", "avatar":"http://vishub.org/assets/logos/original/excursion-10.png", "tags":["Do\u00f1ana", "Lynx", "Biology"], "theme":"theme1", "age_range":"4 - 20", "subject":["Biology"], "language":"en", "educational_objectives":"Know about Iberian Lynx", "adquired_competencies":"Pupils will be smarter", 
  "author":"Vish Editor Team", "slides":[{"id":"article1", "type":"standard", "template":"t1", "elements":[{"id":"article1_zone1", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/312.jpeg", "style":"position: relative; width:117.0886075949367%; height:109.47368421052632%; top:-4.7368421052631575%; left:-2.320675105485232%;"}, {"id":"article1_zone2", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><b><i><br></i></b></span></div><div class="initTextDiv vish-parent-font4" style="text-align: right;"><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><b><i><br></i></b></span></div><div class="initTextDiv vish-parent-font4 vish-parent-fontundefined" style="text-align: right;"><span class="vish-font4 vish-fonthelvetica" style="color:undefined;undefined;"><i>by <b><span class="vish-fontundefined vish-fontHelvetica" style="color:#cb6120;undefined;">Vish</span> Editor</b> Team<b>&nbsp;</b></i></span></div>'}, 
  {"id":"article1_zone3", "areaid":"subheader"}]}, {"id":"article2", "type":"standard", "template":"t8", "elements":[{"id":"article2_zone1", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font6 vish-parent-fontundefined" style="font-weight: normal; "><span class="vish-font6 vish-fontHelvetica" style="color:#db9600;font-weight: bold;  ;">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;"> Lynx &nbsp; &nbsp; &nbsp;</span><span class="vish-fontundefined vish-fontHelvetica" style="color:#5ea099;undefined;">Description and habitat</span></div>'}, 
  {"id":"article2_zone2", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/73.jpeg", "style":"position: relative; width:130.43478260869566%; height:106.63507109004739%; top:0%; left:-25.217391304347824%;"}, {"id":"article2_zone3", "type":"text", "areaid":"center", "body":'In most respects, the Iberian Lynx resembles other species of lynx, with a short tail,tufted ears and a ruff of fur beneath the chin. ...<div class="vish-parent-font7" style="font-weight: normal; "><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, 
  {"id":"article2_zone4", "type":"image", "areaid":"right", "body":"http://vishub.org/pictures/313.png", "style":"position: relative; width:119.56521739130434%; height:88.60759493670886%; top:2.9535864978902953%; left:-2.608695652173913%;"}]}, {"id":"article12", "template":"t3", "elements":[{"id":"article12_zone1", "type":"text", "areaid":"header", "body":"Experimento virtual"}, {"id":"article12_zone2", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" id="resizableunicID8" class="t3_object" wmode="opaque">', 
  "style":"position: relative; width:100%; height:100%; top:0%; left:0%;"}]}, {"id":"article8", "type":"flashcard", "background":"url(http://vishub.org/pictures/317.png)", "pois":[{"id":"article8_poi1", "x":"36.9", "y":"67.3", "slide_id":"article8_article1"}, {"id":"article8_poi2", "x":"55.4", "y":"68.16", "slide_id":"article8_article2"}, {"id":"article8_poi3", "x":"45.875", "y":"5.5", "slide_id":"article8_article3"}], "slides":[{"id":"article8_article1", "type":"standard", "template":"t2", "elements":[{"id":"article8_article1_zone1", 
  "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/318.jpeg", "style":"position: relative; width:110.31518624641834%; height:97.1590909090909%; top:2.0833333333333335%; left:-1.146131805157593%;"}]}, {"id":"article8_article2", "type":"standard", "template":"t2", "elements":[{"id":"article8_article2_zone1", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/327.jpeg", "style":"position: relative; width:103.15186246418338%; height:90.53030303030303%; top:3.0303030303030303%; left:-0.5730659025787965%;"}]}, 
  {"id":"article8_article3", "type":"standard", "template":"t2", "elements":[{"id":"article8_article3_zone1", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/319.jpeg", "style":"position: relative; width:119.05444126074498%; height:129.54545454545453%; top:-2.6515151515151514%; left:-3.5816618911174785%;"}]}]}, {"id":"article9", "type":"standard", "template":"t3", "elements":[{"id":"article9_zone1", "type":"text", "areaid":"header", "body":'<span class="vish-font6 vish-fontHelvetica" style="color: rgb(219, 150, 0); font-weight: normal; ">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">&nbsp;</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">Lynx</span><div class="vish-parent-font4"><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, 
  {"id":"article9_zone2", "type":"video", "areaid":"left", "poster":"https://raw.github.com/ging/vish_editor/master/public/vishEditor/images/example_poster_image.jpg", "style":"position: relative; width:100%; height:100%; top:-3.125%; left:0.14326647564469913%;", "sources":'[{ "type": "video/webm", "src": "http://vishub.org/videos/325.webm"},{ "type": "video/mp4", "src": "http://vishub.org/videos/325.mp4"}]'}]}, {"id":"article3", "type":"standard", "template":"t3", "elements":[{"id":"article3_zone1", 
  "type":"text", "areaid":"header", "body":'<span class="vish-font6 vish-fontHelvetica" style="color: rgb(219, 150, 0); font-weight: normal; ">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">&nbsp;</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">Lynx</span><div class="vish-parent-font4"><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}, {"id":"article3_zone2", 
  "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/8t29CZcGAbs?wmode=opaque" frameborder="0" id="resizableunicID4" class="t3_object" wmode="opaque"></iframe>', "style":"position: relative; width:85.81661891117479%; height:100%; top:0%; left:6.446991404011461%;"}]}, {"id":"article4", "type":"standard", "template":"t6", "elements":[{"id":"article4_zone1", "type":"text", "areaid":"header", "body":'<div class="initTextDiv vish-parent-font6" style="font-weight: normal; "><span class="vish-font6 vish-fontHelvetica" style="color:#db9600;font-weight: bold;  ;">Iberian</span><span class="vish-font6 vish-fontHelvetica" style="color:undefined;font-weight: bold; ;">&nbsp;Lynx</span><br></div>'}, 
  {"id":"article4_zone2", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/314.jpeg", "style":"position: relative; width:373.6111111111111%; height:217.91044776119404%; top:-34.9680170575693%; left:-42.129629629629626%;"}, {"id":"article4_zone3", "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/314.jpeg", "style":"position: relative; width:373.14814814814815%; height:217.69722814498934%; top:-46.695095948827294%; left:-199.07407407407408%;"}, {"id":"article4_zone4", 
  "type":"text", "areaid":"right", "body":'<div class="vish-parent-font4 vish-parent-fontundefined" style="text-align: center; font-weight: normal; "><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;">During the mating season the female leaves her territory...</span><span class="vish-fontundefined vish-fontHelvetica" style="color:undefined;undefined;"></span></div>'}]}, {"id":"article5", "type":"standard", "template":"t10", "elements":[{"id":"article5_zone1", "type":"object", 
  "areaid":"center", "body":'<iframe src="http://en.wikipedia.org/wiki/Do%C3%B1ana_National_Park?wmode=transparent" id="resizableunicID7" class="t10_object" wmode="opaque"></iframe>', "style":"position: relative; width:100%; height:100%; top:0%; left:0%;"}]}, {"id":"article7", "type":"flashcard", "background":"url(http://vishub.org/pictures/320.jpeg)", "pois":[{"id":"article7_poi1", "x":"15.63", "y":"8.5", "slide_id":"article7_article1"}, {"id":"article7_poi2", "x":"77.75", "y":"11.5", "slide_id":"article7_article2"}, 
  {"id":"article7_poi3", "x":"17.125", "y":"58.83", "slide_id":"article7_article3"}], "slides":[{"id":"article7_article1", "type":"standard", "template":"t10", "elements":[{"id":"article7_article1_zone1", "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/321.jpeg", "style":"position: relative; width:49.62406015037594%; height:66.22073578595318%; top:15.719063545150501%; left:24.18546365914787%;"}]}, {"id":"article7_article2", "type":"standard", "template":"t10", "elements":[{"id":"article7_article2_zone1", 
  "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/322.jpeg", "style":"position: relative; width:60.526315789473685%; height:67.3913043478261%; top:15.719063545150501%; left:20.17543859649123%;"}]}, {"id":"article7_article3", "type":"standard", "template":"t10", "elements":[{"id":"article7_article3_zone1", "type":"image", "areaid":"center", "body":"http://vishub.org/pictures/323.jpeg", "style":"position: relative; width:115.91478696741855%; height:116.05351170568562%; top:-2.842809364548495%; left:-0.7518796992481203%;"}]}]}, 
  {"id":"article6", "type":"standard", "template":"t12", "elements":[{"id":"article6_zone1", "areaid":"left1"}, {"id":"article6_zone2", "areaid":"right1"}, {"id":"article6_zone3", "areaid":"left2"}, {"id":"article6_zone4", "type":"image", "areaid":"right2", "body":"http://vishub.org/pictures/312.jpeg", "style":"position: relative; width:114.6268656716418%; height:113.83399209486166%; top:0%; left:0%;"}]}, {"id":"article13", "type":"standard", "template":"t2", "elements":[{"id":"article13_zone1", 
  "type":"snapshot", "areaid":"left", "body":'<iframe src="http://en.wikipedia.org" id="resizableunicID10" class="snapshot_content" scrolling="no" wmode="transparent"></iframe>', "style":"position: relative; width:61.46131805157593%; height:61.17424242424242%; top:40.15151515151515%; left:-15.759312320916905%;", "scrollTop":417, "scrollLeft":129}]}, {"id":"article14", "type":"VirtualTour", "map_service":"Google Maps", "center":{"lat":"41.23", "lng":"-366.3"}, "zoom":"5", "mapType":"roadmap", "width":"100%", 
  "height":"100%", "pois":[{"id":"article14_poi1", "lat":"40.24", "lng":"-3.6", "slide_id":"article14_article1"}, {"id":"article14_poi2", "lat":"41.2", "lng":"2.1", "slide_id":"article14_article2"}, {"id":"article14_poi3", "lat":"37.26", "lng":"-5.97", "slide_id":"article14_article3"}, {"id":"article14_poi4", "lat":"43.26", "lng":"-5.97", "slide_id":"article14_article4"}], "tours":[{"id":"article14_tour1", "path":["article14_poi1", "article14_poi2", "article14_poi3"]}], "slides":[{"id":"article14_article1", 
  "template":"t1", "elements":[{"id":"article14_article1_zone1", "type":"image", "areaid":"left", "body":"http://blogs.20minutos.es/cronicaverde/files/parque_nacional_donana_lince_iberico.jpg", "style":"position: relative; width:97.82608695652173%; height:80.10752688172043%; top:0%; left:0%;"}, {"id":"article14_article1_zone2", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6" style="text-align: center; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="font-family: helvetica;"><span style="font-weight: bold;">Chess</span>: The Art of Learning</span></span><br></span></div>'}, 
  {"id":"article14_article1_zone3", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font3 vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="font-style: italic; font-family: helvetica;">by Aldo Gordillo&nbsp; </span></span><br></span></div>'}]}, {"id":"article14_article2", "template":"t2", "elements":[{"id":"article14_article2_zone1", "type":"text", 
  "areaid":"header", "body":"Experimento virtual1"}, {"id":"article14_article2_zone2", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash"></embed>'}]}, {"id":"article14_article3", "template":"t6", "elements":[{"id":"article14_article3_zone1", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6 vish-parent-font4" style="font-weight: normal; "><span class="vish-font3 vish-fontHelvetica" style=""><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(219, 150, 0);">Iberian</span></span><span class="vish-font6 vish-fontHelvetica" style="undefined;"> </span><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(32, 24, 21);">Lynx</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="color: rgb(113, 113, 117);">Reproduction</span></span><br></span></div>'}, 
  {"id":"article14_article3_zone2", "type":"image", "areaid":"left", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "hyperlink":"http://www.google.es", "style":"position: relative; width:380.95238095238096%; height:218.69565217391303%; top:-36.231884541718856%; left:-58.201090494791664%;"}, {"id":"article14_article3_zone4", "type":"image", "areaid":"center", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:357.14285714285717%; height:205.2173913043478%; top:-45.41062894074813%; left:-193.12174479166666%;"}, 
  {"id":"article14_article3_zone5", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font2" style="text-align: center; font-weight: normal; "><span class="vish-font2 vish-fontHelvetica" style="">During the mating season the female leaves her territory in search of a male. The typical gestation period is about two months; the cubs are born between March and September, with a peak of births in March and April. A litter consists of two or three (rarely one, four or five) kittens weighing between 200 and 250 grams (7.1 and 8.8 oz).The kittens become independent at seven to 10 months old, but remain with the mother until around 20 months old. Survival of the young depends heavily on the availability of prey species. In the wild, both males and females reach sexual maturity at one year old, though in practice they rarely breed until a territory becomes vacant; one female was known not to breed until five years old when its mother died.</span></div>'}]}, 
  {"id":"article14_article4", "type":"standard", "template":"t2", "elements":[{"id":"article14_article4_zone1", "type":"object", "areaid":"left", "body":'<iframe src="http://www.youtube.com/embed/VAEp2gT-2a8?wmode=opaque" frameborder="0" id="resizableunicID_7" class="t2_object" wmode="opaque"></iframe>', "style":"position: relative; width:99.9390243902439%; height:99.6774193548387%; top:2.225806451612903%; left:2.3536585365853657%;"}]}]}]};
  var quiz_samples = {"VEVersion":"0.4", "title":"Quiz samples", "id":"213123", "avatar":"http://vishub.org/assets/logos/original/excursion-15.png", "type":"presentation", "description":"Quiz example", "author":"Aldo", "slides":[{"id":"article2", "type":"standard", "template":"t2", "elements":[{"id":"article2_zone1", "type":"quiz", "areaid":"left", "quiztype":"multiplechoice", "selfA":true, "question":{"value":"\u00adWhat is the oldest ancient weapon?", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:38px;">&shy;What is the oldest ancient weapon?</span></span></p>\n'}, 
  "choices":[{"id":1, "value":"Fu\u00ad", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">Fu&shy;</span></span></p>\n', "answer":false}, {"id":2, "value":"\u00adBow", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Bow</span></span></p>\n', "answer":true}, {"id":3, "value":"\u00adChu Ko Nuh", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Chu Ko Nuh</span></span></p>\n', 
  "answer":false}, {"id":4, "value":"\u00adWar Galley", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;War Galley</span></span></p>\n', "answer":false}], "extras":{"multipleAnswer":false}, "quiz_simple_json":{"author":"", "type":"quiz_simple", "slides":[{"id":"article2", "type":"quiz_simple", "template":"t2", "elements":[{"id":"article2_zone1", "type":"quiz", "areaid":"left", "quiztype":"multiplechoice", "selfA":true, "question":{"value":"\u00adWhat is the oldest ancient weapon?", 
  "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:38px;">&shy;What is the oldest ancient weapon?</span></span></p>\n'}, "choices":[{"id":1, "value":"Fu\u00ad", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">Fu&shy;</span></span></p>\n', "answer":false}, {"id":2, "value":"\u00adBow", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Bow</span></span></p>\n', 
  "answer":true}, {"id":3, "value":"\u00adChu Ko Nuh", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Chu Ko Nuh</span></span></p>\n', "answer":false}, {"id":4, "value":"\u00adWar Galley", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;War Galley</span></span></p>\n', "answer":false}], "extras":{"multipleAnswer":false}}], "containsQuiz":true}]}}], 
  "containsQuiz":true}, {"id":"article1", "type":"standard", "template":"t2", "elements":[{"id":"article1_zone1", "type":"quiz", "areaid":"left", "quiztype":"truefalse", "selfA":true, "question":{"value":"\u00adWhat of the followings are ancient weapons?", "wysiwygValue":'<p style="text-align:left;">\n\t<span style="color:#ff0000;"><span style="font-size:10px;"><span autocolor="true">&shy;</span><span autocolor="true"><span style="font-size:24px;">What of the followings are ancient weapons?</span></span></span></span></p>\n'}, 
  "choices":[{"id":1, "value":"\u00adChu Ko Nuh", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;</span></span><span style="color: rgb(0, 0, 0); font-size: 24.44444465637207px;">Chu Ko Nuh</span></p>\n', "answer":true}, {"id":2, "value":"\u00adGun", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Gun</span></span></p>\n', "answer":false}, {"id":3, 
  "value":"Halberd", "wysiwygValue":'<p style="text-align:left;">\n\t<font color="#000000" size="5">Halberd</font></p>\n', "answer":true}, {"id":4, "value":"Battleaxe", "wysiwygValue":'<p style="text-align:left;">\n\t<font color="#000000" size="5">Battleaxe</font></p>\n', "answer":true}], "quiz_simple_json":{"author":"", "type":"quiz_simple", "slides":[{"id":"article1", "type":"quiz_simple", "template":"t2", "elements":[{"id":"article1_zone1", "type":"quiz", "areaid":"left", "quiztype":"truefalse", 
  "selfA":true, "question":{"value":"\u00adWhat of the followings are ancient weapons?", "wysiwygValue":'<p style="text-align:left;">\n\t<span style="color:#ff0000;"><span style="font-size:10px;"><span autocolor="true">&shy;</span><span autocolor="true"><span style="font-size:24px;">What of the followings are ancient weapons?</span></span></span></span></p>\n'}, "choices":[{"id":1, "value":"\u00adChu Ko Nuh", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;</span></span><span style="color: rgb(0, 0, 0); font-size: 24.44444465637207px;">Chu Ko Nuh</span></p>\n', 
  "answer":true}, {"id":2, "value":"\u00adGun", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Gun</span></span></p>\n', "answer":false}, {"id":3, "value":"Halberd", "wysiwygValue":'<p style="text-align:left;">\n\t<font color="#000000" size="5">Halberd</font></p>\n', "answer":true}, {"id":4, "value":"Battleaxe", "wysiwygValue":'<p style="text-align:left;">\n\t<font color="#000000" size="5">Battleaxe</font></p>\n', "answer":true}]}], 
  "containsQuiz":true}]}}], "containsQuiz":true}, {"id":"article3", "type":"standard", "template":"t2", "elements":[{"id":"article3_zone1", "type":"quiz", "areaid":"left", "quiztype":"multiplechoice", "selfA":true, "question":{"value":"What are ancient weapons?\u00ad", "wysiwygValue":'<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:38px;">What are ancient weapons?&shy;</span></span></p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n'}, 
  "choices":[{"id":1, "value":"\u00adFu", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Fu</span></span></p>\n', "answer":true}, {"id":2, "value":"\u00adGun", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Gun</span></span></p>\n', "answer":false}, {"id":3, "value":"Chu Ko Nuh\u00ad", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">Chu Ko Nuh&shy;</span></span></p>\n', 
  "answer":true}, {"id":4, "value":"\u00adNuclear bomb", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Nuclear bomb</span></span></p>\n', "answer":false}], "extras":{"multipleAnswer":true}, "quiz_simple_json":{"author":"", "type":"quiz_simple", "slides":[{"id":"article3", "type":"quiz_simple", "template":"t2", "elements":[{"id":"article3_zone1", "type":"quiz", "areaid":"left", "quiztype":"multiplechoice", "selfA":true, 
  "question":{"value":"What are ancient weapons?\u00ad", "wysiwygValue":'<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:38px;">What are ancient weapons?&shy;</span></span></p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n'}, "choices":[{"id":1, "value":"\u00adFu", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Fu</span></span></p>\n', 
  "answer":true}, {"id":2, "value":"\u00adGun", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Gun</span></span></p>\n', "answer":false}, {"id":3, "value":"Chu Ko Nuh\u00ad", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">Chu Ko Nuh&shy;</span></span></p>\n', "answer":true}, {"id":4, "value":"\u00adNuclear bomb", "wysiwygValue":'<p style="text-align:left;">\n\t<span autocolor="true" style="color:#000"><span style="font-size:24px;">&shy;Nuclear bomb</span></span></p>\n', 
  "answer":false}], "extras":{"multipleAnswer":true}}], "containsQuiz":true}]}}], "containsQuiz":true}]};
  var magnetic_gifs = {"id":"405", "type":"presentation", "title":"Magnetic Resonance Imaging of Foods (Mobile)", "description":"Images of magnetic resonance: Food series.\nhttp://insideinsides.blogspot.com.es/", "avatar":"http://vishub.org/assets/logos/original/excursion-35.png", "tags":["Art", "Mobile", "LifeSciences", "Life-Sciences", "EarthScience", "e-learning"], "author":"N\u00e9stor Toribio Ruiz", "slides":[{"id":"article_405_0", "type":"standard", "template":"t1", "elements":[{"id":"zone1", 
  "type":"image", "areaid":"left", "body":"http://3.bp.blogspot.com/-QLfceEKHmis/TijNAXnjwLI/AAAAAAAACSA/LWzvgAAy4YI/s840/insideinsides.jpg", "style":"position: relative; width:97.61388286334056%; height:60.85790884718499%; top:23.288651126319536%; left:1.0773698057890455%;"}, {"id":"zone2", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" class="vish-parent-font7 vish-parent-font2 vish-parent-font4" align="center"><span class="vish-font4 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font2 vish-fontHelvetica" style="color:#201815;undefined;"><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;">Magnetic Resonance</span></span></span></div>'}, 
  {"id":"zone3", "type":"text", "areaid":"subheader", "body":'<div style="font-weight: 400;" class="vish-parent-font5 vish-parent-font2" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font5 vish-fontHelvetica" style="color:undefined;undefined;"><i>Imaging of Foods</i></span></span></div>'}]}, {"id":"article_405_1", "type":"standard", "template":"t5", "elements":[{"id":"zone4", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Broccoli</span></span></div>'}, 
  {"id":"zone5", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/150.gif", "style":"position: relative; width:123.07692307692308%; height:70.78651685393258%; top:12.142323697550912%; left:-17.887178861177883%;"}, {"id":"zone6", "type":"image", "areaid":"right", "body":"http://www.tarot-josnell.com/imagenes/brocoli.jpg", "style":"position: relative; width:107.6923076923077%; height:75.50561797752809%; top:9.438202247191011%; left:-3.6923076923076925%;"}]}, {"id":"article_405_2", 
  "type":"standard", "template":"t5", "elements":[{"id":"zone7", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" class="vish-parent-font2" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Corn</span></span><br></div>'}, {"id":"zone8", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/146.gif", "style":"position: relative; width:70.76923076923077%; height:101.79775280898876%; top:0%; left:15.097430889423077%;"}, 
  {"id":"zone9", "type":"image", "areaid":"right", "body":"http://www.scientificamerican.com/media/inline/that-burger-youre-eating-is-mostly-corn_1.jpg", "style":"position: relative; width:169.23076923076923%; height:123.59550561797752%; top:-13.730335021286868%; left:-36.68716195913461%;"}]}, {"id":"article_405_3", "type":"standard", "template":"t5", "elements":[{"id":"zone10", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Garlic</span></span></div>'}, 
  {"id":"zone11", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/149.gif", "style":"position: relative; width:132.30769230769232%; height:97.52808988764045%; top:6.29962706833743%; left:-16.041053185096153%;"}, {"id":"zone12", "type":"image", "areaid":"right", "body":"http://www.planetmattersandmore.com/wp-content/uploads/2012/04/garlic_bulb.jpg", "style":"position: relative; width:153.84615384615384%; height:84.9438202247191%; top:7.872660776202598%; left:-28.369290865384617%;"}]}, 
  {"id":"article_405_4", "type":"standard", "template":"t5", "elements":[{"id":"zone13", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Tomato</span></span></div>'}, {"id":"zone14", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/148.gif", "style":"position: relative; width:107.6923076923077%; height:78.65168539325843%; top:8.546818079573384%; left:-7.405127892127404%;"}, 
  {"id":"zone15", "type":"image", "areaid":"right", "body":"http://www.lacocinadeinma.com/wp-content/uploads/Tomate.jpg", "style":"position: relative; width:123.07692307692308%; height:89.88764044943821%; top:4.943820224719101%; left:-9.866671048677885%;"}]}, {"id":"article_405_5", "type":"standard", "template":"t5", "elements":[{"id":"zone16", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Pineapple</span></span></div>'}, 
  {"id":"zone17", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/156.gif?1347543540", "style":"position: relative; width:200%; height:81.57303370786516%; top:12.36329496576545%; left:-48.05127892127404%;"}, {"id":"zone18", "type":"image", "areaid":"right", "body":"http://www.floridahillnursery.com/images/gold%20pineapple%20.jpg", "style":"position: relative; width:123.07692307692308%; height:165.8426966292135%; top:-69.93258358387465%; left:-10.784621018629808%;"}]}, {"id":"article_405_6", 
  "type":"standard", "template":"t5", "elements":[{"id":"zone19", "type":"text", "areaid":"header", "body":'<div style="font-weight: 400;" align="center"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="font-weight: 400;">Magnetic Resonance: Apple</span></span></div>'}, {"id":"zone20", "type":"image", "areaid":"left", "body":"http://vishub.org/pictures/151.gif", "style":"position: relative; width:163.07692307692307%; height:119.10112359550561%; top:-8.771533751755618%; left:-32.65127798227164%;"}, 
  {"id":"zone21", "type":"image", "areaid":"right", "body":"http://appleadayproject.files.wordpress.com/2011/03/apple-full2.jpg", "style":"position: relative; width:138.46153846153845%; height:101.79775280898876%; top:-8.996252852879213%; left:-14.4769287109375%;"}]}, {"id":"article_405_7", "type":"standard", "template":"t2", "elements":[{"id":"zone22", "type":"text", "areaid":"left", "body":'<div style="font-weight: 400;" class="vish-parent-font7 vish-parent-font2 vish-parent-fontundefined" align="center"><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"><br></span><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"><br></span><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"><br></span><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;"><br></span><span class="vish-fontundefined vish-fontHelvetica" style="color:#717175;undefined;"><span class="vish-font2 vish-fontHelvetica" style="color:undefined;undefined;"><span class="vish-font7 vish-fontHelvetica" style="color:undefined;undefined;">http://insideinsides.blogspot.com.es/</span></span></span></div>'}]}]};
  var new_wysiwyg = {"VEVersion":"0.3", "id":"4", "type":"presentation", "title":"The Iberian Lynx", "description":"The Iberian Lynx.\nAmazing presentation with images, videos and objects, generated by Vish Editor.", "avatar":"http://vishub.org/assets/logos/original/excursion-10.png", "tags":["Do\u00c3\u00b1ana", "Lynx", "Biology"], "theme":"theme1", "age_range":"4 - 20", "subject":["Biology"], "language":"en", "educational_objectives":"Know about Iberian Lynx", "adquired_competencies":"Pupils will be smarter", 
  "author":"", "slides":[{"id":"article1", "type":"standard", "template":"t2", "elements":[{"id":"article1_zone1", "type":"text", "areaid":"left", "body":'<p>\n\taaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p>\n<p>\n\tbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</p>\n<p>\n\t<span style="font-size:10px;">10cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></p>\n<p>\n\t<span style="font-size: 10px;"><span style="font-size:16px;">16ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd</span></span></p>\n<p>\n\t<span style="font-size: 10px;"><span style="font-size:16px;"><span style="font-size:26px;">26eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</span></span></span></p>\n<p>\n\t<span style="font-size: 10px;"><span style="font-size:16px;"><span style="font-size:26px;"><span style="font-size:48px;">48ffffffffffffffffffffffffffffffffffffffffffffffff</span></span></span></span></p>\n<p>\n\t<span style="font-size: 10px;"><span style="font-size:16px;"><span style="font-size:26px;"><span style="font-size:48px;"><span style="font-size:72px;">72ggggggggggggggg</span></span></span></span></span></p>\n<p>\n\t&nbsp;</p>\n'}]}, 
  {"id":"article2", "type":"standard", "template":"t2", "elements":[{"id":"article2_zone1", "type":"text", "areaid":"left", "body":'<p style="text-align: center;">\n\t<span style="color:#ff0000;"><span style="font-size:48px;"><span style="font-family:trebuchet ms,helvetica,sans-serif;">Hello World</span></span></span></p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t&nbsp;</p>\n<p style="text-align: center;">\n\t<span style="color: rgb(255, 0, 0); font-family: \'trebuchet ms\', helvetica, sans-serif; font-size: 48px;">Hello World</span></p>\n'}]}, 
  {"id":"article3", "type":"standard", "template":"t2", "elements":[{"id":"article3_zone1", "type":"text", "areaid":"left", "body":'<p style="text-align:left;">\n\t<span style="font-size:36px;">&shy;<span style="font-size:20px;">1</span></span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">2</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">3</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">4</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">5</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">6</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">7</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">8</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">9</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">10</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">11</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">12</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">13</span></p>\n<p style="text-align:left;">\n\t<span style="font-size:20px;">14</span></p>\n'}]}, 
  {"id":"article4", "type":"standard", "template":"t1", "elements":[{"id":"article4_zone1", "type":"text", "areaid":"left", "body":'<p style="text-align:left;">\n\t<span style="font-size:36px;"><a href="http://delanada" target="_blank">http://delanada</a>&shy;</span></p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n'}, {"id":"article4_zone2", "areaid":"header"}, {"id":"article4_zone3", "type":"text", "areaid":"subheader", "body":'<p style="text-align:left;">\n\t<span style="font-size:18px;">&shy;asdadsad</span></p>\n'}]}, 
  {"id":"article5", "type":"standard", "template":"t2", "elements":[{"id":"article5_zone1", "type":"text", "areaid":"left", "body":'<p style="text-align:left;">\n\t<span style="font-size:36px;">exponentes<sup>2</sup></span></p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t<span style="font-size:22px;"><span style="font-size:36px;">exponentesb<sub>345</sub>asdadsadasd</span></span></p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t<u><span style="font-size:22px;"><span style="font-size:36px;">Subrayado</span></span></u></p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t<em><span style="font-size:22px;"><span style="font-size:36px;">Cursiva</span></span></em></p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t<strong><span style="font-size:22px;"><span style="font-size:36px;">Negrita</span></span></strong></p>\n'}]}, 
  {"id":"article6", "type":"standard", "template":"t2", "elements":[{"id":"article6_zone1", "type":"text", "areaid":"left", "body":'<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<p style="text-align:left;">\n\t&nbsp;</p>\n<table align="center" border="1" cellpadding="1" cellspacing="1" style="width: 500px;" summary="Fin de ejemplo de tabla">\n\t<caption>\n\t\t<span style="font-size:24px;">Ejemplo de Tabla</span></caption>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<span style="color:#ffff00;"><span style="font-size:36px;"><span style="font-family:comic sans ms,cursive;"><span style="background-color:#000000;">Esto es un</span></span></span></span></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">ejemplo de&nbsp;</span></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">una tabla</span></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">con el</span></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">nuevo</span></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">wysiwyg</span></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<font size="5">a ver si</font></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">redimensiona</span></td>\n\t\t\t<td>\n\t\t\t\t<span style="font-size:24px;">bien</span></td>\n\t\t</tr>\n\t</tbody>\n</table>\n<p style="text-align:left;">\n\t<span style="font-size:36px;">&shy;</span></p>\n'}]}]};
  return{basic_samples:basic_samples, samplesv01:samplesv01, fc_sample:fc_sample, samples_vtour:samples_vtour, full_samples:full_samples, quiz_samples:quiz_samples, magnetic_gifs:magnetic_gifs, new_wysiwyg:new_wysiwyg}
}(VISH);
VISH.Samples.API = function(V, undefined) {
  var recommendationList = [{"id":"1", "url":"http://vishub.org/excursions/144", "title":"Nanogame", "author":"ebarra", "description":" bla bla bla", "image":"http://vishub.org/assets/logos/original/excursion-05.png", "views":"56", "favourites":"3", "number_of_slides":"8"}, {"id":"2", "url":"http://vishub.org/excursions/83", "title":"Flascard Curiosity in my title long", "author":"aldo", "description":" bla bla bla 2", "image":"http://vishub.org/assets/logos/original/excursion-07.png", "views":"563", 
  "favourites":"13", "number_of_slides":"2"}, {"id":"3", "url":"http://vishub.org/excursions/55", "title":"Nanogame by UCAM or by her friend", "author":"nestor", "description":" bla bla bla", "image":"http://vishub.org/assets/logos/original/excursion-08.png", "views":"56", "favourites":"33", "number_of_slides":"8"}, {"id":"4", "url":"http://vishub.org/excursions/14", "title":"Heart", "author":"ebarra", "description":" bla bla bla", "image":"http://vishub.org/assets/logos/original/excursion-15.png", 
  "views":"156", "favourites":"3", "number_of_slides":"8"}, {"id":"5", "url":"http://vishub.org/excursions/81", "title":"Flascard Curiosity", "author":"aldo", "description":" bla bla bla 2", "image":"http://vishub.org/assets/logos/original/excursion-17.png", "views":"463", "favourites":"23", "number_of_slides":"2"}, {"id":"6", "url":"http://vishub.org/excursions/56", "title":"Nanogame", "author":"nestor", "description":" bla bla bla", "image":"http://vishub.org/assets/logos/original/excursion-18.png", 
  "views":"1256", "favourites":"33", "number_of_slides":"8"}];
  var excursionsList = {"excursions":[VISH.Samples.full_samples, VISH.Samples.quiz_samples, VISH.Samples.magnetic_gifs, VISH.Samples.basic_samples, VISH.Samples.fc_sample, VISH.Samples.samples_vtour, VISH.Samples.samplesv01]};
  var flashcardList = {"flashcards":[{"id":"1120", "VEVersion":"0.2", "type":"flashcard", "author":"", "slides":[{"id":"article4", "type":"flashcard", "background":"url(http://4.bp.blogspot.com/-fsV8poJXoJc/ULe8nkVbaVI/AAAAAAAAA-M/Q2vW16z6Ivc/s1600/Imagen16.png)", "pois":[{"id":"article4_poi1", "x":"36.875", "y":"67.33333333333333", "slide_id":"article4_article1"}, {"id":"article4_poi2", "x":"55.375", "y":"68.16666666666667", "slide_id":"article4_article2"}, {"id":"article4_poi3", "x":"45.875", "y":"5.5", 
  "slide_id":"article4_article3"}], "slides":[{"id":"article4_article1", "type":"standard", "template":"t2", "elements":[{"id":"article4_article1_zone1", "type":"image", "areaid":"left", "body":"http://1.bp.blogspot.com/_KaMLeO20q1Q/TGk8gfWkp7I/AAAAAAAAAHI/80bTifiIk6M/s1600/24+Do%C3%B1ana.JPG", "style":"position: relative; width:110.31518624641834%; height:97.1590909090909%; top:2.0833333333333335%; left:-1.146131805157593%;"}]}, {"id":"article4_article2", "type":"standard", "template":"t2", "elements":[{"id":"article4_article2_zone1", 
  "type":"image", "areaid":"left", "body":"http://farm9.staticflickr.com/8504/8367119464_f8ff09456d.jpg", "style":"position: relative; width:103.15186246418338%; height:90.53030303030303%; top:3.0303030303030303%; left:-0.5730659025787965%;"}]}, {"id":"article4_article3", "type":"standard", "template":"t2", "elements":[{"id":"article4_article3_zone1", "type":"image", "areaid":"left", "body":"http://cabeceras.eldiariomontanes.es/imagenes-municipios/galerias/5348/mf01z4411811x1492-452.jpg", "style":"position: relative; width:119.05444126074498%; height:129.54545454545453%; top:-2.6515151515151514%; left:-3.5816618911174785%;"}]}]}]}, 
  {"id":"1115", "VEVersion":"0.2", "type":"flashcard", "author":"", "slides":[{"id":"article4", "type":"flashcard", "background":"url(http://www.exploringnature.org/graphics/endangered_species/endangered_animals200.jpg)", "pois":[{"id":"article4_poi1", "x":"15.625", "y":"8.5", "slide_id":"article4_article3"}, {"id":"article4_poi2", "x":"77.75", "y":"11.5", "slide_id":"article4_article1"}, {"id":"article4_poi3", "x":"17.125", "y":"58.833333333333336", "slide_id":"article4_article2"}], "slides":[{"id":"article4_article3", 
  "type":"standard", "template":"t10", "elements":[{"id":"article4_article3_zone1", "type":"image", "areaid":"center", "body":"http://d30mmglg94tqnw.cloudfront.net/wp-content/plugins/magic-gallery/uploads/12/komodo-dragon_6771_600x450.jpg", "style":"position: relative; width:49.62406015037594%; height:66.22073578595318%; top:15.719063545150501%; left:24.18546365914787%;"}]}, {"id":"article4_article1", "type":"standard", "template":"t10", "elements":[{"id":"article4_article1_zone1", "type":"image", 
  "areaid":"center", "body":"http://www.golden-gate-park.com/wp-content/uploads/2011/03/bison_bufflo_in_golden_gate_park.jpg", "style":"position: relative; width:60.526315789473685%; height:67.3913043478261%; top:15.719063545150501%; left:20.17543859649123%;"}]}, {"id":"article4_article2", "type":"standard", "template":"t10", "elements":[{"id":"article4_article2_zone1", "type":"image", "areaid":"center", "body":"http://wfiles.brothersoft.com/e/elephant_88059-1600x1200.jpg", "style":"position: relative; width:115.91478696741855%; height:116.05351170568562%; top:-2.842809364548495%; left:-0.7518796992481203%;"}]}]}]}, 
  {"id":"111", "title":"Chess: The Art of Learning", "description":"The Art of Learning, a journey in the pursuit of excellence.\nAmazing presentation with images, videos and 3d objects, generated by Vish Editor.", "avatar":"/vishEditor/images/excursion_thumbnails/excursion-10.png", "author":"John Doe", "type":"flashcard", "tags":["Samples", "Test", "Development"], "author":"", "theme":"theme1", "age_range":"4 - 14", "subject":"Media Education", "language":"en", "educational_objectives":"bla bla bla 3", 
  "adquired_competencies":"pupils will be smarter", "slides":[{"id":"article1", "type":"flashcard", "background":"url(http://html.rincondelvago.com/000563580.png)", "pois":[{"id":"article1_poi1", "x":"11", "y":"4.5", "slide_id":"article1_article1"}, {"id":"article1_poi2", "x":"47", "y":"34", "slide_id":"article1_article2"}, {"id":"article1_poi3", "x":"84", "y":"81", "slide_id":"article1_article3"}], "slides":[{"id":"article1_article1", "template":"t1", "elements":[{"id":"article1_article1_zone1", 
  "type":"image", "areaid":"left", "body":"http://blogs.20minutos.es/cronicaverde/files/parque_nacional_donana_lince_iberico.jpg", "style":"position: relative; width:97.82608695652173%; height:80.10752688172043%; top:0%; left:0%;"}, {"id":"article1_article1_zone2", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6" style="text-align: center; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="font-family: helvetica;"><span style="font-weight: bold;">Chess</span>: The Art of Learning</span></span><br></span></div>'}, 
  {"id":"article1_article1_zone3", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font3 vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="font-style: italic; font-family: helvetica;">by Aldo Gordillo&nbsp; </span></span><br></span></div>'}]}, {"id":"article1_article2", "template":"t2", "elements":[{"id":"article1_article2_zone1", "type":"text", 
  "areaid":"header", "body":"Experimento virtual1"}, {"id":"article1_article2_zone2", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash"></embed>'}]}, {"id":"article1_article3", "template":"t6", "elements":[{"id":"article1_article3_zone1", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6 vish-parent-font4" style="font-weight: normal; "><span class="vish-font3 vish-fontHelvetica" style=""><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(219, 150, 0);">Iberian</span></span><span class="vish-font6 vish-fontHelvetica" style="undefined;"> </span><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(32, 24, 21);">Lynx</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="color: rgb(113, 113, 117);">Reproduction</span></span><br></span></div>'}, 
  {"id":"article1_article3_zone2", "type":"image", "areaid":"left", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:380.95238095238096%; height:218.69565217391303%; top:-36.231884541718856%; left:-58.201090494791664%;"}, {"id":"article1_article3_zone3", "type":"image", "areaid":"center", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:357.14285714285717%; height:205.2173913043478%; top:-45.41062894074813%; left:-193.12174479166666%;"}, 
  {"id":"article1_article3_zone4", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font2" style="text-align: center; font-weight: normal; "><span class="vish-font2 vish-fontHelvetica" style="">During the mating season the female leaves her territory in search of a male. The typical gestation period is about two months; the cubs are born between March and September, with a peak of births in March and April. A litter consists of two or three (rarely one, four or five) kittens weighing between 200 and 250 grams (7.1 and 8.8 oz).The kittens become independent at seven to 10 months old, but remain with the mother until around 20 months old. Survival of the young depends heavily on the availability of prey species. In the wild, both males and females reach sexual maturity at one year old, though in practice they rarely breed until a territory becomes vacant; one female was known not to breed until five years old when its mother died.</span></div>'}]}]}]}, 
  {"id":"222", "title":"Curiosity", "description":"The Art of Learning, a journey in the pursuit of excellence.\nAmazing presentation with images, videos and 3d objects, generated by Vish Editor.", "avatar":"/vishEditor/images/excursion_thumbnails/excursion-12.png", "author":"Comepiedras volador", "type":"flashcard", "tags":["Samples", "Test", "Development"], "theme":"theme1", "age_range":"4 - 14", "subject":"Media Education", "language":"en", "educational_objectives":"Known the comepiedras volador", 
  "adquired_competencies":"pupils will be smarter", "slides":[{"id":"article1", "type":"flashcard", "background":"url(http://images.freshnessmag.com/wp-content/uploads//2012/08/nasa-NASA-curiosity-mars-rover-00.jpg)", "pois":[{"id":"article1_poi1", "x":"11", "y":"4.5", "slide_id":"article1_article1"}, {"id":"article1_poi2", "x":"47", "y":"34", "slide_id":"article1_article2"}, {"id":"article1_poi3", "x":"84", "y":"81", "slide_id":"article1_article3"}], "slides":[{"id":"article1_article1", "template":"t1", 
  "elements":[{"id":"article1_article1_zone1", "type":"image", "areaid":"left", "body":"http://blogs.20minutos.es/cronicaverde/files/parque_nacional_donana_lince_iberico.jpg", "style":"position: relative; width:97.82608695652173%; height:80.10752688172043%; top:0%; left:0%;"}, {"id":"article1_article1_zone2", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6" style="text-align: center; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="font-family: helvetica;"><span style="font-weight: bold;">Chess</span>: The Art of Learning</span></span><br></span></div>'}, 
  {"id":"article1_article1_zone3", "type":"text", "areaid":"subheader", "body":'<div class="vish-parent-font3 vish-parent-font4" style="text-align: right; font-weight: normal; "><span class="vish-font3 vish-fontarial"><span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="font-style: italic; font-family: helvetica;">by Aldo Gordillo&nbsp; </span></span><br></span></div>'}]}, {"id":"article1_article2", "template":"t2", "elements":[{"id":"article1_article2_zone1", "type":"text", 
  "areaid":"header", "body":"Experimento virtual1"}, {"id":"article1_article2_zone2", "type":"object", "areaid":"left", "body":'<embed width="99%" height="99%" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash"></embed>'}]}, {"id":"article1_article3", "template":"t6", "elements":[{"id":"article1_article3_zone1", "type":"text", "areaid":"header", "body":'<div class="vish-parent-font3 vish-parent-font6 vish-parent-font4" style="font-weight: normal; "><span class="vish-font3 vish-fontHelvetica" style=""><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(219, 150, 0);">Iberian</span></span><span class="vish-font6 vish-fontHelvetica" style="undefined;"> </span><span class="vish-font6 vish-fontHelvetica" style="undefined;"><span style="color: rgb(32, 24, 21);">Lynx</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="vish-font4 vish-fontHelvetica" style="undefined;"><span style="color: rgb(113, 113, 117);">Reproduction</span></span><br></span></div>'}, 
  {"id":"article1_article3_zone2", "type":"image", "areaid":"left", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:380.95238095238096%; height:218.69565217391303%; top:-36.231884541718856%; left:-58.201090494791664%;"}, {"id":"article1_article3_zone3", "type":"image", "areaid":"center", "body":"http://i13.photobucket.com/albums/a288/inkslinger0611/drawings/Iberian.jpg", "style":"position: relative; width:357.14285714285717%; height:205.2173913043478%; top:-45.41062894074813%; left:-193.12174479166666%;"}, 
  {"id":"article1_article3_zone4", "type":"text", "areaid":"right", "body":'<div class="vish-parent-font2" style="text-align: center; font-weight: normal; "><span class="vish-font2 vish-fontHelvetica" style="">During the mating season the female leaves her territory in search of a male. The typical gestation period is about two months; the cubs are born between March and September, with a peak of births in March and April. A litter consists of two or three (rarely one, four or five) kittens weighing between 200 and 250 grams (7.1 and 8.8 oz).The kittens become independent at seven to 10 months old, but remain with the mother until around 20 months old. Survival of the young depends heavily on the availability of prey species. In the wild, both males and females reach sexual maturity at one year old, though in practice they rarely breed until a territory becomes vacant; one female was known not to breed until five years old when its mother died.</span></div>'}]}]}]}]};
  var smartcardList = {"excursions":[flashcardList.flashcards[0], flashcardList.flashcards[1], flashcardList.flashcards[2], flashcardList.flashcards[3], flashcardList.flashcards[3], flashcardList.flashcards[3], VISH.Samples.fc_sample, VISH.Samples.samples_vtour]};
  var imageList = {"pictures":[{"id":54, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.dan-dare.org/dan%20simpsons/TheSimpsonsEveryoneEver800.jpg"}, {"id":55, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://3.bp.blogspot.com/--H0o8mc28bA/TxrsnMAFMDI/AAAAAAAAARs/eOCVIXKlm9I/s1600/sala-cine.jpg"}, {"id":56, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}, 
  {"id":57, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.granadablogs.com/pateandoelmundo/wp-content/uploads/2009/10/_061.jpg"}, {"id":58, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.revistaintime.com/wp-content/uploads/2012/03/el-padrino-2.jpg"}, {"id":59, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://cinealdesnudo.files.wordpress.com/2011/12/el-indomable-will-hunting.jpg"}, {"id":60, 
  "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://politicamenteconservador.blogia.com/upload/20060818041914-el-senor-de-los-anillos2.jpg"}, {"id":61, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://despertando.me/wp-content/uploads/2012/04/el-se%C3%B1or-de-los-anillos.jpg"}, {"id":62, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://4.bp.blogspot.com/-Fh_v8PYbVg0/TyGdKEiYmKI/AAAAAAAAAPI/MKdfZ224aEQ/s1600/el_senor_de_los_anillos_la_batalla_por_la_tierra_media_2_the_rise_of_the_witchking-181035.jpg"}, 
  {"id":63, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://1.bp.blogspot.com/_9PpLM82o3g0/S8uPONu3kaI/AAAAAAAAC9A/thHNALuFxdE/s1600/Gandalf-vs-El-Balrog-gandalf-7018563-1280-960.jpg"}, {"id":64, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"NOVAACARGAR"}, {"id":65, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}, {"id":66, "title":"ClintEastwood.jpg", 
  "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}, {"id":67, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}, {"id":68, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}, {"id":69, "title":"ClintEastwoooood.jpg", "description":"this is clint", 
  "author":"Demo", "src":"http://upload.wikimedia.org/wikipedia/en/4/47/Simpsons_on_Tracey_Ullman.png"}]};
  var imageListLittle = {"pictures":[{"id":54, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.dan-dare.org/dan%20simpsons/TheSimpsonsEveryoneEver800.jpg"}, {"id":55, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://3.bp.blogspot.com/--H0o8mc28bA/TxrsnMAFMDI/AAAAAAAAARs/eOCVIXKlm9I/s1600/sala-cine.jpg"}, {"id":56, "title":"ClintEastwood.jpg", "description":null, "author":"Demo", "src":"http://www.deviantart.com/download/46036660/The_Simpsonzu_by_spacecoyote.jpg"}]};
  var imageListDummy = {"pictures":[]};
  var video = {"id":"1534", "title":"Midnight Sun", "description":"Awesome HTML5 video example", "author":"John Doe", "poster":"http://d1p69vb2iuddhr.cloudfront.net/assets/www/demo/midnight_sun_800-e460322294501e1d5db9ab3859dd859a.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"};
  var videoList = {"videos":[{"id":"1534", "title":"HTML5 Demo", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML. HTML5 especifica dos variantes de sintaxis para HTML: un clasico HTML (text/html), la variante conocida como HTML5 y una variante XHTML conocida como sintaxis XHTML5 que debera ser servida como XML (XHTML) (application/xhtml+xml).1 2 Esta es la primera vez que HTML y XHTML se han desarrollado en paralelo.", 
  "author":"Awesome Videos", "poster":"http://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Sasso_lungo_da_passo_pordoi.jpg/250px-Sasso_lungo_da_passo_pordoi.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1535", "title":"Paisaje bonito", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", 
  "poster":"http://d1p69vb2iuddhr.cloudfront.net/assets/www/demo/midnight_sun_800-e460322294501e1d5db9ab3859dd859a.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1536", "title":"Otro paisaje bonito", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://1.bp.blogspot.com/-DFj9INluj80/TfiNl7q3DbI/AAAAAAAAAws/hVJu13VbKEY/s1600/paisaje.jpg", 
  "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1537", "title":"Verde", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://www.forodefotos.com/attachments/naturaleza/12983d1281113830-fotos-de-paisaje-fotos-de-paisaje.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + 
  '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1538", "title":"Noche", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://ro18.blogspot.es/img/paisaje.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1539", 
  "title":"Puesta de sol", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://walpaper.es/images/wallpapers/Paisaje-fotografia-HDR-656343.jpeg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1540", "title":"Cayuco", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", 
  "poster":"http://3.bp.blogspot.com/-a-WrZZf0WJo/TsEBPXjUQXI/AAAAAAAAFBg/kh0aS9Kemag/s1600/PAISAJE+JUANMA.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1541", "title":"Aves", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://images.artelista.com/artelista/obras/fichas/8/3/3/8619208014133041.JPG", 
  "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1542", "title":"Delfines", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://4.bp.blogspot.com/-CfZKEdXcXtg/TijG57sIFWI/AAAAAAAAARQ/O8FP1OQ0a0w/s1600/delfines-saltando.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + 
  '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1543", "title":"Gato", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://www.10puntos.com/wp-content/uploads/2010/09/gato-lindo.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + 
  "]"}, {"id":"1544", "title":"Otro gato", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://neko.koiora.net/files/2011/06/Gato17.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1545", "title":"Gato ninja", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", 
  "poster":"http://www.sarda.es/fotos/gato_volador/gato_volador.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}]};
  var videoListLittle = {"videos":[{"id":"1534", "title":"HTML5 Demo", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML. HTML5 especifica dos variantes de sintaxis para HTML: un clasico HTML (text/html), la variante conocida como HTML5 y una variante XHTML conocida como sintaxis XHTML5 que debera ser servida como XML (XHTML) (application/xhtml+xml).1 2 Esta es la primera vez que HTML y XHTML se han desarrollado en paralelo.", 
  "author":"Awesome Videos", "poster":"http://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Sasso_lungo_da_passo_pordoi.jpg/250px-Sasso_lungo_da_passo_pordoi.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1535", "title":"Paisaje bonito", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", 
  "poster":"http://d1p69vb2iuddhr.cloudfront.net/assets/www/demo/midnight_sun_800-e460322294501e1d5db9ab3859dd859a.jpg", "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}, {"id":"1536", "title":"Otro paisaje bonito", "description":"Awesome HTML5 video example", "author":"Aldo Gordillo", "poster":"http://1.bp.blogspot.com/-DFj9INluj80/TfiNl7q3DbI/AAAAAAAAAws/hVJu13VbKEY/s1600/paisaje.jpg", 
  "sources":"[" + '{ "type": "video/webm", "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_720p.webm"},' + '{ "type": "video/mp4",  "src": "http://media.jilion.com/videos/demo/midnight_sun_sv1_360p.mp4" }' + "]"}]};
  var videoListDummy = {"videos":[]};
  var flashList = {"flashes":[{"id":"1534", "title":"Profe", "description":"Flash Object Test", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1535", "title":"Youtube video about HTML5", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML.", "author":"W3C", 
  "content":'<iframe width="560" height="315" src="http://www.youtube.com/embed/1hR7EtD6Bns?wmode=opaque" frameborder="0" allowfullscreen></iframe>'}, {"id":"1536", "title":"Global excursion", "description":"Iframe example", "author":"Vish", "content":'<iframe width="100%" height="100%" src="http://www.globalexcursion-project.eu"></iframe>'}, {"id":"1537", "title":"Image", "description":"Image Embed", "author":"Globedia", "content":'<embed width="100%" src="http://globedia.com/imagenes/noticias/2011/2/10/encuentran-octava-maravilla-mundo-destruida-125-anos_2_585286.jpg"></embed>'}, 
  {"id":"1538", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1539", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, 
  {"id":"1540", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1541", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, 
  {"id":"1542", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1543", "title":"Youtube video", "description":"Flash Object Test 2", "author":"FlashMan", "content":'<iframe width="560" height="315" src="http://www.youtube.com/embed/1hR7EtD6Bns" frameborder="0" allowfullscreen></iframe>'}]};
  var flashListLittle = {"flashes":[{"id":"1534", "title":"Profe", "description":"Flash Object Test", "author":"FlashMan", "content":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1535", "title":"Youtube video about HTML5", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML.", "author":"W3C", 
  "content":'<iframe width="560" height="315" src="http://www.youtube.com/embed/1hR7EtD6Bns?wmode=opaque" frameborder="0" allowfullscreen></iframe>'}, {"id":"1536", "title":"Global excursion", "description":"Iframe example", "author":"Vish", "content":'<iframe width="100%" height="100%" src="http://www.globalexcursion-project.eu"></iframe>'}]};
  var flashListDummy = {"flashes":[]};
  var liveList = [{"id":"1534", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1535", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1536", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, 
  {"id":"1537", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1538", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1539", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, 
  {"id":"1540", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1541", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1542", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, 
  {"id":"1543", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1544", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1545", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, 
  {"id":"1546", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1547", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1548", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}];
  var liveListLittle = [{"id":"1534", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1535", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}, {"id":"1548", "title":"Do\u00f1ana Test", "description":"Parque Nacional de Do\u00f1ana (Spain) ", "author":"Demo", "fulltext":"http://www.youtube.com/watch?v=5TVrUFxzOk8"}];
  var liveListDummy = [];
  var objectList = [{"id":"1534", "title":"Game Strauss", "description":"Fichero PDF", "author":"Conspirazzi", "object":"http://www.conspirazzi.com/e-books/game-strauss.pdf"}, {"id":"1536", "title":"Profe", "description":"Flash Object Test", "author":"FlashMan", "object":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1537", "title":"Youtube video about HTML5", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML.", 
  "author":"W3C", "object":'<iframe width="560" height="315" src="http://www.youtube.com/embed/1hR7EtD6Bns?wmode=opaque" frameborder="0" allowfullscreen></iframe>'}, {"id":"1538", "title":"Global excursion", "description":"Iframe example", "author":"Vish", "object":'<iframe width="100%" height="100%" src="http://www.globalexcursion-project.eu"></iframe>'}, {"id":"1539", "title":"Image", "description":"Image Embed", "author":"Globedia", "object":'<embed width="100%" src="http://globedia.com/imagenes/noticias/2011/2/10/encuentran-octava-maravilla-mundo-destruida-125-anos_2_585286.jpg"></embed>'}, 
  {"id":"1540", "title":"Profe Demo", "description":"Flash Object Test 2", "author":"FlashMan", "object":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}];
  var objectListLittle = [{"id":"1534", "title":"Game Strauss", "description":"Fichero PDF", "author":"Conspirazzi", "object":"http://www.conspirazzi.com/e-books/game-strauss.pdf"}, {"id":"1536", "title":"Profe", "description":"Flash Object Test", "author":"FlashMan", "object":'<embed width="100%" height="100%" id="player_api" src="examples/contents/swf/virtualexperiment.swf" type="application/x-shockwave-flash" wmode="opaque"></embed>'}, {"id":"1537", "title":"Youtube video about HTML5", "description":"HTML5 (HyperText Markup Language, version 5) es la quinta revision importante del lenguaje basico de la World Wide Web, HTML.", 
  "author":"W3C", "object":'<iframe width="560" height="315" src="http://www.youtube.com/embed/1hR7EtD6Bns?wmode=opaque" frameborder="0" allowfullscreen></iframe>'}];
  var objectListDummy = [];
  var tagsList = {"tags":["ActionScript", "AppleScript", "Asp", "BASIC", "C", "C++", "Clojure", "COBOL", "ColdFusion", "Erlang", "Fortran", "Groovy", "Haskell", "Java", "JavaScript", "Lisp", "Perl", "PHP", "Python", "Ruby", "Scala", "Scheme"]};
  var thumbnailsList = {"pictures":[{"title":"Thumbnail 1", "description":"Sample excursion thumbnail 1", "src":"/vishEditor/images/excursion_thumbnails/excursion-01.png"}, {"title":"Thumbnail 2", "description":"Sample excursion thumbnail 2", "src":"/vishEditor/images/excursion_thumbnails/excursion-02.png"}, {"title":"Thumbnail 3", "description":"Sample excursion thumbnail 3", "src":"/vishEditor/images/excursion_thumbnails/excursion-03.png"}, {"title":"Thumbnail 4", "description":"Sample excursion thumbnail 4", 
  "src":"/vishEditor/images/excursion_thumbnails/excursion-04.png"}, {"title":"Thumbnail 5", "description":"Sample excursion thumbnail 5", "src":"/vishEditor/images/excursion_thumbnails/excursion-05.png"}, {"title":"Thumbnail 6", "description":"Sample excursion thumbnail 6", "src":"/vishEditor/images/excursion_thumbnails/excursion-06.png"}, {"title":"Thumbnail 7", "description":"Sample excursion thumbnail 7", "src":"/vishEditor/images/excursion_thumbnails/excursion-07.png"}, {"title":"Thumbnail 8", 
  "description":"Sample excursion thumbnail 8", "src":"/vishEditor/images/excursion_thumbnails/excursion-08.png"}, {"title":"Thumbnail 9", "description":"Sample excursion thumbnail 9", "src":"/vishEditor/images/excursion_thumbnails/excursion-09.png"}, {"title":"Thumbnail 10", "description":"Sample excursion thumbnail 10", "src":"/vishEditor/images/excursion_thumbnails/excursion-10.png"}, {"title":"Thumbnail 11", "description":"Sample excursion thumbnail 11", "src":"/vishEditor/images/excursion_thumbnails/excursion-11.png"}, 
  {"title":"Thumbnail 12", "description":"Sample excursion thumbnail 12", "src":"/vishEditor/images/excursion_thumbnails/excursion-12.png"}, {"title":"Thumbnail 13", "description":"Sample excursion thumbnail 13", "src":"/vishEditor/images/excursion_thumbnails/excursion-13.png"}, {"title":"Thumbnail 14", "description":"Sample excursion thumbnail 14", "src":"/vishEditor/images/excursion_thumbnails/excursion-14.png"}, {"title":"Thumbnail 15", "description":"Sample excursion thumbnail 15", "src":"/vishEditor/images/excursion_thumbnails/excursion-15.png"}, 
  {"title":"Thumbnail 16", "description":"Sample excursion thumbnail 16", "src":"/vishEditor/images/excursion_thumbnails/excursion-16.png"}, {"title":"Thumbnail 17", "description":"Sample excursion thumbnail 17", "src":"/vishEditor/images/excursion_thumbnails/excursion-17.png"}, {"title":"Thumbnail 18", "description":"Sample excursion thumbnail 18", "src":"/vishEditor/images/excursion_thumbnails/excursion-18.png"}, {"title":"Thumbnail 19", "description":"Sample excursion thumbnail 19", "src":"/vishEditor/images/excursion_thumbnails/excursion-19.png"}, 
  {"title":"Thumbnail 20", "description":"Sample excursion thumbnail 20", "src":"/vishEditor/images/excursion_thumbnails/excursion-20.png"}, {"title":"Thumbnail 21", "description":"Sample excursion thumbnail 21", "src":"/vishEditor/images/excursion_thumbnails/excursion-21.png"}, {"title":"Thumbnail 22", "description":"Sample excursion thumbnail 22", "src":"/vishEditor/images/excursion_thumbnails/excursion-22.png"}, {"title":"Thumbnail 23", "description":"Sample excursion thumbnail 23", "src":"/vishEditor/images/excursion_thumbnails/excursion-23.png"}, 
  {"title":"Thumbnail 24", "description":"Sample excursion thumbnail 24", "src":"/vishEditor/images/excursion_thumbnails/excursion-24.png"}, {"title":"Thumbnail 25", "description":"Sample excursion thumbnail 25", "src":"/vishEditor/images/excursion_thumbnails/excursion-25.png"}, {"title":"Thumbnail 26", "description":"Sample excursion thumbnail 26", "src":"/vishEditor/images/excursion_thumbnails/excursion-26.png"}, {"title":"Thumbnail 27", "description":"Sample excursion thumbnail 27", "src":"/vishEditor/images/excursion_thumbnails/excursion-27.png"}, 
  {"title":"Thumbnail 28", "description":"Sample excursion thumbnail 28", "src":"/vishEditor/images/excursion_thumbnails/excursion-28.png"}, {"title":"Thumbnail 29", "description":"Sample excursion thumbnail 29", "src":"/vishEditor/images/excursion_thumbnails/excursion-29.png"}, {"title":"Thumbnail 30", "description":"Sample excursion thumbnail 30", "src":"/vishEditor/images/excursion_thumbnails/excursion-30.png"}]};
  return{recommendationList:recommendationList, excursionsList:excursionsList, smartcardList:smartcardList, flashcardList:flashcardList, imageList:imageList, imageListLittle:imageListLittle, imageListDummy:imageListDummy, videoList:videoList, videoListLittle:videoListLittle, videoListDummy:videoListDummy, flashList:flashList, flashListLittle:flashListLittle, flashListDummy:flashListDummy, liveList:liveList, liveListLittle:liveListLittle, liveListDummy:liveListDummy, objectList:objectList, objectListLittle:objectListLittle, 
  objectListDummy:objectListDummy, tagsList:tagsList, thumbnailsList:thumbnailsList}
}(VISH);
VISH.Slides = function(V, $, undefined) {
  var slideEls;
  var curSlideIndex;
  var SLIDE_CLASSES = ["far-past", "past", "current", "next", "far-next"];
  var curSubSlideId = null;
  var init = function() {
    _getcurSlideIndexFromHash();
    $(document).bind("OURDOMContentLoaded", handleDomLoaded)
  };
  var handleDomLoaded = function() {
    slideEls = document.querySelectorAll("section.slides > article");
    if(isSlideset(V.SlideManager.getPresentationType())) {
      setCurrentSlideIndex(0)
    }
    updateSlides(true);
    $("body").addClass("loaded")
  };
  var _getcurSlideIndexFromHash = function() {
    var slideNo = parseInt(location.hash.substr(1));
    if(slideNo) {
      setCurrentSlideIndex(slideNo - 1)
    }else {
      if(V.Editing) {
        setCurrentSlideIndex(-1)
      }else {
        setCurrentSlideIndex(0)
      }
    }
  };
  var getSlides = function() {
    return slideEls
  };
  var setSlides = function(newSlideEls) {
    slideEls = newSlideEls
  };
  var updateSlides = function(goingRight) {
    updateSlideEls();
    if(goingRight) {
      triggerLeaveEvent(curSlideIndex - 1)
    }else {
      triggerLeaveEvent(curSlideIndex + 1)
    }
    triggerEnterEvent(curSlideIndex);
    _updateHash()
  };
  var _updateHash = function() {
    location.replace("#" + (curSlideIndex + 1))
  };
  var updateSlideEls = function() {
    for(var i = 0;i < slideEls.length;i++) {
      switch(i) {
        case curSlideIndex - 2:
          updateSlideClass(i, "far-past");
          break;
        case curSlideIndex - 1:
          updateSlideClass(i, "past");
          break;
        case curSlideIndex:
          updateSlideClass(i, "current");
          break;
        case curSlideIndex + 1:
          updateSlideClass(i, "next");
          break;
        case curSlideIndex + 2:
          updateSlideClass(i, "far-next");
          break;
        default:
          updateSlideClass(i);
          break
      }
    }
  };
  var updateSlideClass = function(slideNo, className) {
    var el = _getSlide(slideNo);
    if(!el) {
      return
    }
    if(className) {
      $(el).addClass(className)
    }
    for(var i in SLIDE_CLASSES) {
      if(className != SLIDE_CLASSES[i]) {
        $(el).removeClass(SLIDE_CLASSES[i])
      }
    }
  };
  var setCurrentSlideIndex = function(newCurSlideIndex) {
    curSlideIndex = newCurSlideIndex
  };
  var getCurrentSlide = function() {
    return slideEls[curSlideIndex]
  };
  var getCurrentSubSlide = function() {
    if(curSubSlideId === null) {
      return null
    }else {
      return $("#" + curSubSlideId)
    }
  };
  var getCurrentSlideNumber = function() {
    return curSlideIndex + 1
  };
  var setCurrentSlideNumber = function(currentSlideNumber) {
    setCurrentSlideIndex(currentSlideNumber - 1)
  };
  var _getSlide = function(no) {
    return getSlideWithNumber(no + 1)
  };
  var getSlideWithNumber = function(slideNumber) {
    var no = slideNumber - 1;
    if(no < 0 || no >= slideEls.length) {
      return null
    }else {
      return slideEls[no]
    }
  };
  var getNumberOfSlide = function(slide) {
    if(slideEls) {
      var result = 0;
      $.each(slideEls, function(index, value) {
        if($(value).attr("id") == $(slide).attr("id")) {
          result = index;
          return
        }
      });
      return result
    }else {
      return 0
    }
  };
  var getSlidesQuantity = function() {
    return getSlides().length
  };
  var getSlideType = function(slideEl) {
    if(slideEl && slideEl.tagName === "ARTICLE") {
      switch($(slideEl).attr("type")) {
        case undefined:
        ;
        case V.Constant.STANDARD:
          return V.Constant.STANDARD;
          break;
        case V.Constant.FLASHCARD:
          return V.Constant.FLASHCARD;
          break;
        case V.Constant.QUIZ_SIMPLE:
          return V.Constant.QUIZ_SIMPLE;
          break;
        case V.Constant.GAME:
          return V.Constant.GAME;
          break;
        case V.Constant.VTOUR:
          return V.Constant.VTOUR;
          break;
        default:
          return V.Constant.UNKNOWN;
          break
      }
    }else {
      return null
    }
  };
  var isCurrentFirstSlide = function() {
    return curSlideIndex === 0
  };
  var isCurrentLastSlide = function() {
    return curSlideIndex === slideEls.length - 1
  };
  var triggerEnterEvent = function(no) {
    var el = _getSlide(no);
    if(!el) {
      return
    }
    _triggerEnterEventById(el.id)
  };
  var triggerLeaveEvent = function(no) {
    var el = _getSlide(no);
    if(!el) {
      return
    }
    _triggerLeaveEventById(el.id)
  };
  var _triggerEnterEventById = function(slide_id) {
    var el = $("#" + slide_id)[0];
    var onEnter = el.getAttribute("onslideenter");
    if(onEnter) {
      (new Function(onEnter)).call(el)
    }
    var evt = document.createEvent("Event");
    evt.initEvent("slideenter", true, true);
    el.dispatchEvent(evt)
  };
  var _triggerLeaveEventById = function(slide_id) {
    var el = $("#" + slide_id)[0];
    var onLeave = el.getAttribute("onslideleave");
    if(onLeave) {
      (new Function(onLeave)).call(el)
    }
    var evt = document.createEvent("Event");
    evt.initEvent("slideleave", true, true);
    el.dispatchEvent(evt)
  };
  var _prevSlide = function() {
    if(curSlideIndex > 0) {
      setCurrentSlideIndex(curSlideIndex - 1);
      updateSlides(false)
    }
  };
  var _nextSlide = function() {
    if(curSlideIndex < slideEls.length - 1) {
      setCurrentSlideIndex(curSlideIndex + 1);
      updateSlides(true)
    }
  };
  var forwardOneSlide = function(event) {
    if(isCurrentLastSlide() && V.Status.getDevice().desktop) {
      V.Recommendations.showFancybox()
    }else {
      goToSlide(curSlideIndex + 2)
    }
  };
  var backwardOneSlide = function() {
    goToSlide(curSlideIndex)
  };
  var goToSlide = function(no, triggeredByUser) {
    if(no === getCurrentSlideNumber()) {
      return
    }
    triggeredByUser = !(triggeredByUser === false);
    if(triggeredByUser && V.Status.isPreventDefaultMode() && V.Messenger) {
      var params = new Object;
      params.slideNumber = no;
      V.Messenger.notifyEventByMessage(V.Constant.Event.onGoToSlide, params);
      return
    }
    if(!V.Editing && $.fancybox) {
      $.fancybox.close()
    }
    if(no > slideEls.length || no <= 0) {
      return
    }else {
      if(no > curSlideIndex + 1) {
        while(curSlideIndex + 1 < no) {
          _nextSlide()
        }
      }else {
        if(no < curSlideIndex + 1) {
          while(curSlideIndex + 1 > no) {
            _prevSlide()
          }
        }
      }
    }
    if(V.Editing) {
      $(".selectable").css("border-style", "none");
      V.Editor.Tools.cleanZoneTools();
      V.Editor.Thumbnails.selectThumbnail(no)
    }else {
      V.SlideManager.updateSlideCounter()
    }
    var params = new Object;
    params.slideNumber = no;
    V.EventsNotifier.notifyEvent(V.Constant.Event.onGoToSlide, params, triggeredByUser)
  };
  var lastSlide = function() {
    goToSlide(slideEls.length)
  };
  var openSubslide = function(slide_id, triggeredByUser) {
    triggeredByUser = !(triggeredByUser === false);
    if(triggeredByUser && V.Status.isPreventDefaultMode() && V.Messenger) {
      var params = new Object;
      params.slideNumber = slide_id;
      V.Messenger.notifyEventByMessage(V.Constant.Event.onFlashcardPointClicked, params);
      return
    }
    _onOpenSubslide(slide_id);
    $("#" + slide_id).show();
    _triggerEnterEventById(slide_id);
    var params = new Object;
    params.slideNumber = slide_id;
    V.EventsNotifier.notifyEvent(V.Constant.Event.onFlashcardPointClicked, params, triggeredByUser)
  };
  var closeSubslide = function(slide_id, triggeredByUser) {
    triggeredByUser = !(triggeredByUser === false);
    if(triggeredByUser && V.Status.isPreventDefaultMode() && V.Messenger) {
      var params = new Object;
      params.slideNumber = slide_id;
      V.Messenger.notifyEventByMessage(V.Constant.Event.onFlashcardSlideClosed, params);
      return
    }
    _onCloseSubslide(slide_id);
    $("#" + slide_id).hide();
    _triggerLeaveEventById(slide_id);
    var params = new Object;
    params.slideNumber = slide_id;
    V.EventsNotifier.notifyEvent(V.Constant.Event.onFlashcardSlideClosed, params, triggeredByUser)
  };
  var _onOpenSubslide = function(subSlideId) {
    curSubSlideId = subSlideId;
    $("#closeButton").hide()
  };
  var _onCloseSubslide = function() {
    curSubSlideId = null;
    if(V.Status.getDevice().mobile) {
      setTimeout(function() {
        V.ViewerAdapter.decideIfCloseButton();
        V.ViewerAdapter.decideIfPageSwitcher()
      }, 800)
    }else {
      V.ViewerAdapter.decideIfPageSwitcher()
    }
  };
  var closeAllSlides = function() {
    $(".slides > article").hide()
  };
  var isSlideset = function(type) {
    switch(type) {
      case V.Constant.FLASHCARD:
      ;
      case V.Constant.VTOUR:
        return true;
      default:
        return false
    }
  };
  return{init:init, getSlides:getSlides, setSlides:setSlides, updateSlides:updateSlides, updateSlideEls:updateSlideEls, setCurrentSlideIndex:setCurrentSlideIndex, getCurrentSlide:getCurrentSlide, getCurrentSubSlide:getCurrentSubSlide, getCurrentSlideNumber:getCurrentSlideNumber, setCurrentSlideNumber:setCurrentSlideNumber, getSlideWithNumber:getSlideWithNumber, getNumberOfSlide:getNumberOfSlide, getSlidesQuantity:getSlidesQuantity, getSlideType:getSlideType, isCurrentFirstSlide:isCurrentFirstSlide, 
  isCurrentLastSlide:isCurrentLastSlide, forwardOneSlide:forwardOneSlide, backwardOneSlide:backwardOneSlide, goToSlide:goToSlide, lastSlide:lastSlide, openSubslide:openSubslide, closeSubslide:closeSubslide, closeAllSlides:closeAllSlides, isSlideset:isSlideset}
}(VISH, jQuery);
VISH.Events = function(V, $, undefined) {
  var eMobile;
  var bindedEventListeners = false;
  var mobile;
  var init = function() {
    mobile = !V.Status.getDevice().desktop;
    eMobile = V.Events.Mobile;
    if(!V.Editing) {
      eMobile.init();
      bindViewerEventListeners()
    }
  };
  var bindViewerEventListeners = function() {
    if(bindedEventListeners) {
      return
    }else {
      bindedEventListeners = true
    }
    $(document).bind("keydown", handleBodyKeyDown);
    $(document).on("click", "#page-switcher-start", function() {
      V.Slides.backwardOneSlide()
    });
    $(document).on("click", "#page-switcher-end", function() {
      V.Slides.forwardOneSlide()
    });
    $(document).on("click", "#closeButton", function(event) {
      event.stopPropagation();
      event.preventDefault();
      var comeBackUrl = V.SlideManager.getOptions()["comeBackUrl"];
      if(comeBackUrl) {
        window.top.location.href = V.SlideManager.getOptions()["comeBackUrl"]
      }else {
        if(V.Status.getIsEmbed() && V.Status.getDevice().features.history) {
          history.back()
        }
      }
    });
    $(document).on("click", "#back_arrow", function(event) {
      V.Slides.backwardOneSlide()
    });
    $(document).on("click", "#forward_arrow", function(event) {
      V.Slides.forwardOneSlide()
    });
    $(document).on("click", ".close_subslide", onFlashcardCloseSlideClicked);
    var presentation = V.SlideManager.getCurrentPresentation();
    for(index in presentation.slides) {
      var slide = presentation.slides[index];
      switch(slide.type) {
        case V.Constant.FLASHCARD:
          for(ind in slide.pois) {
            var poi = slide.pois[ind];
            $(document).on("click", "#" + poi.id, {poi_id:poi.id}, onFlashcardPoiClicked)
          }
          break;
        case V.Constant.VTOUR:
          break
      }
    }
    if(typeof applicationCache !== "undefined") {
      applicationCache.addEventListener("cached", function() {
        V.Storage.addPresentation(presentation)
      }, false);
      applicationCache.addEventListener("updateready", function() {
        V.Storage.addPresentation(presentation)
      }, false)
    }
    var multipleOnResize = undefined;
    window.onresize = function() {
      if(typeof multipleOnResize === "undefined") {
        multipleOnResize = false;
        setTimeout(function() {
          if(!multipleOnResize) {
            multipleOnResize = undefined;
            V.ViewerAdapter.updateInterface()
          }else {
            multipleOnResize = undefined;
            window.onresize()
          }
        }, 600)
      }else {
        multipleOnResize = true
      }
    };
    if(mobile) {
      eMobile.bindViewerMobileEventListeners()
    }
  };
  var unbindViewerEventListeners = function() {
    if(!bindedEventListeners) {
      return
    }else {
      bindedEventListeners = false
    }
    $(document).unbind("keydown", handleBodyKeyDown);
    $(document).off("click", "#page-switcher-start", V.Slides.backwardOneSlide);
    $(document).off("click", "#page-switcher-end", V.Slides.forwardOneSlide);
    $(document).off("click", "#back_arrow", V.Slides.backwardOneSlide);
    $(document).off("click", "#forward_arrow", V.Slides.forwardOneSlide);
    $(document).off("click", "#closeButton");
    $(document).off("click", ".close_subslide", onFlashcardCloseSlideClicked);
    var presentation = V.SlideManager.getCurrentPresentation();
    for(index in presentation.slides) {
      var slide = presentation.slides[index];
      switch(slide.type) {
        case V.Constant.FLASHCARD:
          for(ind in slide.pois) {
            var poi = slide.pois[ind];
            $(document).off("click", "#" + poi.id, {poi_id:poi.id}, onFlashcardPoiClicked)
          }
          break;
        case V.Constant.VTOUR:
          break
      }
    }
    if(typeof applicationCache !== "undefined") {
      applicationCache.removeEventListener("cached", function() {
        V.Storage.addPresentation(presentation)
      }, false);
      applicationCache.removeEventListener("updateready", function() {
        V.Storage.addPresentation(presentation)
      }, false)
    }
    if(mobile) {
      eMobile.unbindViewerMobileEventListeners()
    }
  };
  var handleBodyKeyDown = function(event) {
    switch(event.keyCode) {
      case 38:
      ;
      case 39:
        V.Slides.forwardOneSlide();
        event.preventDefault();
        break;
      case 37:
      ;
      case 40:
        V.Slides.backwardOneSlide();
        event.preventDefault();
        break
    }
  };
  var onFlashcardPoiClicked = function(event) {
    if(typeof event === "string") {
      var poiId = event
    }else {
      if(typeof event === "object") {
        var poiId = event.data.poi_id
      }else {
        return
      }
    }
    var poi = V.Flashcard.getPoiData(poiId);
    if(poi !== null) {
      V.Slides.openSubslide(poi.slide_id, true)
    }
  };
  var onFlashcardCloseSlideClicked = function(event) {
    var close_slide_id = event.target.id.substring(5);
    V.Slides.closeSubslide(close_slide_id, true)
  };
  return{init:init, bindViewerEventListeners:bindViewerEventListeners, unbindViewerEventListeners:unbindViewerEventListeners, onFlashcardPoiClicked:onFlashcardPoiClicked, onFlashcardCloseSlideClicked:onFlashcardCloseSlideClicked}
}(VISH, jQuery);
VISH.Flashcard = function(V, $, undefined) {
  var flashcards;
  var pois;
  var FPS = 25;
  var TOTAL_FRAMES = 20;
  var FRAME_WIDTH = 50;
  var init = function(presentation) {
    if(!flashcards) {
      flashcards = new Array;
      pois = new Array
    }
  };
  var startAnimation = function(slideId) {
    if(typeof flashcards !== "undefined" && typeof flashcards[slideId] !== "undefined" && typeof flashcards[slideId].timer == "undefined") {
      flashcards[slideId].timer = setInterval(function() {
        animateArrows(slideId)
      }, 1E3 / FPS)
    }
  };
  var stopAnimation = function(slideId) {
    if(typeof flashcards !== "undefined" && typeof flashcards[slideId] !== "undefined" && typeof flashcards[slideId].timer !== "undefined") {
      clearTimeout(flashcards[slideId].timer);
      flashcards[slideId].timer = undefined
    }
  };
  var addArrow = function(fcId, poi, sync) {
    var flashcard_div = $("#" + fcId);
    var div_to_add = "<div class='fc_poi' id='" + poi.id + "' style='position:absolute;left:" + poi.x + "%;top:" + poi.y + "%'></div>";
    flashcard_div.append(div_to_add);
    if(typeof flashcards[fcId] === "undefined") {
      flashcards[fcId] = new Object;
      flashcards[fcId].arrows = []
    }
    var arrow = new Object;
    arrow.id = poi.id;
    if(sync) {
      arrow.position = 0
    }else {
      var rand_pos = Math.floor(Math.random() * TOTAL_FRAMES + 1) * FRAME_WIDTH;
      arrow.position = rand_pos
    }
    arrow.slide_id = poi.slide_id;
    flashcards[fcId].arrows.push(arrow);
    pois[arrow.id] = arrow
  };
  var animateArrows = function(slideId) {
    if(!slideId || typeof flashcards[slideId] === "undefined") {
      return
    }
    $(flashcards[slideId].arrows).each(function(index, value) {
      var new_pos = (value.position + FRAME_WIDTH) % (TOTAL_FRAMES * FRAME_WIDTH);
      var arrow_dom_el = $("#" + value.id);
      $(arrow_dom_el).css("background-position", new_pos + "px" + " 0px");
      flashcards[slideId].arrows[index].position = new_pos
    })
  };
  var getPoiData = function(poiId) {
    if(typeof pois !== "undefined" && typeof pois[poiId] !== "undefined") {
      return pois[poiId]
    }
    return null
  };
  return{init:init, addArrow:addArrow, startAnimation:startAnimation, stopAnimation:stopAnimation, animateArrows:animateArrows, getPoiData:getPoiData}
}(VISH, jQuery);
VISH.Quiz = function(V, $, undefined) {
  var quizMode;
  var quizSessionId;
  var currentQuiz;
  var currentQuizSession;
  var currentPolling;
  var initBeforeRender = function(presentation) {
    if(presentation.type === V.Constant.QUIZ_SIMPLE) {
      quizMode = V.Constant.QZ_MODE.RT;
      if(V.Utils.getOptions().quizSessionId) {
        quizSessionId = V.Utils.getOptions().quizSessionId
      }
    }else {
      quizMode = V.Constant.QZ_MODE.SELFA
    }
  };
  var init = function() {
    $("#prompt2name").watermark("Quiz Session Name");
    V.Quiz.API.init();
    V.Quiz.MC.init();
    V.Quiz.TF.init();
    _loadEvents()
  };
  var _loadEvents = function() {
    $(document).on("click", ".quizAnswerButton", _onAnswerQuiz);
    $(document).on("click", ".quizStartButton", _onStartQuiz);
    $(document).on("click", ".quizStopButton", _onStopQuiz);
    $("a#addQuizSessionFancybox").fancybox({"autoDimensions":false, "scrolling":"no", "width":"0%", "height":"0%", "padding":0, "autoScale":true, "onStart":function(data) {
      loadTab("tab_quiz_session");
      $("#fancybox-close").height(0);
      $("#fancybox-close").css("padding", 0)
    }, "onComplete":function(data) {
      setTimeout(function() {
        $("#fancybox-close").height("22px");
        $("#fancybox-close").css("padding", "10px");
        $("#fancybox-close").css("padding-left", "4px");
        $("#fancybox-wrap").css("margin-top", "0px");
        $("#fancybox-wrap").width($(".current").width() + 100);
        $("#fancybox-wrap").height($(".current").height() + 70);
        $(".outer_box").css("width", "100%");
        $(".outer_box").height($(".current").height() + 70);
        $("#fancybox-wrap").css("top", $(".current").offset().top + "px");
        $("#fancybox-wrap").css("left", $(".current").offset().left + "px");
        $("#fancybox-content").width("100%");
        $("#fancybox-content").height("100%");
        $("#fancybox-content > div").width("100%");
        $("#fancybox-content > div").height("100%");
        $("#fancybox-wrap").show();
        if(currentQuizSession && currentQuizSession.url) {
          _loadQr(currentQuizSession.url)
        }
      }, 300)
    }, "onClosed":function() {
      _stopPolling();
      _cleanResults()
    }})
  };
  var _onAnswerQuiz = function(event) {
    var quiz = $("div.quizzContainer").has(event.target);
    var quizModule = _getQuizModule($(quiz).attr("type"));
    if(quizModule) {
      if(quizMode === V.Constant.QZ_MODE.SELFA) {
        quizModule.onAnswerQuiz(quiz)
      }else {
        var report = quizModule.getReport(quiz);
        _answerRTQuiz(quiz, quizModule, report)
      }
    }
  };
  var _answerRTQuiz = function(quiz, quizModule, report) {
    if(!quizSessionId) {
      return
    }
    if(report.empty === true) {
      _showAlert("prompt3_alert");
      return
    }
    quizModule.disableQuiz(quiz);
    _loadingAnswerButton(quiz);
    var answers = report.answers;
    V.Debugging.log(answers);
    V.Quiz.API.sendAnwers(answers, quizSessionId, function(data) {
      disableAnswerButton(quiz);
      _showAlert("prompt4_alert")
    }, function(error) {
      disableAnswerButton(quiz);
      _showAlert("prompt5_alert")
    })
  };
  var _onStartQuiz = function(event) {
    var startButton = $(event.target);
    var quiz = $("div.quizzContainer").has(startButton);
    switch($(startButton).attr("quizStatus")) {
      case "running":
        $("#fancybox-close").hide();
        $("a#addQuizSessionFancybox").trigger("click");
        break;
      case "loading":
        break;
      case "stop":
      ;
      default:
        _startNewQuizSession(quiz);
        break
    }
  };
  var _startNewQuizSession = function(quiz) {
    if(currentQuizSession) {
      _showAlert("prompt1_alert");
      return
    }
    _loadingLaunchButton(quiz);
    var quizJSON = _getQuizJSONFromQuiz(quiz);
    V.Quiz.API.startQuizSession(quiz, quizJSON, _onQuizSessionReceived, _onQuizSessionReceivedError)
  };
  var _onQuizSessionReceived = function(quiz, quizSession) {
    V.Debugging.log("_onQuizSessionReceived");
    V.Debugging.log(quizSession);
    currentQuiz = quiz;
    currentQuizSession = quizSession;
    _runningLaunchButton(quiz);
    $("a#addQuizSessionFancybox").trigger("click")
  };
  var _onQuizSessionReceivedError = function(quiz, error) {
    V.Debugging.log("_OnQuizSessionReceivedError");
    V.Debugging.log(error);
    _enableLaunchButton(quiz)
  };
  var _getQuizJSONFromQuiz = function(quiz) {
    var slide = $("article").has(quiz);
    return _getQuizJSONFromSlide(slide)
  };
  var _getQuizJSONFromSlide = function(slide) {
    var slideId = $(slide).attr("id");
    var presentation = V.SlideManager.getCurrentPresentation();
    if(slideId && presentation) {
      var slides = presentation.slides;
      var sL = slides.length;
      for(var i = 0;i < sL;i++) {
        if(slides[i].id == slideId) {
          var elements = slides[i].elements;
          var eL = elements.length;
          for(var j = 0;j < eL;j++) {
            if(elements[j].type == V.Constant.QUIZ) {
              return elements[j].quiz_simple_json
            }
          }
        }
      }
    }
  };
  var _onStopQuiz = function(event) {
    $.fancybox($("#prompt2_alert").html(), {"autoDimensions":false, "scrolling":"no", "width":$(".current").width(), "height":Math.min(200, $(".current").height()), "showCloseButton":false, "padding":5, "onCleanup":function() {
    }, "onClosed":function() {
    }})
  };
  var onCloseQuizSession = function(saving) {
    var name = undefined;
    switch(saving) {
      case "yes":
        $(".prompt2name").each(function(index, pn) {
          if($(pn).is(":visible")) {
            name = $(pn).val()
          }
        });
        $(".prompt_button_viewer2").addClass("quizStartButtonLoading");
        _closeQuizSession(name);
        break;
      case "no":
        $(".prompt_button_viewer1").addClass("quizStartButtonLoading");
        _closeQuizSession();
        break;
      case "cancel":
      ;
      default:
        $.fancybox.close();
        break
    }
  };
  var _closeQuizSession = function(name) {
    V.Quiz.API.closeQuizSession(currentQuizSession.id, name, function(data) {
      $.fancybox.close();
      $(".prompt_button_viewer1").removeClass("quizStartButtonLoading");
      $(".prompt_button_viewer2").removeClass("quizStartButtonLoading");
      _enableLaunchButton(currentQuiz);
      currentQuiz = null;
      currentQuizSession = null
    })
  };
  var render = function(slide, template) {
    var quizModule = _getQuizModule(slide.quiztype);
    if(quizModule) {
      return quizModule.render(slide, template)
    }
  };
  var renderButtons = function(selfA) {
    var quizButtons = $("<div class='quizButtons'></div>");
    if(quizMode === V.Constant.QZ_MODE.SELFA && (V.Configuration.getConfiguration().mode === V.Constant.VISH || V.Configuration.getConfiguration()["mode"] === V.Constant.NOSERVER) && V.User.isLogged() && !V.Utils.getOptions().preview) {
      var startButton = $("<input type='button' class='quizButton quizStartButton' value='Launch'/>");
      $(quizButtons).prepend(startButton)
    }
    if(selfA || quizMode === V.Constant.QZ_MODE.RT) {
      var answerButton = $("<input type='button' class='quizButton quizAnswerButton' value='Answer'/>");
      $(quizButtons).prepend(answerButton)
    }
    return quizButtons
  };
  var _enableAnswerButton = function(quiz) {
    var answerButton = $(quiz).find("input.quizAnswerButton");
    $(answerButton).removeAttr("disabled");
    $(answerButton).removeClass("quizStartButtonLoading");
    $(answerButton).removeAttr("quizStatus")
  };
  var _loadingAnswerButton = function(quiz) {
    var answerButton = $(quiz).find("input.quizAnswerButton");
    $(answerButton).attr("disabled", "disabled");
    $(answerButton).addClass("quizStartButtonLoading");
    $(answerButton).attr("quizStatus", "loading")
  };
  var disableAnswerButton = function(quiz) {
    var answerButton = $(quiz).find("input.quizAnswerButton");
    $(answerButton).attr("disabled", "disabled");
    $(answerButton).addClass("quizAnswerButtonDisabled");
    $(answerButton).removeClass("quizStartButtonLoading");
    $(answerButton).attr("quizStatus", "disabled")
  };
  var _enableLaunchButton = function(quiz) {
    var startButton = $(quiz).find("input.quizStartButton");
    $(startButton).removeAttr("disabled");
    $(startButton).removeClass("quizStartButtonLoading");
    $(startButton).removeAttr("quizStatus");
    $(startButton).attr("value", "Launch")
  };
  var _loadingLaunchButton = function(quiz) {
    var startButton = $(quiz).find("input.quizStartButton");
    $(startButton).attr("disabled", "disabled");
    $(startButton).addClass("quizStartButtonLoading");
    $(startButton).attr("quizStatus", "loading");
    $(startButton).attr("value", "Launch")
  };
  var _runningLaunchButton = function(quiz) {
    var startButton = $(quiz).find("input.quizStartButton");
    $(startButton).removeAttr("disabled");
    $(startButton).removeClass("quizStartButtonLoading");
    $(startButton).attr("quizStatus", "running");
    $(startButton).attr("value", "Options")
  };
  var loadTab = function(tab_id) {
    $(".fancy_viewer_tab_content").hide();
    $("#" + tab_id + "_content").show();
    $(".fancy_viewer_tab").removeClass("fancy_selected");
    $("#" + tab_id).addClass("fancy_selected");
    $(".help_in_fancybox_viewer").hide();
    $("#" + tab_id + "_help").show();
    switch(tab_id) {
      case "tab_quiz_session":
        _loadQuizSession();
        break;
      case "tab_quiz_stats":
        _loadStats();
        break;
      default:
        break
    }
  };
  var _loadQuizSession = function() {
    _cleanResults();
    if(!currentQuizSession) {
      return
    }
    if(V.Configuration.getConfiguration()["mode"] == V.Constant.NOSERVER) {
      currentQuizSession.url = "http://vishub.org/quiz_sessions/4567"
    }
    var myA = $("#tab_quiz_session_url_link");
    $(myA).attr("href", currentQuizSession.url);
    $(myA).html("<p id='tab_quiz_session_url'>" + currentQuizSession.url + "</p>");
    var sharingText = $(currentQuiz).find(".mc_question_wrapper_viewer").text().trim();
    var twitter = $("#tab_quiz_session_share_twitter");
    $(twitter).attr("href", "https://twitter.com/share?url=" + currentQuizSession.url + "&text=" + sharingText + "");
    var facebook = $("#tab_quiz_session_share_facebook");
    var facebookUrl = "http://www.facebook.com/sharer.php?s=100&p[url]=" + currentQuizSession.url + "&p[title]=" + sharingText;
    $(facebook).attr("href", facebookUrl);
    var gPlus = $("#tab_quiz_session_share_gPlus");
    $(gPlus).attr("href", "https://plus.google.com/share?url=" + currentQuizSession.url)
  };
  var _loadQr = function(url) {
    if(typeof url != "string") {
      return
    }
    var container = $(".quizQr");
    $(container).html("");
    var height = $(container).height();
    var width = height;
    var qrOptions = {render:"canvas", width:width, height:height, color:"#000", bgColor:"#fff", text:url.toString()};
    $(container).qrcode(qrOptions)
  };
  var _onClickQR = function() {
    var changeToFs = false;
    var changeFromFs = false;
    var elem = $(".quizQr")[0];
    if(V.Status.getIsInIframe() && isFullscreen(parent.document)) {
      return
    }
    if(isFullscreen(document)) {
      changeFromFS = cancelFullScreen(document)
    }else {
      changeToFS = requestFullScreen(elem)
    }
    if(changeToFs) {
      $(".quizQr").attr("disabledTitle", $(".quizQr").attr("title"));
      $(".quizQr").removeAttr("title")
    }else {
      if(changeFromFs) {
        $(".quizQr").attr("title", $(".quizQr").attr("disabledTitle"))
      }
    }
    if(changeToFs || changeFromFs) {
      _loadQr(currentQuizSession.url)
    }
  };
  var isFullscreen = function(myDoc) {
    return myDoc.fullScreen || myDoc.mozFullScreen || myDoc.webkitIsFullScreen
  };
  var cancelFullScreen = function(myDoc) {
    if(myDoc.cancelFullScreen) {
      myDoc.cancelFullScreen();
      return true
    }else {
      if(myDoc.mozCancelFullScreen) {
        myDoc.mozCancelFullScreen();
        return true
      }else {
        if(myDoc.webkitCancelFullScreen) {
          myDoc.webkitCancelFullScreen();
          return true
        }
      }
    }
    return false
  };
  var requestFullScreen = function(elem) {
    if(elem.requestFullscreen) {
      elem.requestFullscreen();
      return true
    }else {
      if(elem.mozRequestFullScreen) {
        elem.mozRequestFullScreen();
        return true
      }else {
        if(elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
          return true
        }
      }
    }
    return false
  };
  var _loadStats = function() {
    _cleanResults();
    V.Quiz.API.getResults(currentQuizSession.id, function(results) {
      _drawResults(results, {"first":true});
      _startPolling()
    })
  };
  var _startPolling = function() {
    _stopPolling();
    currentPolling = setInterval(function() {
      if(!currentQuizSession) {
        _stopPolling();
        return
      }
      V.Quiz.API.getResults(currentQuizSession.id, function(results) {
        _drawResults(results, {"first":false})
      })
    }, 2E3)
  };
  var _stopPolling = function() {
    if(currentPolling) {
      clearInterval(currentPolling)
    }
  };
  var _drawResults = function(results, options) {
    var canvas = $("#quiz_chart");
    var desiredWidth = $("#fancybox-content").width();
    var desiredHeight = $("#fancybox-content").height() * 0.8;
    $(canvas).width(desiredWidth);
    $(canvas).height(desiredHeight);
    $(canvas).attr("width", desiredWidth);
    $(canvas).attr("height", desiredHeight);
    var quizModule = _getQuizModule($(currentQuiz).attr("type"));
    if(quizModule) {
      $("#quiz_chart").show();
      quizModule.drawResults(currentQuiz, results, options)
    }
  };
  var _cleanResults = function() {
    var canvas = $("#quiz_chart");
    var ctx = $(canvas).get(0).getContext("2d");
    ctx.clearRect(0, 0, $(canvas).width(), $(canvas).height());
    $(canvas).hide()
  };
  var _getQuizModule = function(quiz_type) {
    switch(quiz_type) {
      case V.Constant.QZ_TYPE.OPEN:
        break;
      case V.Constant.QZ_TYPE.MCHOICE:
        return V.Quiz.MC;
        break;
      case V.Constant.QZ_TYPE.TF:
        return V.Quiz.TF;
        break;
      default:
        return null;
        break
    }
  };
  var updateCheckbox = function(checkbox, check) {
    if(typeof check == "boolean") {
      check = check.toString()
    }
    var imagePathRoot = V.ImagesPath + "quiz/checkbox";
    switch(check) {
      case "true":
        $(checkbox).attr("check", "true");
        $(checkbox).attr("src", imagePathRoot + "_checked.png");
        break;
      case "false":
        $(checkbox).attr("check", "false");
        $(checkbox).attr("src", imagePathRoot + "_wrong.png");
        break;
      case "none":
      ;
      default:
        $(checkbox).attr("check", "none");
        $(checkbox).attr("src", imagePathRoot + ".png");
        break
    }
  };
  var _showAlert = function(alertId) {
    $.fancybox($("#" + alertId).html(), {"autoDimensions":false, "scrolling":"no", "width":$(".current").width(), "height":Math.min(200, $(".current").height()), "showCloseButton":false, "padding":5})
  };
  var aftersetupSize = function(increase) {
    setTimeout(function() {
      if(currentQuizSession && currentQuizSession.url) {
        _loadQr(currentQuizSession.url)
      }
    }, 500)
  };
  return{initBeforeRender:initBeforeRender, init:init, render:render, renderButtons:renderButtons, updateCheckbox:updateCheckbox, disableAnswerButton:disableAnswerButton, loadTab:loadTab, onCloseQuizSession:onCloseQuizSession, aftersetupSize:aftersetupSize}
}(VISH, jQuery);
VISH.Editor.Tools = function(V, $, undefined) {
  var toolbarEventsLoaded = false;
  var INCREASE_SIZE = 1.05;
  var init = function() {
    cleanZoneTools();
    cleanToolbar();
    if(!toolbarEventsLoaded) {
      $.each($("img.toolbar_icon"), function(index, toolbarButton) {
        $(toolbarButton).on("click", function(event) {
          if(typeof V.Editor.Tools[$(toolbarButton).attr("action")] == "function") {
            V.Editor.Tools[$(toolbarButton).attr("action")](this)
          }
        })
      });
      $(document).on("keydown", ".tools_input_addUrl", _addUrlOnKeyDown);
      toolbarEventsLoaded = true
    }
    loadPresentationToolbar();
    V.Editor.Tools.Menu.init()
  };
  var loadToolsForZone = function(zone) {
    cleanZoneTools();
    var type = $(zone).clone().attr("type");
    switch(type) {
      case "text":
        loadToolbarForElement(type);
        break;
      case "image":
        loadToolbarForElement(type);
        break;
      case "video":
        loadToolbarForElement(type);
        break;
      case "object":
        var object = $(zone).find(".object_wrapper").children()[0];
        loadToolbarForObject(object);
        break;
      case "snapshot":
        loadToolbarForElement("snapshot");
        break;
      case "quiz":
        loadToolbarForElement("quiz");
        break;
      case undefined:
        $(zone).find(".menuselect_hide").show();
        return;
      default:
        break
    }
    $(zone).find(".delete_content").show()
  };
  var cleanZoneTools = function(zone) {
    $(".menuselect_hide").hide();
    $(".delete_content").hide();
    _cleanElementToolbar()
  };
  var cleanToolbar = function() {
    _cleanPresentationToolbar();
    _cleanElementToolbar()
  };
  var enableToolbar = function() {
    $("#toolbar_wrapper").show()
  };
  var disableToolbar = function() {
    $("#toolbar_wrapper").hide()
  };
  var loadPresentationToolbar = function() {
    var presentationType = V.Editor.getPresentationType();
    switch(presentationType) {
      case V.Constant.PRESENTATION:
        $("#hidden_button_to_launch_theme_fancybox").fancybox({"autoDimensions":false, "width":600, "scrolling":"no", "height":400, "padding":0});
        $("#toolbar_presentation").find("img.toolbar_presentation").show();
        break;
      case V.Constant.FLASHCARD:
        $("#hidden_button_to_launch_picture_fancybox_for_flashcard").fancybox({"autoDimensions":false, "width":800, "scrolling":"no", "height":600, "padding":0, "onStart":function(data) {
          V.Editor.Image.setAddContentMode(V.Constant.FLASHCARD);
          V.Editor.Utils.loadTab("tab_pic_from_url")
        }, "onClosed":function(data) {
          V.Editor.Image.setAddContentMode(V.Constant.NONE)
        }});
        $("#toolbar_presentation").find("img.toolbar_flashcard").show();
        break;
      case V.Constant.GAME:
        $("#toolbar_presentation").find("img.toolbar_game").show();
        break;
      case V.Constant.QUIZ_SIMPLE:
        disableToolbar();
        $("#menubarCarrousel").hide();
        break;
      case V.Constant.VTOUR:
        $("#toolbar_presentation").find("img.toolbar_vtour").show();
        break;
      default:
        disableToolbar();
        break
    }
  };
  var _cleanPresentationToolbar = function() {
    $("#toolbar_presentation").find("img").hide()
  };
  var loadToolbarForElement = function(type) {
    _cleanElementToolbar();
    if(type == "text" || type == "quiz") {
      _loadTextToolbar();
      return
    }
    var toolbarClass = "toolbar_" + type;
    $("#toolbar_element").find("img").hide();
    $("#toolbar_element").find("img." + toolbarClass).show()
  };
  var _loadTextToolbar = function() {
    $("#toolbar_element").find("img").hide();
    $("#toolbar_text").show();
    $("#toolbar_text").show()
  };
  var loadToolbarForObject = function(object) {
    var objectInfo = V.Object.getObjectInfo(object);
    switch(objectInfo.type) {
      case "web":
        loadToolbarForElement(objectInfo.type);
        break;
      default:
        loadToolbarForElement("object");
        break
    }
  };
  var _cleanElementToolbar = function() {
    $("#toolbar_text").hide();
    $("#toolbar_text").hide();
    $("#toolbar_element").find("img").hide()
  };
  var selectTheme = function() {
    $("#hidden_button_to_launch_theme_fancybox").trigger("click")
  };
  var changeFlashcardBackground = function() {
    $("#hidden_button_to_launch_picture_fancybox_for_flashcard").trigger("click")
  };
  var zoomMore = function() {
    _changeZoom("+")
  };
  var zoomLess = function() {
    _changeZoom("-")
  };
  var resizeMore = function() {
    _resize("+")
  };
  var resizeLess = function() {
    _resize("-")
  };
  var _resize = function(action) {
    var object, objectInfo, resizeFactor;
    var area = V.Editor.getCurrentArea();
    var type = $(area).attr("type");
    if(action == "+") {
      resizeFactor = INCREASE_SIZE
    }else {
      resizeFactor = 1 / INCREASE_SIZE
    }
    switch(type) {
      case "snapshot":
        var snapshot_wrapper = area.children(":first");
        var proportion = $(snapshot_wrapper).height() / $(snapshot_wrapper).width();
        var originalWidth = $(snapshot_wrapper).width();
        snapshot_wrapper.width(originalWidth * resizeFactor);
        snapshot_wrapper.height(originalWidth * resizeFactor * proportion);
        break;
      case "object":
        var parent = area.children(":first");
        object = parent.children(":first");
        objectInfo = V.Object.getObjectInfo(object);
        var newWidth, newHeight;
        var aspectRatio = parent.width() / parent.height();
        var originalHeight = object.height();
        var originalWidth = object.width();
        var parentoriginalHeight = parent.height();
        var parentoriginalWidth = parent.width();
        $(parent).width(parentoriginalWidth * resizeFactor);
        $(parent).height(parentoriginalHeight * resizeFactor);
        var styleZoom = V.Utils.getZoomFromStyle($(object).attr("style"));
        if(styleZoom != 1) {
          newWidth = newWidth / styleZoom;
          newHeight = Math.round(newWidth / aspectRatio);
          newWidth = Math.round(newWidth)
        }else {
          newHeight = parentoriginalHeight * resizeFactor;
          newWidth = parentoriginalWidth * resizeFactor
        }
        $(object).width(newWidth);
        $(object).height(newHeight);
        break;
      case "image":
        object = $(area).find("img");
        var originalHeight = object.height();
        var originalWidth = object.width();
        object.width(originalWidth * resizeFactor);
        object.height(originalHeight * resizeFactor);
        break;
      case "video":
        object = $(area).find("video");
        var originalHeight = object.height();
        var originalWidth = object.width();
        object.width(originalWidth * resizeFactor);
        object.height(originalHeight * resizeFactor);
        break;
      default:
        break
    }
  };
  var _changeZoom = function(action) {
    var object, objectInfo, zoom;
    var area = V.Editor.getCurrentArea();
    var type = $(area).attr("type");
    switch(type) {
      case "object":
        var parent = area.children(":first");
        object = parent.children(":first");
        objectInfo = V.Object.getObjectInfo(object);
        if(objectInfo.type === "web") {
          var iframe = $(area).find("iframe");
          zoom = V.Utils.getZoomFromStyle($(iframe).attr("style"));
          if(action == "+") {
            zoom = zoom + 0.1
          }else {
            zoom = zoom - 0.1
          }
          $(iframe).attr("style", V.Editor.Utils.addZoomToStyle($(iframe).attr("style"), zoom));
          V.Editor.Object.autofixWrapperedObjectAfterZoom(iframe, zoom)
        }
        break;
      default:
        break
    }
  };
  var addLink = function() {
    $.fancybox($("#tools_addUrl").html(), {"autoDimensions":false, "scrolling":"no", "width":800, "height":215, "showCloseButton":true, "padding":0, "onStart":function() {
    }, "onComplete":function() {
      var area = V.Editor.getCurrentArea();
      var hyperlink = $(area).attr("hyperlink");
      if(hyperlink) {
        $(".tools_input_addUrl").val(hyperlink);
        $(".removeUrlButton").show()
      }else {
        $(".removeUrlButton").hide()
      }
    }, "onClosed":function() {
      $(".removeUrlButton").hide()
    }})
  };
  var _addUrlOnKeyDown = function(event) {
    switch(event.keyCode) {
      case 13:
        addUrl();
        break;
      default:
        break
    }
  };
  var addUrl = function() {
    var url;
    $(".tools_input_addUrl").each(function(index, input) {
      if($($(input).parent().parent()).attr("id") !== "tools_addUrl") {
        url = $(input).val()
      }
    });
    if(url) {
      url = V.Editor.Utils.autocompleteUrls(url);
      var area = V.Editor.getCurrentArea();
      switch($(area).attr("type")) {
        case "image":
          $(area).attr("hyperlink", url);
          break;
        default:
          break
      }
    }
    $.fancybox.close()
  };
  var removeUrl = function() {
    var area = V.Editor.getCurrentArea();
    $(area).removeAttr("hyperlink");
    $.fancybox.close()
  };
  return{init:init, loadPresentationToolbar:loadPresentationToolbar, loadToolsForZone:loadToolsForZone, loadToolbarForObject:loadToolbarForObject, loadToolbarForElement:loadToolbarForElement, cleanZoneTools:cleanZoneTools, cleanToolbar:cleanToolbar, enableToolbar:enableToolbar, disableToolbar:disableToolbar, selectTheme:selectTheme, changeFlashcardBackground:changeFlashcardBackground, addLink:addLink, addUrl:addUrl, removeUrl:removeUrl, resizeMore:resizeMore, resizeLess:resizeLess, zoomMore:zoomMore, 
  zoomLess:zoomLess}
}(VISH, jQuery);
VISH.Addons = function(V, undefined) {
  var init = function(addons) {
    if(typeof addons === "object") {
      for(var i = 0;i < addons.length;i++) {
        var targeted = V.Editing && addons[i].target === V.Constant.Edit || !V.Editing && addons[i].target === V.Constant.Viewer || addons[i].target === V.Constant.AnyMode;
        if(targeted) {
          if(typeof V.Addons[addons[i].id] !== "undefined" && typeof V.Addons[addons[i].id].init === "function") {
            V.Addons[addons[i].id].init(addons[i].config)
          }
        }
      }
    }
  };
  return{init:init}
}(VISH, jQuery);
VISH.VideoPlayer = function(V, $, undefined) {
  var init = function() {
    V.VideoPlayer.CustomPlayer.init();
    V.VideoPlayer.HTML5.init();
    V.VideoPlayer.Youtube.init()
  };
  var getTypeVideoWithId = function(videoId) {
    return getTypeVideo(document.getElementById(videoId))
  };
  var getTypeVideo = function(video) {
    if(!video) {
      return V.Constant.UNKNOWN
    }else {
      if(video.tagName === "VIDEO") {
        return V.Constant.Video.HTML5
      }else {
        if(video.tagName === "OBJECT" || video.tagName === "IFRAME") {
          return V.Constant.Video.Youtube
        }
      }
    }
    return V.Constant.UNKNOWN
  };
  var playVideo = function(videoId, currentTime, triggeredByUser) {
    switch(getTypeVideoWithId(videoId)) {
      case V.Constant.Video.HTML5:
        V.VideoPlayer.HTML5.playVideo(videoId, currentTime, triggeredByUser);
        break;
      case V.Constant.Video.Youtube:
        V.VideoPlayer.Youtube.playVideo(videoId, currentTime, triggeredByUser);
        break;
      default:
        break
    }
  };
  var pauseVideo = function(videoId, currentTime, triggeredByUser) {
    switch(getTypeVideoWithId(videoId)) {
      case V.Constant.Video.HTML5:
        V.VideoPlayer.HTML5.pauseVideo(videoId, currentTime, triggeredByUser);
        break;
      case V.Constant.Video.Youtube:
        V.VideoPlayer.Youtube.pauseVideo(videoId, currentTime, triggeredByUser);
        break;
      default:
        break
    }
  };
  var seekVideo = function(videoId, seekTime, triggeredByUser) {
    switch(getTypeVideoWithId(videoId)) {
      case V.Constant.Video.HTML5:
        V.VideoPlayer.HTML5.seekVideo(videoId, seekTime, triggeredByUser);
        break;
      case V.Constant.Video.Youtube:
        V.VideoPlayer.Youtube.seekVideo(videoId, seekTime, triggeredByUser);
        break;
      default:
        break
    }
  };
  var getDuration = function(video) {
    switch(getTypeVideo(video)) {
      case V.Constant.Video.HTML5:
        return video.getDuration();
        break;
      case V.Constant.Video.Youtube:
        return youtubePlayers[video.id].getDuration();
        break;
      default:
        break
    }
  };
  var getCurrentTime = function(video) {
    switch(getTypeVideo(video)) {
      case V.Constant.Video.HTML5:
        return video.getCurrentTime();
        break;
      case V.Constant.Video.Youtube:
        return youtubePlayers[video.id].getCurrentTime();
        break;
      default:
        break
    }
  };
  return{init:init, getTypeVideoWithId:getTypeVideoWithId, getTypeVideo:getTypeVideo, playVideo:playVideo, pauseVideo:pauseVideo, seekVideo:seekVideo, getDuration:getDuration, getCurrentTime:getCurrentTime}
}(VISH, jQuery);
VISH.Messenger = function(V, undefined) {
  var init = function() {
    V.EventsNotifier.registerCallback(V.Constant.Event.onGoToSlide, function(params) {
      notifyEventByMessage(V.Constant.Event.onGoToSlide, params)
    });
    V.EventsNotifier.registerCallback(V.Constant.Event.onPlayVideo, function(params) {
      notifyEventByMessage(V.Constant.Event.onPlayVideo, params)
    });
    V.EventsNotifier.registerCallback(V.Constant.Event.onPauseVideo, function(params) {
      notifyEventByMessage(V.Constant.Event.onPauseVideo, params)
    });
    V.EventsNotifier.registerCallback(V.Constant.Event.onSeekVideo, function(params) {
      notifyEventByMessage(V.Constant.Event.onSeekVideo, params)
    });
    V.EventsNotifier.registerCallback(V.Constant.Event.onFlashcardPointClicked, function(params) {
      notifyEventByMessage(V.Constant.Event.onFlashcardPointClicked, params)
    });
    V.EventsNotifier.registerCallback(V.Constant.Event.onFlashcardSlideClosed, function(params) {
      notifyEventByMessage(V.Constant.Event.onFlashcardSlideClosed, params)
    })
  };
  var notifyEventByMessage = function(event, params) {
    if(params.triggeredByUser === false) {
      return
    }
    var VEMessage = V.Messenger.Helper.createMessage(event, params);
    V.EventsNotifier.notifyEvent(V.Constant.Event.onMessage, VEMessage, true)
  };
  return{init:init, notifyEventByMessage:notifyEventByMessage}
}(VISH);
VISH.Editor.Quiz = function(V, $, undefined) {
  var init = function() {
    V.Editor.Quiz.MC.init();
    V.Editor.Quiz.TF.init()
  };
  var _getQuizModule = function(quiz_type) {
    switch(quiz_type) {
      case VISH.Constant.QZ_TYPE.OPEN:
        break;
      case VISH.Constant.QZ_TYPE.MCHOICE:
        return V.Editor.Quiz.MC;
        break;
      case VISH.Constant.QZ_TYPE.TF:
        return V.Editor.Quiz.TF;
        break;
      default:
        return null;
        break
    }
  };
  var add = function(quizType, area) {
    var current_area;
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    if(_getQuizModule(quizType)) {
      _getQuizModule(quizType).add(current_area)
    }
    $.fancybox.close()
  };
  var save = function(area) {
    var current_area;
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    var quizType = $(area).attr("quiztype");
    if(_getQuizModule(quizType)) {
      return _getQuizModule(quizType).save(current_area)
    }
  };
  var draw = function(area, quiz) {
    if(_getQuizModule(quiz.quiztype)) {
      _getQuizModule(quiz.quiztype).draw(area, quiz)
    }
  };
  return{init:init, add:add, save:save, draw:draw}
}(VISH, jQuery);
VISH.Addons.IframeMessenger = function(V, undefined) {
  var listenerInitialized = false;
  var init = function(config) {
    if(!config || !config.enable) {
      return
    }
    if(window.addEventListener) {
      window.addEventListener("message", _onWebAppMessage, false)
    }else {
      if(el.attachEvent) {
        window.attachEvent("message", _onWebAppMessage)
      }
    }
    V.Constant.Event.onIframeMessengerHello = "onIframeMessengerHello"
  };
  var _initListener = function() {
    V.EventsNotifier.registerCallback(V.Constant.Event.onMessage, _onVishEditorMessage);
    listenerInitialized = true
  };
  var _onVishEditorMessage = function(VEMessage) {
    _sendMessage(VEMessage)
  };
  var _onWebAppMessage = function(webAppMessage) {
    if(webAppMessage) {
      var VEMessage = webAppMessage.data;
      var processSelfMessages = V.Status.isPreventDefaultMode();
      if(V.Messenger.Helper.validateVEMessage(VEMessage, {allowSelfMessages:processSelfMessages})) {
        if(_isVEHelloMessage(VEMessage)) {
          if(!listenerInitialized) {
            _initListener();
            if(V.Status.getIsInIframe()) {
              var helloEcho = JSON.parse(VEMessage);
              helloEcho.origin = V.Status.getIframe().id;
              VEMessage = JSON.stringify(helloEcho)
            }
            _sendMessage(VEMessage)
          }
        }else {
          V.Messenger.Helper.processVEMessage(VEMessage)
        }
      }
    }
  };
  var _isVEHelloMessage = function(VEMessage) {
    var message = JSON.parse(VEMessage);
    return message.VEevent === V.Constant.Event.onIframeMessengerHello
  };
  var _validateWebAppMessage = function(webAppMessage) {
    if(!webAppMessage) {
      return false
    }
    return V.Messenger.Helper.validateVEMessage(webAppMessage.data)
  };
  var _sendMessage = function(VEMessage) {
    window.parent.postMessage(VEMessage, "*")
  };
  return{init:init}
}(VISH, jQuery);
VISH.AppletPlayer = function() {
  var loadApplet = function(element) {
    $.each(element.children(".appletelement"), function(index, value) {
      var toAppend = "<applet code='" + $(value).attr("code") + "' width='" + $(value).attr("width") + "' height='" + $(value).attr("height") + "' archive='" + $(value).attr("archive") + "'>" + $(value).attr("params") + "</applet>";
      $(value).html(toAppend)
    })
  };
  var unloadApplet = function(element) {
    $(".appletelement applet").remove()
  };
  return{loadApplet:loadApplet, unloadApplet:unloadApplet}
}(VISH, jQuery);
VISH.Configuration = function(V, $, undefined) {
  var configuration;
  var init = function(myConfiguration) {
    configuration = myConfiguration;
    _initPaths()
  };
  var _initPaths = function() {
    V.ImagesPath = configuration["ImagesPath"];
    V.StylesheetsPath = configuration["StylesheetsPath"];
    V.UploadImagePath = configuration["uploadImagePath"];
    V.UploadObjectPath = configuration["uploadObjectPath"];
    V.UploadPresentationPath = configuration["uploadPresentationPath"]
  };
  var applyConfiguration = function() {
    if(configuration["presentationSettings"]) {
      if(!configuration["presentationTags"]) {
        $(".tagBoxUpload").css("display", "none");
        $(".tagBoxIntro").css("display", "none")
      }
      if(!configuration["presentationThumbnails"]) {
        $("#thumbnails_in_excursion_details").css("display", "none")
      }
    }
    if(!configuration["VishLives"]) {
      $(".addLive").css("display", "none")
    }
    if(!configuration["VishRepo"]) {
      $("#tab_pic_repo").css("display", "none");
      $("#tab_object_repo").css("display", "none");
      $("#tab_video_repo").css("display", "none")
    }
    if(!configuration["Upload"]) {
      $("#tab_pic_upload").css("display", "none");
      $("#tab_object_upload").css("display", "none")
    }
    if(!configuration["Youtube"]) {
      $("#tab_video_youtube").css("display", "none")
    }
    if(!configuration["Vimeo"]) {
      $("#tab_video_vimeo").css("display", "none")
    }
    if(!configuration["Flickr"]) {
      $("#tab_pic_flikr").css("display", "none")
    }
  };
  var getConfiguration = function() {
    return configuration
  };
  return{init:init, applyConfiguration:applyConfiguration, getConfiguration:getConfiguration}
}(VISH, jQuery);
VISH.Debugging = function(V, $, undefined) {
  var developping = false;
  var settings;
  var presentationOptions;
  var init = function(options) {
    if(options) {
      if(typeof options["developping"] == "boolean") {
        developping = options["developping"];
        if(developping) {
          presentationOptions = options;
          if(options["developmentSettings"]) {
            settings = options["developmentSettings"]
          }
        }
      }else {
        developping = false;
        settings = null
      }
    }else {
      developping = false;
      settings = null
    }
  };
  var log = function(text) {
    if(window.console && window.console.log && developping) {
      console.log(text)
    }
  };
  var shuffleJson = function(json) {
    return _shuffle(json)
  };
  var _shuffle = function(o) {
    for(var j, x, i = o.length;i;j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x) {
    }
    return o
  };
  var enableDevelopingMode = function() {
    developping = true
  };
  var disableDevelopingMode = function() {
    developping = false
  };
  var isDevelopping = function() {
    return developping
  };
  var getActionSave = function() {
    if(settings) {
      return settings.actionSave
    }else {
      return"view"
    }
  };
  var getActionInit = function() {
    if(settings) {
      return settings.actionInit
    }else {
      return"nothing"
    }
  };
  var getPresentationSamples = function() {
    if(settings && settings.samples) {
      return settings.samples
    }else {
      log("VISH.Debugging Error: Please specify development settings");
      return null
    }
  };
  var initVishViewer = function() {
    var mypresentation = null;
    if(V.Editing) {
      if(!presentationOptions) {
        log("VISH.Debugging Error: Specify presentationOptions");
        return
      }
      mypresentation = V.Editor.getSavedPresentation();
      if(mypresentation === null) {
        mypresentation = V.Editor.savePresentation()
      }
    }else {
      log("You are already in Vish Viewer");
      return
    }
    $("article").remove();
    $("#menubar").hide();
    $("#menubar_helpsection").hide();
    $("#menubar_helpsection2").hide();
    $("#joyride_help_button").hide();
    $("#preview_circle").hide();
    V.Editor.Tools.cleanZoneTools();
    V.Editor.Tools.disableToolbar();
    $("#menubar-viewer").show();
    V.SlideManager.init(presentationOptions, mypresentation)
  };
  var initVishEditor = function() {
    var mypresentation = null;
    if(V.Editing) {
      log("You are already in Vish Editor");
      return
    }else {
      if(!presentationOptions) {
        log("VISH.Debugging Error: Specify presentationOptions");
        return
      }
      mypresentation = V.Editor.getSavedPresentation()
    }
    $("article").remove();
    $("#menubar").show();
    $("#menubar_helpsection").show();
    $("#menubar_helpsection2").show();
    $("#joyride_help_button").show();
    $("#preview_circle").show();
    V.Editor.Tools.enableToolbar();
    $("#menubar-viewer").hide();
    V.Editor.init(presentationOptions, mypresentation)
  };
  return{init:init, log:log, shuffleJson:shuffleJson, enableDevelopingMode:enableDevelopingMode, disableDevelopingMode:disableDevelopingMode, isDevelopping:isDevelopping, getActionSave:getActionSave, getActionInit:getActionInit, getPresentationSamples:getPresentationSamples, initVishViewer:initVishViewer, initVishEditor:initVishEditor}
}(VISH, jQuery);
VISH.Editor.API = function(V, $, undefined) {
  var init = function() {
  };
  var requestExcursions = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.excursionsList;
        successCallback(result)
      }
      return
    }
    _requestByType("excursion", text, successCallback, failCallback)
  };
  var requestRecomendedExcursions = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.excursionsList;
        successCallback(result)
      }
      return
    }
    _requestByType("excursion", "", successCallback, failCallback)
  };
  var requestSmartcards = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.smartcardList;
        successCallback(result)
      }
      return
    }
    _requestByType("smartcard", text, successCallback, failCallback)
  };
  var requestRecomendedSmartcards = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.smartcardList;
        successCallback(result)
      }
      return
    }
    _requestByType("smartcard", "", successCallback, failCallback)
  };
  var requestVideos = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = jQuery.extend({}, V.Samples.API.videoList);
        switch(text) {
          case "dummy":
            result["videos"] = V.Samples.API.videoListDummy["videos"];
            break;
          case "little":
            result["videos"] = V.Debugging.shuffleJson(V.Samples.API.videoListLittle["videos"]);
            break;
          default:
            result["videos"] = V.Debugging.shuffleJson(V.Samples.API.videoList["videos"])
        }
        successCallback(result)
      }
      return
    }
    _requestByType("video", text, successCallback, failCallback)
  };
  var requestRecomendedVideos = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.videoList;
        result["videos"] = V.Debugging.shuffleJson(V.Samples.API.videoList["videos"]);
        successCallback(result)
      }
      return
    }
    _requestByType("video", "", successCallback, failCallback)
  };
  var requestFlashes = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = jQuery.extend({}, V.Samples.API.flashList);
        switch(text) {
          case "dummy":
            result["flashes"] = V.Samples.API.flashListDummy["flashes"];
            break;
          case "little":
            result["flashes"] = V.Debugging.shuffleJson(V.Samples.API.flashListLittle["flashes"]);
            break;
          default:
            result["flashes"] = V.Debugging.shuffleJson(V.Samples.API.flashList["flashes"])
        }
        successCallback(result)
      }
      return
    }
    _requestByType("swfs", text, successCallback, failCallback)
  };
  var requestRecomendedFlashes = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.flashList;
        result["flashes"] = V.Debugging.shuffleJson(V.Samples.API.flashList["flashes"]);
        successCallback(result)
      }
      return
    }else {
      _requestByType("swfs", "", successCallback, failCallback)
    }
  };
  var requestImages = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = jQuery.extend({}, V.Samples.API.imageList);
        switch(text) {
          case "dummy":
            result["pictures"] = V.Samples.API.imageListDummy["pictures"];
            break;
          case "little":
            result["pictures"] = V.Debugging.shuffleJson(V.Samples.API.imageListLittle["pictures"]);
            break;
          default:
            result["pictures"] = V.Debugging.shuffleJson(V.Samples.API.imageList["pictures"])
        }
        successCallback(result)
      }
      return
    }
    _requestByType("picture", text, successCallback, failCallback)
  };
  var requestRecomendedImages = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Samples.API.imageList;
        result["pictures"] = V.Debugging.shuffleJson(V.Samples.API.imageList["pictures"]);
        successCallback(result)
      }
      return
    }
    _requestByType("picture", "", successCallback, failCallback)
  };
  var requestLives = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = jQuery.extend({}, V.Samples.API.liveList);
        switch(text) {
          case "dummy":
            result = V.Samples.API.liveListDummy;
            break;
          case "little":
            result = V.Debugging.shuffleJson(V.Samples.API.liveListLittle);
            break;
          default:
            result = V.Debugging.shuffleJson(V.Samples.API.liveList)
        }
        successCallback(result)
      }
      return
    }
    _requestByType("live", text, successCallback, failCallback)
  };
  var requestRecomendedLives = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Debugging.shuffleJson(V.Samples.API.liveList);
        successCallback(result)
      }
      return
    }
    _requestByType("live", "", successCallback, failCallback)
  };
  var requestObjects = function(text, successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = jQuery.extend({}, V.Samples.API.objectList);
        switch(text) {
          case "dummy":
            result = V.Samples.API.objectListDummy;
            break;
          case "little":
            result = V.Debugging.shuffleJson(V.Samples.API.objectListLittle);
            break;
          default:
            result = V.Debugging.shuffleJson(V.Samples.API.objectList)
        }
        successCallback(result)
      }
      return
    }
    _requestByType("object", text, successCallback, failCallback)
  };
  var requestRecomendedObjects = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        var result = V.Debugging.shuffleJson(V.Samples.API.objectList);
        successCallback(result)
      }
      return
    }
    _requestByType("object", "", successCallback, failCallback)
  };
  var _requestByType = function(type, query, successCallback, failCallback) {
    if(type === "live" || type === "object") {
      _requestResourceType(type, query, successCallback, failCallback);
      return
    }else {
      if(type === "excursion" || type === "smartcard") {
        _requestExcursionType(type, query, successCallback, failCallback);
        return
      }
    }
    $.ajax({type:"GET", url:"/search.json?type=" + type + "&q=" + query, dataType:"html", success:function(response) {
      if(typeof successCallback == "function") {
        var resp = JSON.parse(response);
        successCallback(resp)
      }
    }, error:function(xhr, ajaxOptions, thrownError) {
      if(typeof failCallback == "function") {
        failCallback()
      }
    }})
  };
  var _requestResourceType = function(type, query, successCallback, failCallback) {
    $.ajax({type:"GET", url:"/resources/search.json?" + type + "=1&q=" + query, dataType:"html", success:function(response) {
      if(typeof successCallback == "function") {
        var resp = JSON.parse(response);
        successCallback(resp)
      }
    }, error:function(xhr, ajaxOptions, thrownError) {
      if(typeof failCallback == "function") {
        failCallback()
      }
    }})
  };
  var _requestExcursionType = function(type, query, successCallback, failCallback) {
    if(type === "excursion") {
      type = ""
    }
    $.ajax({type:"GET", url:"/excursions/search.json?type=" + type + "&q=" + query, dataType:"html", success:function(response) {
      if(typeof successCallback == "function") {
        var resp = JSON.parse(response);
        successCallback(resp)
      }
    }, error:function(xhr, ajaxOptions, thrownError) {
      if(typeof failCallback == "function") {
        failCallback()
      }
    }})
  };
  var tags;
  var requestTags = function(successCallback, failCallback) {
    if(tags && typeof successCallback == "function") {
      successCallback(tags);
      return
    }
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        tags = V.Samples.API.tagsList["tags"];
        successCallback(V.Samples.API.tagsList["tags"])
      }
      return
    }
    $.ajax({type:"GET", url:"/tags.json?mode=popular&limit=100", dataType:"html", success:function(response) {
      if(typeof successCallback == "function") {
        var tagsJSON = JSON.parse(response);
        tags = [];
        if(tagsJSON.length > 0) {
          $.each(tagsJSON, function(index, tagJSON) {
            tags.push(tagJSON.value)
          })
        }
        successCallback(tags)
      }
    }, error:function(xhr, ajaxOptions, thrownError) {
      if(typeof failCallback == "function") {
        failCallback()
      }
    }})
  };
  var requestThumbnails = function(successCallback, failCallback) {
    if(V.Utils.getOptions().configuration.mode == V.Constant.NOSERVER) {
      if(typeof successCallback == "function") {
        successCallback(V.Samples.API.thumbnailsList)
      }
      return
    }
    $.ajax({async:false, type:"GET", url:"/excursion_thumbnails.json", dataType:"json", success:function(data) {
      if(typeof successCallback == "function") {
        successCallback(data)
      }
    }, error:function(xhr, ajaxOptions, thrownError) {
      if(typeof failCallback == "function") {
        failCallback(xhr, ajaxOptions, thrownError)
      }
    }})
  };
  return{init:init, requestExcursions:requestExcursions, requestRecomendedExcursions:requestRecomendedExcursions, requestSmartcards:requestSmartcards, requestRecomendedSmartcards:requestRecomendedSmartcards, requestVideos:requestVideos, requestRecomendedVideos:requestRecomendedVideos, requestImages:requestImages, requestRecomendedImages:requestRecomendedImages, requestFlashes:requestFlashes, requestRecomendedFlashes:requestRecomendedFlashes, requestObjects:requestObjects, requestRecomendedObjects:requestRecomendedObjects, 
  requestLives:requestLives, requestRecomendedLives:requestRecomendedLives, requestTags:requestTags, requestThumbnails:requestThumbnails}
}(VISH, jQuery);
VISH.Editor.AvatarPicker = function(V, $, undefined) {
  var avatars = null;
  var selectedAvatar;
  var thumbnailsDetailsId = "thumbnails_in_presentation_details";
  var carrouselDivId = "avatars_carrousel";
  var init = function() {
    $("#hidden_button_to_uploadThumbnail").fancybox({"autoDimensions":false, "width":800, "scrolling":"no", "height":600, "padding":0, "onStart":function(data) {
      V.Editor.Image.setAddContentMode(V.Constant.THUMBNAIL);
      V.Editor.Utils.loadTab("tab_pic_from_url")
    }, "onClosed":function(data) {
      V.Editor.Image.setAddContentMode(V.Constant.NONE)
    }})
  };
  var onLoadPresentationDetails = function(mySelectedAvatar) {
    if(mySelectedAvatar) {
      selectedAvatar = mySelectedAvatar
    }
    if(avatars === null) {
      $("#" + thumbnailsDetailsId).hide();
      V.Editor.API.requestThumbnails(_onThumbnailsReceived, _onThumbnailsError)
    }else {
      _selectAvatarInCarrousel(selectedAvatar)
    }
  };
  var onCustomThumbnailSelected = function(thumbnail_url) {
    V.Editor.Tools.Menu.displaySettings();
    _addCustomThumbnail(thumbnail_url)
  };
  var _addCustomThumbnail = function(thumbnail_url) {
    var element = $("<div class='carrousel_element_single_row_thumbnails'><img class='carrousel_element_single_row_thumbnails carrousel_last_added_element' src='" + thumbnail_url + "'/></div>")[0];
    V.Editor.Carrousel.insertElement(carrouselDivId, element, 1);
    var element = $(".carrousel_last_added_element");
    $(element).click(function(event) {
      _onAvatarSelected(event)
    });
    V.Editor.Carrousel.goToElement(carrouselDivId, $(element)[0]);
    $(element).trigger("click");
    $(element).removeClass("carrousel_last_added_element")
  };
  var _onAvatarSelected = function(event) {
    if($(event.target)[0].tagName !== "IMG") {
      return
    }else {
      var avatar = $(event.target)
    }
    if($(avatar).hasClass("uploadThumbnail")) {
      $("#hidden_button_to_uploadThumbnail").trigger("click");
      return
    }
    $(".carrousel_element_single_row_thumbnails").removeClass("selectedThumbnail");
    $(avatar).addClass("selectedThumbnail");
    $("#presentation_avatar").val($(event.target).attr("src"))
  };
  var _selectRandom = function(max) {
    var randomnumber = Math.ceil(Math.random() * max) + 1;
    $("#" + carrouselDivId + " .carrousel_element_single_row_thumbnails:nth-child(" + randomnumber + ") img").addClass("selectedThumbnail");
    $("#presentation_avatar").val($("#" + carrouselDivId + " .carrousel_element_single_row_thumbnails:nth-child(" + randomnumber + ") img").attr("src"))
  };
  var _selectDefaultAvatarInCarrousel = function(avatar) {
    if(avatar) {
      var avatarName = avatar.split("/").pop();
      var avatarImages = $("#" + carrouselDivId).find("img.carrousel_element_single_row_thumbnails");
      $.each(avatarImages, function(i, image) {
        if($(image).attr("src").split("/").pop() === avatarName) {
          $(image).addClass("selectedThumbnail");
          V.Editor.Carrousel.goToElement(carrouselDivId, $(image))
        }
      })
    }
  };
  var _selectAvatarInCarrousel = function(avatar) {
    if(avatar) {
      var avatarImages = $("#" + carrouselDivId).find("img.carrousel_element_single_row_thumbnails");
      $.each(avatarImages, function(i, image) {
        if($(image).attr("src") === avatar) {
          $(image).addClass("selectedThumbnail");
          V.Editor.Carrousel.goToElement(carrouselDivId, $(image))
        }
      })
    }
  };
  var _onThumbnailsReceived = function(data) {
    avatars = data;
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    var content = "";
    var carrouselImages = [];
    carrouselImages.push($("<img class='uploadThumbnail' src='" + V.ImagesPath + "icons/addThumbnail.png'/>")[0]);
    $.each(avatars.pictures, function(i, item) {
      var myImg = $("<img src=" + item.src + " />");
      carrouselImages.push($(myImg)[0])
    });
    V.Utils.Loader.loadImagesOnCarrouselOrder(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onThumbnailsError = function(xhr, ajaxOptions, thrownError) {
    V.Debugging.log("_onThumbnailsError");
    V.Debugging.log("status returned by server:" + xhr.status);
    V.Debugging.log("Error in client: " + thrownError);
    V.Debugging.log("ERROR!" + thrownError)
  };
  var _onImagesLoaded = function() {
    $("#" + thumbnailsDetailsId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onAvatarSelected;
    options["rowItems"] = 5;
    options["styleClass"] = "thumbnails";
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options);
    $(".buttonintro").addClass("buttonintro_extramargin");
    $(".buttonpedagogical").addClass("buttonpedagogical_extramargin");
    if(selectedAvatar) {
      if(!_isDefaultAvatar(selectedAvatar)) {
        _addCustomThumbnail(selectedAvatar)
      }else {
        _selectDefaultAvatarInCarrousel(selectedAvatar)
      }
    }else {
      _selectRandom(4)
    }
  };
  var _isDefaultAvatar = function(avatar) {
    if(!avatar) {
      return false
    }
    var namePattern = "(^excursion-)";
    var avatarName = avatar.split("/").pop();
    if(avatarName.match(namePattern) === null) {
      return false
    }
    var pathPattern = "(^" + V.ImagesPath + ")";
    return avatar.match(pathPattern) !== null
  };
  return{init:init, onLoadPresentationDetails:onLoadPresentationDetails, onCustomThumbnailSelected:onCustomThumbnailSelected, _isDefaultAvatar:_isDefaultAvatar}
}(VISH, jQuery);
VISH.Editor.Carrousel = function(V, $, undefined) {
  var createCarrousel = function(containerId, options) {
    if(!containerId) {
      return
    }
    var rows = 1;
    var rowItems = 5;
    var scrollItems = null;
    var styleClass = "";
    var titleClass = "";
    var callback = null;
    var width = 650;
    var startAtLastElement = false;
    var pagination = true;
    var sortable = false;
    var afterCreateCarruselFunction = null;
    if(options) {
      if(options["rows"]) {
        rows = options["rows"]
      }
      if(options["rowItems"]) {
        rowItems = options["rowItems"]
      }
      if(options["scrollItems"]) {
        scrollItems = options["scrollItems"]
      }
      if(options["styleClass"]) {
        styleClass = options["styleClass"]
      }
      if(options["titleClass"]) {
        titleClass = options["titleClass"]
      }
      if(options["callback"]) {
        callback = options["callback"]
      }
      if(options["width"]) {
        width = options["width"]
      }
      if(options["startAtLastElement"]) {
        startAtLastElement = options["startAtLastElement"]
      }
      if(typeof options["pagination"] == "boolean") {
        pagination = options["pagination"]
      }
      if(typeof options["sortable"] == "boolean") {
        sortable = options["sortable"]
      }
      if(options["afterCreateCarruselFunction"]) {
        afterCreateCarruselFunction = options["afterCreateCarruselFunction"]
      }
    }
    var multipleRow = rows > 1;
    var carrouselClass = "";
    if(styleClass) {
      carrouselClass = "_" + styleClass
    }
    if(!scrollItems) {
      scrollItems = rowItems
    }
    if(multipleRow) {
      var rowClass = "multiple_row" + carrouselClass
    }else {
      var rowClass = "single_row" + carrouselClass
    }
    var wrapperDiv = $("#" + containerId);
    wrapperDiv.attr("class", "image_carousel image_carousel_" + rowClass);
    wrapperDiv.removeAttr("id");
    var mainDiv = document.createElement("div");
    $(mainDiv).html($(wrapperDiv).html());
    $(wrapperDiv).html("");
    mainDiv.setAttribute("id", containerId);
    var clearFix = document.createElement("div");
    clearFix.setAttribute("class", "clearfix");
    var button_prev = document.createElement("a");
    var button_next = document.createElement("a");
    button_prev.setAttribute("class", "prev");
    button_next.setAttribute("class", "next");
    $(button_prev).addClass("prev_" + rowClass);
    $(button_next).addClass("next_" + rowClass);
    button_prev.setAttribute("href", "#");
    button_next.setAttribute("href", "#");
    button_prev.setAttribute("id", "carrousel_prev" + containerId);
    button_next.setAttribute("id", "carrousel_next" + containerId);
    $(button_prev).html("<span>prev</span>");
    $(button_next).html("<span>next</span>");
    $(wrapperDiv).append(clearFix);
    $(wrapperDiv).append(button_prev);
    $(wrapperDiv).append(button_next);
    if(pagination) {
      var paginationDiv = document.createElement("div");
      paginationDiv.setAttribute("class", "pagination pagination_" + rowClass);
      paginationDiv.setAttribute("id", "carrousel_pag" + containerId);
      $(wrapperDiv).append(paginationDiv)
    }
    $(mainDiv).children().addClass("carrousel_element_" + rowClass);
    $(mainDiv).children().each(function(index, value) {
      $(value).children().addClass("carrousel_element_" + rowClass)
    });
    if(callback && typeof callback == "function") {
      $(mainDiv).children().click(function(event) {
        callback(event)
      })
    }
    if(multipleRow) {
      _applyMultipleRows(containerId, wrapperDiv, mainDiv, rows, rowItems, scrollItems, rowClass, width)
    }else {
      $(wrapperDiv).prepend(mainDiv);
      if(startAtLastElement) {
        var start = $(mainDiv).children().length - rowItems + 1
      }else {
        var start = 0
      }
      _setMainCarrousel(containerId, containerId, rows, [], rowItems, scrollItems, width, start, function() {
        if(pagination) {
          _forceShowPagination(containerId)
        }
        if(sortable) {
          $("#" + containerId).sortable()
        }
        if(typeof afterCreateCarruselFunction === "function") {
          afterCreateCarruselFunction()
        }
      })
    }
    return
  };
  var _applyMultipleRows = function(containerId, wrapperDiv, mainDiv, rows, rowItems, scrollItems, rowClass, width) {
    var synchronizeIds = [];
    var i;
    for(i = 0;i < rows;i++) {
      window[mainDiv.id + "_row" + i] = document.createElement("div");
      window[mainDiv.id + "_row" + i].setAttribute("id", mainDiv.id + "_row" + i);
      window[mainDiv.id + "_row" + i].setAttribute("class", "carrousel_wrapper_" + rowClass);
      if(i != 0) {
        synchronizeIds.push(mainDiv.id + "_row" + i)
      }
    }
    $(mainDiv).children().each(function(index, value) {
      $(window[mainDiv.id + "_row" + index % rows]).append(value)
    });
    for(i = rows - 1;i >= 0;i--) {
      $(wrapperDiv).prepend(window[mainDiv.id + "_row" + i]);
      if(i == 0) {
        var newContainerId = mainDiv.id + "_row" + i;
        _setMainCarrousel(newContainerId, containerId, rows, synchronizeIds, rowItems, scrollItems, width)
      }else {
        _setRowCarrousel(mainDiv.id + "_row" + i, rowItems, scrollItems, width)
      }
    }
    $(".caroufredsel_wrapper").css("margin-bottom", "30px")
  };
  var _setRowCarrousel = function(id, rowItems, scrollItems, width) {
    $("#" + id).carouFredSel({auto:false, circular:false, infinite:false, width:width, scroll:{items:scrollItems, fx:"scroll", duration:1E3, timeoutDuration:2E3}, items:{visible:{min:rowItems, max:rowItems}}})
  };
  var _setMainCarrousel = function(id, widgetsId, rows, synchronizeIds, rowItems, scrollItems, width, start, afterCreateCarruselFunction) {
    if(!start) {
      start = 0
    }
    $("#" + id).carouFredSel({circular:false, infinite:false, auto:false, width:width, scroll:{items:scrollItems, duration:1E3, timeoutDuration:2E3}, items:{visible:{min:rowItems, max:rowItems}, start:start}, prev:{button:"#carrousel_prev" + widgetsId, key:"left"}, next:{button:"#carrousel_next" + widgetsId, key:"right"}, pagination:"#carrousel_pag" + widgetsId, onCreate:afterCreateCarruselFunction});
    if(synchronizeIds) {
      $(synchronizeIds).each(function(index, value) {
        $("#" + id).trigger("configuration", ["synchronise", "#" + value])
      })
    }
    $("#" + id).attr("rows", rows)
  };
  var cleanCarrousel = function(containerId) {
    $("#" + containerId).html("");
    var containderIdForMultiRow = containerId + "_row0";
    if($("#" + containderIdForMultiRow).attr("rows")) {
      var rows = $("#" + containderIdForMultiRow).attr("rows");
      var i;
      for(i = 0;i < rows;i++) {
        _cleanOneRowCarrousel(containerId + "_row" + i)
      }
      $("#" + containderIdForMultiRow).attr("id", containerId)
    }else {
      _cleanOneRowCarrousel(containerId)
    }
  };
  var _cleanOneRowCarrousel = function(containerId) {
    var carrouselWrapper = $("#" + containerId).parent().parent();
    if($(carrouselWrapper).hasClass("image_carousel")) {
      $(carrouselWrapper).removeClass();
      $(carrouselWrapper).html("");
      $(carrouselWrapper).attr("id", containerId)
    }
  };
  var _forceShowPagination = function(containerId) {
    var parent = $("#" + containerId).parent().parent();
    if($(parent).hasClass("image_carousel")) {
      $(parent).find(".pagination").attr("style", "")
    }
  };
  var goToElement = function(carrouselDivId, element) {
    if($(element).is("IMG")) {
      element = $(element).parent()
    }
    $("#" + carrouselDivId).trigger("slideTo", element)
  };
  var advanceCarrousel = function(carrouselDivId, no) {
    $("#" + carrouselDivId).trigger("next", no)
  };
  var backCarrousel = function(carrouselDivId, no) {
    $("#" + carrouselDivId).trigger("prev", no)
  };
  var insertElement = function(carrouselDivId, element, posc) {
    $("#" + carrouselDivId).trigger("insertItem", [element, posc])
  };
  var mustMoveCarrousel = function(direction) {
    if(!V.Editor.Slides.isSlideFocused()) {
      return false
    }
    var visibleThumbnails = V.Editor.Thumbnails.getVisibleThumbnails();
    switch(direction) {
      case "next":
        var last = visibleThumbnails[1];
        var future = V.Slides.getCurrentSlideNumber() + 1;
        if(future > last) {
          return true
        }
        break;
      case "prev":
        var first = visibleThumbnails[0];
        var future = V.Slides.getCurrentSlideNumber() - 1;
        if(future < first) {
          return true
        }
        break;
      default:
        return false
    }
  };
  return{createCarrousel:createCarrousel, cleanCarrousel:cleanCarrousel, goToElement:goToElement, advanceCarrousel:advanceCarrousel, backCarrousel:backCarrousel, insertElement:insertElement, mustMoveCarrousel:mustMoveCarrousel}
}(VISH, jQuery);
VISH.Editor.Clipboard = function(V, $, undefined) {
  var stack;
  var _lastTimestamp;
  var init = function() {
    stack = [null, null, null]
  };
  var copy = function(element, type) {
    if(element) {
      var params = {};
      switch(type) {
        case V.Constant.Clipboard.Slide:
          var slideType = V.Slides.getSlideType(element);
          switch(slideType) {
            case V.Constant.STANDARD:
              params.textAreas = V.Editor.Slides.copyTextAreasOfSlide(element);
              break;
            case V.Constant.FLASHCARD:
            ;
            case V.Constant.VTOUR:
              var slidesetModule = V.Editor.Slideset.getModule(slideType);
              params.JSON = jQuery.extend(true, {}, slidesetModule.getSlideset(element.id));
              break;
            default:
              break
          }
          break;
        default:
          return
      }
      stack[0] = V.Utils.getOuterHTML($(element).clone()[0]);
      stack[1] = type;
      stack[2] = params;
      if(V.Status.getDevice().features.localStorage) {
        localStorage.setItem(V.Constant.Clipboard.LocalStorageStack, JSON.stringify(stack))
      }
    }
  };
  var paste = function() {
    if(_lastTimestamp) {
      var elapsed = (new Date).getTime() - _lastTimestamp;
      if(elapsed < 500) {
        return
      }
    }
    _lastTimestamp = (new Date).getTime();
    if(V.Status.getDevice().features.localStorage) {
      var storedStack = localStorage.getItem(V.Constant.Clipboard.LocalStorageStack);
      if(storedStack !== null) {
        var myStack = JSON.parse(storedStack)
      }
    }
    if(!myStack) {
      myStack = stack
    }
    if(!myStack[0]) {
      return
    }else {
      myStack[0] = $(myStack[0])[0]
    }
    switch(myStack[1]) {
      case V.Constant.Clipboard.Slide:
        var slideToCopy = $(myStack[0]).clone()[0];
        var options = {};
        if(myStack[2]) {
          if(myStack[2].textAreas) {
            options.textAreas = myStack[2].textAreas
          }
          if(myStack[2].JSON) {
            options.JSON = myStack[2].JSON
          }
        }
        V.Editor.Slides.copySlide(slideToCopy, options);
        break;
      default:
        break
    }
  };
  return{init:init, copy:copy, paste:paste}
}(VISH, jQuery);
VISH.Editor.Dummies = function(V, undefined) {
  var dummies = [];
  var init = function() {
    dummies = ["<article id='article_id_to_change' type='standard' template='t1' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='left' \t size='large' class='t1_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='header' size='small' class='t1_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='subheader' size='extra-small' class='t1_subheader editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t2' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='left' \t size='large' class='t2_left editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t3' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t3_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='large'  class='t3_left editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t4' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t4_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='large'  class='t4_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='right'  size='small'  class='t4_right editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t5' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t5_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='medium' class='t5_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='right'  size='medium' class='t5_right editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t6' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t6_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='medium' class='t6_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='center' size='medium' class='t6_center editable grey_background selectable'></div><div id='div_id_to_change' areaid='right' size='medium'    class='t6_right editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t7' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t7_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='medium' class='t7_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='center' size='large'  class='t7_center editable grey_background selectable'></div><div id='div_id_to_change' areaid='subheader' size='small' class='t7_subheader editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t8' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t8_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='small'  class='t8_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='center' size='large'  class='t8_center editable grey_background selectable'></div><div id='div_id_to_change' areaid='right' size='small'     class='t8_right editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t9' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t9_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='medium' class='t9_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='center' size='medium' class='t9_center editable grey_background selectable'></div><div id='div_id_to_change' areaid='right' size='medium'    class='t9_right editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t10' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='center'  size='large' class='t10_center editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t11' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='center1' size='medium' class='t11_center1 editable grey_background selectable'></div><div id='div_id_to_change' areaid='center2' size='medium'  class='t11_center2 editable grey_background selectable'></div><div id='div_id_to_change' areaid='center3'  size='medium'  class='t11_center3 editable grey_background selectable'></div></article>", "<article id='article_id_to_change' type='standard' template='t12' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + 
    V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='left1'   size='medium' class='t12_left1 editable grey_background selectable'></div><div id='div_id_to_change' areaid='right1' size='medium' class='t12_right1 editable grey_background selectable'></div><div id='div_id_to_change' areaid='left2' size='medium' class='t12_left2 editable grey_background selectable'></div><div id='div_id_to_change' areaid='right2' size='medium'  class='t12_right2 editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t13' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='header'  size='small' class='t13_header editable grey_background selectable'></div><div id='div_id_to_change' areaid='circle' size='medium' class='t13_circle editable grey_background selectable'></div><div id='div_id_to_change' areaid='left' size='medium' class='t13_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='right' size='medium'  class='t13_right editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t14' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='circle1' size='small' class='t14_circle1 editable grey_background selectable'></div><div id='div_id_to_change' areaid='right1' size='medium' class='t14_right1 editable grey_background selectable'></div><div id='div_id_to_change' areaid='circle2' size='small' class='t14_circle2 editable grey_background selectable'></div><div id='div_id_to_change' areaid='right2' size='medium' class='t14_right2 editable grey_background selectable'></div><div id='div_id_to_change' areaid='circle3' size='small' class='t14_circle3 editable grey_background selectable'></div><div id='div_id_to_change' areaid='right3' size='medium' class='t14_right3 editable grey_background selectable'></div></article>", 
    "<article id='article_id_to_change' type='standard' template='t15' slidenumber='slidenumber_to_change'><div class='delete_slide'></div><img class='help_in_template' id='help_template_image' src='" + V.ImagesPath + "icons/helptutorial_circle_blank.png'/><div id='div_id_to_change' \tareaid='left' \t size='medium' class='t15_left editable grey_background selectable'></div><div id='div_id_to_change' areaid='center' size='medium' class='t15_center editable grey_background selectable'></div><div id='div_id_to_change' areaid='right' size='medium' class='t15_right editable grey_background selectable'></div><div id='div_id_to_change' areaid='center2' size='large' class='t15_center2 editable grey_background selectable'></div></article>"]
  };
  var getDummy = function(template, slideNumber) {
    var dummy = dummies[parseInt(template, 10) - 1];
    return _replaceIds(dummy, slideNumber)
  };
  var getScaffold = function(template, slideNumber, articleId, zoneIds) {
    var dummy = dummies[parseInt(template, 10) - 1];
    return _removeEditable(_replaceIds(dummy, slideNumber, articleId, zoneIds))
  };
  var getScaffoldForSlide = function(template, slideNumber, slide) {
    var zoneIds = [];
    for(el in slide.elements) {
      zoneIds.push(slide.elements[el].id)
    }
    return getScaffold(template, slideNumber, slide.id, zoneIds)
  };
  var _replaceIds = function(dummy, slideNumber, articleId, zoneIds) {
    var newDummy = dummy;
    var nextZoneId = 0;
    if(!articleId) {
      articleId = V.Utils.getId("article")
    }
    if(newDummy.indexOf("article_id_to_change") != -1) {
      newDummy = newDummy.replace("article_id_to_change", articleId)
    }
    while(newDummy.indexOf("slidenumber_to_change") != -1) {
      newDummy = newDummy.replace("slidenumber_to_change", slideNumber)
    }
    while(newDummy.indexOf("div_id_to_change") != -1) {
      if(zoneIds) {
        var newZoneId = zoneIds[nextZoneId];
        nextZoneId++
      }else {
        var newZoneId = V.Utils.getId(articleId + "_zone")
      }
      newDummy = newDummy.replace("div_id_to_change", newZoneId)
    }
    return newDummy
  };
  var _removeEditable = function(dummy) {
    return dummy.replace(/editable /g, "")
  };
  return{init:init, getDummy:getDummy, getScaffold:getScaffold, getScaffoldForSlide:getScaffoldForSlide}
}(VISH);
VISH.Editor.Events = function(V, $, undefined) {
  var bindedEventListeners = false;
  var init = function() {
    if(V.Editing) {
      bindEditorEventListeners()
    }
  };
  var ctrlDown = false;
  var handleBodyKeyDown = function(event) {
    switch(event.keyCode) {
      case 39:
        if(V.Editor.Slides.isSlideFocused()) {
          V.Slides.forwardOneSlide();
          event.preventDefault()
        }
        break;
      case 37:
        if(V.Editor.Slides.isSlideFocused()) {
          V.Slides.backwardOneSlide();
          event.preventDefault()
        }
        break;
      case 17:
        ctrlDown = true;
        break;
      case 67:
        if(V.Editor.Slides.isSlideFocused()) {
          if(ctrlDown) {
            if(V.Slides.getCurrentSlideNumber()) {
              V.Editor.Clipboard.copy(V.Slides.getCurrentSlide(), V.Constant.Clipboard.Slide)
            }
          }
        }
        break;
      case 86:
        if(V.Editor.Slides.isSlideFocused()) {
          if(ctrlDown) {
            V.Editor.Clipboard.paste()
          }
        }
        break;
      case 46:
        if(V.Editor.Slides.isSlideFocused()) {
          V.Editor.Slides.removeSlide(V.Slides.getCurrentSlideNumber())
        }
        break
    }
  };
  var handleBodyKeyUp = function(event) {
    switch(event.keyCode) {
      case 17:
        ctrlDown = false;
        break
    }
  };
  var _onFlashcardPoiClicked = function(event) {
    if(V.Editor.getMode() === V.Constant.PRESENTATION) {
      V.Slides.openSubslide(event.data.slide_id, true)
    }
  };
  var _onFlashcardCloseSlideClicked = function(event) {
    var close_slide = event.target.id.substring(5);
    V.Slides.closeSubslide(close_slide, true)
  };
  var bindEditorEventListeners = function() {
    if(!bindedEventListeners) {
      var presentation = V.Editor.getPresentation();
      $(document).bind("keydown", handleBodyKeyDown);
      $(document).bind("keyup", handleBodyKeyUp);
      $(document).on("click", ".close_subslide", _onFlashcardCloseSlideClicked);
      if(V.Editing && presentation) {
        for(index in presentation.slides) {
          var slide = presentation.slides[index];
          switch(slide.type) {
            case V.Constant.FLASHCARD:
              bindEventsForFlashcard(slide);
              break;
            case V.Constant.VTOUR:
              break
          }
        }
      }
      $(window.document).on("click", function() {
        window.focus()
      });
      bindedEventListeners = true
    }
  };
  var bindEventsForFlashcard = function(slide) {
    for(ind in slide.pois) {
      var poi = slide.pois[ind];
      $(document).on("click", "#" + poi.id, {slide_id:poi.slide_id}, _onFlashcardPoiClicked)
    }
  };
  var unbindEditorEventListeners = function() {
    if(bindedEventListeners) {
      var presentation = V.Editor.getPresentation();
      if(presentation.type === "presentation") {
        $(document).unbind("keydown", handleBodyKeyDown);
        $(document).unbind("keyup", handleBodyKeyUp)
      }
      for(index in presentation.slides) {
        if(presentation.slides[index].type === "flashcard") {
          for(ind in presentation.slides[index].pois) {
            var poi = presentation.slides[index].pois[ind];
            $(document).off("click", "#" + poi.id, {slide_id:poi.slide_id}, _onFlashcardPoiClicked)
          }
          $(document).off("click", ".close_subslide", _onFlashcardCloseSlideClicked)
        }
      }
      $(window.document).off("click", function() {
        window.focus()
      });
      bindedEventListeners = false
    }
  };
  return{init:init, bindEditorEventListeners:bindEditorEventListeners, bindEventsForFlashcard:bindEventsForFlashcard, unbindEditorEventListeners:unbindEditorEventListeners}
}(VISH, jQuery);
VISH.Editor.Filter = function(V, $, undefined) {
  var init = function() {
    var device = V.Status.getDevice();
    var browser = device.browser;
    switch(browser.name) {
      case V.Constant.IE:
        $("#tab_object_snapshot").hide();
        break;
      case V.Constant.UNKNOWN:
        $("#tab_object_snapshot").hide();
        break
    }
  };
  return{init:init}
}(VISH, jQuery);
VISH.Editor.Flashcard.Creator = function(V, $, undefined) {
  var flashcardId;
  var currentPois = undefined;
  var trustOrgPois = false;
  var init = function() {
    flashcardId = null
  };
  var getId = function() {
    return flashcardId
  };
  var onLoadMode = function() {
    loadSlideset();
    V.Editor.Thumbnails.redrawThumbnails();
    V.Editor.Tools.init()
  };
  var onLeaveMode = function() {
    currentPois = _getCurrentPois();
    $("#flashcard-background").hide()
  };
  var loadSlideset = function(presentation) {
    V.Editor.setPresentationType(V.Constant.FLASHCARD);
    V.Editor.Slides.hideSlides();
    $("#flashcard-background").show();
    if(presentation) {
      var flashcard = presentation.slides[0];
      flashcardId = flashcard.id;
      $("#flashcard-background").attr("flashcard_id", flashcardId);
      $("#flashcard-background").css("background-image", flashcard.background);
      $("#fc_change_bg_big").hide();
      trustOrgPois = true
    }else {
      if(!flashcardId) {
        flashcardId = V.Utils.getId("article")
      }
      $("#flashcard-background").attr("flashcard_id", flashcardId)
    }
    $("#flashcard-background").droppable()
  };
  var onBackgroundSelected = function(contentToAdd) {
    $("#flashcard-background").css("background-image", "url(" + contentToAdd + ")");
    $("#fc_change_bg_big").hide();
    $.fancybox.close()
  };
  var redrawPois = function() {
    $(".draggable_arrow_div").show();
    _applyStyleToPois();
    $(".draggable_arrow_div").draggable({revert:"invalid", stop:function(event, ui) {
      if($(event.target).offset().top > 50 && $(event.target).offset().top < 600 && $(event.target).offset().left > 55 && $(event.target).offset().left < 805) {
        $(event.target).attr("moved", "true");
        var old_pos = $(event.target).offset();
        $(event.target).css("position", "fixed");
        $(event.target).css("top", old_pos.top + 30 + "px");
        $(event.target).css("left", old_pos.left - 16 + "px")
      }else {
        $(event.target).attr("moved", "false");
        var old_pos = $(event.target).offset();
        $(event.target).css("position", "relative");
        $(event.target).css("top", "auto");
        $(event.target).css("left", "auto")
      }
    }});
    $(".carrousel_element_single_row_slides").droppable()
  };
  var _applyStyleToPois = function() {
    if(typeof currentPois === "undefined" && trustOrgPois) {
      var presentation = V.Editor.getPresentation();
      if(presentation && presentation.slides && presentation.slides[0] && presentation.slides[0].pois) {
        currentPois = presentation.slides[0].pois
      }else {
        return
      }
    }
    if(typeof currentPois !== "undefined") {
      $.each(currentPois, function(index, val) {
        $("#" + val.id).css("position", "fixed");
        $("#" + val.id).offset({top:600 * parseInt(val.y) / 100 + 38, left:800 * parseInt(val.x) / 100 + 48});
        $("#" + val.id).attr("moved", "true")
      })
    }
  };
  var getPois = function() {
    var pois = [];
    $(".draggable_arrow_div[moved='true']").each(function(index, s) {
      pois[index] = {};
      pois[index].id = flashcardId + "_" + s.id;
      pois[index].x = (100 * ($(s).offset().left - 48) / 800).toString();
      pois[index].y = (100 * ($(s).offset().top - 38) / 600).toString();
      pois[index].slide_id = flashcardId + "_" + $(s).attr("slide_id")
    });
    return pois
  };
  var _getCurrentPois = function() {
    var pois = [];
    $(".draggable_arrow_div[moved='true']").each(function(index, s) {
      pois[index] = {};
      pois[index].id = s.id;
      pois[index].x = (100 * ($(s).offset().left - 48) / 800).toString();
      pois[index].y = (100 * ($(s).offset().top - 38) / 600).toString();
      pois[index].slide_id = $(s).attr("slide_id")
    });
    return pois
  };
  var _hidePois = function() {
    $(".draggable_arrow_div").hide()
  };
  var _hasPoiInBackground = function() {
    return $(".draggable_arrow_div[moved='true']").length > 0
  };
  var _hasChangedBackground = function() {
    if($("#flashcard-background").css("background-image").indexOf("flashcard_initial_background.jpg") != -1) {
      return false
    }else {
      return true
    }
  };
  var onClickCarrouselElement = function(event) {
    switch($(event.target).attr("action")) {
      case "plus":
        $.fancybox($("#message2_form").html(), {"autoDimensions":false, "scrolling":"no", "width":550, "height":200, "showCloseButton":false, "padding":5});
        break;
      case "goToSlide":
        V.Editor.Preview.preview({forcePresentation:true, slideNumberToPreview:parseInt($(event.target).attr("slideNumber"))});
        break;
      default:
        break
    }
  };
  var validateOnSave = function() {
    if(!_hasPoiInBackground()) {
      return"message3_form"
    }
    if(!_hasChangedBackground()) {
      return"message4_form"
    }
    return true
  };
  var getSlideHeader = function() {
    var slide = {};
    slide.id = flashcardId;
    slide.type = V.Constant.FLASHCARD;
    slide.background = $("#flashcard-background").css("background-image");
    slide.pois = getPois();
    slide.slides = [];
    return slide
  };
  return{init:init, getId:getId, onLoadMode:onLoadMode, onLeaveMode:onLeaveMode, loadSlideset:loadSlideset, onBackgroundSelected:onBackgroundSelected, redrawPois:redrawPois, getPois:getPois, onClickCarrouselElement:onClickCarrouselElement, getSlideHeader:getSlideHeader, validateOnSave:validateOnSave}
}(VISH, jQuery);
VISH.Editor.I18n = function(V, $, undefined) {
  var translations;
  var defaultTranslations;
  var language;
  var init = function(lang) {
    switch(V.Configuration.getConfiguration()["mode"]) {
      case V.Constant.NOSERVER:
        if(typeof i18n["vish"]["default"] !== "undefined") {
          defaultTranslations = i18n["vish"]["default"]
        }
        break;
      case V.Constant.VISH:
        if(typeof i18n["vish"]["default"] !== "undefined") {
          defaultTranslations = i18n["vish"]["default"]
        }
        break;
      case V.Constant.STANDALONE:
        if(typeof i18n["standalone"]["default"] !== "undefined") {
          defaultTranslations = i18n["standalone"]["default"]
        }
        break
    }
    if(typeof lang !== "undefined") {
      language = lang
    }else {
      return
    }
    switch(V.Configuration.getConfiguration()["mode"]) {
      case V.Constant.NOSERVER:
        if(typeof i18n["vish"][language] !== "undefined") {
          translations = i18n["vish"][language]
        }
        break;
      case V.Constant.VISH:
        if(typeof i18n["vish"][language] !== "undefined") {
          translations = i18n["vish"][language];
          defaultTranslations = i18n["vish"]["default"]
        }
        break;
      case V.Constant.STANDALONE:
        if(typeof i18n["standalone"][language] !== "undefined") {
          translations = i18n["standalone"][language];
          defaultTranslations = i18n["standalone"]["default"]
        }
        break
    }
    if(typeof translations === "undefined") {
      return
    }
    $("[i18n-key]").each(function(index, elem) {
      var translation = getTrans($(elem).attr("i18n-key"));
      if(translation != null) {
        switch(elem.tagName) {
          case "INPUT":
            _translateInput(elem, translation);
            break;
          case "TEXTAREA":
            _translateTextArea(elem, translation);
            break;
          case "DIV":
            _translateDiv(elem, translation);
            break;
          case "LI":
            _translateLI(elem, translation);
            break;
          default:
            _genericTranslate(elem, translation);
            break
        }
      }
    });
    _translateTutorialImage()
  };
  var _translateInput = function(input, translation) {
    if($(input).val() !== "") {
      $(input).val(translation)
    }
    if($(input).attr("placeholder")) {
      $(input).attr("placeholder", translation)
    }
  };
  var _translateDiv = function(div, translation) {
    if($(div).attr("title") != undefined) {
      $(div).attr("title", translation)
    }
    if($(div).attr("data-text") != undefined) {
      $(div).attr("data-text", translation)
    }
  };
  var _translateTextArea = function(textArea, translation) {
    $(textArea).attr("placeholder", translation)
  };
  var _translateLI = function(elem, translation) {
    if($(elem).attr("data-text") != undefined) {
      $(elem).attr("data-text", translation)
    }else {
      _genericTranslate(elem, translation)
    }
  };
  var _genericTranslate = function(elem, translation) {
    $(elem).text(translation)
  };
  var _translateTutorialImage = function() {
    if(typeof translations != "undefined" && typeof language !== "undefined") {
      var factor;
      if(language === "es") {
        factor = 2
      }
      var normal_pos = 360;
      var hover_pos = 480;
      $("#start_tutorial").css("background-position", "0px -" + normal_pos + "px");
      $("#start_tutorial").hover(function() {
        $("#start_tutorial").css("background-position", "0px -" + hover_pos + "px")
      }, function() {
        $("#start_tutorial").css("background-position", "0px -" + normal_pos + "px")
      });
      $("#contentusetut").attr("src", V.ImagesPath + "contentuse_" + language + ".png")
    }
  };
  var getTrans = function(s) {
    if(typeof translations !== "undefined" && translations[s]) {
      return translations[s]
    }
    if(typeof defaultTranslations !== "undefined" && defaultTranslations[s]) {
      return defaultTranslations[s]
    }
    var key_pattern = /^i\./g;
    if(key_pattern.exec(s) != null) {
      return null
    }else {
      return s
    }
  };
  return{getTrans:getTrans, init:init}
}(VISH, jQuery);
VISH.Editor.Image.Flikr = function(V, $, undefined) {
  var carrouselDivId = "tab_flikr_content_carrousel";
  var queryMaxNumberFlikrImages = 80;
  var init = function() {
    var myInput = $("#tab_pic_flikr_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        V.Editor.Image.Flikr.listImages($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    $("#tab_pic_flikr_content").find("input[type='search']").attr("value", "")
  };
  var listImages = function(text) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    var url_flikr = "http://api.flickr.com/services/feeds/photos_public.gne?tags=" + text + "&tagmode=any&format=json&jsoncallback=?";
    var carrouselImages = [];
    $.getJSON(url_flikr, function(data) {
      if(!data.items.length > 0) {
        $("#" + carrouselDivId).show();
        $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
        return
      }
      $.each(data.items, function(i, item) {
        var myImg = $("<img id=img_flkr" + i + " src=" + item.media.m.replace(/_m/i, "") + " imageFlikrId=" + i + "/>");
        carrouselImages.push(myImg)
      });
      V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
    })
  };
  var addImage = function(event) {
    var image_url = $(event.target).attr("src");
    V.Editor.Image.addContent(image_url)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 2;
    options["callback"] = V.Editor.Image.Flikr.addImage;
    options["rowItems"] = 4;
    options["scrollItems"] = 4;
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  return{init:init, onLoadTab:onLoadTab, listImages:listImages, addImage:addImage}
}(VISH, jQuery);
VISH.Editor.Image.Repository = function(V, $, undefined) {
  var carrouselDivId = "tab_pic_repo_content_carrousel";
  var previewDivId = "tab_pic_repo_content_preview";
  var currentImages = new Array;
  var selectedImage = null;
  var init = function() {
    var myInput = $("#tab_pic_repo_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        _requestData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    var previousSearch = $("#tab_pic_repo_content").find("input[type='search']").val() != "";
    if(!previousSearch) {
      _requestInitialData()
    }
  };
  var _requestInitialData = function() {
    V.Editor.API.requestRecomendedImages(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestImages(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    currentImages = new Array;
    var carrouselImages = [];
    var content = "";
    if(!data.pictures || data.pictures.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data.pictures, function(index, image) {
      var myImg = $("<img src=" + image.src + " >");
      carrouselImages.push(myImg);
      currentImages[image.id] = image
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 2;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 4;
    options["scrollItems"] = 4;
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
    V.Debugging.log("API error")
  };
  var _onClickCarrouselElement = function(event) {
    var image_url = $(event.target).attr("src");
    V.Editor.Image.addContent(image_url)
  };
  return{init:init, onLoadTab:onLoadTab}
}(VISH, jQuery);
VISH.Editor.MenuTablet = function(V, $, undefined) {
  var init = function() {
    $(".menu_option_main").click(function(event) {
      if($("ul.menu_option_main").css("display") == "none") {
        $("ul.menu_option_main > li > ul").hide();
        $("ul.menu_option_main").show()
      }else {
        $("ul.menu_option_main").hide()
      }
    });
    $("a.menu_option").click(function(event) {
      if(!$(this).hasClass("menu_action") && $(this).parent()[0].tagName === "LI" && $(this).parent().find("ul").length == 1) {
        event.preventDefault();
        event.stopPropagation();
        var subMenu = $(this).parent().find("ul")[0];
        if($(subMenu).is(":visible")) {
          $(subMenu).hide();
          return
        }
        $("ul.menu_option_main > li > ul").hide();
        $(subMenu).show()
      }else {
      }
    })
  };
  return{init:init}
}(VISH, jQuery);
VISH.Editor.Object.Flash = function(V, $, undefined) {
  var drawFlashObjectWithSource = function(src) {
    var current_area = V.Editor.getCurrentArea();
    var template = V.Editor.getTemplate();
    var nextFlashId = V.Utils.getId();
    var idToDrag = "draggable" + nextFlashId;
    var idToResize = "resizable" + nextFlashId;
    current_area.attr("type", "object");
    var embedDiv = document.createElement("div");
    embedDiv.setAttribute("id", idToDrag);
    $(embedDiv).addClass("object_wrapper");
    $(embedDiv).addClass(template + "_object");
    var embedTag = document.createElement("embed");
    embedTag.setAttribute("id", idToResize);
    embedTag.setAttribute("class", template + "_object");
    embedTag.setAttribute("src", src);
    embedTag.setAttribute("wmode", "opaque");
    $(embedDiv).append(embedTag);
    $(current_area).html("");
    $(current_area).append(embedDiv);
    V.Editor.addDeleteButton($(current_area));
    $("#" + idToDrag).draggable({cursor:"move"})
  };
  return{drawFlashObjectWithSource:drawFlashObjectWithSource}
}(VISH, jQuery);
VISH.Editor.Object.Live = function(V, $, undefined) {
  var carrouselDivId = "tab_live_webcam_content_carrousel";
  var previewDivId = "tab_live_webcam_content_preview";
  var footId = "tab_live_webcam_content_preview_foot";
  var currentObject = new Array;
  var selectedObject = null;
  var init = function() {
    var myInput = $("#tab_live_webcam_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        _requestData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function(tab) {
    if(tab != "webcam") {
      return
    }
    var previousSearch = $("#tab_live_webcam_content").find("input[type='search']").val() != "";
    if(!previousSearch) {
      _cleanObjectPreview();
      _requestInicialData()
    }
    $("#" + footId).find(".okButton").hide()
  };
  var _requestInicialData = function() {
    V.Editor.API.requestRecomendedLives(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestLives(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanObjectPreview();
    currentObject = new Array;
    var carrouselImages = [];
    var carrouselImagesTitles = [];
    var content = "";
    if(!data || data.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data, function(index, object) {
      var objectInfo = V.Object.getObjectInfo(object.fulltext);
      var imageSource = null;
      switch(objectInfo.type) {
        case "swf":
          imageSource = V.ImagesPath + "carrousel/swf.png";
          break;
        case "youtube":
          imageSource = V.ImagesPath + "carrousel/youtube.png";
          break;
        case "web":
          if(objectInfo.wrapper == "IFRAME") {
            imageSource = V.ImagesPath + "carrousel/iframe.png"
          }else {
            imageSource = V.ImagesPath + "carrousel/object.png"
          }
          break;
        default:
          imageSource = V.ImagesPath + "carrousel/object.png";
          break
      }
      var myImg = $("<img src='" + imageSource + "' objectId='" + object.id + "'>");
      carrouselImages.push(myImg);
      carrouselImagesTitles.push(object.title);
      currentObject[object.id] = object
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId, carrouselImagesTitles)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 5;
    options["styleClass"] = "title";
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
    V.Debugging.log("Error")
  };
  var _onClickCarrouselElement = function(event) {
    var objectId = $(event.target).attr("objectid");
    if(typeof objectId != "undefined") {
      var renderedObject = V.Editor.Object.renderObjectPreview(currentObject[objectId].fulltext);
      _renderObjectPreview(renderedObject, currentObject[objectId]);
      selectedObject = currentObject[objectId]
    }
  };
  var _renderObjectPreview = function(renderedObject, object) {
    var objectArea = $("#" + previewDivId).find("#tab_live_webcam_content_preview_live");
    var metadataArea = $("#" + previewDivId).find("#tab_live_webcam_content_preview_metadata");
    $(objectArea).html("");
    $(metadataArea).html("");
    if(renderedObject && object) {
      $(objectArea).append(renderedObject);
      var table = V.Editor.Utils.generateTable(object.author, object.title, object.description);
      $(metadataArea).html(table);
      $("#" + footId).find(".okButton").show()
    }
  };
  var _cleanObjectPreview = function() {
    var objectArea = $("#" + previewDivId).find("#tab_live_webcam_content_preview_live");
    var metadataArea = $("#" + previewDivId).find("#tab_live_webcam_content_preview_metadata");
    $(objectArea).html("");
    $(metadataArea).html("");
    $("#" + footId).find(".okButton").hide()
  };
  var addSelectedObject = function() {
    if(selectedObject != null) {
      V.Editor.Object.drawObject(selectedObject.fulltext);
      $.fancybox.close()
    }
  };
  return{init:init, onLoadTab:onLoadTab, addSelectedObject:addSelectedObject}
}(VISH, jQuery);
VISH.Editor.Object.PDF = function(V, $, undefined) {
  var init = function() {
  };
  var generateWrapperForPdf = function(url) {
    return"<iframe src='http://docs.google.com/viewer?url=" + url + "&embedded=true'></iframe>"
  };
  var generatePreviewWrapperForPdf = function(url) {
    return"<iframe class='objectPreview' src='http://docs.google.com/viewer?url=" + url + "&embedded=true'></iframe>"
  };
  return{init:init, generatePreviewWrapperForPdf:generatePreviewWrapperForPdf, generateWrapperForPdf:generateWrapperForPdf}
}(VISH, jQuery);
VISH.Editor.Object.Repository = function(V, $, undefined) {
  var carrouselDivId = "tab_object_repo_content_carrousel";
  var previewDivId = "tab_object_repo_content_preview";
  var footId = "tab_object_repo_content_preview_foot";
  var currentObject = new Array;
  var selectedObject = null;
  var init = function() {
    var myInput = $("#tab_object_repo_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        _requestData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    var previousSearch = $("#tab_object_repo_content").find("input[type='search']").val() != "";
    if(!previousSearch) {
      _cleanObjectPreview();
      _requestInicialData()
    }
    $("#" + footId).find(".okButton").hide()
  };
  var _requestInicialData = function() {
    V.Editor.API.requestRecomendedObjects(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestObjects(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanObjectPreview();
    currentObject = new Array;
    var carrouselImages = [];
    var carrouselImagesTitles = [];
    var content = "";
    if(!data || data.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data, function(index, objectItem) {
      var objectInfo = V.Object.getObjectInfo(objectItem.object);
      var imageSource = null;
      switch(objectInfo.type) {
        case "swf":
          imageSource = V.ImagesPath + "carrousel/swf.png";
          break;
        case "youtube":
          imageSource = V.ImagesPath + "carrousel/youtube.png";
          break;
        case "web":
          if(objectInfo.wrapper == "IFRAME") {
            imageSource = V.ImagesPath + "carrousel/iframe.png"
          }else {
            imageSource = V.ImagesPath + "carrousel/object.png"
          }
          break;
        default:
          imageSource = V.ImagesPath + "carrousel/object.png";
          break
      }
      var myImg = $("<img src='" + imageSource + "' objectId='" + objectItem.id + "'>");
      carrouselImages.push(myImg);
      carrouselImagesTitles.push(objectItem.title);
      currentObject[objectItem.id] = objectItem
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId, carrouselImagesTitles)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 5;
    options["styleClass"] = "title";
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
    V.Debugging.log("Error")
  };
  var _onClickCarrouselElement = function(event) {
    var objectId = $(event.target).attr("objectid");
    if(typeof objectId != "undefined") {
      var renderedObject = V.Editor.Object.renderObjectPreview(currentObject[objectId].object);
      _renderObjectPreview(renderedObject, currentObject[objectId]);
      selectedObject = currentObject[objectId]
    }
  };
  var _renderObjectPreview = function(renderedObject, object) {
    var objectArea = $("#" + previewDivId).find("#tab_object_repo_content_preview_object");
    var metadataArea = $("#" + previewDivId).find("#tab_object_repo_content_preview_metadata");
    $(objectArea).html("");
    $(metadataArea).html("");
    if(renderedObject && object) {
      $(objectArea).append(renderedObject);
      var table = V.Editor.Utils.generateTable(object.author, object.title, object.description);
      $(metadataArea).html(table);
      $("#" + footId).find(".okButton").show()
    }
  };
  var _cleanObjectPreview = function() {
    var objectArea = $("#" + previewDivId).find("#tab_object_repo_content_preview_object");
    var metadataArea = $("#" + previewDivId).find("#tab_object_repo_content_preview_metadata");
    $(objectArea).html("");
    $(metadataArea).html("");
    $("#" + footId).find(".okButton").hide()
  };
  var addSelectedObject = function() {
    if(selectedObject != null) {
      V.Editor.Object.drawObject(selectedObject.object);
      $.fancybox.close()
    }
  };
  return{init:init, onLoadTab:onLoadTab, addSelectedObject:addSelectedObject}
}(VISH, jQuery);
VISH.Editor.Object.Snapshot = function(V, $, undefined) {
  var contentToAdd = null;
  var urlDivId = "tab_object_snapshot_content";
  var urlInputId = "object_snapshot_code";
  var init = function() {
    var urlInput = $(urlDivId).find("input");
    $(urlInput).watermark("Paste website URL");
    $("#" + urlDivId + " .previewButton").click(function(event) {
      if(V.Police.validateObject($("#" + urlInputId).val())[0]) {
        contentToAdd = V.Editor.Utils.autocompleteUrls($("#" + urlInputId).val());
        V.Editor.Object.drawPreview(urlDivId, contentToAdd)
      }
    })
  };
  var onLoadTab = function(tab) {
    contentToAdd = null;
    V.Editor.Object.resetPreview(urlDivId);
    $("#" + urlInputId).val("")
  };
  var drawPreviewElement = function() {
    if(_validateSnapShot(contentToAdd)) {
      drawSnapShot(_wrapperSnapShot(contentToAdd));
      $.fancybox.close()
    }
  };
  var _validateSnapShot = function(object) {
    var objectInfo = V.Object.getObjectInfo(object);
    switch(objectInfo.wrapper) {
      case null:
        return _validateUrl(object);
        break;
      case "IFRAME":
        return _validateUrl(objectInfo.source);
        break;
      default:
        return false;
        break
    }
  };
  var _validateUrl = function(url) {
    var http_urls_pattern = /(http(s)?:\/\/)([aA-zZ0-9%=_&+?])+([./-][aA-zZ0-9%=_&+?]+)*[/]?/g;
    if(url.match(http_urls_pattern) != null) {
      return true
    }else {
      return false
    }
  };
  var _wrapperSnapShot = function(content) {
    var objectInfo = V.Object.getObjectInfo(content);
    if(objectInfo.wrapper === null) {
      return"<iframe src='" + content + "'></iframe>"
    }else {
      return content
    }
  };
  var drawSnapShot = function(wrapper, area, style, scrollTop, scrollLeft) {
    var current_area;
    var object_style = "";
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    if(style) {
      object_style = style
    }
    var template = V.Editor.getTemplate(current_area);
    var nextWrapperId = V.Utils.getId();
    var idToDrag = "draggable" + nextWrapperId;
    var idToResize = "resizable" + nextWrapperId;
    current_area.attr("type", "snapshot");
    var wrapperDiv = document.createElement("div");
    wrapperDiv.setAttribute("id", idToDrag);
    if(style) {
      wrapperDiv.setAttribute("style", style)
    }
    $(wrapperDiv).addClass("snapshot_wrapper");
    var iframeTag = $(wrapper);
    $(iframeTag).attr("id", idToResize);
    $(iframeTag).attr("class", "snapshot_content");
    $(iframeTag).attr("scrolling", "no");
    $(iframeTag).attr("wmode", "opaque");
    $(iframeTag).css("pointer-events", "none");
    $(current_area).html("");
    $(current_area).append(wrapperDiv);
    V.Editor.addDeleteButton($(current_area));
    $(wrapperDiv).append(iframeTag);
    if(scrollTop) {
      $("#" + idToDrag).scrollTop(scrollTop)
    }
    if(scrollLeft) {
      $("#" + idToDrag).scrollLeft(scrollLeft)
    }
    $(wrapperDiv).attr("scrollTop", scrollTop);
    $(wrapperDiv).attr("scrollLeft", scrollLeft);
    $("#" + idToDrag).bind("mousedown", function(event) {
      event.preventDefault()
    });
    $("#" + idToDrag).draggable({cursor:"move", disabled:false, start:function(event, ui) {
      if(!_isBorderClick(event, idToDrag)) {
        return false
      }
    }});
    V.Editor.Tools.loadToolsForZone(current_area)
  };
  var _isBorderClick = function(event, idToDrag) {
    var accuracy = 6;
    var scrollAccuracy = -10;
    var width = $("#" + idToDrag).width();
    var height = $("#" + idToDrag).height();
    var offset = $("#" + idToDrag).offset();
    var dif1 = event.pageX - offset.left;
    if(dif1 < accuracy) {
      return true
    }
    var dif2 = event.pageY - offset.top;
    if(dif2 < accuracy) {
      return true
    }
    var dif3 = offset.left + width - event.pageX;
    if(dif3 < scrollAccuracy) {
      return true
    }
    var dif4 = offset.top + height - event.pageY;
    if(dif4 < scrollAccuracy) {
      return true
    }
    return false
  };
  var _resizeWebIframe = function(id, width) {
    var proportion = $("#" + id).height() / $("#" + id).width();
    $("#" + id).width(width);
    $("#" + id).height(width * proportion)
  };
  return{init:init, onLoadTab:onLoadTab, drawPreviewElement:drawPreviewElement, drawSnapShot:drawSnapShot}
}(VISH, jQuery);
VISH.Editor.Object.Web = function(V, $, undefined) {
  var contentToAdd = null;
  var urlDivId = "tab_object_from_web_content";
  var urlInputId = "object_embedWeb_code";
  var init = function() {
    var urlInput = $(urlDivId).find("input");
    $(urlInput).watermark("Paste website URL");
    $("#" + urlDivId + " .previewButton").click(function(event) {
      if(V.Police.validateObject($("#" + urlInputId).val())[0]) {
        contentToAdd = V.Editor.Utils.autocompleteUrls($("#" + urlInputId).val());
        V.Editor.Object.drawPreview(urlDivId, contentToAdd)
      }
    })
  };
  var onLoadTab = function(tab) {
    contentToAdd = null;
    V.Editor.Object.resetPreview(urlDivId);
    $("#" + urlInputId).val("")
  };
  var drawPreviewElement = function() {
    V.Editor.Object.drawPreviewObject(contentToAdd)
  };
  var generateWrapperForWeb = function(url) {
    return"<iframe src='" + url + "?wmode=transparent'></iframe>"
  };
  var generatePreviewWrapperForWeb = function(url) {
    return"<iframe class='objectPreview' src='" + url + "'></iframe>"
  };
  return{init:init, onLoadTab:onLoadTab, drawPreviewElement:drawPreviewElement, generatePreviewWrapperForWeb:generatePreviewWrapperForWeb, generateWrapperForWeb:generateWrapperForWeb}
}(VISH, jQuery);
VISH.Editor.Preview = function(V, $, undefined) {
  var presentation_preview = null;
  var init = function() {
    setTimeout(function() {
      _realInit()
    }, 2E3)
  };
  var _realInit = function() {
    $("img#preview_circle").fancybox({"width":875, "height":656, "padding":0, "autoScale":false, "transitionIn":"none", "transitionOut":"none", "type":"iframe", "onStart":function() {
      if(presentation_preview === null) {
        _prepare()
      }
      V.Editor.Utils.Loader.unloadObjectsInEditorSlide(V.Slides.getCurrentSlide())
    }, "onClosed":function() {
      presentation_preview = null;
      V.Editor.Utils.Loader.loadObjectsInEditorSlide(V.Slides.getCurrentSlide())
    }, "onComplete":function() {
      $("#fancybox-wrap").css("top", "60px");
      $("#fancybox-wrap").css("left", "-2px");
      $("#fancybox-frame").addClass("vishEditorIframe")
    }})
  };
  var preview = function(options) {
    _prepare(options);
    $("img#preview_circle").trigger("click")
  };
  var _prepare = function(options) {
    var slideNumberToPreview;
    var forcePresentation;
    if(!options || !options["slideNumberToPreview"] || typeof options["slideNumberToPreview"] !== "number") {
      slideNumberToPreview = V.Slides.getCurrentSlideNumber()
    }else {
      slideNumberToPreview = options["slideNumberToPreview"]
    }
    if(!options || !options["forcePresentation"] || typeof options["forcePresentation"] !== "boolean") {
      forcePresentation = false
    }else {
      forcePresentation = options["forcePresentation"]
    }
    if(V.Configuration.getConfiguration()["mode"] == "vish") {
      $("#preview_circle").attr("href", "/excursions/preview#" + slideNumberToPreview)
    }else {
      if(V.Configuration.getConfiguration()["mode"] == "noserver") {
        $("#preview_circle").attr("href", "/vishEditor/viewer.html#" + slideNumberToPreview)
      }else {
        if(V.Configuration.getConfiguration()["mode"] == "node") {
        }
      }
    }
    if(!options || !options["presentationJSON"] || typeof options["presentationJSON"] !== "object") {
      presentation_preview = V.Editor.savePresentation({preview:true, forcePresentation:forcePresentation})
    }else {
      presentation_preview = options["presentationJSON"]
    }
    if(options && options["insertMode"] && typeof options["insertMode"] == "boolean") {
      presentation_preview.insertMode = options["insertMode"]
    }
  };
  var getPreview = function() {
    return presentation_preview
  };
  return{init:init, preview:preview, getPreview:getPreview}
}(VISH, jQuery);
VISH.Editor.Quiz.MC = function(V, $, undefined) {
  var choicesLetters = ["a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)", "k)", "l)", "m)", "n)", "o)", "p)", "q)", "r)", "s)"];
  var addQuizOptionButtonClass = "add_quiz_option_mc";
  var deleteQuizOptionButtonClass = "delete_quiz_option_mc";
  var mcCheckbox = "mcCheckbox";
  var initialized = false;
  var init = function() {
    if(!initialized) {
      $(document).on("click", "." + "mcContainer", _clickOnQuizArea);
      $(document).on("click", "." + addQuizOptionButtonClass, _clickToAddOptionInQuiz);
      $(document).on("click", "." + deleteQuizOptionButtonClass, _removeOptionInQuiz);
      $(document).on("click", "." + mcCheckbox, _onCheckboxClick);
      initialized = true
    }
  };
  var _clickOnQuizArea = function(event) {
    switch(event.target.classList[0]) {
      case "mcContainer":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.id));
        break;
      case "mc_option_text":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.parentElement.parentElement.parentElement.id));
        break;
      case "mc_option":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.parentElement.parentElement.id));
        break;
      default:
        break
    }
  };
  var _onCheckboxClick = function(event) {
    var check = $(event.target).attr("check");
    switch(check) {
      case "true":
        V.Quiz.updateCheckbox(event.target, "none");
        break;
      case "false":
        break;
      case "none":
      ;
      default:
        V.Quiz.updateCheckbox(event.target, "true");
        break
    }
  };
  var add = function(area) {
    area.append(_getDummy());
    area.find(".menuselect_hide").remove();
    area.attr("type", "quiz");
    area.attr("quiztype", V.Constant.QZ_TYPE.MCHOICE);
    _launchTextEditorForQuestion(area);
    _addOptionInQuiz(area);
    V.Editor.addDeleteButton(area)
  };
  var _getDummy = function() {
    return"<div class='mcContainer'><div class='mc_question_wrapper'></div><ul class='mc_options'></ul><img src='" + V.ImagesPath + "icons/add.png' class='" + addQuizOptionButtonClass + "'/><input type='hidden' name='quiz_id'/></div></div>"
  };
  var _getOptionDummy = function() {
    return"<li class='mc_option'><div class='mc_option_wrapper'><span class='mc_option_index'></span><div class='mc_option_text'></div><table class='mc_checks'><tr class='checkFirstRow'><td><img src='" + V.ImagesPath + "icons/ve_delete.png' class='" + deleteQuizOptionButtonClass + "'/></td><td><img src='" + V.ImagesPath + "quiz/checkbox.png' class='" + mcCheckbox + "' check='none'/></td></tr></table></div></li>"
  };
  var _clickToAddOptionInQuiz = function(event) {
    var area = $("#" + event.target.parentElement.parentElement.id);
    V.Editor.setCurrentArea(area);
    _addOptionInQuiz(area)
  };
  var _addOptionInQuiz = function(area, value, check) {
    var nChoices = $(area).find("li.mc_option").size();
    var quiz_option = _getOptionDummy();
    var quiz_option = $(quiz_option).attr("nChoice", nChoices + 1);
    $(area).find(".mc_options").append(quiz_option);
    _refreshChoicesIndexs(area);
    if(check) {
      V.Quiz.updateCheckbox($(quiz_option).find("td > img")[1], check)
    }
    _launchTextEditorForOptions(area, nChoices, value);
    if(nChoices > 0) {
      $(area).find("li[nChoice='" + (nChoices + 1) + "']").find("." + deleteQuizOptionButtonClass).css("visibility", "visible")
    }
  };
  var _removeOptionInQuiz = function(event) {
    var area = $("div[type='quiz']").has(event.target);
    V.Editor.setCurrentArea(area);
    var liToRemove = $("li.mc_option").has(event.target);
    $(liToRemove).remove();
    _refreshChoicesIndexs(area)
  };
  var _refreshChoicesIndexs = function(area) {
    var nChoices = $(area).find("li.mc_option").size();
    $(area).find("li.mc_option").each(function(index, option_element) {
      $(option_element).find(".mc_option_index").text(_getChoiceLetter(nChoices, index + 1))
    })
  };
  var _getChoiceLetter = function(nChoices, nChoice) {
    if(nChoices <= choicesLetters.length) {
      return choicesLetters[nChoice - 1]
    }else {
      return nChoice + ")"
    }
  };
  var _launchTextEditorForQuestion = function(area, question) {
    var textArea = $(area).find(".mc_question_wrapper");
    if(!question) {
      V.Editor.Text.launchTextEditor({}, textArea, "", {forceNew:true, fontSize:38, focus:true, autogrow:true})
    }else {
      V.Editor.Text.launchTextEditor({}, textArea, question, {autogrow:true})
    }
  };
  var _launchTextEditorForOptions = function(area, nChoice, value) {
    var first = nChoice === 0;
    var textArea = $(area).find(".mc_option_text")[nChoice];
    if(!value) {
      if(first) {
        V.Editor.Text.launchTextEditor({}, textArea, "Write options here", {forceNew:true, fontSize:24, autogrow:true, placeholder:true})
      }else {
        V.Editor.Text.launchTextEditor({}, textArea, "", {forceNew:true, fontSize:24, autogrow:true, focus:true})
      }
    }else {
      V.Editor.Text.launchTextEditor({}, textArea, value, {autogrow:true})
    }
  };
  var save = function(area) {
    var textArea = $(area).find(".mc_question_wrapper");
    var quiz = {};
    quiz.quizType = VISH.Constant.QZ_TYPE.MCHOICE;
    quiz.selfA = false;
    quiz.extras = {};
    quiz.extras.multipleAnswer = false;
    var nAnswers = 0;
    var questionInstance = V.Editor.Text.getCKEditorFromTextArea($(area).find(".mc_question_wrapper"));
    quiz.question = {};
    quiz.question.value = questionInstance.getPlainText();
    quiz.question.wysiwygValue = questionInstance.getData();
    quiz.choices = [];
    var nChoices = $(area).find("li.mc_option").size();
    var optionTextAreas = $(area).find(".mc_option_text");
    for(var i = 0;i < nChoices;i++) {
      var textArea = optionTextAreas[i];
      var optionInstance = V.Editor.Text.getCKEditorFromTextArea(textArea);
      var choice = {};
      choice.id = (i + 1).toString();
      choice.value = optionInstance.getPlainText();
      choice.wysiwygValue = optionInstance.getData();
      if($(textArea).parent().find(".mcCheckbox").attr("check") === "true") {
        choice.answer = true;
        quiz.selfA = true;
        nAnswers++
      }else {
        choice.answer = "?"
      }
      quiz.choices.push(choice)
    }
    if(quiz.selfA) {
      $(quiz.choices).each(function(index, choice) {
        if(choice.answer !== true) {
          choice.answer = false
        }
      })
    }
    if(nAnswers > 1) {
      quiz.extras.multipleAnswer = true
    }
    return quiz
  };
  var draw = function(area, quiz) {
    $(area).append(_getDummy());
    $(area).attr("type", "quiz");
    $(area).attr("quiztype", VISH.Constant.QZ_TYPE.MCHOICE);
    _launchTextEditorForQuestion(area, quiz.question.wysiwygValue);
    V.Editor.addDeleteButton(area);
    $(quiz.choices).each(function(index, choice) {
      var check = undefined;
      if(quiz.selfA) {
        if(choice.answer === true) {
          check = "true"
        }
      }
      _addOptionInQuiz(area, choice.wysiwygValue, check)
    })
  };
  return{init:init, add:add, save:save, draw:draw}
}(VISH, jQuery);
VISH.Editor.Quiz.TF = function(V, $, undefined) {
  var choicesLetters = ["a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)", "k)", "l)", "m)", "n)", "o)", "p)", "q)", "r)", "s)"];
  var addQuizOptionButtonClass = "add_quiz_option_tf";
  var deleteQuizOptionButtonClass = "delete_quiz_option_tf";
  var tfCheckbox = "tfCheckbox";
  var initialized = false;
  var init = function() {
    if(!initialized) {
      $(document).on("click", "." + "mcContainer", _clickOnQuizArea);
      $(document).on("click", "." + addQuizOptionButtonClass, _clickToAddOptionInQuiz);
      $(document).on("click", "." + deleteQuizOptionButtonClass, _removeOptionInQuiz);
      $(document).on("click", "." + tfCheckbox, _onCheckboxClick);
      initialized = true
    }
  };
  var _clickOnQuizArea = function(event) {
    switch(event.target.classList[0]) {
      case "mcContainer":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.id));
        break;
      case "mc_option_text":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.parentElement.parentElement.parentElement.id));
        break;
      case "mc_option":
        V.Editor.setCurrentArea($("#" + event.target.parentElement.parentElement.parentElement.id));
        break;
      default:
        break
    }
  };
  var _onCheckboxClick = function(event) {
    var check = $(event.target).attr("check");
    var column = $(event.target).attr("column");
    switch(column) {
      case "true":
        if(check === "true") {
          V.Quiz.updateCheckbox(event.target, "none")
        }else {
          var falseColumnCheckbox = $("tr").has(event.target).find(".tfCheckbox[column='false']");
          V.Quiz.updateCheckbox(falseColumnCheckbox, "none");
          V.Quiz.updateCheckbox(event.target, "true")
        }
        break;
      case "false":
        if(check === "false") {
          V.Quiz.updateCheckbox(event.target, "none")
        }else {
          var trueColumnCheckbox = $("tr").has(event.target).find(".tfCheckbox[column='true']");
          V.Quiz.updateCheckbox(trueColumnCheckbox, "none");
          V.Quiz.updateCheckbox(event.target, "false")
        }
        break;
      default:
        break
    }
  };
  var add = function(area) {
    area.append(_getDummy());
    area.find(".menuselect_hide").remove();
    area.attr("type", "quiz");
    area.attr("quiztype", V.Constant.QZ_TYPE.TF);
    _launchTextEditorForQuestion(area);
    _addOptionInQuiz(area);
    V.Editor.addDeleteButton(area)
  };
  var _getDummy = function() {
    return"<div class='tfContainer'><div class='mc_question_wrapper'></div><ul class='mc_options'></ul><img src='" + V.ImagesPath + "icons/add.png' class='" + addQuizOptionButtonClass + "'/><input type='hidden' name='quiz_id'/></div></div>"
  };
  var _getOptionDummy = function() {
    return"<li class='mc_option'><div class='mc_option_wrapper'><span class='mc_option_index'></span><div class='mc_option_text'></div><table class='mc_checks'><tr class='checkFirstRow'><td><img src='" + V.ImagesPath + "icons/ve_delete.png' class='" + deleteQuizOptionButtonClass + "'/></td><td><img src='" + V.ImagesPath + "quiz/checkbox.png' class='" + tfCheckbox + "' column='true' check='none'/></td><td><img src='" + V.ImagesPath + "quiz/checkbox.png' class='" + tfCheckbox + "' column='false' check='none'/></td></tr></table></div></li>"
  };
  var _clickToAddOptionInQuiz = function(event) {
    var area = $("#" + event.target.parentElement.parentElement.id);
    V.Editor.setCurrentArea(area);
    _addOptionInQuiz(area)
  };
  var _addOptionInQuiz = function(area, value, check) {
    var nChoices = $(area).find("li.mc_option").size();
    var quiz_option = _getOptionDummy();
    var quiz_option = $(quiz_option).attr("nChoice", nChoices + 1);
    $(area).find(".mc_options").append(quiz_option);
    _refreshChoicesIndexs(area);
    if(check === "true") {
      V.Quiz.updateCheckbox($(quiz_option).find("td > img")[1], check)
    }else {
      if(check === "false") {
        V.Quiz.updateCheckbox($(quiz_option).find("td > img")[2], check)
      }
    }
    _launchTextEditorForOptions(area, nChoices, value);
    if(nChoices > 0) {
      $(area).find("li[nChoice='" + (nChoices + 1) + "']").find("." + deleteQuizOptionButtonClass).css("visibility", "visible")
    }
  };
  var _removeOptionInQuiz = function(event) {
    var area = $("div[type='quiz']").has(event.target);
    V.Editor.setCurrentArea(area);
    var liToRemove = $("li.mc_option").has(event.target);
    $(liToRemove).remove();
    _refreshChoicesIndexs(area)
  };
  var _refreshChoicesIndexs = function(area) {
    var nChoices = $(area).find("li.mc_option").size();
    $(area).find("li.mc_option").each(function(index, option_element) {
      $(option_element).find(".mc_option_index").text(_getChoiceLetter(nChoices, index + 1))
    })
  };
  var _getChoiceLetter = function(nChoices, nChoice) {
    if(nChoices <= choicesLetters.length) {
      return choicesLetters[nChoice - 1]
    }else {
      return nChoice + ")"
    }
  };
  var _launchTextEditorForQuestion = function(area, question) {
    var textArea = $(area).find(".mc_question_wrapper");
    if(!question) {
      V.Editor.Text.launchTextEditor({}, textArea, "", {forceNew:true, fontSize:38, focus:true, autogrow:true})
    }else {
      V.Editor.Text.launchTextEditor({}, textArea, question, {autogrow:true})
    }
  };
  var _launchTextEditorForOptions = function(area, nChoice, value) {
    var first = nChoice === 0;
    var textArea = $(area).find(".mc_option_text")[nChoice];
    if(!value) {
      if(first) {
        V.Editor.Text.launchTextEditor({}, textArea, "Write options here", {forceNew:true, fontSize:24, autogrow:true, placeholder:true})
      }else {
        V.Editor.Text.launchTextEditor({}, textArea, "", {forceNew:true, fontSize:24, autogrow:true, focus:true})
      }
    }else {
      V.Editor.Text.launchTextEditor({}, textArea, value, {autogrow:true})
    }
  };
  var save = function(area) {
    var textArea = $(area).find(".mc_question_wrapper");
    var quiz = {};
    quiz.quizType = VISH.Constant.QZ_TYPE.TF;
    quiz.selfA = false;
    var questionInstance = V.Editor.Text.getCKEditorFromTextArea($(area).find(".mc_question_wrapper"));
    quiz.question = {};
    quiz.question.value = questionInstance.getPlainText();
    quiz.question.wysiwygValue = questionInstance.getData();
    quiz.choices = [];
    var nChoices = $(area).find("li.mc_option").size();
    var optionTextAreas = $(area).find(".mc_option_text");
    for(var i = 0;i < nChoices;i++) {
      var textArea = optionTextAreas[i];
      var optionInstance = V.Editor.Text.getCKEditorFromTextArea(textArea);
      var choice = {};
      choice.id = (i + 1).toString();
      choice.value = optionInstance.getPlainText();
      choice.wysiwygValue = optionInstance.getData();
      var trueColumCheckbox = $(textArea).parent().find(".tfCheckbox[column='true']");
      if($(trueColumCheckbox).attr("check") === "true") {
        choice.answer = true;
        quiz.selfA = true
      }else {
        var falseColumCheckbox = $(textArea).parent().find(".tfCheckbox[column='false']");
        if($(falseColumCheckbox).attr("check") === "false") {
          choice.answer = false;
          quiz.selfA = true
        }else {
          choice.answer = "?"
        }
      }
      quiz.choices.push(choice)
    }
    return quiz
  };
  var draw = function(area, quiz) {
    $(area).append(_getDummy());
    $(area).attr("type", "quiz");
    $(area).attr("quiztype", VISH.Constant.QZ_TYPE.TF);
    _launchTextEditorForQuestion(area, quiz.question.wysiwygValue);
    V.Editor.addDeleteButton(area);
    $(quiz.choices).each(function(index, choice) {
      var check = undefined;
      if(quiz.selfA) {
        if(choice.answer === true) {
          check = "true"
        }else {
          if(choice.answer === false) {
            check = "false"
          }
        }
      }
      _addOptionInQuiz(area, choice.wysiwygValue, check)
    })
  };
  return{init:init, add:add, save:save, draw:draw}
}(VISH, jQuery);
VISH.Editor.Renderer = function(V, $, undefined) {
  var slides = null;
  var init = function(presentation) {
    $("#presentation_title").val(presentation.title);
    $("#presentation_description").val(presentation.description);
    $("#presentation_avatar").val(presentation.avatar);
    if(presentation.age_range) {
      var start_range = presentation.age_range.substring(0, presentation.age_range.indexOf("-") - 1);
      var end_range = presentation.age_range.substring(presentation.age_range.indexOf("-") + 2);
      $("#slider-range").slider("values", [start_range, end_range]);
      $("#age_range").val(start_range + " - " + end_range);
      $("#age_range").val(presentation.age_range)
    }else {
      $("#age_range").val(V.Constant.AGE_RANGE)
    }
    $("#subject_tag").val(presentation.subject);
    $("#language_tag").val(presentation.language);
    $("#educational_objectives_tag").val(presentation.educational_objectives);
    $("#acquired_competencies_tag").val(presentation.adquired_competencies);
    V.Editor.Themes.selectTheme(presentation.theme);
    V.Editor.setMode(presentation.type);
    var slidesetModule = V.Editor.Slideset.getCreatorModule(presentation.type);
    var isSlideset = slidesetModule !== null;
    if(isSlideset) {
      _renderSlideset(presentation, slidesetModule)
    }else {
      if(presentation.type === VISH.Constant.PRESENTATION) {
        renderPresentation(presentation)
      }else {
        if(presentation.type === VISH.Constant.QUIZ_SIMPLE) {
          presentation.type = VISH.Constant.PRESENTATION;
          renderPresentation(presentation)
        }
      }
    }
  };
  var renderPresentation = function(presentation) {
    slides = presentation.slides;
    for(var i = 0;i < slides.length;i++) {
      switch(slides[i].type) {
        case V.Constant.FLASHCARD:
          _renderFlashcard(slides[i], i + 1);
          break;
        case V.Constant.VTOUR:
          _renderVTour(slides[i], i + 1);
          break;
        case V.Constant.STANDARD:
        ;
        default:
          _renderSlide(slides[i], i + 1);
          break
      }
    }
  };
  var _renderSlideset = function(presentation, slidesetModule) {
    var slideset = V.Editor.Slideset.undoNestedSlides(presentation.slides[0]);
    if(slideset && slideset.slides) {
      slides = slideset.slides;
      var sL = slides.length;
      for(var i = 0;i < sL;i++) {
        _renderSlide(slides[i], i + 1)
      }
    }
    slidesetModule.loadSlideset(presentation)
  };
  var _renderSlide = function(slide, slideNumber) {
    var template = "1";
    if(slide.template) {
      template = slide.template.substring(1)
    }
    var scaffold = V.Editor.Dummies.getScaffoldForSlide(template, slideNumber, slide);
    V.Editor.Slides.addSlide(scaffold);
    V.Editor.Slides.redrawSlides();
    V.Slides.lastSlide();
    for(el in slide.elements) {
      var areaId = slide.elements[el].id;
      var area = $("div#" + areaId + "[areaid='" + slide.elements[el].areaid + "']");
      if(area.length === 0) {
        continue
      }
      if(slide.elements[el].type === "text") {
        V.Editor.Text.launchTextEditor({}, area, slide.elements[el].body)
      }else {
        if(slide.elements[el].type === "image") {
          V.Editor.Image.drawImage(slide.elements[el].body, area, slide.elements[el].style, slide.elements[el].hyperlink)
        }else {
          if(slide.elements[el].type === "video") {
            var options = [];
            options["poster"] = slide.elements[el].poster;
            options["autoplay"] = slide.elements[el].autoplay;
            var sourcesArray = [];
            $.each(JSON.parse(slide.elements[el].sources), function(index, source) {
              sourcesArray.push([source.src, source.type])
            });
            V.Editor.Video.HTML5.drawVideo(sourcesArray, options, area)
          }else {
            if(slide.elements[el].type === "object") {
              V.Editor.Object.drawObject(slide.elements[el].body, area, slide.elements[el].style, slide.elements[el].zoomInStyle)
            }else {
              if(slide.elements[el].type === "snapshot") {
                V.Editor.Object.Snapshot.drawSnapShot(slide.elements[el].body, area, slide.elements[el].style, slide.elements[el].scrollTop, slide.elements[el].scrollLeft)
              }else {
                if(slide.elements[el].type === "quiz") {
                  V.Editor.Quiz.draw(area, slide.elements[el])
                }
              }
            }
          }
        }
      }
    }
    $("div.selectable:empty").addClass("editable")
  };
  var _renderFlashcard = function(slide, slideNumber) {
    V.Editor.Flashcard.addFlashcard(slide);
    V.Renderer.renderSlide(slide, "", "<div class='delete_slide'></div>");
    V.Editor.Slides.redrawSlides();
    V.Slides.lastSlide()
  };
  var _renderVTour = function(slide, slideNumber) {
    V.Editor.VirtualTour.addVirtualTour(slide);
    V.Renderer.renderSlide(slide, "", "<div class='delete_slide'></div>");
    V.Editor.Slides.redrawSlides();
    V.Slides.lastSlide()
  };
  return{init:init, renderPresentation:renderPresentation}
}(VISH, jQuery);
VISH.Editor.Slides = function(V, $, undefined) {
  var showSlides = function() {
    $(".slides > article").removeClass("temp_hidden")
  };
  var hideSlides = function() {
    $(".slides > article").addClass("temp_hidden")
  };
  var redrawSlides = function() {
    $(document).trigger("OURDOMContentLoaded")
  };
  var isSlideFocused = function() {
    if($(".wysiwygInstance").is(":focus")) {
      return false
    }
    if($("#fancybox-content").is(":visible")) {
      return false
    }
    if($("input").is(":focus")) {
      return false
    }
    if(V.Editor && V.Editor.getCurrentArea() !== null) {
      return false
    }
    return true
  };
  var moveSlideTo = function(slide_to_move, reference_slide, movement) {
    if(typeof slide_to_move === "undefined" || typeof reference_slide === "undefined") {
      return
    }
    if(typeof slide_to_move.length !== undefined) {
      slide_to_move = $(slide_to_move)[0];
      if(typeof slide_to_move === "undefined") {
        return
      }
    }
    if(typeof reference_slide.length !== undefined) {
      reference_slide = $(reference_slide)[0];
      if(typeof reference_slide === "undefined") {
        return
      }
    }
    if(slide_to_move.tagName != "ARTICLE" || reference_slide.tagName != "ARTICLE" || slide_to_move == reference_slide) {
      return
    }
    var article_to_move = slide_to_move;
    var article_reference = reference_slide;
    var moving_current_slide = false;
    if(V.Slides.getCurrentSlide() === article_to_move) {
      moving_current_slide = true
    }
    var textAreas = copyTextAreasOfSlide(article_to_move);
    $(article_to_move).remove();
    if(movement == "after") {
      $(article_reference).after(article_to_move)
    }else {
      if(movement == "before") {
        $(article_reference).before(article_to_move)
      }else {
        V.Debugging.log("V.Slides: Error. Movement not defined... !");
        return
      }
    }
    V.Editor.Utils.refreshDraggables(article_to_move);
    _cleanTextAreas(article_to_move);
    _loadTextAreasOfSlide(article_to_move, textAreas);
    V.Slides.setSlides(document.querySelectorAll("section.slides > article"));
    if(moving_current_slide) {
      V.Slides.setCurrentSlideIndex(V.Slides.getNumberOfSlide(article_to_move))
    }
    V.Slides.updateSlideEls()
  };
  var copySlideWithNumber = function(slideNumber, options) {
    var slide = V.Slides.getSlideWithNumber(slideNumber);
    if(slide === null) {
      return
    }
    var newSlide = $(slide).clone();
    copySlide(newSlide, options)
  };
  var copySlide = function(slideToCopy, options) {
    slideToCopy = _cleanTextAreas(slideToCopy);
    slideToCopy = V.Editor.Utils.replaceIdsForSlide(slideToCopy);
    var newId = $(slideToCopy).attr("id");
    if(typeof slideToCopy == "undefined") {
      return
    }
    var slideToCopyType = V.Slides.getSlideType(slideToCopy);
    var slidesetModule = V.Editor.Slideset.getModule(slideToCopyType);
    if(typeof slidesetModule !== "undefined") {
      var slidesetModule = V.Editor.Slideset.getModule(slideToCopyType);
      var slidesetId = $(slideToCopy).attr("id");
      if(!options.JSON) {
        return
      }
      var slideToCopyJSON = V.Editor.Utils.replaceIdsForSlideJSON(options.JSON, slidesetId);
      slidesetModule.preCopyActions(slideToCopyJSON, slideToCopy)
    }
    var currentSlide = V.Slides.getCurrentSlide();
    if(currentSlide) {
      $(currentSlide).after(slideToCopy)
    }else {
      $("section#slides_panel").append(slideToCopy)
    }
    var slideCopied = $("#" + newId);
    V.Editor.Utils.refreshDraggables(slideCopied);
    if(slideToCopyType === V.Constant.STANDARD) {
      if(options.textAreas) {
        _loadTextAreasOfSlide(slideCopied, options.textAreas)
      }
    }
    if(typeof slidesetModule !== "undefined") {
      slidesetModule.postCopyActions(slideToCopyJSON, slideCopied)
    }
    V.Slides.setSlides(document.querySelectorAll("section.slides > article"));
    V.Slides.updateSlideEls();
    V.Editor.Thumbnails.redrawThumbnails(function() {
      if(currentSlide) {
        V.Editor.Thumbnails.moveCarrouselToSlide(V.Slides.getCurrentSlideNumber() + 1);
        V.Slides.goToSlide(V.Slides.getCurrentSlideNumber() + 1)
      }else {
        V.Slides.goToSlide(1);
        V.Editor.Thumbnails.moveCarrouselToSlide(1)
      }
    })
  };
  var _cleanTextAreas = function(slide) {
    $(slide).find("div[type='text'],div.wysiwygTextArea").each(function(index, textArea) {
      $(textArea).html("")
    });
    return slide
  };
  var copyTextAreasOfSlide = function(slide) {
    var textAreas = {};
    $(slide).find("div[type='text']").each(function(index, textArea) {
      var areaId = $(textArea).attr("areaid");
      var ckEditor = V.Editor.Text.getCKEditorFromZone(textArea);
      if(areaId && ckEditor !== null) {
        textAreas[areaId] = ckEditor.getData()
      }
    });
    $(slide).find("div[type='quiz']").each(function(index, quizArea) {
      var areaId = $(quizArea).attr("areaid");
      textAreas[areaId] = [];
      $(quizArea).find("div.wysiwygTextArea").each(function(index, textArea) {
        var ckEditor = V.Editor.Text.getCKEditorFromTextArea(textArea);
        if(areaId && ckEditor !== null) {
          textAreas[areaId].push(ckEditor.getData())
        }
      })
    });
    return textAreas
  };
  var _loadTextAreasOfSlide = function(slide, textAreas) {
    $(slide).find("div[type='text']").each(function(index, textArea) {
      var areaId = $(textArea).attr("areaid");
      if(areaId && textAreas[areaId]) {
        var data = textAreas[areaId];
        V.Editor.Text.launchTextEditor({}, $(textArea), data)
      }
    });
    $(slide).find("div[type='quiz']").each(function(index, quizArea) {
      var areaId = $(quizArea).attr("areaid");
      if(areaId && textAreas[areaId]) {
        var data = textAreas[areaId];
        $(quizArea).find("div.wysiwygTextArea").each(function(index, textArea) {
          var parent = $(textArea).parent();
          $(parent).html("");
          V.Editor.Text.launchTextEditor({}, $(parent), data[index], {autogrow:true})
        })
      }
    })
  };
  var addSlide = function(slide) {
    $(".slides").append(slide)
  };
  var removeSlide = function(slideNumber) {
    var slide = V.Slides.getSlideWithNumber(slideNumber);
    if(slide === null) {
      return
    }
    var standardSlide = slide.type === V.Constant.STANDARD;
    var removing_current_slide = false;
    if(V.Slides.getCurrentSlide() === slide) {
      removing_current_slide = true
    }
    $(slide).remove();
    if(removing_current_slide) {
      if(V.Slides.getCurrentSlideNumber() === 1 && V.Slides.getSlidesQuantity() > 1) {
        V.Slides.setCurrentSlideNumber(1)
      }else {
        V.Slides.setCurrentSlideNumber(V.Slides.getCurrentSlideNumber() - 1)
      }
    }
    redrawSlides();
    V.Editor.Thumbnails.redrawThumbnails();
    if(!standardSlide) {
      V.Editor.Tools.Menu.init()
    }
  };
  return{showSlides:showSlides, hideSlides:hideSlides, redrawSlides:redrawSlides, isSlideFocused:isSlideFocused, moveSlideTo:moveSlideTo, copySlide:copySlide, copySlideWithNumber:copySlideWithNumber, addSlide:addSlide, removeSlide:removeSlide, copyTextAreasOfSlide:copyTextAreasOfSlide}
}(VISH, jQuery);
VISH.Editor.Themes = function(V, $, undefined) {
  var initialized = false;
  var themes = {};
  var init = function() {
    if(!initialized) {
      themes["theme1"] = {number:"1", color:"000"};
      themes["theme2"] = {number:"2", color:"fff"};
      themes["theme3"] = {number:"3", color:"666"};
      themes["theme4"] = {number:"4", color:"000"};
      themes["theme5"] = {number:"5", color:"fff"};
      themes["theme6"] = {number:"6", color:"555"};
      themes["theme7"] = {number:"7", color:"000"};
      themes["theme8"] = {number:"8", color:"000"};
      themes["theme9"] = {number:"9", color:"666"};
      themes["theme10"] = {number:"10", color:"666"};
      themes["theme11"] = {number:"11", color:"fff"};
      themes["theme12"] = {number:"12", color:"666"}
    }
  };
  var selectTheme = function(theme) {
    V.Themes.loadTheme(theme);
    var draftPresentation = V.Editor.getPresentation();
    if(!draftPresentation) {
      draftPresentation = {}
    }
    draftPresentation.theme = theme;
    V.Editor.setPresentation(draftPresentation);
    V.Editor.Text.refreshAutoColors();
    $.fancybox.close()
  };
  var getCurrentTheme = function() {
    var themeId;
    var draftPresentation = V.Editor.getPresentation();
    if(draftPresentation && draftPresentation.theme) {
      themeId = draftPresentation.theme
    }else {
      themeId = V.Constant.Themes.Default
    }
    return themes[themeId]
  };
  return{init:init, selectTheme:selectTheme, getCurrentTheme:getCurrentTheme}
}(VISH, jQuery);
VISH.Editor.Thumbnails = function(V, $, undefined) {
  var carrouselDivId = "slides_carrousel";
  var redrawThumbnailsCallback;
  var init = function() {
  };
  var redrawThumbnails = function(successCallback) {
    redrawThumbnailsCallback = successCallback;
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    var carrouselImages = [];
    var carrouselImagesTitles = [];
    var carrouselElements = 0;
    $(".slides > article").each(function(index, s) {
      switch($(s).attr("type")) {
        case undefined:
        ;
        case V.Constant.STANDARD:
          var template = $(s).attr("template");
          carrouselElements += 1;
          carrouselImages.push($("<img class='image_barbutton fill_slide_button' slideNumber='" + carrouselElements + "' action='goToSlide' src='" + V.ImagesPath + "templatesthumbs/" + template + ".png' />"));
          carrouselImagesTitles.push(carrouselElements);
          break;
        case V.Constant.FLASHCARD:
          carrouselElements += 1;
          carrouselImages.push($("<img class='image_barbutton fill_slide_button' slideNumber='" + carrouselElements + "' action='goToSlide' src='" + V.Utils.getSrcFromCSS($(s).attr("avatar")) + "' />"));
          carrouselImagesTitles.push(carrouselElements);
          break;
        case V.Constant.VTOUR:
          carrouselElements += 1;
          carrouselImages.push($("<img class='image_barbutton fill_slide_button' slideNumber='" + carrouselElements + "' action='goToSlide' src='" + V.ImagesPath + "templatesthumbs/tVTour.png' />"));
          carrouselImagesTitles.push(carrouselElements);
          break;
        default:
          break
      }
    });
    carrouselImages.push($("<img class='image_barbutton add_slide_button' action='plus' id='addslidebutton' src='" + V.ImagesPath + "templatesthumbs/add_slide.png' />"));
    carrouselElements += 1;
    if(carrouselElements < 8) {
      var i;
      for(i = 0 + carrouselElements;i < 8;i++) {
        carrouselImages.push($("<img class='image_barbutton empty_slide_button' action='default' src='" + V.ImagesPath + "templatesthumbs/default.png' />"));
        carrouselElements += 1
      }
    }
    V.Utils.Loader.loadImagesOnCarrouselOrder(carrouselImages, _onImagesLoaded, carrouselDivId, carrouselImagesTitles)
  };
  var _onImagesLoaded = function() {
    var presentationType = V.Editor.getPresentationType();
    $(".add_slide_button").hover(function() {
      $(this).attr("src", V.ImagesPath + "hover/add_slide.png")
    }, function() {
      $(this).attr("src", V.ImagesPath + "templatesthumbs/add_slide.png")
    });
    $(".barbutton").css("background-color", "transparent");
    var options = new Array;
    options["rows"] = 1;
    options["rowItems"] = 8;
    options["scrollItems"] = 1;
    options["styleClass"] = "slides";
    options["width"] = 900;
    options["startAtLastElement"] = true;
    options["pagination"] = false;
    options["afterCreateCarruselFunction"] = _afterCreateSlidesCarrousel;
    if(presentationType === V.Constant.PRESENTATION) {
      options["callback"] = _onClickCarrouselElement
    }else {
      if(presentationType === V.Constant.FLASHCARD) {
        options["callback"] = V.Editor.Flashcard.Creator.onClickCarrouselElement
      }else {
        if(presentationType === V.Constant.VTOUR) {
          options["callback"] = V.Editor.VirtualTour.Creator.onClickCarrouselElement
        }else {
          options["callback"] = _onClickCarrouselElement
        }
      }
    }
    $("#" + carrouselDivId).show();
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _afterCreateSlidesCarrousel = function() {
    var presentationType = V.Editor.getPresentationType();
    if(presentationType === V.Constant.PRESENTATION) {
      if(V.Slides.getCurrentSlideNumber() > 0) {
        selectThumbnail(V.Slides.getCurrentSlideNumber())
      }
      var firstCarrouselNumber;
      $("#" + carrouselDivId).sortable({items:'div.carrousel_element_single_row_slides:has(img[action="goToSlide"])', change:function(event, ui) {
      }, start:function(event, ui) {
        firstCarrouselNumber = parseInt($($("div.carrousel_element_single_row_slides")[0]).find("img.carrousel_element_single_row_slides[slidenumber]").attr("slidenumber"))
      }, stop:function(event, ui) {
        var dragElement = ui.item;
        var img = $(ui.item).find("img.carrousel_element_single_row_slides[slidenumber]");
        if(isNaN($(img).attr("slidenumber"))) {
          return
        }
        var orgPosition = parseInt($(img).attr("slidenumber"));
        var carrouselContainer = [];
        $.each($("div.carrousel_element_single_row_slides:has(img[slidenumber])"), function(index, value) {
          carrouselContainer.push(value)
        });
        var destPosition = firstCarrouselNumber + $(carrouselContainer).index($("div.carrousel_element_single_row_slides:has(img[slidenumber='" + orgPosition + "'])"));
        var movement = null;
        if(destPosition > orgPosition) {
          movement = "after"
        }else {
          if(destPosition < orgPosition) {
            movement = "before"
          }else {
            return
          }
        }
        var slideOrg = V.Slides.getSlideWithNumber(orgPosition);
        var slideDst = V.Slides.getSlideWithNumber(destPosition);
        if(slideOrg != null && slideDst != null && movement != null) {
          V.Editor.Slides.moveSlideTo(slideOrg, slideDst, movement);
          var carrouselVisibleElements = 8;
          $.each($("div.carrousel_element_single_row_slides:has(img[slidenumber])"), function(index, value) {
            var slideNumber = $(value).find("img.carrousel_element_single_row_slides").attr("slidenumber");
            if(slideNumber < firstCarrouselNumber || slideNumber > firstCarrouselNumber + carrouselVisibleElements - 1) {
              return
            }else {
              var slideNumber = firstCarrouselNumber + index;
              var p = $(value).find("p.carrousel_element_single_row_slides");
              $(p).html(slideNumber);
              var img = $(value).find("img.carrousel_element_single_row_slides");
              $(img).attr("slidenumber", slideNumber)
            }
          })
        }
      }})
    }else {
      if(presentationType === V.Constant.FLASHCARD) {
        V.Editor.Flashcard.Creator.redrawPois()
      }else {
        if(presentationType === V.Constant.VTOUR) {
          V.Editor.VirtualTour.Creator.redrawPois()
        }
      }
    }
    if(typeof redrawThumbnailsCallback === "function") {
      redrawThumbnailsCallback();
      redrawThumbnailsCallback = undefined
    }
  };
  var _onClickCarrouselElement = function(event) {
    switch($(event.target).attr("action")) {
      case "plus":
        $("#addSlideFancybox").trigger("click");
        break;
      case "goToSlide":
        V.Slides.goToSlide($(event.target).attr("slideNumber"));
        break;
      default:
        break
    }
  };
  var selectThumbnail = function(no) {
    $(".image_barbutton").removeClass("selectedSlideThumbnail");
    $(".image_barbutton[slideNumber=" + no + "]").addClass("selectedSlideThumbnail")
  };
  var getVisibleThumbnails = function() {
    var thumbnails = $("div.carrousel_element_single_row_slides").not(".draggable_arrow_div");
    var first = _getNumberOfThumbnail($(thumbnails[0]));
    var last = first;
    $(thumbnails).each(function(index, thumbnail) {
      var number = _getNumberOfThumbnail(thumbnail);
      if(isNaN(number)) {
        return false
      }else {
        last = number
      }
    });
    var last = Math.min(last, first + 7);
    return[first, last]
  };
  var _getNumberOfThumbnail = function(thumbnailDiv) {
    return parseInt($(thumbnailDiv).find("img.carrousel_element_single_row_slides[slidenumber]").attr("slidenumber"))
  };
  var moveCarrouselToSlide = function(slideNumber) {
    V.Editor.Carrousel.goToElement(carrouselDivId, slideNumber - 1)
  };
  return{init:init, redrawThumbnails:redrawThumbnails, selectThumbnail:selectThumbnail, getVisibleThumbnails:getVisibleThumbnails, moveCarrouselToSlide:moveCarrouselToSlide}
}(VISH, jQuery);
VISH.Editor.Tools.Menu = function(V, $, undefined) {
  var _initialized = false;
  var _hoverMenu = false;
  var _init = function() {
    if(!_initialized) {
      if(!V.Status.getDevice().desktop) {
        if(V.Status.getDevice().tablet) {
          V.Editor.MenuTablet.init()
        }else {
          disableMenu();
          return
        }
      }else {
        _hoverMenu = true
      }
      $.each($("#menu a.menu_action"), function(index, menuButton) {
        $(menuButton).on("click", function(event) {
          event.preventDefault();
          if($(menuButton).parent().hasClass("menu_item_disabled")) {
            return
          }
          if(typeof V.Editor.Tools.Menu[$(menuButton).attr("action")] == "function") {
            V.Editor.Tools.Menu[$(menuButton).attr("action")](this);
            _hideMenuAfterAction()
          }
        })
      });
      _initSettings();
      _initialized = true
    }
  };
  var init = function() {
    _init();
    $("#menu").hide();
    var presentationType = V.Editor.getPresentationType();
    _disableMenuItem($("ul.menu_option_main").find("li"));
    _enableMenuItem($("ul.menu_option_main").find("a.menu_all").parent());
    switch(presentationType) {
      case V.Constant.PRESENTATION:
        _enableMenuItem($("ul.menu_option_main").find("a.menu_presentation").parent());
        if(V.Editor.isPresentationStandard()) {
          _enableMenuItem($("ul.menu_option_main").find("a.menu_standard_presentation").parent())
        }
        break;
      case V.Constant.FLASHCARD:
        _enableMenuItem($("ul.menu_option_main").find("a.menu_flashcard").parent());
        break;
      case V.Constant.GAME:
        _enableMenuItem($("ul.menu_option_main").find("a.menu_game").parent());
        break;
      case V.Constant.VTOUR:
        _enableMenuItem($("ul.menu_option_main").find("a.menu_vtour").parent());
        break;
      case V.Constant.QUIZ_SIMPLE:
        break;
      default:
        break
    }
    $("#menu").show()
  };
  var _enableMenuItem = function(items) {
    $(items).removeClass("menu_item_disabled").addClass("menu_item_enabled")
  };
  var _disableMenuItem = function(items) {
    $(items).removeClass("menu_item_enabled").addClass("menu_item_disabled")
  };
  var updateMenuAfterAddSlide = function(slideType) {
    switch(slideType) {
      case V.Constant.STANDARD:
        break;
      case V.Constant.FLASHCARD:
      ;
      case V.Constant.VTOUR:
        return init();
        break;
      default:
        break
    }
  };
  var disableMenu = function() {
    $("#menu").hide();
    $("#menu").attr("id", "menuDisabled")
  };
  var enableMenu = function() {
    $("#menuDisabled").show();
    $("#menuDisabled").attr("id", "menu")
  };
  var _initSettings = function() {
    if(V.Configuration.getConfiguration()["presentationSettings"] && !V.Editor.hasInitialPresentation()) {
      $("a#edit_presentation_details").fancybox({"autoDimensions":false, "scrolling":"no", "width":800, "height":660, "padding":0, "hideOnOverlayClick":false, "hideOnContentClick":false, "showCloseButton":false});
      displaySettings()
    }else {
      $("a#edit_presentation_details").fancybox({"autoDimensions":false, "scrolling":"no", "width":800, "height":660, "padding":0, "hideOnOverlayClick":false, "hideOnContentClick":false, "showCloseButton":true})
    }
  };
  var displaySettings = function() {
    $("a#edit_presentation_details").trigger("click")
  };
  var firstSettingsCall = true;
  var onSettings = function() {
    if(firstSettingsCall) {
      $("a#edit_presentation_details").fancybox({"autoDimensions":false, "scrolling":"no", "width":800, "height":660, "padding":0, "hideOnOverlayClick":false, "hideOnContentClick":false, "showCloseButton":true})
    }
    if(V.Configuration.getConfiguration()["presentationTags"] && firstSettingsCall) {
      V.Editor.API.requestTags(_onInitialTagsReceived);
      var draftPresentation = V.Editor.getPresentation();
      if(draftPresentation && draftPresentation.avatar) {
        V.Editor.AvatarPicker.onLoadPresentationDetails(draftPresentation.avatar)
      }else {
        V.Editor.AvatarPicker.onLoadPresentationDetails(null)
      }
    }
  };
  var _onInitialTagsReceived = function(data) {
    var tagList = $(".tagBoxIntro .tagList");
    var draftPresentation = V.Editor.getPresentation();
    if($(tagList).children().length == 0) {
      if(!draftPresentation) {
      }else {
        if(draftPresentation.tags) {
          $.each(draftPresentation.tags, function(index, tag) {
            $(tagList).append("<li>" + tag + "</li>")
          })
        }
      }
      $(tagList).tagit({tagSource:data, sortable:true, maxLength:15, maxTags:6, watermarkAllowMessage:V.Editor.I18n.getTrans("i.AddTags"), watermarkDenyMessage:V.Editor.I18n.getTrans("i.limitReached")})
    }
  };
  var onSavePresentationDetailsButtonClicked = function(event) {
    event.preventDefault();
    if($("#presentation_title").val().length < 1) {
      $("#presentation_details_error").slideDown("slow");
      $("#presentation_details_error").show();
      return false
    }
    var draftPresentation = V.Editor.getPresentation();
    if(!draftPresentation) {
      draftPresentation = {}
    }
    draftPresentation.title = $("#presentation_title").val();
    draftPresentation.description = $("#presentation_description").val();
    draftPresentation.avatar = $("#presentation_avatar").val();
    draftPresentation.tags = V.Editor.Utils.convertToTagsArray($("#tagindex").tagit("tags"));
    draftPresentation.age_range = $("#age_range").val();
    draftPresentation.subject = $("#subject_tag").val();
    draftPresentation.language = $("#language_tag").val();
    draftPresentation.educational_objectives = $("#educational_objectives_tag").val();
    draftPresentation.adquired_competencies = $("#acquired_competencies_tag").val();
    V.Editor.setPresentation(draftPresentation);
    $("#presentation_details_error").hide();
    $.fancybox.close()
  };
  var onPedagogicalButtonClicked = function(event) {
    event.preventDefault();
    $("#presentation_details_fields").slideUp();
    $("#pedagogical_options_fields").slideDown()
  };
  var onDonePedagogicalButtonClicked = function(event) {
    event.preventDefault();
    $("#pedagogical_options_fields").slideUp();
    $("#presentation_details_fields").slideDown()
  };
  var onSaveButtonClicked = function() {
    var slidesetModule = V.Editor.Slideset.getCreatorModule(V.Editor.getPresentationType());
    var isSlideset = slidesetModule !== null;
    if(isSlideset) {
      var validate = slidesetModule.validateOnSave();
      if(typeof validate === "string") {
        _showDialog(validate);
        return
      }
    }
    if(V.Slides.getSlides().length === 0) {
      _showDialog("message1_form");
      return
    }
    switch(V.Configuration.getConfiguration()["mode"]) {
      case V.Constant.NOSERVER:
        $("a[save-option-id='save']").hide();
        break;
      case V.Constant.VISH:
        if(V.Editor.isPresentationDraft()) {
          $("a[save-option-id='save']").hide()
        }else {
          $("a[save-option-id='draft']").hide();
          $("a[save-option-id='publish']").hide()
        }
        break;
      case V.Constant.STANDALONE:
        $("a[save-option-id='publish']").hide();
        $("a[save-option-id='draft']").hide();
        break
    }
    $.fancybox($("#save_form").html(), {"autoDimensions":false, "width":350, "scrolling":"no", "height":150, "showCloseButton":false, "padding":0, "onClosed":function() {
      var response = $("#save_answer").val();
      if(response !== "cancel") {
        $("#save_answer").val("cancel");
        var presentation = V.Editor.savePresentation();
        V.Editor.afterSavePresentation(presentation, response)
      }else {
        return false
      }
    }})
  };
  var _showDialog = function(id) {
    if($("#" + id).length === 0) {
      return
    }
    $.fancybox($("#" + id).html(), {"autoDimensions":false, "scrolling":"no", "width":350, "height":200, "showCloseButton":false, "padding":5})
  };
  var preview = function() {
    V.Editor.Preview.preview()
  };
  var help = function() {
    $("#help_right").trigger("click")
  };
  var switchToPresentation = function() {
    _beforeChangeMode();
    V.Editor.setMode(V.Constant.PRESENTATION);
    var presentation = V.Editor.savePresentation();
    V.Editor.setPresentation(presentation);
    V.Editor.setPresentationType("presentation");
    V.Editor.Slides.showSlides();
    V.Editor.Thumbnails.redrawThumbnails();
    V.Editor.Tools.init()
  };
  var switchToFlashcard = function() {
    if(V.Slides.getSlides().length === 0) {
      $.fancybox($("#message5_form").html(), {"autoDimensions":false, "scrolling":"no", "width":450, "height":220, "showCloseButton":false, "padding":5})
    }else {
      _beforeChangeMode();
      V.Editor.setMode(V.Constant.FLASHCARD);
      V.Editor.Flashcard.Creator.onLoadMode()
    }
  };
  var switchToVirtualTour = function() {
    if(V.Slides.getSlides().length === 0) {
      $.fancybox($("#message5_form").html(), {"autoDimensions":false, "scrolling":"no", "width":450, "height":220, "showCloseButton":false, "padding":5})
    }else {
      _beforeChangeMode();
      V.Editor.setMode(V.Constant.VTOUR);
      V.Editor.VirtualTour.Creator.onLoadMode()
    }
  };
  var _beforeChangeMode = function() {
    switch(V.Editor.getMode()) {
      case V.Constant.PRESENTATION:
        break;
      case V.Constant.FLASHCARD:
        V.Editor.Flashcard.Creator.onLeaveMode();
        break;
      case V.Constant.VTOUR:
        V.Editor.VirtualTour.Creator.onLeaveMode();
        break;
      default:
        break
    }
  };
  var insertSmartcard = function() {
    $("#addSlideFancybox").trigger("click");
    V.Editor.Utils.loadTab("tab_smartcards_repo")
  };
  var insertPresentation = function() {
    $("#addSlideFancybox").trigger("click");
    V.Editor.Utils.loadTab("tab_presentations_repo")
  };
  var insertSlide = function() {
    $("#addSlideFancybox").trigger("click");
    V.Editor.Utils.loadTab("tab_templates")
  };
  var _hideMenuAfterAction = function() {
    if(_hoverMenu) {
      $("#menu").hide();
      setTimeout(function() {
        $("#menu").show()
      }, 50)
    }
  };
  return{init:init, updateMenuAfterAddSlide:updateMenuAfterAddSlide, disableMenu:disableMenu, enableMenu:enableMenu, displaySettings:displaySettings, insertPresentation:insertPresentation, insertSmartcard:insertSmartcard, insertSlide:insertSlide, onSettings:onSettings, onSavePresentationDetailsButtonClicked:onSavePresentationDetailsButtonClicked, onPedagogicalButtonClicked:onPedagogicalButtonClicked, onDonePedagogicalButtonClicked:onDonePedagogicalButtonClicked, onSaveButtonClicked:onSaveButtonClicked, 
  preview:preview, help:help, switchToPresentation:switchToPresentation, switchToFlashcard:switchToFlashcard, switchToVirtualTour:switchToVirtualTour}
}(VISH, jQuery);
VISH.Editor.Tour = function(V, $, undefined) {
  var startTourWithId = function(helpid, tipLocation) {
    clear();
    var loc;
    if(tipLocation === undefined) {
      loc = "top"
    }else {
      loc = tipLocation
    }
    $(window).joyride({"tipLocation":loc, "tipContent":"#" + helpid, "postRideCallback":V.Editor.Tour.clear})
  };
  var clear = function() {
    $(".joyride-tip-guide").each(function() {
      $(this).remove()
    })
  };
  return{clear:clear, startTourWithId:startTourWithId}
}(VISH, jQuery);
VISH.Editor.Utils.Loader = function(V, $, undefined) {
  var _loadObjectsInEditor = function(objects) {
    $.each(objects, function(index, object) {
      var htmlContent = $(object).attr("htmlContent");
      if(typeof htmlContent !== "undefined") {
        $(object).html(htmlContent);
        $(object).removeAttr("htmlContent")
      }
    })
  };
  var _unloadObjectsInEditor = function(objects) {
    $.each(objects, function(index, object) {
      var htmlContent = $(object).html();
      if(typeof htmlContent !== "undefined" && htmlContent !== "") {
        $(object).attr("htmlContent", $(object).html());
        $(object).html("")
      }
    })
  };
  var _loadSnapshotsInEditor = function(snapshots) {
    $.each(snapshots, function(index, snapshot) {
      var htmlContent = $(snapshot).attr("htmlContent");
      if(typeof htmlContent !== "undefined") {
        $(snapshot).html(htmlContent);
        $(snapshot).removeAttr("htmlContent");
        var scrollTop = parseInt($(snapshot).attr("scrollTop"));
        var scrollLeft = parseInt($(snapshot).attr("scrollLeft"));
        $(snapshot).scrollTop(scrollTop);
        $(snapshot).scrollLeft(scrollLeft)
      }
    })
  };
  var _unloadSnapshotsInEditor = function(snapshots, updateScrolls) {
    $.each(snapshots, function(index, snapshot) {
      var htmlContent = $(snapshot).html();
      if(typeof htmlContent !== "undefined" && htmlContent !== "") {
        if(updateScrolls === true) {
          $(snapshot).attr("scrollTop", $(snapshot).scrollTop());
          $(snapshot).attr("scrollLeft", $(snapshot).scrollLeft())
        }
        $(snapshot).attr("htmlContent", htmlContent);
        $(snapshot).html("")
      }
    })
  };
  var loadObjectsInEditorSlide = function(slide) {
    _loadObjectsInEditor($(slide).find(".object_wrapper"));
    _loadSnapshotsInEditor($(slide).find(".snapshot_wrapper"))
  };
  var unloadObjectsInEditorSlide = function(slide) {
    _unloadObjectsInEditor($(slide).find(".object_wrapper"));
    _unloadSnapshotsInEditor($(slide).find(".snapshot_wrapper"), true)
  };
  var loadAllObjects = function() {
    _loadObjectsInEditor($(".object_wrapper"));
    _loadSnapshotsInEditor($(".snapshot_wrapper"))
  };
  var unloadAllObjects = function() {
    _unloadObjectsInEditor($(".object_wrapper"));
    _unloadSnapshotsInEditor($(".snapshot_wrapper"))
  };
  return{loadObjectsInEditorSlide:loadObjectsInEditorSlide, unloadObjectsInEditorSlide:unloadObjectsInEditorSlide, loadAllObjects:loadAllObjects, unloadAllObjects:unloadAllObjects}
}(VISH, jQuery);
VISH.Editor.Video.HTML5 = function(V, $, undefined) {
  var init = function() {
  };
  var drawVideoWithUrl = function(url) {
    drawVideo([[url, _getVideoType(url)]])
  };
  var _getVideoType = function(url) {
    var source = V.Object.getObjectInfo(url).source;
    return"video/" + source.split(".").pop()
  };
  var drawVideo = function(sources, options, area, style) {
    var current_area;
    if(area) {
      current_area = area
    }else {
      current_area = V.Editor.getCurrentArea()
    }
    var posterUrl = V.ImagesPath + "example_poster_image.jpg";
    var autoplay = false;
    if(options) {
      if(options["poster"]) {
        posterUrl = options["poster"]
      }
      if(options["autoplay"]) {
        autoplay = options["autoplay"]
      }
    }
    var template = V.Editor.getTemplate(area);
    var nextVideoId = V.Utils.getId();
    var idToDragAndResize = "draggable" + nextVideoId;
    current_area.attr("type", "video");
    var videoTag = document.createElement("video");
    videoTag.setAttribute("id", idToDragAndResize);
    videoTag.setAttribute("draggable", true);
    videoTag.setAttribute("class", template + "_video");
    videoTag.setAttribute("title", "Click to drag");
    videoTag.setAttribute("controls", "controls");
    videoTag.setAttribute("preload", "metadata");
    videoTag.setAttribute("poster", posterUrl);
    videoTag.setAttribute("autoplayonslideenter", autoplay);
    if(style) {
      videoTag.setAttribute("style", style)
    }
    $(sources).each(function(index, source) {
      var videoSource = document.createElement("source");
      videoSource.setAttribute("src", source[0]);
      if(source[1]) {
        videoSource.setAttribute("type", source[1])
      }
      $(videoTag).append(videoSource)
    });
    var fallbackText = document.createElement("p");
    $(fallbackText).html("Your browser does not support HTML5 video.");
    $(videoTag).append(fallbackText);
    $(current_area).html("");
    $(current_area).append(videoTag);
    V.Editor.addDeleteButton($(current_area));
    $("#" + idToDragAndResize).draggable({cursor:"move"});
    V.Editor.Tools.loadToolsForZone(current_area)
  };
  var renderVideoFromSources = function(sources) {
    var posterUrl = V.ImagesPath + "example_poster_image.jpg";
    var rendered = "<video class='objectPreview' preload='metadata' controls='controls' poster='" + posterUrl + "' >";
    $.each(sources, function(index, source) {
      rendered = rendered + "<source src='" + source + "' " + _getVideoType(source) + ">"
    });
    rendered = rendered + "</video>";
    return rendered
  };
  return{init:init, drawVideoWithUrl:drawVideoWithUrl, drawVideo:drawVideo, renderVideoFromSources:renderVideoFromSources}
}(VISH, jQuery);
VISH.Editor.Video.Repository = function(V, $, undefined) {
  var carrouselDivId = "tab_video_repo_content_carrousel";
  var previewDivId = "tab_video_repo_content_preview";
  var currentVideos = new Array;
  var selectedVideo = null;
  var init = function() {
    var myInput = $("#tab_video_repo_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        _requestData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    var previousSearch = $("#tab_video_repo_content").find("input[type='search']").val() != "";
    if(!previousSearch) {
      _cleanVideoPreview();
      _requestInitialData()
    }
  };
  var _requestInitialData = function() {
    V.Editor.API.requestRecomendedVideos(_onDataReceived, _onAPIError)
  };
  var _requestData = function(text) {
    V.Editor.API.requestVideos(text, _onDataReceived, _onAPIError)
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanVideoPreview();
    currentVideos = new Array;
    var carrouselImages = [];
    var content = "";
    if(!data.videos || data.videos.length == 0) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data.videos, function(index, video) {
      if(video) {
        var myImg = $("<img src='" + video.poster + "' videoId='" + video.id + "'/>");
        carrouselImages.push(myImg);
        currentVideos[video.id] = video
      }
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = _onClickCarrouselElement;
    options["rowItems"] = 5;
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var _onAPIError = function() {
  };
  var _onClickCarrouselElement = function(event) {
    var videoId = $(event.target).attr("videoid");
    var renderedVideo = V.Renderer.renderVideo(currentVideos[videoId], "preview");
    _renderVideoPreview(renderedVideo, currentVideos[videoId]);
    selectedVideo = currentVideos[videoId]
  };
  var _renderVideoPreview = function(renderedVideo, video) {
    var videoArea = $("#" + previewDivId).find("#tab_video_repo_content_preview_video");
    var metadataArea = $("#" + previewDivId).find("#tab_video_repo_content_preview_metadata");
    var button = $("#" + previewDivId).find(".okButton");
    $(videoArea).html("");
    $(metadataArea).html("");
    if(renderedVideo && video) {
      $(videoArea).append(renderedVideo);
      var table = V.Editor.Utils.generateTable(video.author, video.title, video.description);
      $(metadataArea).html(table);
      $(button).show()
    }
  };
  var _cleanVideoPreview = function() {
    var videoArea = $("#" + previewDivId).find("#tab_video_repo_content_preview_video");
    var metadataArea = $("#" + previewDivId).find("#tab_video_repo_content_preview_metadata");
    var button = $("#" + previewDivId).find(".okButton");
    $(videoArea).html("");
    $(metadataArea).html("");
    $(button).hide()
  };
  var addSelectedVideo = function() {
    if(selectedVideo != null) {
      var sourcesArray = [];
      var options = new Array;
      options["poster"] = selectedVideo.poster;
      var sources = selectedVideo.sources;
      if(typeof sources == "string") {
        sources = JSON.parse(sources)
      }
      $.each(sources, function(index, source) {
        sourcesArray.push([source.src, source.type])
      });
      V.Editor.Video.HTML5.drawVideo(sourcesArray, options);
      $.fancybox.close()
    }
  };
  return{init:init, onLoadTab:onLoadTab, addSelectedVideo:addSelectedVideo}
}(VISH, jQuery);
VISH.Editor.Video.Vimeo = function(V, $, undefined) {
  var carrouselDivId = "tab_video_vimeo_content_carrousel";
  var previewDivId = "tab_video_vimeo_content_preview";
  var queryMaxMaxNumberVimeoVideo = 20;
  var currentVideos = new Array;
  var selectedVideo = null;
  var init = function() {
    var myInput = $("#tab_video_vimeo_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        V.Editor.Video.Vimeo.requestVimeoData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    $("#tab_video_vimeo_content").find("input[type='search']").val("");
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanVideoPreview()
  };
  var requestVimeoData = function(text) {
    V.Debugging.log("enter in requestVimeoData and text's value is:" + text);
    V.Debugging.log("url_vimeo is :" + url_vimeo);
    jQuery.getJSON(url_vimeo, function(data) {
      _onDataReceived(data)
    })
  };
  var _onDataReceived = function(data) {
    V.Debugging.log("enter in _onDataReceived and data value is: " + data)
  };
  var _onImagesLoaded = function() {
  };
  var vimeo_video_pattern_1 = /https?:\/\/?youtu.be\/([aA-zZ0-9]+)/g;
  var vimeo_video_pattern_2 = /(https?:\/\/)?(www.youtube.com\/watch\?v=|embed\/)([aA-z0-9Z]+)[&=.]*/g;
  var _getYoutubeIdFromURL = function(url) {
  };
  var addSelectedVideo = function() {
  };
  var onClickCarrouselElement = function(event) {
  };
  var _renderVideoPreview = function(renderedIframe, video) {
  };
  var _cleanVideoPreview = function() {
  };
  var _generateWrapper = function(videoId) {
  };
  var generateWrapperForYoutubeVideoUrl = function(url) {
  };
  return{init:init, onLoadTab:onLoadTab, requestVimeoData:requestVimeoData}
}(VISH, jQuery);
VISH.Editor.Video.Youtube = function(V, $, undefined) {
  var carrouselDivId = "tab_video_youtube_content_carrousel";
  var previewDivId = "tab_video_youtube_content_preview";
  var queryMaxMaxNumberYoutubeVideo = 20;
  var currentVideos = new Array;
  var selectedVideo = null;
  var init = function() {
    var myInput = $("#tab_video_youtube_content").find("input[type='search']");
    $(myInput).watermark(V.Editor.I18n.getTrans("i.SearchContent"));
    $(myInput).keydown(function(event) {
      if(event.keyCode == 13) {
        V.Editor.Video.Youtube.requestYoutubeData($(myInput).val());
        $(myInput).blur()
      }
    })
  };
  var onLoadTab = function() {
    $("#tab_video_youtube_content").find("input[type='search']").val("");
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanVideoPreview()
  };
  var requestYoutubeData = function(text) {
    var url_youtube = "http://gdata.youtube.com/feeds/api/videos?q=" + text + "&alt=json-in-script&callback=?&max-results=" + queryMaxMaxNumberYoutubeVideo + "&start-index=1";
    jQuery.getJSON(url_youtube, function(data) {
      _onDataReceived(data)
    })
  };
  var _onDataReceived = function(data) {
    V.Editor.Carrousel.cleanCarrousel(carrouselDivId);
    $("#" + carrouselDivId).hide();
    _cleanVideoPreview();
    currentVideos = new Array;
    var carrouselImages = [];
    var content = "";
    if(!data.feed || data.feed.length == 0 || !data.feed.entry) {
      $("#" + carrouselDivId).html("<p class='carrouselNoResults'> No results found </p>");
      $("#" + carrouselDivId).show();
      return
    }
    $.each(data.feed.entry, function(i, item) {
      var video = item["id"]["$t"];
      var title = item["title"]["$t"];
      var author = item.author[0].name.$t;
      var subtitle = item.media$group.media$description.$t;
      video = video.replace("http://gdata.youtube.com/feeds/api/videos/", "http://www.youtube.com/watch?v=");
      var videoID = video.replace("http://www.youtube.com/watch?v=", "");
      currentVideos[videoID] = new Object;
      currentVideos[videoID].id = videoID;
      currentVideos[videoID].title = title;
      currentVideos[videoID].author = author;
      currentVideos[videoID].subtitle = subtitle;
      var image_url = "http://img.youtube.com/vi/" + videoID + "/0.jpg";
      var myImg = $("<img videoID=" + videoID + " src=" + image_url + " />");
      carrouselImages.push(myImg)
    });
    V.Utils.Loader.loadImagesOnCarrousel(carrouselImages, _onImagesLoaded, carrouselDivId)
  };
  var _onImagesLoaded = function() {
    $("#" + carrouselDivId).show();
    var options = new Array;
    options["rows"] = 1;
    options["callback"] = V.Editor.Video.Youtube.onClickCarrouselElement;
    options["rowItems"] = 5;
    V.Editor.Carrousel.createCarrousel(carrouselDivId, options)
  };
  var addSelectedVideo = function() {
    if(selectedVideo != null) {
      V.Editor.Object.drawObject(_generateWrapper(selectedVideo.id));
      $.fancybox.close()
    }
  };
  var onClickCarrouselElement = function(event) {
    var videoId = $(event.target).attr("videoID");
    var renderedPreviewVideo = _generatePreviewWrapper(videoId);
    _renderVideoPreview(renderedPreviewVideo, currentVideos[videoId]);
    selectedVideo = currentVideos[videoId]
  };
  var _renderVideoPreview = function(renderedIframe, video) {
    var videoArea = $("#" + previewDivId).find("#tab_video_youtube_content_preview_video");
    var metadataArea = $("#" + previewDivId).find("#tab_video_youtube_content_preview_metadata");
    var button = $("#" + previewDivId).find(".okButton");
    $(videoArea).html("");
    $(metadataArea).html("");
    if(renderedIframe && video) {
      $(videoArea).append(renderedIframe);
      var table = V.Editor.Utils.generateTable(video.author, video.title, video.description);
      $(metadataArea).html(table);
      $(button).show()
    }
  };
  var _cleanVideoPreview = function() {
    var videoArea = $("#" + previewDivId).find("#tab_video_youtube_content_preview_video");
    var metadataArea = $("#" + previewDivId).find("#tab_video_youtube_content_preview_metadata");
    var button = $("#" + previewDivId).find(".okButton");
    $(videoArea).html("");
    $(metadataArea).html("");
    $(button).hide()
  };
  var _generateWrapper = function(videoId) {
    var video_embedded = "http://www.youtube.com/embed/" + videoId;
    current_area = V.Editor.getCurrentArea();
    var width_height = V.Editor.Utils.dimentionToDraw(current_area.width(), current_area.height(), 325, 243);
    var wrapper = "<iframe src='" + video_embedded + "?wmode=opaque' frameborder='0' style='width:" + width_height.width + "px; height:" + width_height.height + "px;'></iframe>";
    return wrapper
  };
  var generateWrapperForYoutubeVideoUrl = function(url) {
    var videoId = V.VideoPlayer.Youtube.getYoutubeIdFromURL(url);
    if(videoId != null) {
      return _generateWrapper(videoId)
    }else {
      return"Youtube Video ID can't be founded."
    }
  };
  var _generatePreviewWrapper = function(videoId) {
    var video_embedded = "http://www.youtube.com/embed/" + videoId;
    var wrapper = '<iframe class="objectPreview" type="text/html" src="' + video_embedded + '?wmode=opaque" frameborder="0"></iframe>';
    return wrapper
  };
  var generatePreviewWrapperForYoutubeVideoUrl = function(url) {
    var videoId = V.VideoPlayer.Youtube.getYoutubeIdFromURL(url);
    if(videoId != null) {
      return _generatePreviewWrapper(videoId)
    }else {
      return"<p class='objectPreview'>Youtube Video ID can't be founded.</p>"
    }
  };
  return{init:init, onLoadTab:onLoadTab, onClickCarrouselElement:onClickCarrouselElement, requestYoutubeData:requestYoutubeData, addSelectedVideo:addSelectedVideo, generateWrapperForYoutubeVideoUrl:generateWrapperForYoutubeVideoUrl, generatePreviewWrapperForYoutubeVideoUrl:generatePreviewWrapperForYoutubeVideoUrl}
}(VISH, jQuery);
VISH.Editor.VirtualTour.Creator = function(V, $, undefined) {
  var virtualTourId;
  var currentPois = undefined;
  var markers;
  var canvas;
  var map;
  var overlay;
  var geocoder;
  var initialized = false;
  var single_click;
  var click_timer;
  var trustOrgPois = false;
  var gMlLoaded = false;
  var init = function() {
    if(initialized) {
      return
    }
    virtualTourId = null;
    markers = {};
    canvas = $("#vt_canvas");
    clickTimer = null;
    single_click = false;
    _loadVTourCreatorEvents();
    initialized = true
  };
  var _loadVTourCreatorEvents = function() {
    $("#vt_search_input").on("keydown", function(event) {
      switch(event.keyCode) {
        case 13:
          event.preventDefault();
          break;
        default:
          break
      }
    });
    $("#vt_search_button").on("click", function(event) {
      event.preventDefault();
      _onSearchAddress()
    })
  };
  var getId = function() {
    return virtualTourId
  };
  var onLoadMode = function() {
    loadSlideset();
    V.Editor.Thumbnails.redrawThumbnails();
    V.Editor.Tools.init()
  };
  var onLeaveMode = function() {
    currentPois = _getCurrentPois();
    $("#vtour-background").hide()
  };
  var loadSlideset = function(presentation) {
    var virtualTour;
    V.Editor.setPresentationType(V.Constant.VTOUR);
    V.Editor.Slides.hideSlides();
    $("#vtour-background").show();
    if(presentation) {
      virtualTour = presentation.slides[0];
      virtualTourId = virtualTour.id;
      $("#vtour-background").attr("VirtualTour_id", virtualTourId);
      trustOrgPois = true
    }else {
      if(!virtualTourId) {
        virtualTourId = V.Utils.getId("article")
      }
      $("#vtour-background").attr("VirtualTour_id", virtualTourId)
    }
    if(typeof map == "undefined") {
      _loadMap(virtualTour)
    }else {
      _removeAllMarkers()
    }
  };
  var _loadMap = function(vt) {
    if(!gMlLoaded) {
      V.Utils.Loader.loadGoogleLibrary("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places", function() {
        gMlLoaded = true;
        _loadMap(vt)
      });
      return
    }
    if(!vt) {
      vt = {};
      vt.center = {"lat":34, "lng":2};
      vt.zoom = 2;
      vt.mapType = V.Constant.VTour.DEFAULT_MAP
    }
    var latlng = new google.maps.LatLng(vt.center.lat, vt.center.lng);
    var myOptions = {zoom:parseInt(vt.zoom), center:latlng, streetViewControl:false, mapTypeId:vt.mapType};
    map = new google.maps.Map($(canvas)[0], myOptions);
    overlay = new google.maps.OverlayView;
    overlay.draw = function() {
    };
    overlay.setMap(map);
    _loadLabel();
    geocoder = new google.maps.Geocoder;
    var input = document.getElementById("vt_search_input");
    var options = {};
    autocomplete = new google.maps.places.Autocomplete(input, options);
    google.maps.event.addListener(autocomplete, "place_changed", function() {
      _onSearchAddress()
    });
    google.maps.event.addListener(map, "click", function() {
      $("#vt_search_input").blur()
    })
  };
  var redrawPois = function() {
    $(canvas).droppable({accept:function(event, ui) {
      return true
    }, drop:function(event, ui) {
    }});
    $(".draggable_arrow_div").show();
    _restorePois();
    var reverted = false;
    $(".draggable_arrow_div").draggable({revert:function(dropped) {
      reverted = !dropped;
      return reverted
    }, stop:function(event, ui) {
      if(reverted) {
        return
      }
      var pageX = event.pageX - 55;
      var pageY = event.pageY - 30;
      var point = new google.maps.Point(pageX, pageY);
      var position = overlay.getProjection().fromContainerPixelToLatLng(point);
      if(_isPositionInViewport(position)) {
        var poi_id = $(event.target).attr("id");
        var slide_id = $(event.target).attr("slide_id");
        var marker = _addMarkerToPosition(position, poi_id, slide_id)
      }else {
        $(event.target).animate({top:0, left:0}, "slow")
      }
    }});
    $(".carrousel_element_single_row_slides").droppable()
  };
  var _restorePois = function() {
    if(!gMlLoaded) {
      setTimeout(function() {
        _restorePois()
      }, 1E3);
      return
    }
    if(typeof currentPois === "undefined" && trustOrgPois) {
      var presentation = V.Editor.getPresentation();
      if(presentation && presentation.slides && presentation.slides[0] && presentation.slides[0].pois) {
        currentPois = presentation.slides[0].pois
      }else {
        return
      }
    }
    if(typeof currentPois !== "undefined") {
      $.each(currentPois, function(index, poi) {
        if($("#" + poi.id).length > 0) {
          _addMarkerToCoordinates(poi.lat, poi.lng, poi.id, poi.slide_id)
        }
      })
    }
  };
  var _addMarkerToCoordinates = function(lat, lng, poi_id, slide_id) {
    return _addMarkerToPosition(new google.maps.LatLng(lat, lng), poi_id, slide_id)
  };
  var _addMarkerToPosition = function(myLatlng, poi_id, slide_id) {
    var label = new Label({map:map});
    var slideNumber;
    var slideNumberPattern = /([0-9]+)/g;
    var regexResult = slideNumberPattern.exec(poi_id);
    if(regexResult !== null && regexResult[0]) {
      slideNumber = regexResult[0]
    }
    var pinImage = new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + slideNumber + "|FF776B|000000", new google.maps.Size(25, 40), new google.maps.Point(0, 0), new google.maps.Point(10, 34));
    var marker = new google.maps.Marker({position:myLatlng, map:map, draggable:true, icon:pinImage, poi_id:poi_id, slide_id:slide_id, label:label, title:"(" + myLatlng.lat().toFixed(3) + "," + myLatlng.lng().toFixed(3) + ")"});
    if(slideNumber) {
      label.bindTo("position", marker, "position")
    }
    google.maps.event.addListener(marker, "click", function(event) {
      _onClick(marker)
    });
    $("#" + poi_id).hide();
    markers[poi_id] = marker;
    return marker
  };
  var _onClick = function(marker) {
    var point = overlay.getProjection().fromLatLngToContainerPixel(marker.position);
    var arrow = $("#" + marker.poi_id);
    $(arrow).show();
    var currentLeftOffset = $(arrow).offset().left;
    $(arrow).css("left", 0);
    var originalLeftOffset = $(arrow).offset().left;
    var top = point.y - 650;
    var left = point.x - originalLeftOffset + 25;
    $(arrow).css("top", top);
    $(arrow).css("left", left);
    $("#" + marker.poi_id).animate({top:0, left:0}, "slow");
    _removeMarker(marker)
  };
  var _onDoubleClick = function(marker) {
  };
  var _removeAllMarkers = function() {
    for(var key in markers) {
      _removeMarker(markers[key])
    }
  };
  var _removeMarker = function(marker) {
    marker.setMap(null);
    if(marker.label) {
      marker.label.onRemove()
    }
    if(typeof markers[marker.poi_id] !== "undefined") {
      delete markers[marker.poi_id]
    }
  };
  var _isPositionInViewport = function(position) {
    return map.getBounds().contains(position)
  };
  function Label(opt_options) {
    this.setValues(opt_options);
    var span = this.span_ = document.createElement("span");
    $(span).addClass("poi_label");
    var div = this.div_ = document.createElement("div");
    $(div).addClass("poi_label_container");
    div.appendChild(span)
  }
  var labelsInit = false;
  function _loadLabel() {
    if(labelsInit) {
      return
    }
    Label.prototype = new google.maps.OverlayView;
    Label.prototype.onAdd = function() {
      var pane = this.getPanes().overlayImage;
      pane.appendChild(this.div_);
      var me = this;
      this.listeners_ = [google.maps.event.addListener(this, "position_changed", function() {
        me.draw()
      }), google.maps.event.addListener(this, "text_changed", function() {
        me.draw()
      })]
    };
    Label.prototype.onRemove = function() {
      this.div_.parentNode.removeChild(this.div_);
      for(var i = 0, I = this.listeners_.length;i < I;++i) {
        google.maps.event.removeListener(this.listeners_[i])
      }
    };
    Label.prototype.draw = function() {
      var projection = this.getProjection();
      var position = projection.fromLatLngToDivPixel(this.get("position"));
      var div = this.div_;
      div.style.left = position.x + "px";
      div.style.top = position.y + "px";
      div.style.display = "block";
      div.style.zIndex = "2000";
      if(typeof this.get("text") != "undefined") {
        this.span_.innerHTML = this.get("text").toString()
      }
    };
    labelsInit = true
  }
  var _onSearchAddress = function() {
    var text = $("#vt_search_input").val();
    if(typeof text == "string" && text != "") {
      _getAddressForText(text, function(location) {
        if(location) {
          map.setCenter(location.address);
          map.fitBounds(location.bounds);
          $("#vt_search_input").val("");
          $("#vt_search_input").attr("placeholder", "Search places")
        }else {
          $("#vt_search_input").val("");
          $("#vt_search_input").attr("placeholder", "No results")
        }
      })
    }
  };
  var _getAddressForText = function(addressText, callback) {
    geocoder.geocode({"address":addressText}, function(results, status) {
      if(status === google.maps.GeocoderStatus.OK) {
        var addrLocation = results[0].geometry.location;
        var bounds = results[0].geometry.bounds;
        var location = {address:addrLocation, bounds:bounds};
        if(typeof callback === "function") {
          callback(location)
        }
      }else {
        if(typeof callback === "function") {
          callback(null)
        }
      }
    })
  };
  var getPois = function() {
    var pois = [];
    for(var key in markers) {
      var marker = markers[key];
      var poi = {};
      poi.lat = marker.position.lat().toString();
      poi.lng = marker.position.lng().toString();
      poi.id = virtualTourId + "_" + marker.poi_id;
      poi.slide_id = virtualTourId + "_" + marker.slide_id;
      pois.push(poi)
    }
    return pois
  };
  var _getCurrentPois = function() {
    var pois = [];
    for(var key in markers) {
      var marker = markers[key];
      var poi = {};
      poi.lat = marker.position.lat();
      poi.lng = marker.position.lng();
      poi.id = marker.poi_id;
      poi.slide_id = marker.slide_id;
      pois.push(poi)
    }
    return pois
  };
  var _hasPoiInMap = function() {
    return _getCurrentPois().length > 0
  };
  var onClickCarrouselElement = function(event) {
    switch($(event.target).attr("action")) {
      case "plus":
        $.fancybox($("#message2_form").html(), {"autoDimensions":false, "scrolling":"no", "width":550, "height":200, "showCloseButton":false, "padding":5});
        break;
      case "goToSlide":
        V.Editor.Preview.preview({forcePresentation:true, slideNumberToPreview:parseInt($(event.target).attr("slideNumber"))});
        break;
      default:
        break
    }
  };
  var validateOnSave = function() {
    if(!_hasPoiInMap()) {
      return"message6_form"
    }
    return true
  };
  var getSlideHeader = function() {
    var slide = {};
    slide.id = virtualTourId;
    slide.type = V.Constant.VTOUR;
    var center = map.getCenter();
    slide.center = {lat:center.lat().toString(), lng:center.lng().toString()};
    slide.zoom = map.getZoom().toString();
    slide.mapType = _getMapType(map);
    slide.width = "100%";
    slide.height = "100%";
    slide.pois = getPois();
    slide.slides = [];
    return slide
  };
  var _getMapType = function(map) {
    if(map && map.mapTypeId) {
      return map.mapTypeId
    }else {
      return V.Constant.VTour.DEFAULT_MAP
    }
  };
  return{init:init, getId:getId, onLoadMode:onLoadMode, onLeaveMode:onLeaveMode, loadSlideset:loadSlideset, redrawPois:redrawPois, getPois:getPois, onClickCarrouselElement:onClickCarrouselElement, getSlideHeader:getSlideHeader, validateOnSave:validateOnSave}
}(VISH, jQuery);
VISH.Events.Mobile = function(V, $, undefined) {
  var PM_TOUCH_SENSITIVITY = 20;
  var PM_TOUCH_DESVIATION = 60;
  var MINIMUM_ZOOM_TO_ENABLE_SCROLL = 1.2;
  var PM_TOUCH_SENSITIVITY_FOR_PAGER_FALLBACK = 15;
  var LONG_TOUCH_DURATION = 1E3;
  var bindedEventListeners = false;
  var init = function() {
    var device = V.Status.getDevice();
    var isIphoneAndSafari = device.iPhone && device.browser.name === V.Constant.SAFARI;
    if(isIphoneAndSafari) {
      _simpleClick = _simpleClickForIphoneAndSafari
    }
    if(device.tablet) {
      _longClick = _longClickForTablets
    }
    if(!isIphoneAndSafari && !device.tablet) {
      _checkClickTouches = function() {
        return false
      }
    }
  };
  var bindViewerMobileEventListeners = function() {
    if(bindedEventListeners) {
      return
    }else {
      bindedEventListeners = true
    }
    $(document).bind("touchstart", handleTouchStart);
    window.addEventListener("load", function() {
      _hideAddressBar()
    });
    $(window).on("orientationchange", function() {
      _hideAddressBar();
      $(window).trigger("resize")
    });
    document.body.addEventListener("touchmove", handleTouchMove, true);
    document.body.addEventListener("touchend", handleTouchEnd, true);
    document.body.addEventListener("touchcancel", handleTouchCancel, true)
  };
  var unbindViewerMobileEventListeners = function() {
    if(!bindedEventListeners) {
      return
    }else {
      bindedEventListeners = false
    }
    $(document).unbind("touchstart", handleTouchStart);
    window.removeEventListener("load", function() {
      _hideAddressBar()
    });
    $(window).off("orientationchange", function() {
      _hideAddressBar();
      window.onresize()
    });
    document.body.removeEventListener("touchmove", handleTouchMove, true);
    document.body.removeEventListener("touchend", handleTouchEnd, true)
  };
  var touchStartX = 0;
  var touchStartY = 0;
  var touchCX = 0;
  var touchCY = 0;
  var touchesLength = 0;
  var touchStartTime = 0;
  var handleTouchStart = function(event) {
    _resetTouchVars();
    var touches = _getTouches(event);
    touchesLength = touches.length;
    if(touchesLength === 1) {
      touchStartX = touches[0].pageX;
      touchStartY = touches[0].pageY
    }
    touchStartTime = (new Date).getTime()
  };
  var _resetTouchVars = function() {
    touchStartX = -1;
    touchStartY = -1;
    touchCX = -1;
    touchCY = -1;
    touchesLength = -1;
    touchStart = -1
  };
  var handleTouchMove = function(event) {
    var touches = _getTouches(event);
    if(touches.length === 1) {
      touchCX = touches[0].pageX;
      touchCY = touches[0].pageY;
      var zoom = document.documentElement.clientWidth / window.innerWidth;
      if(zoom <= MINIMUM_ZOOM_TO_ENABLE_SCROLL) {
        event.preventDefault();
        return
      }
    }
  };
  var handleTouchEnd = function(event) {
    if(touchesLength === 1) {
      if(_checkClickTouches(event)) {
        return
      }
      if(_checkAdvanceSlidesTouches(event)) {
        return
      }
      if(_checkOtherTouches(event)) {
        return
      }
    }
    _resetTouchVars()
  };
  var handleTouchCancel = function() {
    _resetTouchVars()
  };
  var _hideAddressBar = function() {
  };
  var _checkClickTouches = function(event) {
    var click = touchCX == -1 && touchCY == -1;
    if(click) {
      var duration = (new Date).getTime() - touchStartTime;
      if(duration < LONG_TOUCH_DURATION) {
        _simpleClick(event)
      }else {
        _longClick(event)
      }
    }
    return click
  };
  var _simpleClick = function(event) {
    return true
  };
  var _simpleClickForIphoneAndSafari = function(event) {
    if($(event.target).hasClass("fc_poi")) {
      event.preventDefault();
      var poiId = event.target.id;
      V.Events.onFlashcardPoiClicked(poiId)
    }else {
      if($(event.target).hasClass("close_subslide")) {
        event.preventDefault();
        V.Events.onFlashcardCloseSlideClicked(event)
      }
    }
    return true
  };
  var _longClick = function(event) {
    return true
  };
  var _longClickForTablets = function(event) {
    if(_checkPaginatorClick(event.target.id)) {
      event.preventDefault();
      event.stopPropagation();
      _applyPaginatorClick(event.target.id)
    }
  };
  var _checkAdvanceSlidesTouches = function(event) {
    var touchDX = touchCX - touchStartX;
    var touchDY = touchCY - touchStartY;
    var absTouchDX = Math.abs(touchDX);
    var absTouchDY = Math.abs(touchDY);
    var move_slide = absTouchDX > PM_TOUCH_SENSITIVITY && absTouchDY < PM_TOUCH_DESVIATION;
    move_slide = move_slide && touchCX !== -1;
    if(move_slide) {
      event.preventDefault();
      var zoom = document.documentElement.clientWidth / window.innerWidth;
      if(zoom > MINIMUM_ZOOM_TO_ENABLE_SCROLL) {
        return
      }
      var subslide = V.Slides.getCurrentSubSlide();
      if(subslide !== null) {
        V.Slides.closeSubslide($(subslide).attr("id"))
      }
      if(touchDX > 0) {
        V.Slides.backwardOneSlide()
      }else {
        V.Slides.forwardOneSlide()
      }
    }
    return move_slide
  };
  var _checkOtherTouches = function(event) {
    return false
  };
  var _checkOtherTouchesForTablets = function(event) {
    var id = event.target.id;
    if(_checkPaginatorClick(id)) {
      if((absTouchDX + absTouchDY) / 2 < PM_TOUCH_SENSITIVITY_FOR_PAGER_FALLBACK) {
        event.preventDefault();
        _applyPaginatorClick(id);
        return true
      }
    }
  };
  var _checkPaginatorClick = function(targetId) {
    return targetId === "page-switcher-end" || targetId === "page-switcher-start"
  };
  var _applyPaginatorClick = function(targetId) {
    if(targetId === "page-switcher-end") {
      $("#page-switcher-end").trigger("click")
    }else {
      if(targetId === "page-switcher-start") {
        $("#page-switcher-start").trigger("click")
      }
    }
  };
  var _getTouches = function(event) {
    if(event.touches) {
      return event.touches
    }else {
      if(event.originalEvent.touches) {
        return event.originalEvent.touches
      }else {
        return null
      }
    }
  };
  return{init:init, bindViewerMobileEventListeners:bindViewerMobileEventListeners, unbindViewerMobileEventListeners:unbindViewerMobileEventListeners}
}(VISH, jQuery);
VISH.EventsNotifier = function(V, $, undefined) {
  var listeners;
  var init = function() {
    listeners = new Array
  };
  var registerCallback = function(listenedEvent, callback) {
    if(listenedEvent in listeners) {
      listeners[listenedEvent].push(callback)
    }else {
      listeners[listenedEvent] = [];
      listeners[listenedEvent].push(callback);
      if(listenedEvent == V.Constant.Event.onMessage) {
        V.Messenger.init()
      }
    }
  };
  var unRegisterCallback = function(listenedEvent, callback) {
    if(listenedEvent in listeners) {
      if(listeners[listenedEvent].indexOf(callback) !== -1) {
        listeners[listenedEvent].splice(listeners[listenedEvent].indexOf(callback), 1)
      }
    }
  };
  var notifyEvent = function(triggeredEvent, params, triggeredByUser) {
    if(!listeners) {
      return
    }
    params = params || {};
    params.triggeredByUser = !(triggeredByUser === false);
    var eventListeners = listeners[triggeredEvent];
    if(eventListeners) {
      for(var i = 0;i < eventListeners.length;i++) {
        eventListeners[i](params)
      }
    }
  };
  return{init:init, notifyEvent:notifyEvent, registerCallback:registerCallback, unRegisterCallback:unRegisterCallback}
}(VISH, jQuery);
VISH.Game = function(V, $, undefined) {
  var actions = {};
  var registerActions = function(presentation) {
    actions = presentation.game.actions
  };
  var raiseAction = function(action_name) {
    if(actions[action_name]) {
      V.Debugging.log("show slide " + actions[action_name].slide_id)
    }
  };
  return{raiseAction:raiseAction, registerActions:registerActions}
}(VISH, jQuery);
var VISH = VISH || {};
VISH.Constant = VISH.Constant || {};
VISH.Constant.Event = {};
VISH.Constant.Event.onMessage = "onMessage";
VISH.Constant.Event.onGoToSlide = "onGoToSlide";
VISH.Constant.Event.onPlayVideo = "onPlayVideo";
VISH.Constant.Event.onPauseVideo = "onPauseVideo";
VISH.Constant.Event.onSeekVideo = "onSeekVideo";
VISH.Constant.Event.onFlashcardPointClicked = "onFlashcardPointClicked";
VISH.Constant.Event.onFlashcardSlideClosed = "onFlashcardSlideClosed";
VISH.Constant.Event.onSetSlave = "onSetSlave";
VISH.Constant.Event.onPreventDefault = "onPreventDefault";
VISH.Constant.Event.allowExitWithoutConfirmation = "allowExitWithoutConfirmation";
VISH.Constant.Event.onSelectedSlides = "onSelectedSlides";
VISH.Constant.Event.onIframeMessengerHello = "onIframeMessengerHello";
VISH.IframeAPI = function(V, undefined) {
  var helloAttempts;
  var maxHelloAttempts = 15;
  var helloTimeout;
  var options;
  var listeners;
  var init = function(initOptions) {
    options = initOptions;
    if(window.addEventListener) {
      window.addEventListener("message", _onWrapperedVEMessage, false)
    }else {
      if(el.attachEvent) {
        window.attachEvent("message", _onWrapperedVEMessage)
      }
    }
    listeners = new Array;
    _startHelloExchange()
  };
  var _startHelloExchange = function() {
    registerCallback(VISH.Constant.Event.onIframeMessengerHello, function(origin) {
      if(helloTimeout) {
        clearTimeout(helloTimeout)
      }
      _applyOptions(origin);
      if(options && typeof options.callback === "function") {
        options.callback(origin)
      }
    });
    helloAttempts = 0;
    helloTimeout = setInterval(function() {
      _sayHello()
    }, 1E3);
    _sayHello()
  };
  var _sayHello = function() {
    var helloMessage = _createMessage(VISH.Constant.Event.onIframeMessengerHello);
    sendMessage(helloMessage, "*");
    helloAttempts++;
    if(helloAttempts >= maxHelloAttempts && helloTimeout) {
      clearTimeout(helloTimeout)
    }
  };
  var _sendPreventDefaults = function(preventDefaults, destination) {
    var params = {};
    params.preventDefaults = preventDefaults;
    var VEMessage = _createMessage(VISH.Constant.Event.onPreventDefault, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var _applyOptions = function(destination) {
    if(options) {
      if(options.preventDefault === true) {
        _sendPreventDefaults(true, destination)
      }
    }
  };
  var registerCallback = function(listenedEvent, callback) {
    if(callback) {
      listeners[listenedEvent] = callback
    }
  };
  var unRegisterCallback = function(listenedEvent) {
    if(listenedEvent in listeners) {
      listeners[listenedEvent] = null
    }
  };
  function message(VEevent, params, origin, destination) {
    this.vishEditor = true;
    this.VEevent = VEevent;
    if(params) {
      this.params = params
    }
    if(origin) {
      this.origin = origin
    }else {
      this.origin = "?"
    }
    if(destination) {
      this.destination = destination
    }else {
      this.destination = "*"
    }
  }
  var _createMessage = function(VEevent, params, origin, destination) {
    var VEMessage = new message(VEevent, params, origin, destination);
    return JSON.stringify(VEMessage)
  };
  var _validateVEMessage = function(VEMessage) {
    if(typeof VEMessage !== "string") {
      return false
    }
    try {
      var VEMessageObject = JSON.parse(VEMessage);
      if(typeof VEMessageObject !== "object") {
        return false
      }
      if(VEMessageObject.vishEditor !== true) {
        return false
      }
      if(!VEMessageObject.VEevent) {
        return false
      }
    }catch(e) {
      return false
    }
    return true
  };
  var sendMessage = function(VEMessage, destination) {
    if(typeof destination === "string") {
      if(destination === "*") {
        _broadcastMessage(VEMessage)
      }else {
        var iframe = document.getElementById(destination);
        if(iframe && iframe.contentWindow) {
          iframe.contentWindow.postMessage(VEMessage, "*")
        }
      }
    }else {
      if(_isArray(destination) && typeof destination[0] == "string") {
        for(var i = 0;i < destination.length;i++) {
          var iframe = document.getElementById(destination[i]);
          if(iframe && iframe.contentWindow) {
            iframe.contentWindow.postMessage(VEMessage, "*")
          }
        }
      }else {
        _broadcastMessage(VEMessage)
      }
    }
  };
  var _broadcastMessage = function(VEMessage) {
    var allVEIframes = document.querySelectorAll(".vishEditorIframe");
    for(var i = 0;i < allVEIframes.length;i++) {
      allVEIframes[i].contentWindow.postMessage(VEMessage, "*")
    }
  };
  var _onWrapperedVEMessage = function(wrapperedVEMessage) {
    if(wrapperedVEMessage) {
      if(_validateVEMessage(wrapperedVEMessage.data)) {
        _processVEMessage(wrapperedVEMessage.data)
      }
    }
  };
  var _processVEMessage = function(VEMessage) {
    var VEMessageObject = JSON.parse(VEMessage);
    if(listeners[VISH.Constant.Event.onMessage]) {
      listeners[VISH.Constant.Event.onMessage](VEMessage, VEMessageObject.origin)
    }
    var callback = listeners[VEMessageObject.VEevent];
    if(!callback) {
      return
    }
    switch(VEMessageObject.VEevent) {
      case VISH.Constant.Event.onGoToSlide:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onPlayVideo:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onPauseVideo:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onSeekVideo:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onFlashcardPointClicked:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onFlashcardSlideClosed:
        if(VEMessageObject.params) {
          callback(VEMessageObject.params.slideNumber, VEMessageObject.origin)
        }
        break;
      case VISH.Constant.Event.onIframeMessengerHello:
        callback(VEMessageObject.origin);
        break;
      default:
        _print("VISH.Messenger.Proceesor Error: Unrecognized event: " + VEMessageObject.VEevent);
        break
    }
  };
  var goToSlide = function(slideNumber, destination) {
    var params = {};
    params.slideNumber = slideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onGoToSlide, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var playVideo = function(videoId, currentTime, videoSlideNumber, destination) {
    var params = {};
    params.videoId = videoId;
    params.currentTime = currentTime;
    params.slideNumber = videoSlideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onPlayVideo, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var pauseVideo = function(videoId, currentTime, videoSlideNumber, destination) {
    var params = {};
    params.videoId = videoId;
    params.currentTime = currentTime;
    params.slideNumber = videoSlideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onPauseVideo, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var seekVideo = function(videoId, currentTime, videoSlideNumber, destination) {
    var params = {};
    params.videoId = videoId;
    params.currentTime = currentTime;
    params.slideNumber = videoSlideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onSeekVideo, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var openSlideInFlashcard = function(flashcardSlideNumber, slideNumber, destination) {
    var params = {};
    params.flashcardSlideNumber = flashcardSlideNumber;
    params.slideNumber = slideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onFlashcardPointClicked, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var closeSlideInFlashcard = function(flashcardSlideNumber, slideNumber, destination) {
    var params = {};
    params.flashcardSlideNumber = flashcardSlideNumber;
    params.slideNumber = slideNumber;
    var VEMessage = _createMessage(VISH.Constant.Event.onFlashcardSlideClosed, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var setSlave = function(slave, destination) {
    var params = {};
    params.slave = slave;
    var VEMessage = _createMessage(VISH.Constant.Event.onSetSlave, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var setMaster = function(master) {
    var params = {};
    var allVEIframes = document.querySelectorAll(".vishEditorIframe");
    for(var i = 0;i < allVEIframes.length;i++) {
      if(allVEIframes[i].id !== master) {
        params.slave = true
      }else {
        params.slave = false
      }
      var destination = allVEIframes[i].id;
      var VEMessage = _createMessage(VISH.Constant.Event.onSetSlave, params, null, destination);
      sendMessage(VEMessage, destination)
    }
  };
  var allowExitWithoutConfirmation = function(destination) {
    var params = {};
    var VEMessage = _createMessage(VISH.Constant.Event.allowExitWithoutConfirmation, params, null, destination);
    sendMessage(VEMessage, destination)
  };
  var _print = function(objectToPrint) {
    if(console && console.log) {
      console.log(objectToPrint)
    }
  };
  var _isArray = function(object) {
    if(typeof object !== "undefined") {
      return object.constructor === Array
    }
    return false
  };
  return{init:init, registerCallback:registerCallback, unRegisterCallback:unRegisterCallback, sendMessage:sendMessage, setSlave:setSlave, setMaster:setMaster, allowExitWithoutConfirmation:allowExitWithoutConfirmation, goToSlide:goToSlide, playVideo:playVideo, pauseVideo:pauseVideo, seekVideo:seekVideo, openSlideInFlashcard:openSlideInFlashcard, closeSlideInFlashcard:closeSlideInFlashcard}
}(VISH);
VISH.ImagePlayer = function() {
  var reloadGifs = function(slide) {
    var imgs = $(slide).find("img");
    $.each(imgs, function(index, img) {
      var ext = V.Object.getExtensionFromSrc($(img).attr("src"));
      if(ext === "gif") {
        $(img).attr("src", $(img).attr("src"))
      }
    })
  };
  return{reloadGifs:reloadGifs}
}(VISH, jQuery);
VISH.Messenger.Helper = function(V, undefined) {
  function message(VEevent, params, origin, destination) {
    this.vishEditor = true;
    this.VEevent = VEevent;
    if(params) {
      this.params = params
    }
    if(origin) {
      this.origin = origin
    }else {
      this.origin = "?"
    }
    if(destination) {
      this.destination = destination
    }else {
      this.destination = "*"
    }
  }
  var createMessage = function(VEevent, params, origin, destination) {
    if(!origin) {
      if(V.Status.getIsInIframe()) {
        origin = V.Status.getIframe().id
      }
    }
    var VEMessage = new message(VEevent, params, origin, destination);
    return JSON.stringify(VEMessage)
  };
  var validateVEMessage = function(VEMessage, params) {
    if(typeof VEMessage !== "string") {
      return false
    }
    try {
      var VEMessageObject = JSON.parse(VEMessage);
      if(typeof VEMessageObject !== "object") {
        return false
      }
      if(VEMessageObject.vishEditor !== true) {
        return false
      }
      if(!VEMessageObject.VEevent) {
        return false
      }
      if(V.Status.getIsInIframe() && params && params.allowSelfMessages === false) {
        if(VEMessageObject.origin === V.Status.getIframe().id) {
          return false
        }
      }
    }catch(e) {
      return false
    }
    return true
  };
  var processVEMessage = function(VEMessage) {
    var VEMessageObject = JSON.parse(VEMessage);
    switch(VEMessageObject.VEevent) {
      case V.Constant.Event.onGoToSlide:
        if(VEMessageObject.params && VEMessageObject.params.slideNumber) {
          V.Slides.goToSlide(VEMessageObject.params.slideNumber, false)
        }
        break;
      case V.Constant.Event.onPlayVideo:
        if(VEMessageObject.params && VEMessageObject.params.videoId) {
          if(VEMessageObject.params.slideNumber && V.Slides.getCurrentSlideNumber() != VEMessageObject.params.slideNumber) {
            V.Slides.goToSlide(VEMessageObject.params.slideNumber, false)
          }
          V.VideoPlayer.playVideo(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, false)
        }
        break;
      case V.Constant.Event.onPauseVideo:
        if(VEMessageObject.params && VEMessageObject.params.videoId) {
          if(VEMessageObject.params.slideNumber && V.Slides.getCurrentSlideNumber() != VEMessageObject.params.slideNumber) {
            V.Slides.goToSlide(VEMessageObject.params.slideNumber, false)
          }
          V.VideoPlayer.pauseVideo(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, false)
        }
        break;
      case V.Constant.Event.onSeekVideo:
        if(VEMessageObject.params && VEMessageObject.params.videoId) {
          if(VEMessageObject.params.slideNumber && V.Slides.getCurrentSlideNumber() != VEMessageObject.params.slideNumber) {
            V.Slides.goToSlide(VEMessageObject.params.slideNumber, false)
          }
          V.VideoPlayer.seekVideo(VEMessageObject.params.videoId, VEMessageObject.params.currentTime, false)
        }
        break;
      case V.Constant.Event.onFlashcardPointClicked:
        if(VEMessageObject.params && VEMessageObject.params.slideNumber) {
          V.Slides.openSubslide(VEMessageObject.params.slideNumber, false)
        }
        break;
      case V.Constant.Event.onFlashcardSlideClosed:
        if(VEMessageObject.params && VEMessageObject.params.slideNumber) {
          V.Slides.closeSubslide(VEMessageObject.params.slideNumber, false)
        }
        break;
      case V.Constant.Event.onSetSlave:
        if(VEMessageObject.params && typeof VEMessageObject.params.slave != "undefined") {
          V.Status.setSlaveMode(VEMessageObject.params.slave)
        }
        break;
      case V.Constant.Event.onPreventDefault:
        if(VEMessageObject.params && typeof VEMessageObject.params.preventDefaults != "undefined") {
          V.Status.setPreventDefaultMode(VEMessageObject.params.preventDefaults)
        }
        break;
      case V.Constant.Event.allowExitWithoutConfirmation:
        V.Editor.allowExitWithoutConfirmation();
        break;
      case V.Constant.Event.onSelectedSlides:
        V.EventsNotifier.notifyEvent(V.Constant.Event.onSelectedSlides, VEMessageObject.params, true);
        break;
      default:
        V.Debugging.log("V.Messenger.Proceesor Error: Unrecognized event: " + VEMessageObject.VEevent);
        break
    }
  };
  return{createMessage:createMessage, processVEMessage:processVEMessage, validateVEMessage:validateVEMessage}
}(VISH, jQuery);
VISH.Object = function(V, $, undefined) {
  var init = function() {
  };
  function objectInfo(wrapper, source, sourceType) {
    this.wrapper = wrapper;
    this.source = source;
    this.type = sourceType
  }
  var getObjectInfo = function(object) {
    var wrapper = null;
    var element = $(object)[0];
    if(typeof element != "undefined") {
      var wrapper = element.tagName
    }
    var source = _getSourceFromObject(object, wrapper);
    var type = _getTypeFromSource(source);
    return new objectInfo(wrapper, source, type)
  };
  var _getSourceFromObject = function(object, wrapper) {
    switch(wrapper) {
      case null:
        return object;
      case "EMBED":
        return $(object).attr("src");
      case "OBJECT":
        if(typeof $(object).attr("src") != "undefined") {
          return $(object).attr("src")
        }
        if(typeof $(object).attr("data") != "undefined") {
          return $(object).attr("data")
        }
        return"source not founded";
      case "IFRAME":
        return $(object).attr("src");
      default:
        V.Debugging.log("Unrecognized object wrapper: " + wrapper);
        return null;
        break
    }
  };
  var _getTypeFromSource = function(source) {
    var http_urls_pattern = /(http(s)?:\/\/)([aA-zZ0-9%=_&+?])+([./-][aA-zZ0-9%=_&+?]+)*[/]?/g;
    var www_urls_pattern = /(www[.])([aA-zZ0-9%=_&+?])+([./-][aA-zZ0-9%=_&+?]+)*[/]?/g;
    var youtube_video_pattern = /(http(s)?:\/\/)?(((youtu.be\/)([aA-zZ0-9-]+))|((www.youtube.com\/((watch\?v=)|(embed\/)|(v\/)))([aA-z0-9-Z&=.])+))/g;
    var html5VideoFormats = ["mp4", "webm", "ogg"];
    var imageFormats = ["jpg", "jpeg", "png", "gif", "bmp"];
    if(typeof source != "string") {
      return null
    }
    if(source.match(youtube_video_pattern) != null) {
      return"youtube"
    }
    source = source.split("?")[0];
    var extension = getExtensionFromSrc(source);
    if(imageFormats.indexOf(extension) != "-1") {
      return"image"
    }
    if(extension == "swf") {
      return"swf"
    }
    if(extension == "pdf") {
      return"pdf"
    }
    if(html5VideoFormats.indexOf(extension) != "-1") {
      return"HTML5"
    }
    if(source.match(http_urls_pattern) != null || source.match(www_urls_pattern) != null) {
      return"web"
    }
    return extension
  };
  var getExtensionFromSrc = function(source) {
    return source.split(".").pop().toLowerCase()
  };
  return{init:init, getExtensionFromSrc:getExtensionFromSrc, getObjectInfo:getObjectInfo}
}(VISH, jQuery);
VISH.ObjectPlayer = function(V, $, undefined) {
  var loadObject = function(slide) {
    $.each(slide.children(".objectelement"), function(index, value) {
      if($(value).hasClass("youtubeelement")) {
        V.VideoPlayer.Youtube.loadYoutubeObject(slide, value);
        return
      }
      if($(value).attr("objectWrapper").match("^<iframe") !== null && V.Status.isOnline() === false) {
        $(value).html("<img src='" + V.ImagesPath + "/adverts/advert_new_grey_iframe.png'/>");
        return
      }
      var object = $($(value).attr("objectWrapper"));
      $(object).attr("style", $(value).attr("zoomInStyle"));
      $(value).html("<div style='" + $(value).attr("objectStyle") + "'>" + V.Utils.getOuterHTML(object) + "</div>");
      adjustDimensionsAfterZoom($($(value).children()[0]).children()[0])
    })
  };
  var unloadObject = function(slide) {
    $.each($(slide).children(".objectelement"), function(index, value) {
      $(value).html("")
    })
  };
  var aftersetupSize = function() {
    if($(".current").hasClass("object")) {
      loadObject($(".current"))
    }
  };
  var adjustDimensionsAfterZoom = function(objectWithZoom) {
    var parent = $(objectWithZoom).parent();
    var parentHeight = $(parent).height();
    var parentWidth = $(parent).width();
    var zoom = V.Utils.getZoomFromStyle($(objectWithZoom).attr("style"));
    var percentHeight = parentHeight / zoom / parentHeight * 100;
    var percentWidth = parentWidth / zoom / parentWidth * 100;
    $(objectWithZoom).height(percentHeight + "%");
    $(objectWithZoom).width(percentWidth + "%")
  };
  return{loadObject:loadObject, unloadObject:unloadObject, aftersetupSize:aftersetupSize, adjustDimensionsAfterZoom:adjustDimensionsAfterZoom}
}(VISH, jQuery);
VISH.Police = function(V, $, undefined) {
  var init = function() {
  };
  var valid_url_pattern = /((http(s)?:\/\/)|(www[.]))(.*)/g;
  var validateObject = function(object, callback) {
    if(!object) {
      return[false, "Object is null or undefined"]
    }
    if(typeof object == "string" && object.trim() == "") {
      return[false, "Object is an empty string"]
    }
    var objectInfo = V.Object.getObjectInfo(object);
    if(!objectInfo) {
      return[false, "Can't get Object info"]
    }
    if(!objectInfo.source || !objectInfo.type) {
      return[false, "Can't recognize object source"]
    }
    if(objectInfo.source.trim() == "") {
      return[false, "Object source is an empty string"]
    }
    if(typeof callback == "function") {
      _validateUrl(objectInfo.source, callback)
    }
    return[true, "Validation Ok"]
  };
  function _validateUrl(url, callback) {
    _checkUrl(url, function(status) {
      if(status === 404) {
        callback([false, "HTTP 404: Not found"])
      }else {
        callback([true, "Validation Ok"])
      }
    })
  }
  function _checkUrl(url, cb) {
    jQuery.ajax({url:url, dataType:"text", type:"GET", complete:function(xhr) {
      if(typeof cb === "function") {
        cb.apply(this, [xhr.status])
      }
    }})
  }
  var validateFileUpload = function(fileName) {
    if(!fileName) {
      return[false, "Name is null or undefined"]
    }
    if(fileName.trim() == "") {
      return[false, "Name is an empty string"]
    }
    return[true, "Validation Ok"]
  };
  return{init:init, validateObject:validateObject, validateFileUpload:validateFileUpload}
}(VISH, jQuery);
VISH.Presentation = function(V, undefined) {
  var mySlides = null;
  var init = function(slides) {
    mySlides = slides;
    V.Renderer.init();
    for(var i = 0;i < slides.length;i++) {
      V.Renderer.renderSlide(slides[i])
    }
    _finishRenderer()
  };
  var _finishRenderer = function() {
    V.VideoPlayer.HTML5.setVideoEvents();
    V.SlideManager.addEnterLeaveEvents();
    var evt = document.createEvent("Event");
    evt.initEvent("OURDOMContentLoaded", false, true);
    document.dispatchEvent(evt)
  };
  return{init:init}
}(VISH);
VISH.Quiz.API = function(V, $, undefined) {
  var init = function() {
  };
  var startQuizSession = function(quiz, quizJSON, successCallback, failCallback) {
    if(V.Configuration.getConfiguration().mode === V.Constant.VISH) {
      var send_type = "POST";
      var params = {"quiz":JSON.stringify(quizJSON), "authenticity_token":V.User.getToken()};
      $.ajax({type:send_type, url:"http://" + window.location.host + "/quiz_sessions", data:params, success:function(data) {
        if(typeof successCallback == "function") {
          successCallback(quiz, data)
        }
      }, error:function(error) {
        if(typeof failCallback == "function") {
          failCallback(error)
        }
      }})
    }else {
      if(V.Configuration.getConfiguration()["mode"] == V.Constant.NOSERVER) {
        var quizSessionId = Math.ceil(1E4 * (1 + Math.random())).toString();
        var url = "http://" + window.location.host + "/quiz_sessions/" + quizSessionId;
        var quiz_session = {id:quizSessionId, url:url};
        if(typeof successCallback == "function") {
          setTimeout(function() {
            successCallback(quiz, quiz_session)
          }, 1E3)
        }
      }
    }
  };
  var sendAnwers = function(answers, quizSessionId, successCallback, failCallback) {
    if(V.Configuration.getConfiguration().mode === V.Constant.VISH) {
      var send_type = "PUT";
      var params = {"id":quizSessionId, "answers":JSON.stringify(answers), "authenticity_token":V.User.getToken()};
      $.ajax({type:send_type, url:"http://" + window.location.host + "/quiz_sessions/" + quizSessionId, data:params, success:function(data) {
        if(typeof successCallback == "function") {
          successCallback(data)
        }
      }, error:function(error) {
        if(typeof failCallback == "function") {
          failCallback(error)
        }
      }});
      return null
    }else {
      if(typeof successCallback == "function") {
        setTimeout(function() {
          successCallback()
        }, 1E3)
      }
    }
  };
  var getResults = function(quizSessionId, successCallback, failCallback) {
    if(V.Configuration.getConfiguration()["mode"] == "vish") {
      var send_type = "GET";
      var params = {"id":quizSessionId, "authenticity_token":V.User.getToken()};
      $.ajax({type:send_type, url:"http://" + window.location.host + "/quiz_sessions/" + quizSessionId + "/results.json", data:params, success:function(data) {
        if(typeof successCallback == "function") {
          successCallback(data)
        }
      }, error:function(error) {
        if(typeof failCallback == "function") {
          failCallback(error)
        }
      }})
    }else {
      if(V.Configuration.getConfiguration()["mode"] == "noserver") {
        var data = [{"answer":'[{"no":"1","answer":"true"},{"no":"2","answer":"false"},{"no":"3","answer":"true"},{"no":"4","answer":"true"}]', "created_at":"2013-05-13T13:10:23Z", "id":30, "quiz_session_id":19}, {"answer":'[{"no":"1","answer":"true"},{"no":"2","answer":"false"},{"no":"3","answer":"false"},{"no":"4","answer":"true"}]', "created_at":"2013-05-13T13:10:37Z", "id":31, "quiz_session_id":19}, {"answer":'[{"no":"1","answer":"true"},{"no":"2","answer":"true"},{"no":"3","answer":"false"},{"no":"4","answer":"false"}]', 
        "created_at":"2013-05-13T13:10:52Z", "id":32, "quiz_session_id":19}, {"answer":'[{"no":"1","answer":"true"},{"no":"2","answer":"false"},{"no":"3","answer":"true"},{"no":"4","answer":"true"}]', "created_at":"2013-05-13T13:11:09Z", "id":33, "quiz_session_id":19}, {"answer":'[{"no":"1","answer":"true"},{"no":"2","answer":"false"},{"no":"3","answer":"true"},{"no":"4","answer":"true"}]', "created_at":"2013-05-13T13:11:41Z", "id":34, "quiz_session_id":19}];
        if(typeof successCallback == "function") {
          setTimeout(function() {
            successCallback(data)
          }, 1E3)
        }
      }
    }
  };
  var closeQuizSession = function(quizSessionId, name, successCallback, failCallback) {
    if(V.Configuration.getConfiguration()["mode"] == "vish") {
      var send_type = "GET";
      var params = {"id":quizSessionId, "authenticity_token":V.User.getToken()};
      if(typeof name == "string") {
        params["name"] = name
      }
      $.ajax({type:send_type, url:"http://" + window.location.host + "/quiz_sessions/" + quizSessionId + "/close", data:params, success:function(data) {
        if(typeof successCallback == "function") {
          successCallback(data)
        }
      }, error:function(error) {
        if(typeof failCallback == "function") {
          failCallback(error)
        }
      }})
    }else {
      if(V.Configuration.getConfiguration()["mode"] == "noserver") {
        var data = {"processed":"true"};
        if(typeof successCallback == "function") {
          setTimeout(function() {
            successCallback(data)
          }, 1E3)
        }
      }
    }
  };
  return{init:init, startQuizSession:startQuizSession, closeQuizSession:closeQuizSession, sendAnwers:sendAnwers, getResults:getResults}
}(VISH, jQuery);
VISH.Quiz.MC = function(V, $, undefined) {
  var choicesLetters = ["a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)", "k)", "l)", "m)", "n)", "o)", "p)", "q)", "r)", "s)"];
  var choices = {};
  var init = function() {
    _loadEvents()
  };
  var _loadEvents = function() {
  };
  var render = function(slide, template) {
    var quizId = V.Utils.getId();
    var container = $("<div id='" + quizId + "' class='quizzContainer mcContainer' type='" + V.Constant.QZ_TYPE.MCHOICE + "'></div>");
    var multipleAnswer = false;
    var inputType = "radio";
    if(slide.extras && slide.extras.multipleAnswer === true) {
      multipleAnswer = true;
      inputType = "checkbox"
    }
    var questionWrapper = $("<div class='mc_question_wrapper, mc_question_wrapper_viewer'></div>");
    $(questionWrapper).html(slide.question.wysiwygValue);
    $(container).append(questionWrapper);
    var optionsWrapper = $("<table cellspacing='0' cellpadding='0' class='mc_options'></table>");
    choices[quizId] = [];
    for(var i = 0;i < slide.choices.length;i++) {
      var option = slide.choices[i];
      var optionWrapper = $("<tr class='mc_option' nChoice='" + (i + 1) + "'></tr>");
      var optionBox = $("<td><input class='mc_box' type='" + inputType + "' name='mc_option' value='" + i + "'/></td>");
      var optionIndex = $("<td><span class='mc_option_index mc_option_index_viewer'>" + choicesLetters[i] + "</span></td>");
      var optionText = $("<td><div class='mc_option_text mc_option_text_viewer'></div></td>");
      $(optionText).html(option.wysiwygValue);
      $(optionWrapper).append(optionBox);
      $(optionWrapper).append(optionIndex);
      $(optionWrapper).append(optionText);
      $(optionsWrapper).append(optionWrapper);
      choices[quizId].push(option)
    }
    $(container).append(optionsWrapper);
    var quizButtons = V.Quiz.renderButtons(slide.selfA);
    $(container).append(quizButtons);
    return V.Utils.getOuterHTML(container)
  };
  var onAnswerQuiz = function(quiz) {
    var answeredQuiz = false;
    var quizChoices = choices[$(quiz).attr("id")];
    $(quiz).find("input[name='mc_option']").each(function(index, radioBox) {
      var answerValue = parseInt($(radioBox).attr("value"));
      var choice = quizChoices[answerValue];
      if($(radioBox).is(":checked")) {
        var trAnswer = $("tr.mc_option").has(radioBox);
        if(choice.answer === true) {
          $(trAnswer).addClass("mc_correct_choice")
        }else {
          if(choice.answer === false) {
            $(trAnswer).addClass("mc_wrong_choice")
          }
        }
        answeredQuiz = true
      }
    });
    var trCorrectAnswers = [];
    for(var key in quizChoices) {
      if(quizChoices[key].answer === true) {
        var trCorrect = $(quiz).find("tr.mc_option")[key];
        trCorrectAnswers.push($(quiz).find("tr.mc_option")[key]);
        if(answeredQuiz) {
          $(trCorrect).addClass("mc_correct_choice")
        }
      }
    }
    if(!answeredQuiz) {
      $(trCorrectAnswers).each(function(index, trCorrect) {
        $(trCorrect).find("input[name='mc_option']").attr("checked", "checked")
      })
    }
    disableQuiz(quiz)
  };
  var getReport = function(quiz) {
    var report = {};
    report.answers = [];
    $(quiz).find("input[name='mc_option']").each(function(index, radioBox) {
      if($(radioBox).is(":checked")) {
        report.answers.push({no:(index + 1).toString(), answer:"true"})
      }
    });
    report.empty = report.answers.length === 0;
    return report
  };
  var disableQuiz = function(quiz) {
    $(quiz).find("input[name='mc_option']").attr("disabled", "disabled");
    V.Quiz.disableAnswerButton(quiz)
  };
  var getChoicesLetters = function() {
    return choicesLetters
  };
  var drawResults = function(quiz, results, options) {
    var canvas = $("#quiz_chart");
    var nAnswers = $(quiz).find("tr.mc_option[nChoice]").length;
    V.QuizCharts.drawQuizChart(canvas, V.Constant.QZ_TYPE.MCHOICE, nAnswers, results, options)
  };
  return{init:init, render:render, onAnswerQuiz:onAnswerQuiz, getChoicesLetters:getChoicesLetters, getReport:getReport, disableQuiz:disableQuiz, drawResults:drawResults}
}(VISH, jQuery);
VISH.Quiz.TF = function(V, $, undefined) {
  var choices = {};
  var init = function() {
    _loadEvents()
  };
  var _loadEvents = function() {
  };
  var render = function(slide, template) {
    var quizId = V.Utils.getId();
    var container = $("<div id='" + quizId + "' class='quizzContainer mcContainer' type='" + V.Constant.QZ_TYPE.TF + "'></div>");
    var questionWrapper = $("<div class='mc_question_wrapper, mc_question_wrapper_viewer'></div>");
    $(questionWrapper).html(slide.question.wysiwygValue);
    $(container).append(questionWrapper);
    var optionsWrapper = $("<table cellspacing='0' cellpadding='0' class='tf_options'></table>");
    choices[quizId] = [];
    var newTr = $("<tr class='mc_option tf_head'><td><img src='" + V.ImagesPath + "quiz/checkbox_checked.png' class='tfCheckbox_viewer'/></td><td><img src='" + V.ImagesPath + "quiz/checkbox_wrong.png' class='tfCheckbox_viewer'/></td><td></td><td></td></tr>");
    $(optionsWrapper).prepend(newTr);
    for(var i = 0;i < slide.choices.length;i++) {
      var option = slide.choices[i];
      var optionWrapper = $("<tr class='mc_option' nChoice='" + (i + 1) + "'></tr>");
      var optionBox1 = $("<td><input class='tf_radio' type='radio' name='tf_radio" + i + "' column='true' value='" + index + "'/></td>");
      var optionBox2 = $("<td><input class='tf_radio' type='radio' name='tf_radio" + i + "' column='false' value='" + index + "'/></td>");
      var optionIndex = $("<td><span class='mc_option_index mc_option_index_viewer'>" + V.Quiz.MC.getChoicesLetters()[i] + "</span></td>");
      var optionText = $("<td><div class='mc_option_text mc_option_text_viewer'></div></td>");
      $(optionText).html(option.wysiwygValue);
      $(optionWrapper).append(optionBox1);
      $(optionWrapper).append(optionBox2);
      $(optionWrapper).append(optionIndex);
      $(optionWrapper).append(optionText);
      $(optionsWrapper).append(optionWrapper);
      choices[quizId].push(option)
    }
    $(container).append(optionsWrapper);
    var quizButtons = V.Quiz.renderButtons(slide.selfA);
    $(container).append(quizButtons);
    return V.Utils.getOuterHTML(container)
  };
  var onAnswerQuiz = function(quiz) {
    var quizChoices = choices[$(quiz).attr("id")];
    $(quiz).find("tr.mc_option").not(".tf_head").each(function(index, tr) {
      var trueRadio = $(tr).find("input[type='radio'][column='true']")[0];
      var falseRadio = $(tr).find("input[type='radio'][column='false']")[0];
      var myAnswer;
      if($(trueRadio).is(":checked")) {
        myAnswer = true
      }else {
        if($(falseRadio).is(":checked")) {
          myAnswer = false
        }else {
          myAnswer = undefined
        }
      }
      var choice = quizChoices[index];
      var trChoice = $(quiz).find("tr.mc_option").not(".tf_head")[index];
      if(myAnswer === choice.answer) {
        $(trChoice).addClass("mc_correct_choice")
      }else {
        if(typeof myAnswer != "undefined") {
          $(trChoice).addClass("mc_wrong_choice")
        }else {
          if(choice.answer === true) {
            $(trueRadio).attr("checked", true)
          }else {
            if(choice.answer === false) {
              $(falseRadio).attr("checked", true)
            }
          }
        }
      }
    });
    disableQuiz(quiz)
  };
  var getReport = function(quiz) {
    var report = {};
    report.answers = [];
    report.empty = true;
    $(quiz).find("tr.mc_option").not(".tf_head").each(function(index, tr) {
      var trueRadio = $(tr).find("input[type='radio'][column='true']")[0];
      var falseRadio = $(tr).find("input[type='radio'][column='false']")[0];
      if($(trueRadio).is(":checked")) {
        report.answers.push({no:(index + 1).toString(), answer:"true"});
        report.empty = false
      }else {
        if($(falseRadio).is(":checked")) {
          report.answers.push({no:(index + 1).toString(), answer:"false"});
          report.empty = false
        }else {
          report.answers.push({no:(index + 1).toString(), answer:"none"})
        }
      }
    });
    return report
  };
  var disableQuiz = function(quiz) {
    $(quiz).find("input[type='radio']").attr("disabled", "disabled");
    V.Quiz.disableAnswerButton(quiz)
  };
  var drawResults = function(quiz, results, options) {
    var canvas = $("#quiz_chart");
    var nAnswers = $(quiz).find("tr.mc_option[nChoice]").length;
    V.QuizCharts.drawQuizChart(canvas, V.Constant.QZ_TYPE.TF, nAnswers, results, options)
  };
  return{init:init, render:render, onAnswerQuiz:onAnswerQuiz, getReport:getReport, disableQuiz:disableQuiz, drawResults:drawResults}
}(VISH, jQuery);
var VISH = VISH || {};
VISH.Constant = VISH.Constant || {};
VISH.Constant.QZ_TYPE = VISH.Constant.QZ_TYPE || {};
VISH.Constant.QZ_TYPE.OPEN = "open";
VISH.Constant.QZ_TYPE.MCHOICE = "multiplechoice";
VISH.Constant.QZ_TYPE.TF = "truefalse";
VISH.QuizCharts = function(V, $, undefined) {
  var choicesLetters = ["a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)", "k)", "l)", "m)", "n)", "o)", "p)", "q)", "r)", "s)"];
  var pieBackgroundColor = ["#F38630", "#E0E4CC", "#69D2E7", "#FFF82A", "#FF0FB4", "#2A31FF", "#FF6075", "#00D043"];
  var pieLetterColor = ["#000", "#000", "#000", "#000", "#000", "#000", "#000", "#000"];
  var choices = {};
  var init = function() {
  };
  var drawQuizChart = function(canvas, quizType, nAnswers, results, options) {
    var answersList = _getAnswers(results);
    switch(quizType) {
      case V.Constant.QZ_TYPE.OPEN:
        break;
      case V.Constant.QZ_TYPE.MCHOICE:
        _drawMcChoiceQuizChart(canvas, nAnswers, answersList, options);
        break;
      case V.Constant.QZ_TYPE.TF:
        _drawTFQuizChart(canvas, nAnswers, answersList, options);
        break;
      default:
        return null;
        break
    }
  };
  var _drawMcChoiceQuizChart = function(canvas, nAnswers, answersList, options) {
    var pieFragments = [];
    var data = [];
    for(var i = 0;i < nAnswers;i++) {
      pieFragments[i] = {};
      pieFragments[i].value = 0;
      pieFragments[i].label = choicesLetters[i];
      pieFragments[i].color = pieBackgroundColor[i];
      pieFragments[i].labelColor = pieLetterColor[i];
      pieFragments[i].labelFontSize = "16"
    }
    var alL = answersList.length;
    for(var j = 0;j < alL;j++) {
      var answers = answersList[j];
      var aL = answers.length;
      for(var k = 0;k < aL;k++) {
        var answer = answers[k];
        var index = answer.no - 1;
        if(answer.answer === "true") {
          pieFragments[index].value++
        }
      }
    }
    for(var i = 0;i < nAnswers;i++) {
      data.push(pieFragments[i])
    }
    var ctx = $(canvas).get(0).getContext("2d");
    var animation = false;
    if(options && options.first === true) {
      animation = true
    }
    var options = {showTooltips:false, animation:animation};
    var myNewChart = (new Chart(ctx)).Pie(data, options)
  };
  var _drawTFQuizChart = function(canvas, nAnswers, answersList, options) {
    var labels = [];
    var dataTrue = [];
    var dataFalse = [];
    var maxValue = 0;
    var scaleSteps = 10;
    for(var i = 0;i < nAnswers;i++) {
      labels[i] = "V       " + choicesLetters[i] + "       F";
      dataTrue[i] = 0;
      dataFalse[i] = 0
    }
    var alL = answersList.length;
    for(var j = 0;j < alL;j++) {
      var answers = answersList[j];
      var aL = answers.length;
      for(var k = 0;k < aL;k++) {
        var answer = answers[k];
        var index = answer.no - 1;
        if(answer.answer === "true") {
          dataTrue[index]++
        }else {
          dataFalse[index]++
        }
      }
    }
    for(var l = 0;l < nAnswers;l++) {
      if(dataTrue[l] > maxValue) {
        maxValue = dataTrue[l]
      }
      if(dataFalse[l] > maxValue) {
        maxValue = dataFalse[l]
      }
    }
    if(maxValue < 10) {
      scaleSteps = Math.max(1, maxValue)
    }
    var ctx = $(canvas).get(0).getContext("2d");
    var data = {labels:labels, datasets:[{fillColor:"#E2FFE3", strokeColor:"rgba(220,220,220,1)", data:dataTrue}, {fillColor:"#FFE2E2", strokeColor:"rgba(220,220,220,1)", data:dataFalse}]};
    var animation = false;
    if(options && options.first === true) {
      animation = true
    }
    var options = {animation:animation, scaleOverride:true, scaleStepWidth:Math.max(1, Math.ceil(maxValue / 10)), scaleSteps:scaleSteps, showTooltips:false};
    var myNewChart = (new Chart(ctx)).Bar(data, options)
  };
  var _getAnswers = function(results) {
    var answers = [];
    var rL = results.length;
    for(var i = 0;i < rL;i++) {
      answers.push(JSON.parse(results[i].answer))
    }
    return answers
  };
  var getQuizParams = function(quiz) {
    var params = {};
    try {
      params.quizType = quiz["slides"][0]["elements"][0]["quiztype"];
      params.nAnswers = quiz["slides"][0]["elements"][0]["choices"].length
    }catch(e) {
    }
    return params
  };
  return{init:init, drawQuizChart:drawQuizChart, getQuizParams:getQuizParams}
}(VISH, jQuery);
VISH.Recommendations = function(V, $, undefined) {
  var url_to_get_recommendations;
  var user_id;
  var presentation_id;
  var generated;
  var init = function(options) {
    user_id = V.User.getId();
    presentation_id = V.SlideManager.getCurrentPresentation().id;
    if(options && options["urlToGetRecommendations"]) {
      url_to_get_recommendations = options["urlToGetRecommendations"]
    }
    generated = false;
    $("#fancyRec").fancybox({"type":"inline", "autoDimensions":false, "scrolling":"no", "autoScale":false, "width":"100%", "height":"100%", "padding":0, "overlayOpacity":0, "onComplete":function(data) {
      $("#fancybox-outer").css("background", "rgba(0,0,0,.7)");
      $("#fancybox-wrap").css("margin-top", "0px")
    }, "onClosed":function(data) {
      $("#fancybox-outer").css("background", "white");
      $("#fancybox-wrap").css("margin-top", "-14px")
    }})
  };
  var generateFancybox = function() {
    if(!generated) {
      if(url_to_get_recommendations !== undefined) {
        var params_to_send = {user_id:user_id, excursion_id:presentation_id, quantity:9};
        $.ajax({type:"GET", url:url_to_get_recommendations, data:params_to_send, success:function(data) {
          _fillFancyboxWithData(data)
        }})
      }else {
        _fillFancyboxWithData(VISH.Samples.API.recommendationList)
      }
      generated = true
    }
  };
  var _fillFancyboxWithData = function(data) {
    if(!data || data.length === 0) {
      return
    }
    var ex;
    var result = "";
    for(var i = data.length - 1;i >= 0;i--) {
      ex = data[i];
      if(V.Status.getIsEmbed()) {
        result += '<a href="' + ex.url + '.full">'
      }
      result += '<div class="rec-excursion" id="recom-' + ex.id + '" number="' + ex.id + '">' + '<ul class="rec-thumbnail">' + '<li class="rec-img-excursion">' + '<img src="' + ex.image + '">' + '<div class="rec-number_pages">' + ex.number_of_slides + "</div>" + "</li>" + '<li class="rec-info-excursion">' + '<div class="rec-title-excursion">' + ex.title + "</div>" + '<div class="rec-by">by <span class="rec-name">' + ex.author + "</span></div>" + '<span class="rec-visits">' + ex.views + '</span> <span class="rec-views">views</span>' + 
      '<div class="rec-likes">' + ex.favourites + '<img class="rec-menu_icon" src="http://vishub.org/assets/icons/star-on10.png"></div>' + "</li>" + "</ul>" + "</div>";
      if(V.Status.getIsEmbed()) {
        result += "</a>"
      }
    }
    $("#fancy_recommendations .rec-grid").html(result);
    if(!V.Status.getIsEmbed()) {
      for(var i = data.length - 1;i >= 0;i--) {
        $("#recom-" + data[i].id).click(function(my_event) {
          V.Utils.sendParentToURL(data[$(my_event.toElement).closest(".rec-excursion").attr("number")].url)
        })
      }
    }
  };
  var showFancybox = function() {
    if(V.Utils.getOptions() && V.Utils.getOptions().preview) {
      return
    }
    $("#fancyRec").trigger("click")
  };
  return{init:init, generateFancybox:generateFancybox, showFancybox:showFancybox}
}(VISH, jQuery);
VISH.Renderer.Filter = function(V, $, undefined) {
  var init = function() {
  };
  var allowElement = function(element) {
    var device = V.Status.getDevice();
    if(device.desktop) {
      switch(element.type) {
        case "applet":
          return false;
        default:
          return true
      }
    }else {
      if(device.mobile || device.tablet) {
        switch(element.type) {
          case "object":
            var objectInfo = V.Object.getObjectInfo(element.body);
            if(objectInfo.type == "swf") {
              return false
            }else {
              if(objectInfo.type == "youtube") {
                return true
              }
            }
            break;
          case "video":
            return true;
            break;
          case "snapshot":
            return true;
            break;
          case "applet":
            return false;
          default:
            return true
        }
      }
    }
    return true
  };
  var renderContentFiltered = function(element, template) {
    return"<div id='" + element["id"] + "' class='contentfiltered " + template + "_" + element["areaid"] + "'><img class='" + template + "_image' src='" + V.ImagesPath + "adverts/advert_new_grey.png'/></div>"
  };
  return{init:init, allowElement:allowElement, renderContentFiltered:renderContentFiltered}
}(VISH, jQuery);
VISH.SlideManager = function(V, $, undefined) {
  var initOptions;
  var mySlides = null;
  var slideStatus = {};
  var myDoc;
  var current_presentation;
  var presentationType = "presentation";
  var init = function(options, presentation) {
    V.Editing = false;
    V.Debugging.init(options);
    if(options) {
      initOptions = options
    }else {
      initOptions = {}
    }
    if(options && options["configuration"] && V.Configuration) {
      V.Configuration.init(options["configuration"])
    }
    if(V.Debugging.isDevelopping()) {
      if(options["configuration"]["mode"] === V.Constant.NOSERVER && !presentation && V.Debugging.getPresentationSamples() !== null) {
        presentation = V.Debugging.getPresentationSamples()
      }
    }
    V.Debugging.log("\n\nSlideManager.init with presentation:\n");
    V.Debugging.log(JSON.stringify(presentation));
    V.Utils.init();
    presentation = V.Utils.fixPresentation(presentation);
    current_presentation = presentation;
    setPresentationType(presentation.type);
    V.Status.init(function() {
      _initAferStatusLoaded(options, presentation)
    })
  };
  var _initAferStatusLoaded = function(options, presentation) {
    V.Flashcard.init();
    V.VirtualTour.init();
    V.Quiz.initBeforeRender(presentation);
    V.Renderer.init();
    V.Slides.init();
    V.Utils.loadDeviceCSS();
    V.User.init(options);
    V.Storage.init();
    V.Recommendations.init(options);
    V.Events.init();
    V.EventsNotifier.init();
    V.VideoPlayer.init();
    V.Themes.loadTheme(presentation.theme);
    mySlides = presentation.slides;
    V.Presentation.init(mySlides);
    V.Quiz.init();
    if(options.addons) {
      V.Addons.init(options.addons)
    }
    V.ViewerAdapter.init(options);
    if(!V.Status.getIsEmbed()) {
      window.focus()
    }
  };
  var toggleFullScreen = function() {
    if(V.Status.isSlaveMode()) {
      return
    }
    if(V.Status.getIsInIframe()) {
      var myDoc = parent.document
    }else {
      var myDoc = document
    }
    if(V.Status.getIsInIframe()) {
      var myElem = V.Status.getIframe()
    }else {
      var myElem = myDoc.getElementById("presentation_iframe")
    }
    if(myDoc.fullScreenElement && myDoc.fullScreenElement !== null || !myDoc.mozFullScreen && !myDoc.webkitIsFullScreen) {
      if(myDoc.documentElement.requestFullScreen) {
        myElem.requestFullScreen()
      }else {
        if(myDoc.documentElement.mozRequestFullScreen) {
          myElem.mozRequestFullScreen()
        }else {
          if(myDoc.documentElement.webkitRequestFullScreen) {
            myElem.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)
          }
        }
      }
    }else {
      if(myDoc.cancelFullScreen) {
        myDoc.cancelFullScreen()
      }else {
        if(myDoc.mozCancelFullScreen) {
          myDoc.mozCancelFullScreen()
        }else {
          if(myDoc.webkitCancelFullScreen) {
            myDoc.webkitCancelFullScreen()
          }
        }
      }
    }
  };
  var addEnterLeaveEvents = function() {
    $("article").live("slideenter", _onslideenter);
    $("article").live("slideleave", _onslideleave)
  };
  var getStatus = function(slideid) {
    if(!slideStatus[slideid]) {
      slideStatus[slideid] = {id:slideid, poiFrameNumber:0, drawingPoi:0}
    }
    return slideStatus[slideid]
  };
  var updateStatus = function(slideid, newStatus) {
    slideStatus[slideid] = newStatus
  };
  var getOptions = function() {
    return initOptions
  };
  var _onslideenter = function(e) {
    var slide = e.target;
    var cSlideNumber = V.Slides.getCurrentSlideNumber();
    V.ViewerAdapter.decideIfPageSwitcher();
    setTimeout(function() {
      if(cSlideNumber !== V.Slides.getCurrentSlideNumber()) {
        return
      }
      if($(slide).hasClass("object")) {
        V.ObjectPlayer.loadObject($(slide))
      }
      if($(e.target).hasClass("snapshot")) {
        V.SnapshotPlayer.loadSnapshot($(slide))
      }
    }, 500);
    V.VideoPlayer.HTML5.playVideos(e.target);
    if($(e.target).hasClass("flashcard_slide")) {
      V.Flashcard.startAnimation(e.target.id)
    }else {
      if($(e.target).hasClass("virtualTour_slide")) {
        V.VirtualTour.loadMap(e.target.id)
      }
    }
    if(_isRecommendationMoment()) {
      V.Recommendations.generateFancybox()
    }
  };
  var _onslideleave = function(e) {
    var slide = e.target;
    if($(slide).hasClass("object")) {
      V.ObjectPlayer.unloadObject($(slide))
    }
    if($(slide).hasClass("snapshot")) {
      V.SnapshotPlayer.unloadSnapshot($(slide))
    }
    V.VideoPlayer.HTML5.stopVideos(slide);
    if($(e.target).hasClass("flashcard_slide")) {
      V.Flashcard.stopAnimation(e.target.id)
    }
  };
  var _isRecommendationMoment = function() {
    var number_of_slides = V.Slides.getSlides().length;
    var slide_number = V.Slides.getCurrentSlideNumber();
    if(number_of_slides === 1 || slide_number === number_of_slides - 1) {
      return true
    }else {
      return false
    }
  };
  var updateSlideCounter = function() {
    var number_of_slides = V.Slides.getSlides().length;
    var slide_number = V.Slides.getCurrentSlideNumber();
    if(number_of_slides === 0) {
      slide_number = 0
    }
    $("#slide-counter").html(slide_number + "/" + number_of_slides)
  };
  var getCurrentPresentation = function() {
    return current_presentation
  };
  var getPresentationType = function() {
    return presentationType
  };
  var setPresentationType = function(type) {
    if(!type) {
      type = V.Constant.STANDARD
    }
    presentationType = type
  };
  return{init:init, getStatus:getStatus, updateStatus:updateStatus, addEnterLeaveEvents:addEnterLeaveEvents, toggleFullScreen:toggleFullScreen, getOptions:getOptions, updateSlideCounter:updateSlideCounter, getCurrentPresentation:getCurrentPresentation, getPresentationType:getPresentationType, setPresentationType:setPresentationType}
}(VISH, jQuery);
VISH.SlidesSelector = function(V, $, undefined) {
  var initialized = false;
  var countIndex;
  var acceptButton;
  var nSlides;
  var slides;
  var init = function() {
    if(!initialized) {
      countIndex = $("#ssbsp");
      acceptButton = $("#ssbaccept");
      nSlides = V.Slides.getSlidesQuantity();
      slides = [nSlides];
      _acceptAll();
      _updateIndex();
      $("#ssbAll").click(function(event) {
        _acceptAll();
        _updateInterface(V.Slides.getCurrentSlideNumber());
        _updateIndex()
      });
      $("#ssbuAll").click(function(event) {
        _denyAll();
        _updateInterface(V.Slides.getCurrentSlideNumber());
        _updateIndex()
      });
      $(acceptButton).click(function(event) {
        var aIndex = V.Slides.getCurrentSlideNumber() - 1;
        if(slides[aIndex] === true) {
          slides[aIndex] = false
        }else {
          slides[aIndex] = true
        }
        _updateInterface(V.Slides.getCurrentSlideNumber());
        _updateIndex()
      });
      $("#ssbdone").click(function(event) {
        var params = new Object;
        params.acceptedSlides = _getAcceptedSlides();
        params.JSON = V.SlideManager.getCurrentPresentation();
        V.Messenger.notifyEventByMessage(V.Constant.Event.onSelectedSlides, params)
      });
      V.EventsNotifier.registerCallback(V.Constant.Event.onGoToSlide, function(params) {
        _updateInterface(params.slideNumber)
      });
      initialized = true
    }
  };
  _acceptAll = function() {
    for(var i = 0;i < nSlides;i++) {
      slides[i] = true
    }
  };
  _denyAll = function() {
    for(var i = 0;i < nSlides;i++) {
      slides[i] = false
    }
  };
  _updateIndex = function() {
    var nAcceptedSlides = _getAcceptedSlides().length;
    $(countIndex).html("+" + nAcceptedSlides)
  };
  _getAcceptedSlides = function() {
    var aSlides = [];
    for(var i = 0;i < nSlides;i++) {
      if(slides[i]) {
        aSlides.push(i + 1)
      }
    }
    return aSlides
  };
  _updateInterface = function(slideNumber) {
    if(slides[slideNumber - 1] === true) {
      $(acceptButton).html("Deny")
    }else {
      $(acceptButton).html("Accept")
    }
  };
  return{init:init}
}(VISH, jQuery);
VISH.SnapshotPlayer = function(V, $, undefined) {
  var loadSnapshot = function(element) {
    $.each(element.children(".snapshotelement"), function(index, value) {
      var wrapper_class = "snapshot_wrapper" + "_viewer";
      var content_class = "snapshot_content" + "_viewer";
      var content = $(value).attr("objectWrapper");
      if(V.Status.isOnline() === false) {
        $(value).html("<img src='" + V.ImagesPath + "adverts/advert_new_grey_iframe.png'/>");
        return
      }
      var iframe = $(V.Utils.getOuterHTML($(content)));
      $(iframe).removeClass();
      $(iframe).addClass(content_class);
      var scrollTop = $(value).attr("scrollTop");
      var scrollLeft = $(value).attr("scrollLeft");
      $(value).html("<div class='" + wrapper_class + "' style='" + $(value).attr("objectStyle") + "'>" + V.Utils.getOuterHTML(iframe) + "</div>");
      if($(value).attr("zoom")) {
        $(value).find("." + content_class).attr("style", V.Utils.getZoomInStyle($(value).attr("zoom")))
      }
      $(value).find("." + wrapper_class).scrollTop(scrollTop);
      $(value).find("." + wrapper_class).scrollLeft(scrollLeft)
    })
  };
  var unloadSnapshot = function(element) {
    var element = $(".past, .next");
    $.each(element.children(".snapshotelement"), function(index, value) {
      $(value).html("")
    })
  };
  var aftersetupSize = function(increase) {
    $.each($(".snapshot_content_viewer"), function(index, iframe) {
      var area = $(iframe).parent().parent();
      var iframe_wrapper = $(iframe).parent();
      $(area).attr("zoom", increase);
      $(iframe).attr("style", V.Utils.getZoomInStyle(increase));
      var scrollLeft = $(area).attr("scrollLeftOrigin");
      var newScrollLeft = scrollLeft * increase;
      var scrollTop = $(area).attr("scrollTopOrigin");
      var newScrollTop = scrollTop * increase;
      $(area).attr("scrollLeft", newScrollLeft);
      $(area).attr("scrollTop", newScrollTop);
      $(iframe_wrapper).scrollLeft(newScrollLeft);
      $(iframe_wrapper).scrollTop(newScrollTop)
    })
  };
  return{loadSnapshot:loadSnapshot, unloadSnapshot:unloadSnapshot, aftersetupSize:aftersetupSize}
}(VISH, jQuery);
VISH.Status.Device.Browser = function(V, $, undefined) {
  var init = function() {
  };
  var fillBrowser = function() {
    var browser = {};
    var version;
    var android;
    version = _getInternetExplorerVersion();
    if(version != -1) {
      browser.name = V.Constant.IE;
      browser.version = version;
      return browser
    }
    version = _getFirefoxVersion();
    if(version != -1) {
      browser.name = V.Constant.FIREFOX;
      browser.version = version;
      return browser
    }
    version = _getGoogleChromeVersion();
    if(version != -1) {
      browser.name = V.Constant.CHROME;
      browser.version = version;
      return browser
    }
    android = /android/i.test(navigator.userAgent);
    version = _getSafariVersion();
    if(version != -1) {
      if(android) {
        browser.name = V.Constant.ANDROID_BROWSER
      }else {
        browser.name = V.Constant.SAFARI
      }
      browser.version = version;
      return browser
    }
    browser.name = V.Constant.UNKNOWN;
    browser.version = -1;
    if(android) {
      browser.name = V.Constant.ANDROID_BROWSER
    }
    return browser
  };
  var _getInternetExplorerVersion = function() {
    var rv = -1;
    if(navigator.appName === V.Constant.UA_IE) {
      var ua = navigator.userAgent;
      var re = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
      if(re.exec(ua) != null) {
        rv = parseFloat(RegExp.$1)
      }
    }
    return rv
  };
  var _getFirefoxVersion = function() {
    var rv = -1;
    if(navigator.appName === V.Constant.UA_NETSCAPE) {
      var ua = navigator.userAgent;
      var re = new RegExp(".* Firefox/([0-9.]+)");
      if(re.exec(ua) != null) {
        rv = parseFloat(RegExp.$1)
      }
    }
    return rv
  };
  var _getGoogleChromeVersion = function() {
    var rv = -1;
    if(navigator.appName === V.Constant.UA_NETSCAPE) {
      var ua = navigator.userAgent;
      var re = new RegExp(".* Chrome/([0-9.]+)");
      if(re.exec(ua) != null) {
        rv = parseFloat(RegExp.$1)
      }
    }
    return rv
  };
  var _getSafariVersion = function() {
    var rv = -1;
    if(navigator.appName === V.Constant.UA_NETSCAPE) {
      var ua = navigator.userAgent;
      if(ua.indexOf("Safari") !== -1 && ua.indexOf("Chrome") === -1 && ua.indexOf("crmo") == -1) {
        var rv = -2;
        var re = new RegExp(".* Version/([0-9.]+)");
        if(re.exec(ua) != null) {
          rv = parseFloat(RegExp.$1)
        }
      }
    }
    return rv
  };
  return{init:init, fillBrowser:fillBrowser}
}(VISH, jQuery);
VISH.Status.Device.Features = function(V, $, undefined) {
  var init = function() {
  };
  var fillFeatures = function() {
    var features = {};
    var elem = document.getElementById("page-fullscreen");
    if(elem && (elem.requestFullScreen || elem.mozRequestFullScreen || elem.webkitRequestFullScreen)) {
      features.fullscreen = true
    }else {
      features.fullscreen = false
    }
    features.touchScreen = !!("ontouchstart" in window);
    features.localStorage = V.Storage.checkLocalStorageSupport();
    features.history = typeof history === "object" && typeof history.back === "function" && typeof history.go === "function";
    return features
  };
  return{init:init, fillFeatures:fillFeatures}
}(VISH, jQuery);
VISH.Storage = function(V, $, undefined) {
  var _initialized;
  var _testing = false;
  var _isLocalStorageSupported;
  var init = function() {
    if(!_initialized) {
      _isLocalStorageSupported = checkLocalStorageSupport();
      _initialized = true;
      if(_testing) {
        clear();
        _isLocalStorageSupported = false
      }
    }
  };
  var add = function(key, value, persistent) {
    if(!_initialized) {
      init()
    }
    if(_isLocalStorageSupported) {
      persistent = !(persistent === false);
      var myObject = {};
      myObject.value = value;
      myObject.persistent = persistent;
      myObject.version = V.VERSION;
      myObject = JSON.stringify(myObject);
      localStorage.setItem(key, myObject);
      return true
    }else {
      return false
    }
  };
  var get = function(key) {
    if(!_initialized) {
      init()
    }
    if(_isLocalStorageSupported) {
      var myObject = localStorage.getItem(key);
      if(typeof myObject === "string") {
        myObject = JSON.parse(myObject);
        if(myObject && myObject.value) {
          if(!myObject.persistent && myObject.version) {
            var cVersion = parseFloat(V.VERSION);
            var valueVersion = parseFloat(myObject.version);
            if(cVersion > valueVersion) {
              return undefined
            }
          }
          return myObject.value
        }
      }
      return undefined
    }else {
      return undefined
    }
  };
  var addPresentation = function(presentation) {
    if(!_initialized) {
      init()
    }
    if(_isLocalStorageSupported) {
      var list = localStorage.getItem("presentation_list") ? JSON.parse(localStorage.getItem("presentation_list")) : new Array;
      if($.inArray(presentation.id, list) === -1) {
        list.push(presentation.id);
        localStorage.setItem("presentation_list", JSON.stringify(list))
      }
      localStorage.setItem("presentation_" + presentation.id, JSON.stringify(presentation));
      localStorage.setItem("presentation_" + presentation.id + "_url", window.location.href);
      if(presentation.avatar !== undefined) {
        _saveImage(presentation.avatar)
      }
    }else {
    }
  };
  var _saveImage = function(path) {
    if(!_initialized) {
      init()
    }
    if(localStorage.getItem(path) === null && !path.match(/^http/)) {
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      var img = new Image;
      img.src = path;
      img.onload = function() {
        canvas.width = this.width;
        canvas.height = this.height;
        ctx.drawImage(this, 0, 0, canvas.width, canvas.height);
        var name = img.src.replace(/http:\/\/[^\/]+/i, "");
        localStorage.setItem(name, canvas.toDataURL())
      }
    }
  };
  var checkLocalStorageSupport = function() {
    return typeof Storage !== "undefined"
  };
  var clear = function() {
    localStorage.clear()
  };
  var setTestingMode = function(bolean) {
    _testing = bolean
  };
  return{init:init, add:add, get:get, addPresentation:addPresentation, checkLocalStorageSupport:checkLocalStorageSupport, clear:clear, setTestingMode:setTestingMode}
}(VISH, jQuery);
VISH.Text = function(V, $, undefined) {
  var init = function() {
    _adaptPs($("article > div.VEtextArea > p"));
    _adaptPs($("article > div.quizzContainer > div > p"));
    _adaptPs($("article > div.quizzContainer").find("td > p"));
    $("article > div.VEtextArea > table").each(function(index, table) {
      _adaptSpans($(table).find("caption").find("span"));
      $(table).find("td").each(function(index, td) {
        _adaptSpans($(td).find("span"));
        _adaptFonts($(td).find("font"))
      });
      var tableOrgStyle = $(table).attr("style");
      if(tableOrgStyle) {
        var tableStyle = "";
        var tableWidth = V.Utils.getWidthFromStyle(tableOrgStyle);
        if(tableWidth) {
          var percentWidth = tableWidth * 100 / 800;
          tableStyle += "width:" + percentWidth + "%;"
        }
        var tableHeight = V.Utils.getHeightFromStyle(tableOrgStyle);
        if(tableHeight) {
          var percentHeight = tableHeight * 100 / 600;
          tableStyle += "height:" + percentHeight + "%;"
        }
        if(tableStyle !== "") {
          $(table).attr("style", tableStyle)
        }
      }
    })
  };
  var _adaptPs = function(selector) {
    $(selector).each(function(index, p) {
      if($(p).children().length === 0) {
        _setStyleInEm(p);
        return
      }
      _adaptSpans($(p).find("span"));
      _adaptFonts($(p).find("font"))
    })
  };
  var _adaptSpans = function(spans) {
    var oldStyle = null;
    var newStyle = null;
    var lastFontSizeCandidate = null;
    var lastFontSize = null;
    $(spans).each(function(index, span) {
      oldStyle = $(span).attr("style");
      lastFontSizeCandidate = parseInt(V.Utils.getFontSizeFromStyle(oldStyle));
      if(typeof lastFontSizeCandidate === "number" && !isNaN(lastFontSizeCandidate)) {
        lastFontSize = lastFontSizeCandidate
      }
      if($(span).find("span").length !== 0) {
        newStyle = V.Utils.removeFontSizeInStyle(oldStyle);
        if(newStyle === null || newStyle === "; ") {
          $(span).removeAttr("style")
        }else {
          $(span).attr("style", newStyle)
        }
      }else {
        var fontSize;
        if(typeof lastFontSizeCandidate === "number" && !isNaN(lastFontSizeCandidate)) {
          fontSize = lastFontSizeCandidate
        }else {
          if(lastFontSize !== null) {
            fontSize = lastFontSize
          }else {
            fontSize = V.Constant.TextDefault
          }
        }
        var em = fontSize / V.Constant.TextBase + "em";
        newStyle = V.Utils.addFontSizeToStyle(oldStyle, em);
        $(span).attr("style", newStyle)
      }
    })
  };
  var _adaptFonts = function(fonts) {
    $(fonts).each(function(index, font) {
      var fSize = $(font).attr("size");
      if(!fSize) {
        return
      }
      var fontSize = parseInt(fSize);
      if(isNaN(fontSize)) {
        return
      }
      $(font).hide();
      var pxfontSize = _font_to_px(fontSize);
      var em = pxfontSize / V.Constant.TextBase + "em";
      var span = $("<span style='font-size:" + em + "'></span>");
      $(span).html($(font).html());
      $(font).parent().prepend(span);
      $(font).remove()
    })
  };
  var _setStyleInEm = function(el) {
    var oldStyle = $(el).attr("style");
    var fontSize;
    if(typeof oldStyle !== "string") {
      oldStyle = ""
    }else {
      fontSize = V.Utils.getFontSizeFromStyle(oldStyle)
    }
    if(typeof fontSize !== "number" || isNaN(fontSize)) {
      fontSize = V.Constant.TextDefault
    }
    var em = fontSize / V.Constant.TextBase + "em";
    var newStyle = V.Utils.addFontSizeToStyle(oldStyle, em);
    $(el).attr("style", newStyle)
  };
  var aftersetupSize = function(increase) {
    increase = increase * _correctionFactor(increase);
    var reference_font_size = V.Constant.TextBase;
    var texts = $("article, #fancybox-content");
    $(texts).css("font-size", reference_font_size * increase + "px")
  };
  var _correctionFactor = function(factor) {
    if(factor < 0.25) {
      return 0.5
    }else {
      if(_isInRange(factor, 0.25, 0.3)) {
        return 0.55
      }else {
        if(_isInRange(factor, 0.3, 0.35)) {
          return 0.65
        }else {
          if(_isInRange(factor, 0.35, 0.4)) {
            return 0.7
          }else {
            if(_isInRange(factor, 0.4, 0.5)) {
              return 0.8
            }else {
              if(_isInRange(factor, 0.5, 0.6)) {
                return 0.85
              }else {
                if(_isInRange(factor, 0.6, 0.75)) {
                  return 0.9
                }else {
                  if(_isInRange(factor, 0.75, 0.95)) {
                    return 0.95
                  }else {
                    if(_isInRange(factor, 0.95, 1.5)) {
                      return 1
                    }else {
                      if(factor > 1.5) {
                        return 1
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    return 1
  };
  var _isInRange = function(number, min, max) {
    return number > min && number <= max
  };
  var _font_to_px = function(fz) {
    switch(fz) {
      case 7:
        return 48;
        break;
      case 6:
        return 32;
        break;
      case 5:
        return 24;
        break;
      case 4:
        return 18;
        break;
      case 3:
        return 16;
        break;
      case 2:
        return 14;
        break;
      case 1:
        return 12;
        break;
      default:
        break
    }
  };
  return{init:init, aftersetupSize:aftersetupSize}
}(VISH, jQuery);
VISH.Themes = function(V, $, undefined) {
  var loadTheme = function(theme) {
    if(!theme) {
      theme = V.Constant.Themes.Default
    }
    _unloadAllThemes();
    V.Utils.loadCSS("themes/" + theme + ".css")
  };
  var _unloadAllThemes = function() {
    var theme_pattern = "(^" + V.StylesheetsPath + "themes/)";
    $("head").find("link[type='text/css']").each(function(index, link) {
      var href = $(link).attr("href");
      if(href) {
        if(href.match(theme_pattern) !== null) {
          $(link).remove()
        }
      }
    })
  };
  return{loadTheme:loadTheme}
}(VISH, jQuery);
VISH.User = function(V, $, undefined) {
  var user;
  var init = function(options) {
    user = new Object;
    if(options["username"]) {
      user.username = options["username"]
    }
    if(options["userId"]) {
      user.id = options["userId"]
    }
    if(options["token"]) {
      user.token = options["token"]
    }
  };
  var isLogged = function() {
    if(user && typeof user.token == "string" && user.id) {
      return true
    }else {
      return false
    }
  };
  var getUser = function() {
    if(user) {
      return user
    }else {
      return null
    }
  };
  var getName = function() {
    if(user && user.username) {
      return user.username
    }else {
      return null
    }
  };
  var getId = function() {
    if(user && user.id) {
      return user.id
    }else {
      return null
    }
  };
  var getToken = function() {
    if(user && user.token) {
      return user.token
    }else {
      return null
    }
  };
  return{init:init, isLogged:isLogged, getUser:getUser, getName:getName, getId:getId, getToken:getToken}
}(VISH, jQuery);
VISH.Utils.Loader = function(V, undefined) {
  var _loadGoogleLibraryCallback = undefined;
  var libVideos = {};
  var libImages = {};
  var getImage = function(imagePath) {
    if(libImages[imagePath]) {
      return libImages[imagePath]
    }else {
      V.Debugging.log("Error, Image with path " + imagePath + " was not preloaded");
      return null
    }
  };
  var getVideo = function(videoPath) {
    if(libVideos[videoPath]) {
      return libVideos[videoPath]
    }else {
      V.Debugging.log("Error, Video with path " + videoPath + " was not preloaded");
      return null
    }
  };
  var loadImage = function(src) {
    var deferred, img;
    deferred = $.Deferred();
    img = new Image;
    img.onload = function() {
      deferred.resolve()
    };
    img.src = src;
    libImages[src] = img;
    return deferred.promise()
  };
  var loadVideo = function(videoSrc, videoId) {
    var deferred, v;
    deferred = $.Deferred();
    v = document.createElement("video");
    v.setAttribute("id", "video" + videoId);
    v.setAttribute("style", "display:none");
    v.setAttribute("preload", "auto");
    v.setAttribute("src", videoSrc);
    document.body.appendChild(v);
    v.addEventListener("loadedmetadata", function() {
      deferred.resolve()
    }, false);
    libVideos[videoSrc] = v;
    return deferred.promise()
  };
  var loadImagesOnCarrousel = function(imagesArray, callback, carrouselDivId, titleArray) {
    var imagesLength = imagesArray.length;
    var imagesLoaded = 0;
    $.each(imagesArray, function(i, image) {
      $(image).load(function(response) {
        if(titleArray && titleArray[imagesArray.indexOf(image)]) {
          $("#" + carrouselDivId).append("<div><p>" + titleArray[imagesArray.indexOf(image)] + "</p>" + V.Utils.getOuterHTML(image) + "</div>")
        }else {
          $("#" + carrouselDivId).append("<div>" + V.Utils.getOuterHTML(image) + "</div>")
        }
        imagesLoaded = imagesLoaded + 1;
        if(imagesLoaded == imagesLength) {
          callback()
        }
      });
      $(image).error(function(response) {
        imagesLoaded = imagesLoaded + 1;
        if(imagesLoaded == imagesLength) {
          callback()
        }
      })
    })
  };
  var loadImagesOnCarrouselOrder = function(imagesArray, callback, carrouselDivId, titleArray) {
    var validImagesArray = imagesArray;
    var imagesLength = imagesArray.length;
    var imagesLoaded = 0;
    $.each(imagesArray, function(i, image) {
      $(image).load(function(response) {
        imagesLoaded = imagesLoaded + 1;
        if(imagesLoaded == imagesLength) {
          _insertElementsWithOrder(validImagesArray, carrouselDivId, titleArray);
          callback()
        }
      });
      $(image).error(function(response) {
        imagesLoaded = imagesLoaded + 1;
        validImagesArray.splice(validImagesArray.indexOf(image), 1);
        if(imagesLoaded == imagesLength) {
          _insertElementsWithOrder(validImagesArray, carrouselDivId, titleArray);
          callback()
        }
      })
    })
  };
  var _insertElementsWithOrder = function(imagesArray, carrouselDivId, titleArray) {
    $.each(imagesArray, function(i, image) {
      if(titleArray && titleArray[imagesArray.indexOf(image)]) {
        var slideNumber = titleArray[imagesArray.indexOf(image)];
        var slideId = V.Slides.getSlideWithNumber(slideNumber).id;
        var poiId = "poi" + slideNumber;
        $("#" + carrouselDivId).append("<div><div class='draggable_arrow_div' slide_id='" + slideId + "' id='" + poiId + "'><img src='" + V.ImagesPath + "flashcard/flashcard_button.png'  class='fc_draggable_arrow'/><p class='draggable_number'>" + slideNumber + "</p></div><p slidenumber='" + slideNumber + "' action='goToSlide'>" + slideNumber + "</p>" + V.Utils.getOuterHTML(image) + "</div>")
      }else {
        $("#" + carrouselDivId).append("<div>" + V.Utils.getOuterHTML(image) + "</div>")
      }
    })
  };
  var loadScript = function(scriptSrc, callback) {
    if(typeof scriptSrc !== "string" || typeof callback !== "function") {
      return
    }
    var head = document.getElementsByTagName("head")[0];
    if(head) {
      var script = document.createElement("script");
      script.setAttribute("src", scriptSrc);
      script.setAttribute("type", "text/javascript");
      var loadFunction = function() {
        if(this.readyState == "complete" || this.readyState == "loaded") {
          callback()
        }
      };
      script.onreadystatechange = loadFunction;
      script.onload = callback;
      head.appendChild(script)
    }
  };
  var loadGoogleLibrary = function(scriptSrc, callback) {
    if(typeof callback === "function") {
      _loadGoogleLibraryCallback = callback
    }else {
      return
    }
    var fullScriptSrc = scriptSrc + "&callback=VISH.Utils.Loader.onGoogleLibraryLoaded";
    loadScript(fullScriptSrc, function() {
    })
  };
  var onGoogleLibraryLoaded = function() {
    if(typeof _loadGoogleLibraryCallback === "function") {
      _loadGoogleLibraryCallback()
    }
    _loadGoogleLibraryCallback = undefined
  };
  return{getImage:getImage, getVideo:getVideo, loadImage:loadImage, loadVideo:loadVideo, loadImagesOnCarrousel:loadImagesOnCarrousel, loadImagesOnCarrouselOrder:loadImagesOnCarrouselOrder, loadScript:loadScript, loadGoogleLibrary:loadGoogleLibrary, onGoogleLibraryLoaded:onGoogleLibraryLoaded}
}(VISH);
VISH.VideoPlayer.CustomPlayer = function(V, $, undefined) {
  var progressBarTimer;
  var init = function() {
  };
  var addCustomPlayerControls = function(videoId, loadEvents) {
    var video = document.getElementById(videoId);
    var customPlayerContainer = $("<div class='customPlayerContainer'>");
    $(video).parent().append(customPlayerContainer);
    $(video).remove();
    $(customPlayerContainer).append(video);
    $(customPlayerContainer).append($("<div class='customPlayerControls'><div class='customPlayerButton customPlayerPlay'></div></div>"));
    $(customPlayerContainer).append($("<div class='customPlayerProgressBar'><div class='progressBarElapsed'></div></div>"));
    var customPlayerControls = $(customPlayerContainer).find("div.customPlayerControls");
    $(customPlayerContainer).attr("style", $(video).attr("style"));
    $(video).attr("style", "width:100%; height:100%;");
    $(customPlayerControls).attr("style", "width: 100%; height:100%;");
    _adjustPlayerControls(customPlayerControls);
    $(video).attr("customPlayerStatus", "ready");
    if(loadEvents) {
      loadCustomPlayerControlEvents(video)
    }
  };
  var _adjustPlayerControls = function(customPlayerControls) {
    var width = $(customPlayerControls).width();
    var height = $(customPlayerControls).height();
    var min_width = 70;
    var originalBackgroundSize = 0.5;
    var icon_width = originalBackgroundSize * width;
    if(icon_width > height) {
      _applyBackgroundSize(customPlayerControls, height / width)
    }else {
      if(icon_width < min_width) {
        _applyBackgroundSize(customPlayerControls, Math.min(1, min_width / width))
      }else {
        _applyBackgroundSize(customPlayerControls, originalBackgroundSize)
      }
    }
  };
  var _applyBackgroundSize = function(customPlayerControls, bs) {
    $(customPlayerControls).find("div.customPlayerButton").css("background-size", bs * 100 + "%")
  };
  var loadCustomPlayerControlEvents = function(video) {
    var customPlayerContainer = $(video).parent();
    var customPlayerControls = $(customPlayerContainer).find("div.customPlayerControls");
    var progressBar = $(customPlayerContainer).parent().find("div.customPlayerProgressBar");
    $(customPlayerControls).bind("click", _onClickCustomPlayerControls);
    $(customPlayerContainer).bind("mouseenter", _onEnterCustomPlayer);
    $(customPlayerContainer).bind("mouseleave", _onLeaveCustomPlayer);
    $(progressBar).bind("click", _onClickProgressBar)
  };
  var _onClickCustomPlayerControls = function(event) {
    event.preventDefault();
    var video = $(this).parent().children()[0];
    onClickVideo(video)
  };
  var _onEnterCustomPlayer = function(event) {
    var video = $(event.target).parent().children()[0];
    if($(video).attr("customPlayerStatus") !== "ready") {
      var progressBar = $(video).parent().find("div.customPlayerProgressBar");
      $(progressBar).show()
    }
  };
  var _onLeaveCustomPlayer = function(event) {
    var progressBar = $(event.target).parent().find("div.customPlayerProgressBar");
    $(progressBar).hide()
  };
  var _startProgressBar = function(video) {
    var progressBar = $(video).parent().find("div.progressBarElapsed");
    var timer = progressBarTimer = setInterval(function() {
      try {
        var ratio = V.VideoPlayer.getCurrentTime(video) / V.VideoPlayer.getDuration(video) * 100;
        $(progressBar).width(ratio + "%");
        if(ratio === 100) {
          clearTimeout(timer)
        }
      }catch(e) {
        clearTimeout(timer)
      }
    }, 400)
  };
  var _onClickProgressBar = function(event) {
    if(V.Status.isSlaveMode()) {
      return
    }
    if($(event.target).hasClass("customPlayerProgressBar")) {
      var progressBar = event.target;
      var elapsed = $(progressBar).find("div.progressBarElapsed")[0]
    }else {
      if($(event.target).hasClass("progressBarElapsed")) {
        var elapsed = event.target;
        var progressBar = $(elapsed).parent()
      }else {
        return
      }
    }
    event.preventDefault();
    event.stopPropagation();
    var video = $(progressBar).parent().children()[0];
    var ratio = (event.pageX - $(progressBar).offset().left) / $(progressBar).outerWidth();
    var seekToPos = Math.round(V.VideoPlayer.getDuration(video) * ratio);
    V.VideoPlayer.seekVideo(video.id, seekToPos, true)
  };
  var onClickVideo = function(video) {
    if(V.Status.isSlaveMode()) {
      return
    }
    switch($(video).attr("customPlayerStatus")) {
      case "ready":
      ;
      case "pause":
        if(!V.Status.isPreventDefaultMode()) {
          onPlayVideo(video)
        }
        V.VideoPlayer.playVideo(video.id, null, true);
        break;
      case "playing":
        if(!V.Status.isPreventDefaultMode()) {
          onPauseVideo(video)
        }
        V.VideoPlayer.pauseVideo(video.id, null, true);
        break;
      default:
        break
    }
  };
  var onPlayVideo = function(video) {
    _startProgressBar(video);
    var customPlayerControlsButton = $(video).parent().find("div.customPlayerControls").find("div");
    var progressBar = $(video).parent().find("div.customPlayerProgressBar");
    $(customPlayerControlsButton).removeClass().addClass("customPlayerButton customPlayerPause");
    $(customPlayerControlsButton).hide();
    $(video).attr("customPlayerStatus", "playing");
    $(progressBar).show()
  };
  var onPauseVideo = function(video) {
    var customPlayerControlsButton = $(video).parent().find("div.customPlayerControls").find("div");
    $(customPlayerControlsButton).removeClass().addClass("customPlayerButton customPlayerPlay");
    $(customPlayerControlsButton).show();
    $(video).attr("customPlayerStatus", "pause")
  };
  var onEndVideo = function(video) {
    $(video).attr("customPlayerStatus", "pause");
    var customPlayerControlsButton = $(video).parent().find("div.customPlayerControls").find("div");
    $(customPlayerControlsButton).removeClass().addClass("customPlayerButton customPlayerReplay");
    $(customPlayerControlsButton).show()
  };
  return{init:init, addCustomPlayerControls:addCustomPlayerControls, loadCustomPlayerControlEvents:loadCustomPlayerControlEvents, onPlayVideo:onPlayVideo, onPauseVideo:onPauseVideo, onEndVideo:onEndVideo}
}(VISH, jQuery);
VISH.VideoPlayer.HTML5 = function(V, $, undefined) {
  var playTriggeredByUser = true;
  var pauseTriggeredByUser = true;
  var seekTriggeredByUser = true;
  var init = function() {
  };
  var setVideoEvents = function() {
    var videos = $("video");
    $.each(videos, function(index, video) {
      video.addEventListener("play", function() {
        var params = new Object;
        params.type = "HTML5";
        params.videoId = video.id;
        params.currentTime = video.currentTime;
        params.slideNumber = V.Slides.getCurrentSlideNumber();
        V.EventsNotifier.notifyEvent(V.Constant.Event.onPlayVideo, params, playTriggeredByUser);
        playTriggeredByUser = true
      }, false);
      video.addEventListener("pause", function() {
        var params = new Object;
        params.type = "HTML5";
        params.videoId = video.id;
        params.currentTime = video.currentTime;
        params.slideNumber = V.Slides.getCurrentSlideNumber();
        V.EventsNotifier.notifyEvent(V.Constant.Event.onPauseVideo, params, pauseTriggeredByUser);
        pauseTriggeredByUser = true
      }, false);
      video.addEventListener("ended", function() {
      }, false);
      video.addEventListener("error", function(err) {
      }, false);
      video.addEventListener("seeked", function(err) {
        var params = new Object;
        params.type = "HTML5";
        params.videoId = video.id;
        params.currentTime = video.currentTime;
        params.slideNumber = V.Slides.getCurrentSlideNumber();
        V.EventsNotifier.notifyEvent(V.Constant.Event.onSeekVideo, params, seekTriggeredByUser);
        seekTriggeredByUser = true
      }, false);
      $(video).focus(function(event) {
        this.blur()
      })
    })
  };
  var playVideos = function(element) {
    var currentVideos = $(element).find("video");
    $.each(currentVideos, function(index, video) {
      if($(video).attr("wasplayingonslideleave") == "true") {
        video.play()
      }else {
        if($(video).attr("wasplayingonslideleave") == "false") {
        }else {
          if(typeof $(video).attr("wasplayingonslideleave") == "undefined") {
            if($(video).attr("autoplayonslideenter") == "true") {
              video.play()
            }
          }
        }
      }
    })
  };
  var stopVideos = function(element) {
    var currentVideos = $(element).find("video");
    $.each(currentVideos, function(index, video) {
      var playing = !video.paused;
      $(video).attr("wasplayingonslideleave", playing);
      if(playing) {
        video.pause()
      }
    })
  };
  var playVideo = function(videoId, currentTime) {
    var video = $("#" + videoId)[0];
    if(typeof currentTime === "number" && video.currentTime !== currentTime) {
      seekTriggeredByUser = false;
      video.currentTime = currentTime
    }
    if(video.paused) {
      playTriggeredByUser = false;
      video.play()
    }
  };
  var pauseVideo = function(videoId, currentTime) {
    var video = $("#" + videoId)[0];
    if(typeof currentTime === "number" && video.currentTime !== currentTime) {
      seekTriggeredByUser = false;
      video.currentTime = currentTime
    }
    if(!video.paused) {
      pauseTriggeredByUser = false;
      video.pause()
    }
  };
  var seekVideo = function(videoId, currentTime) {
    var video = $("#" + videoId)[0];
    if(typeof currentTime === "number" && video.currentTime !== currentTime) {
      seekTriggeredByUser = false;
      video.currentTime = currentTime
    }
  };
  var showControls = function(showControls) {
    var videos = $("video");
    $.each(videos, function(index, video) {
      if(!showControls) {
        $(video).removeAttr("controls")
      }else {
        $(video).attr("controls", true)
      }
    })
  };
  return{init:init, setVideoEvents:setVideoEvents, playVideos:playVideos, stopVideos:stopVideos, playVideo:playVideo, pauseVideo:pauseVideo, seekVideo:seekVideo, showControls:showControls}
}(VISH, jQuery);
var youtubePlayers = {};
var YT = YT || {};
YT.PlayerState = YT.PlayerState || {};
YT.PlayerState.UNSTARTED = -1;
YT.PlayerState.ENDED = 0;
YT.PlayerState.PLAYING = 1;
YT.PlayerState.PAUSED = 2;
YT.PlayerState.BUFFERING = 3;
YT.PlayerState.CUED = 5;
function onYouTubeIframeAPIReady() {
}
VISH.VideoPlayer.Youtube = function(V, $, undefined) {
  var init = function() {
  };
  var _isYouTubeIframeAPIReady = function() {
    if(window["YT"]) {
      return true
    }else {
      return false
    }
  };
  var loadYoutubeObject = function(article, zone) {
    if(V.Status.isOnline() === false) {
      $(zone).html("<img src='" + V.ImagesPath + "adverts/advert_new_grey_video.png'/>");
      return
    }
    if(!_isYouTubeIframeAPIReady()) {
      return
    }
    var youtubeVideoId = getYoutubeIdFromURL($(zone).attr("source"));
    if(youtubeVideoId === null) {
      return
    }
    var iframeId = $(zone).attr("ytContainerId");
    $(zone).html("<div id='" + iframeId + "' style='" + $(zone).attr("objectStyle") + "'></div>");
    youtubePlayers[iframeId] = new YT.Player(iframeId, {height:"100%", width:"100%", videoId:youtubeVideoId, playerVars:{"autoplay":0, "controls":0, "enablejsapi":1, "showinfo":0, wmode:"transparent", "rel":0}, events:{"onReady":onPlayerReady, "onStateChange":onPlayerStateChange, "onError":onPlayerError}});
    $("#" + iframeId).attr("wmode", "transparent");
    V.VideoPlayer.CustomPlayer.addCustomPlayerControls(iframeId, false)
  };
  var onPlayerReady = function(event) {
    var iframe = event.target.getIframe();
    V.VideoPlayer.CustomPlayer.loadCustomPlayerControlEvents(iframe)
  };
  var onPlayerStateChange = function(event) {
    var newState = event.data;
    var iframe = event.target.getIframe();
    switch(newState) {
      case -1:
        break;
      case 0:
        V.VideoPlayer.CustomPlayer.onEndVideo(iframe);
        break;
      case 1:
        V.VideoPlayer.CustomPlayer.onPlayVideo(iframe);
        break;
      case 2:
        V.VideoPlayer.CustomPlayer.onPauseVideo(iframe);
        break;
      case 3:
        break;
      case 4:
        break;
      case 5:
        break;
      default:
        break
    }
  };
  var onPlayerError = function(event) {
    V.Debugging.log("onPlayerError with error type " + event.data)
  };
  var playVideo = function(iframeId, currentTime, triggeredByUser) {
    var ytPlayer = youtubePlayers[iframeId];
    if(ytPlayer && ytPlayer.getPlayerState) {
      var params = new Object;
      params.videoId = iframeId;
      params.currentTime = ytPlayer.getCurrentTime();
      params.slideNumber = V.Slides.getCurrentSlideNumber();
      if(triggeredByUser && V.Status.isPreventDefaultMode()) {
        V.Messenger.notifyEventByMessage(V.Constant.Event.onPlayVideo, params);
        return
      }
      V.EventsNotifier.notifyEvent(V.Constant.Event.onPlayVideo, params, triggeredByUser);
      _seekVideo(ytPlayer, iframeId, currentTime, false);
      if(ytPlayer.getPlayerState() !== YT.PlayerState.PLAYING) {
        ytPlayer.playVideo()
      }
    }
  };
  var pauseVideo = function(iframeId, currentTime, triggeredByUser) {
    var ytPlayer = youtubePlayers[iframeId];
    if(ytPlayer && ytPlayer.getPlayerState) {
      var params = new Object;
      params.videoId = iframeId;
      params.currentTime = ytPlayer.getCurrentTime();
      params.slideNumber = V.Slides.getCurrentSlideNumber();
      if(triggeredByUser && V.Status.isPreventDefaultMode()) {
        V.Messenger.notifyEventByMessage(V.Constant.Event.onPauseVideo, params);
        return
      }
      V.EventsNotifier.notifyEvent(V.Constant.Event.onPauseVideo, params, triggeredByUser);
      if(ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
        ytPlayer.pauseVideo()
      }
      _seekVideo(ytPlayer, iframeId, currentTime, false)
    }
  };
  var seekVideo = function(iframeId, seekTime, triggeredByUser) {
    var ytPlayer = youtubePlayers[iframeId];
    if(ytPlayer && ytPlayer.getPlayerState) {
      _seekVideo(ytPlayer, iframeId, seekTime, triggeredByUser)
    }
  };
  var _seekVideo = function(ytPlayer, iframeId, seekTime, triggeredByUser) {
    var changeCurrentTime = typeof seekTime === "number" && ytPlayer.getCurrentTime() !== seekTime;
    if(changeCurrentTime) {
      var params = new Object;
      params.videoId = iframeId;
      params.currentTime = seekTime;
      params.slideNumber = V.Slides.getCurrentSlideNumber();
      if(triggeredByUser && V.Status.isPreventDefaultMode()) {
        V.Messenger.notifyEventByMessage(V.Constant.Event.onSeekVideo, params);
        return
      }
      V.EventsNotifier.notifyEvent(V.Constant.Event.onSeekVideo, params, triggeredByUser);
      ytPlayer.seekTo(seekTime)
    }
  };
  var getYoutubeIdFromURL = function(url) {
    var id = null;
    if(!url) {
      return id
    }
    var youtube_video_pattern_1 = /https?:\/\/?youtu.be\/([aA-zZ0-9-]+)/g;
    var youtube_video_pattern_2 = /(https?:\/\/)?(www.youtube.com\/watch\?v=|embed\/)([aA-zZ0-9-]+)[&=.]*/g;
    var youtube_video_pattern_3 = /(https?:\/\/)?(www.youtube.com\/v\/)([aA-zZ0-9-]+)/g;
    var youtube_video_pattern_4 = /(https?:\/\/)?(www.youtube.com\/embed\/)([aA-zZ0-9-]+)/g;
    if(url.match(youtube_video_pattern_1) != null) {
      var result = youtube_video_pattern_1.exec(url);
      if(result && result[1]) {
        id = result[1]
      }
      return id
    }
    if(url.match(youtube_video_pattern_2) != null) {
      var result = url.split("&")[0];
      var result = youtube_video_pattern_2.exec(url);
      if(result && result[3]) {
        id = result[3]
      }
      return id
    }
    if(url.match(youtube_video_pattern_3) != null) {
      var result = url.split("&")[0];
      var result = youtube_video_pattern_3.exec(url);
      if(result && result[3]) {
        id = result[3]
      }
      return id
    }
    if(url.match(youtube_video_pattern_4) != null) {
      var result = url.split("&")[0];
      var result = youtube_video_pattern_4.exec(url);
      if(result && result[3]) {
        id = result[3]
      }
      return id
    }
    return id
  };
  return{init:init, loadYoutubeObject:loadYoutubeObject, onPlayerReady:onPlayerReady, onPlayerStateChange:onPlayerStateChange, playVideo:playVideo, pauseVideo:pauseVideo, seekVideo:seekVideo, getYoutubeIdFromURL:getYoutubeIdFromURL}
}(VISH, jQuery);
VISH.ViewerAdapter = function(V, $, undefined) {
  var render_full;
  var is_preview;
  var is_preview_insertMode;
  var close_button;
  var fs_button;
  var can_use_nativeFs;
  var embed;
  var display_recommendations;
  var showViewbar;
  var enter_fs_button;
  var enter_fs_url;
  var exit_fs_button;
  var exit_fs_url;
  var page_is_fullscreen;
  var initialized = false;
  var _lastWidth;
  var _lastHeight;
  var init = function(options) {
    if(initialized) {
      return
    }else {
      _lastWidth = -1;
      _lastHeight = -1;
      initialized = true
    }
    embed = V.Status.getIsEmbed();
    showViewbar = _defaultViewbar();
    if(options) {
      if(typeof render_full !== "boolean") {
        render_full = options["full"] === true && !V.Status.getIsInIframe() || options["forcefull"] === true
      }
      if(typeof options["preview"] === "boolean") {
        is_preview = options["preview"]
      }
      close_button = V.Status.getDevice().mobile && !V.Status.getIsInIframe() && options["comeBackUrl"];
      can_use_nativeFs = V.Status.getDevice().features.fullscreen;
      enter_fs_button = typeof options["fullscreen"] !== "undefined" && !can_use_nativeFs;
      if(enter_fs_button) {
        enter_fs_url = options["fullscreen"]
      }
      exit_fs_button = typeof options["exitFullscreen"] !== "undefined" && !can_use_nativeFs;
      if(exit_fs_button) {
        exit_fs_url = options["exitFullscreen"]
      }
      fs_button = can_use_nativeFs && V.Status.getIsInIframe() || enter_fs_button && exit_fs_button;
      fs_button = fs_button && !is_preview;
      fs_button = fs_button && !embed;
      if(embed) {
        $(".rec-first-row").hide()
      }
      page_is_fullscreen = render_full && !V.Status.getIsInIframe();
      if(typeof options["urlToGetRecommendations"] == "string") {
        display_recommendations = true
      }else {
        display_recommendations = false
      }
    }else {
      render_full = false;
      is_preview = false;
      close_button = false;
      enter_fs_button = false;
      exit_fs_button = false;
      fs_button = false;
      can_use_nativeFs = false;
      display_recommendations = false
    }
    is_preview_insertMode = false;
    if(is_preview) {
      var presentation = V.SlideManager.getCurrentPresentation();
      if(presentation.insertMode === true) {
        is_preview_insertMode = true
      }
    }
    if(V.Status.getDevice().mobile) {
      render_full = true;
      page_is_fullscreen = render_full && !V.Status.getIsInIframe();
      if(page_is_fullscreen) {
        fs_button = false;
        showViewbar = false
      }else {
        close_button = false
      }
    }
    if(V.Status.getDevice().desktop) {
      $("#back_arrow").html("");
      $("#forward_arrow").html("")
    }
    if(showViewbar) {
      V.SlideManager.updateSlideCounter();
      $("#viewbar").show()
    }else {
      $("#viewbar").hide()
    }
    if(is_preview) {
      $("div#viewerpreview").show()
    }
    if(is_preview_insertMode) {
      $("#selectSlidesBar").show();
      $("#viewbar").css("bottom", $("#selectSlidesBar").height() + "px");
      $("#viewbar").css("border-bottom", "none");
      V.SlidesSelector.init()
    }
    if(embed) {
      if(options && typeof options.watermarkURL == "string") {
        $("#embedWatermark").parent().attr("href", options.watermarkURL)
      }
      $("#embedWatermark").show()
    }
    if(close_button) {
      $("button#closeButton").show()
    }
    if(fs_button) {
      _enableFullScreen(page_is_fullscreen);
      $("#page-fullscreen").show()
    }else {
      $("#page-fullscreen").hide()
    }
    updateInterface();
    V.Text.init()
  };
  var decideIfPageSwitcher = function() {
    if(V.Slides.getCurrentSubSlide() !== null) {
      $("#forward_arrow").hide();
      $("#back_arrow").hide()
    }else {
      if(V.Slides.isCurrentFirstSlide()) {
        $("#back_arrow").hide()
      }else {
        $("#back_arrow").show()
      }
      $("#forward_arrow").show()
    }
    if(V.Slides.isCurrentFirstSlide()) {
      $("#page-switcher-start").addClass("disabledarrow")
    }else {
      $("#page-switcher-start").removeClass("disabledarrow")
    }
    $("#page-switcher-end").show()
  };
  var _decideIfViewBarShow = function(fullScreen) {
    if(showViewbar) {
      $("#viewbar").show()
    }else {
      $("#viewbar").hide()
    }
  };
  var _defaultViewbar = function() {
    var presentationType = V.SlideManager.getPresentationType();
    var slidesQuantity = V.Slides.getSlidesQuantity();
    if(presentationType === V.Constant.QUIZ_SIMPLE && slidesQuantity === 1) {
      return false
    }else {
      return true
    }
  };
  var updateInterface = function() {
    var cWidth = $(window).width();
    var cHeight = $(window).height();
    if(cWidth === _lastWidth && cHeight === _lastHeight) {
      return
    }
    _lastWidth = cWidth;
    _lastHeight = cHeight;
    _setupSize(render_full)
  };
  var _setupSize = function(fullscreen) {
    var reserved_px_for_menubar = 40;
    var margin_height = 40;
    var margin_width = 30;
    if(!showViewbar) {
      reserved_px_for_menubar = 0;
      margin_height = 0;
      margin_width = 0
    }else {
      if(is_preview_insertMode) {
        reserved_px_for_menubar = 120
      }
    }
    if(fullscreen) {
      _onFullscreenEvent(true)
    }else {
      _onFullscreenEvent(false)
    }
    var height = _lastHeight - reserved_px_for_menubar;
    var width = _lastWidth;
    var finalW = 800;
    var finalH = 600;
    var aspectRatio = width / height;
    var slidesRatio = 4 / 3;
    if(aspectRatio > slidesRatio) {
      finalH = height - margin_height;
      finalW = finalH * slidesRatio
    }else {
      finalW = width - margin_width;
      finalH = finalW / slidesRatio
    }
    $(".slides > article").css("height", finalH);
    $(".slides > article").css("width", finalW);
    $(".subslide").css("height", finalH);
    $(".subslide").css("width", finalW);
    var marginTop = finalH / 2 + reserved_px_for_menubar / 2;
    var marginLeft = finalW / 2;
    $(".slides > article").css("margin-top", "-" + marginTop + "px");
    $(".slides > article").css("margin-left", "-" + marginLeft + "px");
    $(".subslide").css("margin-top", "-" + finalH / 2 + "px");
    $(".subslide").css("margin-left", "-" + marginLeft + "px");
    var increase = finalH / 600;
    var increaseW = finalW / 800;
    $(".fc_poi img").css("width", 50 * increase + "px");
    $(".fc_poi img").css("height", 50 * increase + "px");
    decideIfPageSwitcher();
    V.Text.aftersetupSize(increase, increaseW);
    V.SnapshotPlayer.aftersetupSize(increase, increaseW);
    V.ObjectPlayer.aftersetupSize(increase, increaseW);
    V.VirtualTour.aftersetupSize(increase, increaseW);
    V.Quiz.aftersetupSize(increase, increaseW);
    _updateFancyboxAfterSetupSize()
  };
  var _updateFancyboxAfterSetupSize = function() {
    if($("#fancybox-content:empty").length === 0) {
      $("#fancybox-wrap").width($(".current").width() + 100);
      $("#fancybox-wrap").height($(".current").height() + 70);
      $("#fancybox-wrap").css("top", $(".current").offset().top + "px");
      $("#fancybox-wrap").css("left", $(".current").offset().left + "px");
      setTimeout(function() {
        $("#fancybox-content").width("100%");
        $("#fancybox-content").height("100%");
        $("#fancybox-content > div").width("100%");
        $("#fancybox-content > div").height("100%")
      }, 300)
    }
  };
  var _enableFullScreen = function(fullscreen) {
    if(can_use_nativeFs) {
      if(V.Status.getIsInIframe()) {
        var myDoc = parent.document
      }else {
        var myDoc = document
      }
      $(document).on("click", "#page-fullscreen", V.SlideManager.toggleFullScreen);
      $(myDoc).on("webkitfullscreenchange mozfullscreenchange fullscreenchange", function(event) {
        setTimeout(function() {
          page_is_fullscreen = !page_is_fullscreen;
          render_full = page_is_fullscreen;
          _setupSize(page_is_fullscreen)
        }, 400)
      })
    }else {
      if(fullscreen && exit_fs_button) {
        $("#page-fullscreen").css("background-image", 'url("' + V.ImagesPath + 'icons/fullscreen.png")');
        $("#page-fullscreen").css("background-position", "0px 0px");
        $(document).on("click", "#page-fullscreen", function() {
          if(exit_fs_url && !embed) {
            window.location = exit_fs_url
          }else {
            if(V.Status.getDevice().features.history) {
              history.back()
            }
          }
        })
      }else {
        if(!fullscreen && enter_fs_button) {
          $(document).on("click", "#page-fullscreen", function() {
            if(typeof window.parent.location.href !== "undefined") {
              V.Utils.sendParentToURL(enter_fs_url + "?orgUrl=" + window.parent.location.href)
            }else {
              V.Utils.sendParentToURL(enter_fs_url + "?embed=true")
            }
          })
        }
      }
    }
  };
  var _onFullscreenEvent = function(fullscreen) {
    if(typeof fullscreen === "undefined") {
      fullscreen = page_is_fullscreen
    }
    if(fullscreen) {
      _onEnterFullScreen()
    }else {
      _onLeaveFullScreen()
    }
  };
  var _onEnterFullScreen = function() {
    $("#page-fullscreen").css("background-image", 'url("' + V.ImagesPath + 'icons/fullscreenback.png")');
    $("#page-fullscreen").css("background-position", "0px 0px");
    $("#page-fullscreen").hover(function() {
      $("#page-fullscreen").css("background-position", "-30px -40px")
    }, function() {
      $("#page-fullscreen").css("background-position", "0px 0px")
    });
    _decideIfViewBarShow(true)
  };
  var _onLeaveFullScreen = function() {
    $("#page-fullscreen").css("background-image", 'url("' + V.ImagesPath + 'icons/fullscreen.png")');
    $("#page-fullscreen").css("background-position", "0px 0px");
    $("#page-fullscreen").hover(function() {
      $("#page-fullscreen").css("background-position", "-40px -40px")
    }, function() {
      $("#page-fullscreen").css("background-position", "0px 0px")
    });
    _decideIfViewBarShow(false)
  };
  var isFullScreen = function() {
    return page_is_fullscreen
  };
  var decideIfCloseButton = function() {
    if(close_button) {
      $("#closeButton").show()
    }
  };
  return{init:init, updateInterface:updateInterface, isFullScreen:isFullScreen, decideIfPageSwitcher:decideIfPageSwitcher, decideIfCloseButton:decideIfCloseButton}
}(VISH, jQuery);
VISH.VirtualTour = function(V, $, undefined) {
  var virtualTours;
  var gMlLoaded = false;
  var gMlLoading = false;
  var lastIncrease;
  var _loadQueue;
  var init = function(presentation) {
    virtualTours = new Array;
    _loadQueue = []
  };
  var drawMap = function(vt) {
    if(!gMlLoaded) {
      if(gMlLoading) {
        setTimeout(function() {
          drawMap(vt)
        }, 1E3);
        return
      }
      gMlLoading = true;
      V.Utils.Loader.loadGoogleLibrary("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places", function() {
        gMlLoaded = true;
        gMlLoading = false;
        drawMap(vt)
      });
      return
    }
    if(vt.type !== V.Constant.VTOUR) {
      return
    }
    if(typeof virtualTours[vt.id] != "undefined") {
      return
    }
    var canvas_id = V.Utils.getId(vt.id + "_canvas");
    var canvas = $("<div id='" + canvas_id + "' class='map_canvas' style='height:" + "100%" + "; width:" + "100%" + "'></div>");
    $("#" + vt.id).append(canvas);
    var latlng = new google.maps.LatLng(vt.center.lat, vt.center.lng);
    if(typeof virtualTours[vt.id] == "undefined") {
      virtualTours[vt.id] = new Object;
      virtualTours[vt.id].id = vt.id;
      virtualTours[vt.id].canvasId = canvas_id;
      virtualTours[vt.id].center = latlng;
      virtualTours[vt.id].zoom = parseInt(vt.zoom);
      virtualTours[vt.id].mapType = vt.mapType;
      virtualTours[vt.id].pois = new Array;
      virtualTours[vt.id].orgPois = vt.pois;
      virtualTours[vt.id].paths = []
    }
    var lqL = _loadQueue.length;
    for(var i = 0;i < lqL;i++) {
      if(_loadQueue[i] === vt.id) {
        loadMap(vt.id);
        _loadQueue.splice(_loadQueue.indexOf(vt.id), 1)
      }
    }
  };
  var loadMap = function(vtId) {
    var vt = virtualTours[vtId];
    if(typeof vt == "undefined") {
      _loadQueue.push(vtId);
      return
    }
    if(typeof vt.map != "undefined") {
      return
    }
    $("#" + vt.id).addClass("temp_shown");
    var canvasId = vt.canvasId;
    var myOptions = {zoom:vt.zoom, center:vt.center, mapTypeId:vt.mapType};
    var map = new google.maps.Map(document.getElementById(canvasId), myOptions);
    vt.map = map;
    $(vt.orgPois).each(function(index, poi) {
      vt.pois[poi.id] = poi;
      _addMarkerToCoordinates(vt, poi.lat, poi.lng, poi.id)
    });
    google.maps.event.addListenerOnce(map, "tilesloaded", function() {
      $("#" + vt.id).removeClass("temp_shown");
      google.maps.event.addListenerOnce(map, "tilesloaded", function() {
      })
    });
    google.maps.event.addDomListener(map, "idle", function() {
    });
    google.maps.event.addDomListener(window, "resize", function() {
    })
  };
  var _addMarkerToCoordinates = function(vt, lat, lng, poi_id) {
    return _addMarkerToPosition(vt, new google.maps.LatLng(lat, lng), poi_id)
  };
  var _addMarkerToPosition = function(vt, myLatlng, poi_id) {
    var marker = new google.maps.Marker({position:myLatlng, map:virtualTours[vt.id].map, draggable:false, poi_id:poi_id, title:"(" + myLatlng.lat().toFixed(3) + "," + myLatlng.lng().toFixed(3) + ")"});
    google.maps.event.addListener(marker, "click", function(event) {
      var poi = _getPoi(vt, marker.poi_id);
      V.Slides.openSubslide(poi.slide_id, true)
    });
    return marker
  };
  var _getPoi = function(vt, poiId) {
    if(typeof virtualTours[vt.id] !== "undefined" && typeof virtualTours[vt.id].pois[poiId] !== "undefined") {
      return virtualTours[vt.id].pois[poiId]
    }
  };
  var aftersetupSize = function(increase) {
  };
  var _getZoomForIncreaseDiff = function(zoom, increaseDiff) {
    var absIncreaseDiff = Math.floor(Math.abs(increaseDiff) / 0.3);
    if(increaseDiff > 0) {
      var newZoom = zoom + absIncreaseDiff
    }else {
      var newZoom = zoom - absIncreaseDiff
    }
    return Math.max(Math.min(newZoom, 20), 1)
  };
  var getVirtualTours = function() {
    return virtualTours
  };
  return{init:init, drawMap:drawMap, loadMap:loadMap, aftersetupSize:aftersetupSize, getVirtualTours:getVirtualTours}
}(VISH, jQuery);

