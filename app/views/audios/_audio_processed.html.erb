<div class="modal hide" id="audio-modal-<%= audio.id.to_s%>">
  <div class="modal-header"><h3 class="text-center"><%= truncate_name(audio.title, :length => 75) %></h3></div>
  <div class="modal-body text-center">
    <div id="full_audio_<%= dom_id audio %>" class="audio-full jp-audio">
      <div id="jpId<%= dom_id audio %>" class="jpId_size0 jp-jplayer"></div>
      <div class="jp-audio">
        <div class="jp-type-single">
          <div id="jp_interface_<%= dom_id audio %>" class="jp-interface">
            <ul class="jp-controls">
              <li>
                <a href="#" class="jp-play" tabindex="1">play</a>
              </li>
              <li>
                <a href="#" class="jp-pause" tabindex="1">pause</a>
              </li>
              <li>
                <a href="#" class="jp-stop" tabindex="1">stop</a>
              </li>
              <li>
                <a href="#" class="jp-mute" tabindex="1">mute</a>
              </li>
              <li>
                <a href="#" class="jp-unmute" tabindex="1">unmute</a>
              </li>
            </ul>
            <div class="jp-progress">
              <div class="jp-seek-bar">
                <div class="jp-play-bar"></div>
              </div>
            </div>
            <div class="jp-volume-bar">
              <div class="jp-volume-bar-value"></div>
            </div>
            <div class="jp-current-time"></div>
            <div class="jp-duration"></div>
          </div>
          <div id="jp_playlist_<%= dom_id audio %>" class="jp-playlist"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="menu_resources">
      <div class="verb_like" id="like_<%= dom_id(audio.activities.first) %>"><%= link_like(audio.activities.first, :size => :big)%></div>
    </div>
    <a href="#" class="btn btn-danger audio-modal-close-<%= audio.id.to_s%>" data-dismiss="modal"><%=t('close')%></a>
    <%= link_to t('details.msg'), audio, :class => "btn btn-success" %>
  </div>
</div>

<ul class="thumbnails">
  <li class="span3">
    <a data-toggle="modal" href="#audio-modal-<%= audio.id.to_s%>" class="container audio-modal-button-<%= audio.id.to_s%>"><%= thumb_for(audio, 75) %></a>
  </li>
  <li class="span9">
    <div class="title">
      <h4 class="bold">
        <a data-toggle="modal" href="#audio-modal-<%= audio.id.to_s%>" class="audio-modal-button-<%= audio.id.to_s%>"><%= truncate_name(audio.title, :length => 35) %></a>
      </h4>
    </div>
    <p><%= simple_format audio.description %></p>
    <p><%= link_to t('details.msg'), audio, :class => "attachment_text_link" %></p>
    <div class="audio-format-links">
      <%= link_to "WebMA", audio_path(audio, :format => :webma), :class => "audio-webma" %>
    </div>
  </li>
</ul>

<%= content_for :javascript do %>
  $(".audio-modal-button-<%= audio.id.to_s%>").on("click", function(){
    <% unless audio.file_processing %>
      $("#jpId<%=audio.id%>").jPlayer( {
        ready: function () {
          $(this).jPlayer("setMedia", {
            webma: "<%= audio_url(audio, :format => 'webma') %>" // Defines the webma url
          });
        },
        solution:"webma",
        preload: "none",
        swfPath: "assets",
        cssSelectorAncestor: "#jp_interface_<%=audio.id%>"
      });
    <% end %>
  });
  $(".audio-modal-close-<%= audio.id.to_s%>").on("click", function(){
    $("#jpId<%=audio.id%>").jPlayer('stop');
  });
<% end %>

