<ul class="thumbnails">
  <li class="span3">
    <a data-toggle="modal" href="#audio-modal-<%= audio.id.to_s%>" class="audio-modal-button-<%= audio.id.to_s%>"><i class='icon75-audio'></i></a>
  </li>
  <li class="span9">
    <div class="title">
      <h4 class="bold">
        <a data-toggle="modal" href="#audio-modal-<%= audio.id.to_s%>" class="audio-modal-button-<%= audio.id.to_s%>"><%= truncate_name(audio.title, :length => 35) %></a>
      </h4>
    </div>
    <p><%= simple_format audio.description %></p>
    <p><%= link_to t('details.msg'), audio, :class => "attachment_text_link" %></p>
    <div class="audio-format-links">
      <%= link_to "WebMA", audio_path(audio, :format => :webma), :class => "audio-webma" %>
    </div>
  </li>
</ul>

<%= content_for :javascript do %>
  $(".audio-modal-button-<%= audio.id.to_s%>").on("click", function(){
    Vish.Wall.getModal("audio", <%= audio.id.to_s %>, <%= audio.activities.first.id.to_s %>, <%= audio.activities.first.liked_by?(current_subject) ? "true" : "false" %>, "<%= raw j truncate_name(audio.title, :length => 75) %>");
    $("#jpId<%=audio.id%>").jPlayer( {
      ready: function () {
        $(this).jPlayer("setMedia", {
          webma: "<%= audio_url(audio, :format => 'webma') %>" // Defines the webma url
        });
      },
      solution:"webma",
      preload: "none",
      swfPath: "assets",
      cssSelectorAncestor: "#jp_interface_<%=audio.id%>"
    });
  });
  $(".audio-modal-close-<%= audio.id.to_s%>").on("click", function(){
    $("#jpId<%=audio.id%>").jPlayer('stop');
  });
<% end %>

