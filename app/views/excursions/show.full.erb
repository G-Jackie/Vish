<section class="slides layout-regular template-default">
      <button id="page-fullscreen" class="fullscreen" type="submit" style="border: none; background-color: transparent" tabindex="2"></button>
    </section>
    
    <div id="viewbar" class="viewbar" style="display:none">   
    <button id="page-switcher-start" class="page-switcher" tabindex="2"><</button>
      <div id="slide-counter"></div>
    <button id="page-switcher-end" class="page-switcher" tabindex="2" >></button>
    </div>
        
    <div style="display:none" id="viewerpreview">Preview</div>
    <button id="closeButton" style="display:none" ><img id="closeButtonImg" src="/assets/icons/back_icon.png"/></button>
    <button id="back_arrow" class="vish_arrow" style="display:none" tabindex="2"><</button>
    <button id="forward_arrow" class="vish_arrow" style="display:none" tabindex="2">></button>


<script>	
	options = {};
	var configuration = {};

	configuration["ImagesPath"] = "/assets/";
	configuration["StylesheetsPath"] = "/assets/";
	configuration["mode"] = "vish";
	options["configuration"] = configuration;
	options["full"] = true;
	options["developping"] = false;
	<% if @excursion %>
		options["fullscreen"] = "<%=excursion_path(@excursion, :format => :full)%>";
		<% if @orgUrl %>
			var orgUrl = "<%=@orgUrl%>";
			options["exitFullscreen"] = orgUrl;
		<% else %>
			options["exitFullscreen"] = "<%=excursion_path(@excursion)%>";
		<% end %>
	<% end %>
	<% if request && request.referrer %>
		options["comeBackUrl"] = "<%=request.referrer%>";
	<% end %>

	options["token"] = "<%= form_authenticity_token %>";
	options["lang"] = "<%= I18n.locale.to_s%>";

	<% if user_signed_in? %>
	    options["username"] = "<%= current_user.name %>";
	<% else %>
	    options["username"] = false;
	<% end %>

	options.addons = [];

	if(window.parent.loadIframeMessenger===true){
		var addon = new Object();
		addon.target = "Viewer";
		addon.id = "IframeMessenger";
		addon.url = "";
		addon.config = {enable: true};
		options.addons.push(addon);
	}

	if((window.parent.embed===true)||(typeof orgUrl !== "undefined")){
		options["embed"] = true;
	}

	function start(){
		var isPreview = false;
        try {
            isPreview = window.parent.VISH && 
            			window.parent.VISH.Editor && 
            			(typeof window.parent.VISH.Editor.Preview.getPreview == "function") && 
            			(typeof window.parent.VISH.Editor.Preview.getPreview() != 'undefined') &&
            			(window.parent.VISH.Editor.Preview.getPreview() != null);
        } catch(exception) {
            isPreview = false;
        }
        
		var myexcursion;

		if(isPreview){
			options["preview"] = true;
        	myexcursion =  window.parent.VISH.Editor.Preview.getPreview();
      	} else {
      		<% if @excursion %>
      			myexcursion = <%= raw @excursion.json %>;
      		<%else%>
      			myexcursion = null;
      		<%end%>
      	}

		VISH.SlideManager.init(options , myexcursion);
	}
</script>
