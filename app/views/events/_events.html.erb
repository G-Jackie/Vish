<% all_events = subject_events(profile_or_current_subject, {:scope => scope, :limit => 0, :page=> defined?(page) ? page : 0, :sort_by=> params[:sort_by]||(defined?(sort_by) ? sort_by : "popularity")}) %>
<% all_events.each do |event| %>
    <%= render :partial => 'events/event', :locals => { :event => event } %>
<% end %>

<script>
  $(document).ready(function(){
    if(typeof update_pageless_state == "function"){
      update_pageless_state("events", <%=all_events.num_pages%>, <%=all_events.current_page%>);
    }
    if(typeof re_apply_backstrech == "function"){
      re_apply_backstrech("events");
    }
  });
</script>

