<% all_events = subject_events(profile_or_current_subject, {:scope => scope, :limit => 0, :page=> page, :sort_by=> params[:sort_by]||sort_by||"popularity"}) %>
  <% all_events.each do |event| %>
      <%= render :partial => 'events/event', :locals => { :event => event } %>
  <% end %>

<script>
  $(document).ready(function(){
    update_pageless_state("events", <%=all_events.num_pages%>, <%=all_events.current_page%>);
    
    $('a[href="#tab2"]').on('shown', function (e) {
      $(".event").fitText(0.4);
    });    
  });

	function add_events_backstrech(){
    if(backstrech_items!=undefined){
		<% all_events.each do |event| %>
        backstrech_items.events["#event-<%=event.id%>"] = "<%=event_raw_thumbail(event)%>";
  		<% end %>
    }
	}

  add_events_backstrech();
</script>

