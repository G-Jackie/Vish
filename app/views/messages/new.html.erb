


<% content_for :title do %>
  <%=t('message.other')%>
<% end %>

<% sidebar %>

<% toolbar :messages %>

<%= location(
  link_to(t('message.other'), conversations_path,:remote => true),
  link_to(t('message.new'), new_message_path, :remote => true)
) %>



<% content_for :javascript do %>

 var recipients = $("#_recipients").fcbkcomplete({

json_url: "<%= contacts_path(:form => true, :format => :json) %>",
cache: true,
filter_hide: true,
newel: false,
height: 6
});  

//////////////
//Contacts
//////////////

var contactos = [];
var i = 0;

<%@user_contacts = current_user.sent_contacts %>
      <%@user_contacts.each do |contact| %>
       contactos[i]= "<%=contact.receiver.name %>";
       i++;
<%end%>


  $(document).keypress(function(e) {
  if(e.which == 13) {
  console.log("antes del for");

    var lista = $("ul.holder li:lt("+ contactos.length + ")");

	console.log("La lista es" + lista);

	console.log("El tama√±o de la lista es:" + lista.size());

	var ultimo = lista.size()-2;
	var ultimoo = ultimo + 1;
	console.log("Voy a ocultar el elemento... : " + ultimo);


	console.log("ya tendria que haberlo ocultado");

   var rel = $("ul.holder li:nth-child(" + ultimoo + ")").attr("rel");
   console.log("Rel es : " + rel);



  for(var j = 0; j<parseInt(ultimo); j++){
  console.log("hago caso a la pulsacion del enter");
  var q = j+1;
  	$("ul.holder li:nth-child(" + ultimoo + ")").hide();

   var comp = parseInt($("ul.holder li:nth-child(" + q + ")").attr("rel"));
   console.log("Comp es: " + comp);
   if(comp == rel){
   		console.log($("ul.holder li:nth-child(" + ultimoo + ")"));
        $("ul.holder li:nth-child(" + ultimoo + ")").remove();
        break;
  }
  		console.log("he entrado en comp!=rel");
  		$("ul.holder li:nth-child(" + ultimoo + ")").show();
  };
  }
  });









	$("#body").cleditor({
	    width:"100%",
	controls: "<%= SocialStream.cleditor_controls %>"
	});

<% unless @recipient.nil? %>
	initialTags:["receiver"],
	$("#_recipients").trigger("addItem",[{"title": "<%= truncate_name @recipient.name %>", "value": "<%= @recipient.id %>"}]);
<% end %>

  	$(".new_message").validate({errorClass: "validation_error"});


<% end %>


<%= render :partial => 'new' %>
<!-- $('#_recipients').find(".tagit-choice").attr("tagvalue");
This line returns the name  of the recipient  -->