<% profile_subject ||= current_subject %>

<% content_for :title do %>
  <%= "#{ profile_subject && profile_subject.name + ': ' }#{ t('repository.title') }" %>
<% end %>

<% sidebar %>

<% if profile_subject %>
  <%= location(
        link_to(profile_subject.name, polymorphic_path(profile_subject), :remote => true),
        link_to(t('repository.title'), polymorphic_path([profile_subject, controller.controller_name]), :remote => true)
      ) %>
<% else %>
  <%= location(
        link_to(t('repository.title'), polymorphic_path(controller.controller_name), :remote => true)
      ) %>
<% end %>

<% if profile_subject %>
  <% toolbar :profile, :subject => profile_subject %>
<% elsif user_signed_in? %>
  <% toolbar %>
<% end %>



<div id="new_file_only" class="">


<div class="menu_new_document tabbable">
<ul class="nav nav-tabs ">
<li class="active"><a data-toggle="tab" href="#docs-1"><i class="iconfile16-file16_file"></i>
<%= t('document.document') %></a></li>
<li> <a data-toggle="tab" href="#docs-2"> <i class="icontool16-tool16_html"></i>
  <%= t('links') %>
</a></li>
<li><a data-toggle="tab" href="#docs-3"><i class="iconfile16-tool16_embed"></i> <%= t('embed.embed') %>
</a></li>
</ul>
  </div>
  </div>


<!--menu type of resource-->
<div class="repository tabbable">
<div class="tab-content">
  <div id="docs-1" class="tab-pane active">

    <!--open file browser-->
    <div class="margin15">
      <% d = Document.new %>
      <% d.owner_id = Actor.normalize_id(current_user) %>
      <%= form_for d, :namespace => 'new_file_only', :remote => false do |f| %>
        <%= f.hidden_field :owner_id %>
        <%= f.file_field :file %>
    </div>

        <div id="new_file_only_wrapper">

          <!--Input (only for links/embed)-->
          <div id="input_wrapper" class="form_row margin15">
            <div class="form_field-new_document">
              <input type="text" name="embed" class="form_tag span4"></input>
            </div>
            <div class="form_label-new_document">
              <%= f.label Link %>
            </div>
          </div>



          <!--title-->
          <div class="form_row margin15">
            <div class="form_field-new_document">
              <%= f.text_field :title, :class => "form_tag span4" %>
            </div>
            <div class="form_label-new_document">
              <%= f.label t('document.info.title.title') %>
            </div>
          </div>

          <!--description-->
          <div class="form_row margin15">
            <div class="form_field-new_document">
              <%= f.text_area :description, :cols => 10, :rows => 10, :class => "form_tag span4" %>
            </div>
            <div class="form_label-new_document">
              <%= f.label t('document.info.description.title') %>
            </div>
          </div>


          <!--tags-->
          <%= f.hidden_field :tags %>

          <%@tags = ActivityObject.tag_counts(:limit => 100, :order => "count desc")%>
          <ul id="preloadTagList" style="display:none">
            <%@tags.each do |tag| %>
              <li><%=tag.name%></li>
            <%end%>
          </ul>

          <div class="clearfloat"></div>
          <div class="form_row ">
            <div class="tagBox span5">
              <ul class="tagList"></ul>
            </div>
          </div>

        </div>

        <!--btn-->
        <div class="clearfloat"></div>
        <div class="form-actions pagination-right space_right">
          <div class="actions center">
            <%= f.submit t('button.save'), :class => "button" %>
          </div>
        </div>

  </div>
  <div id="docs-2" class="tab-pane">  
  
                    <p>Morcilla</p>
  
  </div>
  <div id="docs-3" class="tab-pane">      </div>
</div>









     </div>
</div>

	<%= content_for :javascript do %>	
	  $(document).ready(function() {
		
	    $("#new_file_only_document_description").watermark(I18n.t('document.input'), "#666");
			
	    $('#new_file_only_document_file').change(function(){
	      $("#new_file_only_document_title").val($(this).val().replace(/C:\\fakepath\\/i, ''));
	    });

		  $("#input_wrapper").hide();	
			
	    //$('#new_file_only_document_file').trigger('click');
			
			
			//////////////
			// Link events
			/////////////

			
			var button = $("input[value='Save'][type='submit'][name='commit'].button");
			
			$(button).click(function(event) {
			  if(!validateForm()){
				  event.preventDefault();
					return false;
				}
			  var tagList = $(".tagList")
			  $("input[name='document[tags]']").val(Vish.Utils.convertToTagsArray($(tagList).tagit("tags")));
				<!-- Controller broken... (Provisional code) -->
				$("input[name='document[tags]']").attr("name","tagsHERE")
      });
			
			
			//////////////
			//Tags
			//////////////
			var tagList = $(".tagList");
			var tags = [];
			
			//Load tags
			$.each($("#preloadTagList li"), function(index, element) {
			   tags.push($(element).html());
			});
							
			if ($(tagList).children().length == 0){
	      $.each(tags, function(index, tag) {
	        if(index==2){
	          return false; //break the bucle
	        }
	        $(tagList).append("<li>" + tag + "</li>")
	      });
	    
		    $(tagList).tagit({tagSource:tags, sortable:true, maxLength:15, maxTags:8 , 
				  tagsChanged:function (tag, action) {
		        //tag==tagName
		        //action==["moved","added","popped" (remove)]
		      } 
		    });
	    }	
	  }); 
		
		function resetFields(){
		  $("#new_file_only_document_file").val("");
			$("input[name='embed']").val("")
			$("#new_file_only_document_description").val("");
			$("#new_file_only_document_title").val("");
			var tagList = $(".tagList");
			$(tagList).tagit("reset");
		}
		
		function validateForm(){
		  var fileVal = $("input[name='document[file]']").val();
		  var embedVal = $("input[name='embed']").val();
			if((fileVal.trim()=="")&&(embedVal.trim()=="")){
			  return false;
			}
			return true;
		}
		

	<% end %>
<% end %>

</div>