
<!-- Button to trigger modal -->
<div id="AddResource" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <%= render partial: 'help/help_resource_new' %>
        <h4><%= t('document.main_title')%></h4>
      </div>
      <div class="modal-body">
        <div class="layoutform">
        <!-- Tags preloaded -->
        <%@tags = ActivityObject.tag_counts(:limit => 100, :order => "count desc")%>
        <ul id="resourcePreloadTagList" style="display:none">
          <%@tags.each do |tag| %>
            <li><%=tag.name%></li>
          <%end%>
        </ul>

        <p><%= t('document.body.title1')%></p>

        <div class="panel-group" id="accordion1">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#document">
                  <i class="fa fa-folder-open"></i> <%= t('document.options.documents')%>
                </a>
              </h4>
            </div>

            <div id="document" class="panel-collapse collapse in">
              <div class="panel-body">
                <% d = Document.new %>
                <% d.owner_id = Actor.normalize_id(current_user) %>
                <%= form_for d, :namespace => 'new_file_only', :remote => false do |f| %>
                  <%= f.hidden_field :owner_id %>
                  <%= f.file_field :file %>
                  <%= f.hidden_field :title%>
                  <%= f.hidden_field :description%>
                  <%= f.hidden_field :tag_list, :multiple => true %>
                  <%= f.hidden_field :language, :value => "" %>
                  <%= f.hidden_field :age_min, :value => "4" %>
                  <%= f.hidden_field :age_max, :value => "20" %>
                  <%= f.submit t('button.save'), :class => "document hide"%>
                <% end %>
              </div>
            </div>
          </div>
          
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#link">
                  <i class="fa fa-link"></i> <%= t('document.options.links')%> 
                </a>
              </h4>
            </div>
            <div id="link" class="panel-collapse collapse">
              <div class="panel-body">
                <% d = Link.new %>
                <% d.owner_id = Actor.normalize_id(current_user) %>
                <%= form_for d, :namespace => 'new_file_only', :remote => false, :class => "form-group" do |f| %>
                  <%= f.hidden_field :owner_id %>
                  <%= f.hidden_field :callback_url %>
                  <%= f.hidden_field :loaded %>
                  <%#= f.hidden_field :image %>
                  <%= f.text_field :url %>
                  <%= f.hidden_field :title%>
                  <%= f.hidden_field :description%>
                  <%= f.hidden_field :tag_list, :multiple => true %>
                  <%= f.hidden_field :language, :value => "" %>
                  <%= f.hidden_field :age_min, :value => "4" %>
                  <%= f.hidden_field :age_max, :value => "20" %>
                  <%= f.submit t('button.save'), :class => "link hide"%>
                <% end %>
              </div>
            </div>
          </div>
          
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion3" href="#embed">
                  <i class="fa fa-code"></i> <%= t('document.options.embed')%> 
                </a>
              </h4>
            </div>
            <div id="embed" class="panel-collapse collapse">
              <div class="panel-body">
                <% d = Embed.new %>
                <% d.owner_id = Actor.normalize_id(current_user) %>
                <%= form_for d, :namespace => 'new_file_only', :remote => false, :class => "form-group" do |f| %>
                  <%= f.hidden_field :owner_id %>
                  <%#= f.hidden_field :image %>
                  <%= f.text_field :fulltext %>
                  <%= f.hidden_field :title%>
                  <%= f.hidden_field :description%>
                  <%= f.hidden_field :tag_list, :multiple => true %>
                  <%= f.hidden_field :language, :value => "" %>
                  <%= f.hidden_field :age_min, :value => "4" %>
                  <%= f.hidden_field :age_max, :value => "20" %>
                  <%= f.submit t('button.save'), :class => "embed hide"%>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      
        <form class="form-group layoutform">
          <p><%= t ('document.body.title2') %></p>
          <!--TITULO-->
          <label><%= t('document.leyend.title') %></label>
          <input type="text" class="form-control" placeholder="<%= t('document.title_input')%>">
          
          <!--DESCRIPCION-->
          <label><%= t('document.leyend.description')%></label>
          <textarea type="text" class="form-control" placeholder="<%= t('document.input')%>"></textarea>

          <!--TAGS-->
          <label><%= t('document.leyend.tags') %></label>

          <div class="tagBoxDocument">
             <ul class="resourceTagList"></ul>
          </div>
      <!--_______________________________-->
          <div class="clearfloat"></div>
          
          <!--LANGUAGE-->
          <label><%= t('document.leyend.language')%></label>
          <select class="language">
            <option value="" selected="1">(<%= t('lang.independent') %>)</option>
            <option value="de">Deutsch</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
            <option value="it">Italiano</option>
            <option value="pt">Português</option>
            <option value="ru">Русский</option>
            <option value="ot"><%= t('lang.others') %></option>
          </select>
          
          <!--AGE SLIDER-->
          <label><%= t('document.leyend.recommended_age') %></label>
          <div class="limits">
            <div class="limit1">4</div>
            <div class="limit2">20</div>
            <input type="text" class="age-slider" value="" data-slider-min="0" data-slider-max="30" data-slider-step="1" data-slider-value="[4,20]" data-slider-orientation="horizontal" data-slider-tooltip="hide"/>   
          </div>
          <br>
        </form>
        <!--TEST AGE SLIDER-->
        <b>4</b> <input type="text" class="slider" value="" data-slider-min="0" data-slider-max="20" data-slider-step="1" data-slider-orientation="horizontal" data-slider-value="[4,20]" style="width: 300px"/> <b>20</b>


      </div>
      </div>
      <div class="modal-footer">
        <input type="button" class="btn btn-primary" data-loading-text="<%= t('document.uploading')%>" value="<%= t('document.upload')%>"/>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- SCRIPTS -->
<!--TEST SCRIPT AGE SLIDER-->
<script type="text/javascript">
  $(".slider").slider({});
</script>

<script>
$(document).ready(function(){
  $('.helpResources').popover({ 
    html : true,
    content: function() {
      return $('.contentHelpResources').html();
    }
  });
});
</script>

<script>
  $("#AddResource").on('shown', function() {
    //SLIDER
    var min = 0;
    var max = 30;
    var step = 1;
    var diff = max - min;

    var positionLimits = function() {
      var value1 = $('.age-slider').data('slider').getValue()[0];
      var value2 = $('.age-slider').data('slider').getValue()[1];
      $('.limit1').text(value1);
      $('.limit2').text(value2);

      var percentage =[
        (value1-min)*100/diff,
        (value2-min)*100/diff,
        step*100/diff
      ];
      $(".limit1").css("left", function(ev) {
        return $('.slider').width() * percentage[0]/100 - $(".limit1").width()/2 + 'px';
      });
      $(".limit2").css("left", function(ev) {
        return $('.slider').width() * percentage[1]/100 - $(".limit2").width()/2 + 'px';
      });
    };

    $(".age-slider").slider()
      .on('slide', function(ev){
        positionLimits();
      });

    $(".age-slider").before($(".limits"));
    positionLimits();

  });
</script>

<script>
//COMMON FIELDS
  var uploadButton = $("input[value=<%= t('document.upload')%>][type='button'][class='btn btn-primary']");
  $(uploadButton).click(function(event) {
    var resource_type = $(".accordion-body.collapse.in").attr('id');
 
    if(resource_type == "document" && $("#AddResource input[name='"+resource_type+"[file]']").val() == "") {
      alert("<%= t('document.body.title3')%>");
    } else if (resource_type == "link" && $("#AddResource input[name='"+resource_type+"[url]']").val() == "") {
      alert("<%= t('link.title3')%>");
    } else if (resource_type == "embed" && $("#AddResource input[name='"+resource_type+"[fulltext]']").val() == "") {
      alert("<%= t('embed.title3')%>");
    } else if($(".title").val() == "") {
      alert("<%= t('document.title_alert')%>");
    } else {
      //TITLE
      $("#AddResource input[name='"+resource_type+"[title]']").val($(".title").val());
      //DESCRIPTION
      $("#AddResource input[name='"+resource_type+"[description]']").val($(".description").val());
      //TAGS
      var tagList = $("#AddResource .resourceTagList");
      $("#AddResource input[name='"+resource_type+"[tag_list][]']").val(Vish.Utils.convertToTagsArray($(tagList).tagit("tags")));
      //LANGUAGE
      $("#AddResource input[name='"+resource_type+"[language]']").val($(".language").val());
      //AGE
      var value1 = $('.age-slider').data('slider').getValue()[0];
      var value2 = $('.age-slider').data('slider').getValue()[1];
      $('input[name="'+resource_type+'[age_min]"]').val(value1);
      $('input[name="'+resource_type+'[age_max]"]').val(value2);

      $(this).button('loading');
      //SUBMIT
      $("input[value=<%= t('button.save') %>][type='submit'][name='commit'][class='"+resource_type+" hide']").click();
    }
  });
</script>

<script>
  var resourceTagList = $(".resourceTagList");
  var resourceTags = [];
  
  //Load tags
  $.each($("#resourcePreloadTagList li"), function(index, element) {
     resourceTags.push($(element).html());
  });
          
  if ($(resourceTagList).children().length == 0){
    // $.each($("#resourcePreloadUserTagList li"), function(index, element) {
    //    $(tagList).append("<li>" + $(element).html() + "</li>")
    // });

    $(resourceTagList).tagit({tagSource:resourceTags, sortable:true, maxLength:15, maxTags:8 , 
      watermarkAllowMessage: '<%=t('document.tags.addMessage')%>', watermarkDenyMessage: '<%=t('document.tags.limitMessage')%>' });
  } 
</script>

