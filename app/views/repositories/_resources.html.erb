<% all_resources = subject_resources(profile_or_current_subject, {:scope => scope, :limit => 0, :page=> page, :sort_by=> params[:sort_by]||sort_by||"popularity"}) %>
<% all_resources.each do |resource| %>
    <%= render :partial => 'repositories/resource', :locals => { :resource => resource.object } %>
<% end %> 

<script>
  $(document).ready(function(){
    update_pageless_state("resources", <%=all_resources.num_pages%>, <%=all_resources.current_page%>);

    $('a[href="#tab3"]').on('shown', function (e) {
      $(".resource").fitText(0.4);
    });    
  });
	
  function add_resources_backstrech(){
    if(typeof backstrech_items != "undefined"){
		  <% all_resources.each do |resource| %>
    		<%if resource.object.respond_to?(:type) && resource.object.type =="Picture"%>
            backstrech_items.resources["#document-<%=resource.object.id%>"] = "<%=resource.object.file%>?style=500";
    		<%end%>
  		<% end %> 
    }
	}

  add_resources_backstrech(); 

</script>

