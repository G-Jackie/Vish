<%= div_for link, :class => 'row-fluid' do %>
  <ul class="thumbnails">
    <li class="span3">
      <% if link.callback_url %><a data-toggle="modal" href="#link-modal-<%= link.id.to_s%>" class="link-modal-button-<%= link.id.to_s%>"><% else %><a href="<%= link.url %>" target="_blank" class="container"><% end %><% if link.image %><%= image_tag(link.image) %><% else %><i class='icon_repository75-75_link'></i> <% end %></a>
    </li>
    <li class="span9">
      <div class="title">
        <h4 class="bold">
          <% if link.callback_url %><a data-toggle="modal" href="#link-modal-<%= link.id.to_s%>" class="link-modal-button-<%= link.id.to_s%>"><% else %><a href="<%= link.url %>" target="_blank"><% end %><%= truncate_name(link.title, :length => 35) %></a>
        </h4>
      </div>
      <p><%= simple_format link.description %></p>
      <p><%= link_to t('details.msg'), link, :class => "attachment_text_link" %></p>
    </li>
  </ul>

  <%= javascript_tag do %>
    $(".link-modal-button-<%= link.id.to_s%>").on("click", function(){
      <%= modal_for(link) %>
      SocialStream.Linkser.Wall.openCallback("link-modal-body-<%= link.id.to_s %>", "<%= link.callback_url %>", "<%= link.width %>", "<%= link.height %>");
      $("#link-modal-<%= link.id.to_s%>").on("hidden", function(){
        $("#link-modal-<%= link.id.to_s%> .modal-body").html("<%= raw j image_tag('loading.gif', :class => :loading) %>");
      });
    });
  <% end %>

<% end %>

<div class="clearfloat"></div>
