<div class="boxy_white_edit block document_menu" id="document_edit"  >
  <%= form_for(document, :html => { :method => :put }) do |f| %>
  <% if document and document.errors.any? %>
  <%= javascript_tag do %>
    $(document).ready(function(){
      toggleDocumentEdit();
    });
  <% end %>
  <div class="error">
    <ul>
      <% document.errors.full_messages.each do |msg| %>
      <li>
        <%= msg %>
      </li>
      <% end %>
    </ul>
  </div>
  <% end %>
  <div class="form_row">
    <div class="form_label">
      <%= f.label t('document.info.title.title') %>
    </div>
    <div class="form_field">
      <%= f.text_field :title, :class => "form_tag" %>
    </div>
  </div>
  <div class="form_row">
    <div class="form_label">
      <%= f.label t('document.info.description.title') %>
    </div>
    <div class="form_field">
      <%= f.text_area :description, :class => "form_tag" %>
    </div>
  </div>
	
	<!-- Tags -->
	<!-- Preload tags -->
	<%@tags = ActivityObject.tag_counts(:limit => 100, :order => "count desc")%>
	<ul id="preloadTagList" style="display:none">
	  <%@tags.each do |tag| %>
	    <li><%=tag.name%></li>
	  <%end%>
	</ul>
		
  <div class="form_row">
    <div class="form_label">
      <%= f.label t('document.info.tags.title') %>
    </div>
    <div class="form_field">
      <%= f.hidden_field :tag_list, :class => "form_tag", :id => "input_tag_list" %>
	    <div class="tagBoxEdit span5">
        <ul class="tagList"></ul>
      </div>
    </div>
  </div>

  <div class="actions center">
    <%= f.submit t('button.save'), :class => "button" %>
  </div>
  <% end %>
</div>

<%= content_for :javascript do %>
  $(document).ready(function() {		
    var tagList = $(".tagList");
    var tags = [];
    
    //Load tags
    $.each($("#preloadTagList li"), function(index, element) {
       tags.push($(element).html());
    });
		
		//Add existin tags to the input
    var currentTags = $("#input_tag_list").val().split(",");
		$.each(currentTags, function(index, tag) {
		      if((typeof tag == "string")&&(tag != "")){
					  $(tagList).append("<li>" + tag + "</li>")
					}
    });       
    
    $(tagList).tagit({tagSource:tags, sortable:true, maxLength:15, maxTags:8 });
		
		//Fill tag_list hidden input before send
		 var button = $("input[value='Save'][type='submit'][name='commit'].button");
		 $(button).click(function(event) {
       var tagList = $(".tagList");
       $("#input_tag_list").val(Vish.Utils.convertToTagsArray($(tagList).tagit("tags")));
       return true;
     });
		
  }); 
<% end %>

<% if params[:editing].present? and params[:editing].eql?"true" and document.post_activity.edit_object_by?(current_subject) %>
  <%= javascript_tag do %>
    $(document).ready(function(){
      SocialStream.Repository.toggleDocumentMenu('edit');
    });
  <% end %>
<% end %>
